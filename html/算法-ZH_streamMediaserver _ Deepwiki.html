<!DOCTYPE html>
<html lang="en" class="dark" style="color-scheme: dark;"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="preload" href="https://deepwiki.com/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"><link rel="preload" href="https://deepwiki.com/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"><link rel="stylesheet" href="%E7%AE%97%E6%B3%95-ZH_streamMediaserver%20_%20Deepwiki_files/f30152c0704fba31.css" data-precedence="next"><link rel="stylesheet" href="%E7%AE%97%E6%B3%95-ZH_streamMediaserver%20_%20Deepwiki_files/69dc9a343a8d610c.css" data-precedence="next"><link rel="preload" as="script" fetchpriority="low" href="%E7%AE%97%E6%B3%95-ZH_streamMediaserver%20_%20Deepwiki_files/webpack-acbbbb548492d4a6.js"><script src="%E7%AE%97%E6%B3%95-ZH_streamMediaserver%20_%20Deepwiki_files/4bd1b696-cebf68b71ed1e85d.js" async=""></script><script src="%E7%AE%97%E6%B3%95-ZH_streamMediaserver%20_%20Deepwiki_files/1684-6bf7d92e9478c1cb.js" async=""></script><script src="%E7%AE%97%E6%B3%95-ZH_streamMediaserver%20_%20Deepwiki_files/main-app-8ab5af3d6b81086e.js" async=""></script><script src="%E7%AE%97%E6%B3%95-ZH_streamMediaserver%20_%20Deepwiki_files/page-25509e5272dc1f93.js" async=""></script><meta name="next-size-adjust" content=""><title>算法-ZH/streamMediaserver | Deepwiki</title><meta name="description" content="StreamMediaServer is a multimedia streaming system that supports multiple streaming protocols for live media distribution. This document introduces the system architecture, key components, and their i"><meta property="og:title" content="Algorithm-zh/StreamMediaServer | DeepWiki"><meta property="og:description" content="StreamMediaServer is a multimedia streaming system that supports multiple streaming protocols for live media distribution. This document introduces the system architecture, key components, and their i"><meta property="og:url" content="https://deepwiki.com/Algorithm-zh/StreamMediaServer"><meta property="og:site_name" content="DeepWiki"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Algorithm-zh/StreamMediaServer | DeepWiki"><meta name="twitter:description" content="StreamMediaServer is a multimedia streaming system that supports multiple streaming protocols for live media distribution. This document introduces the system architecture, key components, and their i"><link rel="icon" href="https://deepwiki.com/favicon.ico" type="image/x-icon" sizes="48x48"><link rel="icon" href="https://deepwiki.com/icon.png?66aaf51e0e68c818" type="image/png" sizes="16x16"><link rel="apple-touch-icon" href="https://deepwiki.com/apple-icon.png?a4f658907db0ab87" type="image/png" sizes="180x180"><script src="%E7%AE%97%E6%B3%95-ZH_streamMediaserver%20_%20Deepwiki_files/polyfills-42372ed130431b0a.js" nomodule=""></script><style type="text/css">[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}[data-sonner-toaster][data-lifted=true]{transform:translateY(-8px)}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}</style><script id="hotjar-init-script" crossorigin="anonymous">(function(h,o,t,j,a,r){h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};h._hjSettings={hjid:6382967,hjsv:6,hjdebug:false};a=o.getElementsByTagName('head')[0];r=o.createElement('script');r.async=1;r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;a.appendChild(r);})(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');</script><script async="" src="%E7%AE%97%E6%B3%95-ZH_streamMediaserver%20_%20Deepwiki_files/hotjar-6382967.js"></script><script async="" src="%E7%AE%97%E6%B3%95-ZH_streamMediaserver%20_%20Deepwiki_files/modules.e8a4a0ad0c33518716fb.js" charset="utf-8"></script><style data-title="这是由划词翻译创建的节点，用于控制全文翻译的译文样式。">hcfy-result{}.__hcfy-result-comparison__ hcfy-result-content {
  text-decoration: var(--hcfy-result-main-color, #008B45) underline;
  text-underline-offset: 0.2em;
  color: var(--hcfy-result-text-color, unset);
  font-size: var(--hcfy-result-text-size, unset);
  font-weight: var(--hcfy-result-text-weight, unset);
}

.__hcfy-result-editing__ hcfy-result-content {
  text-decoration: none;
}

.__hcfy-result-editing__ {
  outline: 2px solid #2d72d2;
  border-radius: 2px;
}

hcfy-result-content:focus {
  outline: none;
}

.__hcfy-result-comparison-inline__ hcfy-result-content {
  margin-left: 0.4em;
}</style></head><body class="__variable_5cfdac font-geist-sans relative min-h-screen __variable_9a8899 bg-background antialiased" style="overflow: auto;"><section aria-label="Notifications alt+T" tabindex="-1" aria-live="polite" aria-relevant="additions text" aria-atomic="false"></section><script>((e,t,r,n,a,o,i,s)=>{let u=document.documentElement,l=["light","dark"];function c(t){var r;(Array.isArray(e)?e:[e]).forEach(e=>{let r="class"===e,n=r&&o?a.map(e=>o[e]||e):a;r?(u.classList.remove(...n),u.classList.add(o&&o[t]?o[t]:t)):u.setAttribute(e,t)}),r=t,s&&l.includes(r)&&(u.style.colorScheme=r)}if(n)c(n);else try{let e=localStorage.getItem(t)||r,n=i&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;c(n)}catch(e){}})("class","theme","light",null,["light","dark"],null,true,true)</script><div class="flex min-h-screen w-full flex-col text-white" id="codebase-wiki-repo-page"><div class="bg-main border-b-border sticky top-0 z-30 border-b border-dashed"><div class="font-geist-mono relative flex h-8 items-center justify-center text-xs font-medium text-white sm:hidden"><div class="powered-by-devin-gradient absolute inset-0 z-[-1] h-8 w-full"></div><a target="_blank" rel="noopener noreferrer" class="flex items-center gap-2" href="https://devin.ai/"><svg class="size-3 [&amp;_path]:stroke-0 [&amp;_path]:animate-[custom-pulse_1.8s_infinite_var(--delay,0s)]" xmlns="http://www.w3.org/2000/svg" viewBox="110 110 460 500"><path style="fill:#21c19a" class="[--delay:0.6s]" d="M418.73,332.37c9.84-5.68,22.07-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.58,1.06.19.06.37.11.55.16.87.21,1.76.34,2.65.35.04,0,.08.02.13.02.1,0,.19-.03.29-.04.83-.02,1.64-.13,2.45-.32.14-.03.28-.05.42-.09.87-.24,1.7-.59,2.5-1.03.08-.04.17-.06.25-.1l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.06,5.68-31.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.57-1.06-.19-.06-.37-.11-.56-.16-.88-.21-1.76-.34-2.65-.34-.13,0-.26.02-.4.02-.84.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.24.1.8.44,1.64.79,2.5,1.03.14.04.28.06.42.09.81.19,1.62.3,2.45.32.1,0,.19.04.29.04.04,0,.08-.02.13-.02.89,0,1.77-.13,2.65-.35.19-.04.37-.1.56-.16.88-.26,1.75-.59,2.58-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-.08-.04-.16-.06-.24-.1-.8-.44-1.64-.8-2.51-1.04-.13-.04-.26-.05-.39-.09-.82-.2-1.65-.31-2.49-.33-.13,0-.25-.02-.38-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.75.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.07,5.68-31.9,0-9.84-5.68-15.95-16.27-15.95-27.63s6.11-21.95,15.95-27.63Z"></path><path style="fill:#3969ca" d="M141.09,317.65l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c.08-.04.13-.11.2-.16.78-.48,1.51-1.02,2.15-1.66.1-.1.18-.21.28-.31.57-.6,1.08-1.26,1.51-1.97.07-.12.15-.22.22-.34.44-.77.77-1.6,1.03-2.47.05-.19.1-.37.14-.56.22-.89.37-1.81.37-2.76v-29.43c0-11.36,6.11-21.95,15.96-27.63s22.06-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.57,1.06.19.06.37.11.56.16.87.21,1.76.34,2.64.35.04,0,.09.02.13.02.1,0,.19-.04.29-.04.83-.02,1.65-.13,2.45-.32.14-.03.28-.05.41-.09.87-.24,1.71-.6,2.51-1.04.08-.04.16-.06.24-.1l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.07,5.68-31.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.58-1.06-.19-.06-.37-.11-.55-.16-.88-.21-1.76-.34-2.65-.35-.13,0-.26.02-.4.02-.83.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22Z"></path><path style="fill:#0294de" class="[--delay:1.2s]" d="M396.88,484.35l-50.97-29.43c-.08-.04-.17-.06-.24-.1-.8-.44-1.64-.79-2.51-1.03-.14-.04-.27-.06-.41-.09-.81-.19-1.64-.3-2.47-.32-.13,0-.26-.02-.39-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.76.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.06,5.68-31.9,0-9.84-5.68-15.96-16.27-15.96-27.63v-29.43c0-.95-.15-1.87-.37-2.76-.05-.19-.09-.37-.14-.56-.25-.86-.59-1.69-1.03-2.47-.07-.12-.15-.22-.22-.34-.43-.71-.94-1.37-1.51-1.97-.1-.1-.18-.21-.28-.31-.65-.63-1.37-1.18-2.15-1.66-.07-.04-.13-.11-.2-.16l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.25.1.8.44,1.63.79,2.5,1.03.14.04.29.06.43.09.8.19,1.61.3,2.43.32.1,0,.2.04.3.04.04,0,.09-.02.13-.02.88,0,1.77-.13,2.64-.34.19-.04.37-.1.56-.16.88-.26,1.75-.59,2.57-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22Z"></path></svg>Powered by Devin<hcfy-result style="display: none;"></hcfy-result></a></div><div class="container-wrapper"><div class="container mx-auto flex w-full flex-row items-center gap-2 py-4 md:py-6"><a class="flex items-center gap-3" href="https://deepwiki.com/"><span class="text-base font-medium leading-none text-white md:text-lg hidden sm:block"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">Deepwiki</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a><div class="flex-1"><div class="flex flex-col gap-1"><a class="block text-xs font-medium leading-none text-white sm:hidden md:text-lg" href="https://deepwiki.com/">DeepWiki<hcfy-result style="display: none;"></hcfy-result></a><p class="text-text-secondary text-sm font-normal leading-none md:text-lg"><a href="https://github.com/Algorithm-zh/StreamMediaServer" target="_blank" rel="noopener noreferrer" class="text-[#8f8f8f] transition-colors hover:text-black dark:hover:text-white"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">算法-ZH/streamMediaserver</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></p></div></div><div class="flex items-center gap-4"><a href="https://devin.ai/" target="_blank" rel="noopener noreferrer" class="group hidden items-center gap-1.5 md:flex"><div class="relative"><span class="text-xs font-light text-white/70 transition-colors group-hover:text-white"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">供电</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span><div class="absolute bottom-0 left-0 h-[1px] w-0 bg-black/30 transition-all duration-300 group-hover:w-full dark:bg-white/30"></div></div><div class="flex items-center gap-1 transition-transform duration-300 group-hover:translate-x-0.5"><svg class="size-4 transform transition-transform duration-700 group-hover:rotate-180 [&amp;_path]:stroke-0" xmlns="http://www.w3.org/2000/svg" viewBox="110 110 460 500"><path style="fill:#21c19a" class="" d="M418.73,332.37c9.84-5.68,22.07-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.58,1.06.19.06.37.11.55.16.87.21,1.76.34,2.65.35.04,0,.08.02.13.02.1,0,.19-.03.29-.04.83-.02,1.64-.13,2.45-.32.14-.03.28-.05.42-.09.87-.24,1.7-.59,2.5-1.03.08-.04.17-.06.25-.1l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.06,5.68-31.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.57-1.06-.19-.06-.37-.11-.56-.16-.88-.21-1.76-.34-2.65-.34-.13,0-.26.02-.4.02-.84.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.24.1.8.44,1.64.79,2.5,1.03.14.04.28.06.42.09.81.19,1.62.3,2.45.32.1,0,.19.04.29.04.04,0,.08-.02.13-.02.89,0,1.77-.13,2.65-.35.19-.04.37-.1.56-.16.88-.26,1.75-.59,2.58-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-.08-.04-.16-.06-.24-.1-.8-.44-1.64-.8-2.51-1.04-.13-.04-.26-.05-.39-.09-.82-.2-1.65-.31-2.49-.33-.13,0-.25-.02-.38-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.75.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.07,5.68-31.9,0-9.84-5.68-15.95-16.27-15.95-27.63s6.11-21.95,15.95-27.63Z"></path><path style="fill:#3969ca" d="M141.09,317.65l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c.08-.04.13-.11.2-.16.78-.48,1.51-1.02,2.15-1.66.1-.1.18-.21.28-.31.57-.6,1.08-1.26,1.51-1.97.07-.12.15-.22.22-.34.44-.77.77-1.6,1.03-2.47.05-.19.1-.37.14-.56.22-.89.37-1.81.37-2.76v-29.43c0-11.36,6.11-21.95,15.96-27.63s22.06-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.57,1.06.19.06.37.11.56.16.87.21,1.76.34,2.64.35.04,0,.09.02.13.02.1,0,.19-.04.29-.04.83-.02,1.65-.13,2.45-.32.14-.03.28-.05.41-.09.87-.24,1.71-.6,2.51-1.04.08-.04.16-.06.24-.1l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.07,5.68-31.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.58-1.06-.19-.06-.37-.11-.55-.16-.88-.21-1.76-.34-2.65-.35-.13,0-.26.02-.4.02-.83.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22Z"></path><path style="fill:#0294de" class="" d="M396.88,484.35l-50.97-29.43c-.08-.04-.17-.06-.24-.1-.8-.44-1.64-.79-2.51-1.03-.14-.04-.27-.06-.41-.09-.81-.19-1.64-.3-2.47-.32-.13,0-.26-.02-.39-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.76.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.06,5.68-31.9,0-9.84-5.68-15.96-16.27-15.96-27.63v-29.43c0-.95-.15-1.87-.37-2.76-.05-.19-.09-.37-.14-.56-.25-.86-.59-1.69-1.03-2.47-.07-.12-.15-.22-.22-.34-.43-.71-.94-1.37-1.51-1.97-.1-.1-.18-.21-.28-.31-.65-.63-1.37-1.18-2.15-1.66-.07-.04-.13-.11-.2-.16l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.25.1.8.44,1.63.79,2.5,1.03.14.04.29.06.43.09.8.19,1.61.3,2.43.32.1,0,.2.04.3.04.04,0,.09-.02.13-.02.88,0,1.77-.13,2.64-.34.19-.04.37-.1.56-.16.88-.26,1.75-.59,2.57-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22Z"></path></svg><span class="text-sm font-medium text-white"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">德文</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></div></a><button class="border-border bg-surface hover:border-border-hover hover:bg-component ml-auto flex cursor-pointer items-center gap-1.5 rounded-md border px-3 py-1.5 text-sm font-medium text-white transition-all" aria-label="Share"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg><span><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">分享</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></button><button class="hover:bg-surface-hover flex h-8 w-8 cursor-pointer items-center justify-center rounded-md transition-colors" aria-label="Switch to light mode"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-5 w-5 text-gray-300"><path d="M120,40V16a8,8,0,0,1,16,0V40a8,8,0,0,1-16,0Zm8,24a64,64,0,1,0,64,64A64.07,64.07,0,0,0,128,64ZM58.34,69.66A8,8,0,0,0,69.66,58.34l-16-16A8,8,0,0,0,42.34,53.66Zm0,116.68-16,16a8,8,0,0,0,11.32,11.32l16-16a8,8,0,0,0-11.32-11.32ZM192,72a8,8,0,0,0,5.66-2.34l16-16a8,8,0,0,0-11.32-11.32l-16,16A8,8,0,0,0,192,72Zm5.66,114.34a8,8,0,0,0-11.32,11.32l16,16a8,8,0,0,0,11.32-11.32ZM48,128a8,8,0,0,0-8-8H16a8,8,0,0,0,0,16H40A8,8,0,0,0,48,128Zm80,80a8,8,0,0,0-8,8v24a8,8,0,0,0,16,0V216A8,8,0,0,0,128,208Zm112-88H216a8,8,0,0,0,0,16h24a8,8,0,0,0,0-16Z"></path></svg></button></div></div></div></div><!--$--><div class="w-full flex-1"><div class="container-wrapper relative mx-auto h-full px-0"><div class="container relative mx-auto flex h-full w-full flex-col gap-0 max-md:!px-0 md:flex-row md:gap-6 lg:gap-10"><div class="border-r-border hidden max-h-screen border-r border-dashed py-7 pr-4 transition-[border-radius] md:sticky md:left-0 md:top-20 md:block md:h-[calc(100vh-82px)] md:w-64 md:flex-shrink-0 md:overflow-y-auto lg:py-9 xl:w-72"><div class="flex h-full w-full max-w-full flex-shrink-0 flex-col overflow-hidden" style="scrollbar-color:var(--color-border) transparent"><div class="flex-shrink-0 px-2"><div class="text-secondary pb-1 text-xs"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">最后更新：2025年4月30日（99517F）</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></div></div><ul class="flex-1 flex-shrink-0 space-y-1 overflow-y-auto py-1" style="scrollbar-width:none"><li style="padding-left:0"><a data-selected="true" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/1-streammediaserver-overview"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">StreamMediaserver概述</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/1.1-architecture-overview"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">体系结构概述</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/1.2-build-system"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">构建系统</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/2-network-layer"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">网络层</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/2.1-event-loop-system"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">事件循环系统</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/2.2-tcp-server-and-client"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">TCP服务器和客户端</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/2.3-dns-service"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">DNS服务</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/3-media-processing-system"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">媒体处理系统</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/3.1-rtmp-protocol-implementation"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">RTMP协议实现</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/3.2-http-protocol-implementation"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">HTTP协议实现</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/3.3-media-demuxing"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">媒体脱去</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/4-live-streaming-system"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">实时流媒体系统</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/4.1-liveservice"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">生命服务</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/4.2-session-management"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">会话管理</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/4.3-user-management"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">用户管理</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/4.4-stream-and-gop-management"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">流和共和党管理</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/5-configuration-and-logging"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">配置和记录</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/5.1-configuration-system"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">配置系统</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="https://deepwiki.com/Algorithm-zh/StreamMediaServer/5.2-logging-system"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">记录系统</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li></ul></div></div><div class="flex h-full flex-1 flex-col overflow-hidden"><div class="bg-main border-b-border sticky top-0 z-10 border-b border-dashed md:hidden"><div class="flex cursor-pointer items-center gap-2 p-3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="transition-transform"><path d="M184.49,136.49l-80,80a12,12,0,0,1-17-17L159,128,87.51,56.49a12,12,0,1,1,17-17l80,80A12,12,0,0,1,184.49,136.49Z"></path></svg><span class="truncate text-base font-normal">Menu<hcfy-result style="display: none;"></hcfy-result></span></div></div><div class="relative flex-1 overflow-y-auto px-3 pt-3 md:rounded-md md:px-0 md:pt-0 [&amp;_::selection]:bg-purple-500/40" style="scrollbar-color:var(--color-night) transparent"><div class="pb-30 mx-auto max-w-2xl md:pb-40 md:pt-6 lg:pt-8"><div class="prose prose-invert dark:prose-invert prose-headings:text-inherit prose-p:text-inherit max-w-none"><div><div class="prose-custom prose-custom-md prose-custom-gray !max-w-none text-neutral-300 [overflow-wrap:anywhere]"><h1 id="streammediaserver-overview" class="group flex items-center" data-header="true"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">StreamMediaserver概述</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h1>
<details>
<summary><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">相关源文件</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></summary>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">以下文件用作生成此Wiki页面的上下文：</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<ul>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/CMakeLists.txt" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">cmakelists.txt</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/bin/config/publish/hx.com.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">bin/config/publish/hx.com.json</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/bin/log/tmms.log" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">bin/log/tmms.log</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/src/CMakeLists.txt" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">src/cmakelists.txt</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/src/base/FileLog.cc" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">src/base/filelog.cc</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/src/base/LogStream.cc" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">src/base/logstream.cc</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/src/base/Logger.cc" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">src/base/logger.cc</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/src/base/Logger.h" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">src/base/logger.h</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/src/live/LiveService.cc" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">src/live/liveservice.cc</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/src/main/CMakeLists.txt" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">src/main/cmakelists.txt</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/src/main/TestLog.cc" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">src/main/testlog.cc</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/src/main/main.cc" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">src/main/main.cc</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/src/mmedia/http/HttpRequest.cc" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">src/mmedia/http/httprequest.cc</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/src/mmedia/http/HttpServer.cc" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">src/mmedia/http/httpserver.cc</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
<li><a href="https://github.com/Algorithm-zh/StreamMediaServer/blob/99517f48/src/mmedia/http/HttpServer.h" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">src/mmedia/http/httpserver.h</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></span></a></li>
</ul>
</details>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">StreamMediaserver是一个多媒体流媒体系统，它支持用于实时媒体发行的多个流媒体协议。本文档介绍了系统体系结构，关键组件及其交互。</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<h2 id="purpose-and-scope" class="group flex items-center" data-header="true"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">目的和范围</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h2>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">StreamMediaserver旨在接收来自发布者的媒体流并实时分发给多个观众。它支持各种流媒体协议，包括RTMP（实时消息协议），HTTP/FLV（HTTP上的Flash Video）和HLS（HTTP Live Streaming）。</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">此页面提供了整个系统的高级概述。有关特定组件的详细信息：</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<ul>
<li><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">有关网络层详细信息，请参阅网络层</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></li>
<li><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">有关媒体处理详细信息，请参阅媒体处理系统</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></li>
<li><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">有关实时流媒体功能，请参见实时流媒体系统</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></li>
<li><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">有关配置和记录，请参阅配置和记录</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></li>
</ul>
<h2 id="system-architecture" class="group flex items-center" data-header="true"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">系统体系结构</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h2>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">StreamMediaserver采用模块化，事件驱动的体系结构构建，旨在高性能和可扩展性。该系统分为几层，共同提供媒体流服务。</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><div class="group relative cursor-pointer overflow-x-auto rounded-md bg-[#f2f1f0] p-4 transition-colors hover:bg-[#ededed] dark:bg-[#1f1f1f] dark:hover:bg-[#242424]" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«r0»" data-state="closed"><div class="flex justify-center"><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1258.2041015625 790" style="max-width: 1258.2041015625px;" class="flowchart" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-2wuxlyneir7"><style>#mermaid-2wuxlyneir7{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-2wuxlyneir7 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-2wuxlyneir7 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-2wuxlyneir7 .error-icon{fill:#333;}#mermaid-2wuxlyneir7 .error-text{fill:#cccccc;stroke:#cccccc;}#mermaid-2wuxlyneir7 .edge-thickness-normal{stroke-width:1px;}#mermaid-2wuxlyneir7 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-2wuxlyneir7 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-2wuxlyneir7 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-2wuxlyneir7 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-2wuxlyneir7 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-2wuxlyneir7 .marker{fill:#666;stroke:#666;}#mermaid-2wuxlyneir7 .marker.cross{stroke:#666;}#mermaid-2wuxlyneir7 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-2wuxlyneir7 p{margin:0;}#mermaid-2wuxlyneir7 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#fff;}#mermaid-2wuxlyneir7 .cluster-label text{fill:#fff;}#mermaid-2wuxlyneir7 .cluster-label span{color:#fff;}#mermaid-2wuxlyneir7 .cluster-label span p{background-color:transparent;}#mermaid-2wuxlyneir7 .label text,#mermaid-2wuxlyneir7 span{fill:#fff;color:#fff;}#mermaid-2wuxlyneir7 .node rect,#mermaid-2wuxlyneir7 .node circle,#mermaid-2wuxlyneir7 .node ellipse,#mermaid-2wuxlyneir7 .node polygon,#mermaid-2wuxlyneir7 .node path{fill:#111;stroke:#222;stroke-width:1px;}#mermaid-2wuxlyneir7 .rough-node .label text,#mermaid-2wuxlyneir7 .node .label text,#mermaid-2wuxlyneir7 .image-shape .label,#mermaid-2wuxlyneir7 .icon-shape .label{text-anchor:middle;}#mermaid-2wuxlyneir7 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-2wuxlyneir7 .rough-node .label,#mermaid-2wuxlyneir7 .node .label,#mermaid-2wuxlyneir7 .image-shape .label,#mermaid-2wuxlyneir7 .icon-shape .label{text-align:center;}#mermaid-2wuxlyneir7 .node.clickable{cursor:pointer;}#mermaid-2wuxlyneir7 .root .anchor path{fill:#666!important;stroke-width:0;stroke:#666;}#mermaid-2wuxlyneir7 .arrowheadPath{fill:#0b0b0b;}#mermaid-2wuxlyneir7 .edgePath .path{stroke:#666;stroke-width:2.0px;}#mermaid-2wuxlyneir7 .flowchart-link{stroke:#666;fill:none;}#mermaid-2wuxlyneir7 .edgeLabel{background-color:#161616;text-align:center;}#mermaid-2wuxlyneir7 .edgeLabel p{background-color:#161616;}#mermaid-2wuxlyneir7 .edgeLabel rect{opacity:0.5;background-color:#161616;fill:#161616;}#mermaid-2wuxlyneir7 .labelBkg{background-color:rgba(22, 22, 22, 0.5);}#mermaid-2wuxlyneir7 .cluster rect{fill:#161616;stroke:#222;stroke-width:1px;}#mermaid-2wuxlyneir7 .cluster text{fill:#fff;}#mermaid-2wuxlyneir7 .cluster span{color:#fff;}#mermaid-2wuxlyneir7 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:#333;border:1px solid hsl(0, 0%, 10%);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-2wuxlyneir7 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-2wuxlyneir7 rect.text{fill:none;stroke-width:0;}#mermaid-2wuxlyneir7 .icon-shape,#mermaid-2wuxlyneir7 .image-shape{background-color:#161616;text-align:center;}#mermaid-2wuxlyneir7 .icon-shape p,#mermaid-2wuxlyneir7 .image-shape p{background-color:#161616;padding:2px;}#mermaid-2wuxlyneir7 .icon-shape rect,#mermaid-2wuxlyneir7 .image-shape rect{opacity:0.5;background-color:#161616;fill:#161616;}#mermaid-2wuxlyneir7 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-2wuxlyneir7_flowchart-v2-pointEnd"><path style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-2wuxlyneir7_flowchart-v2-pointStart"><path style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-2wuxlyneir7_flowchart-v2-circleEnd"><circle style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-2wuxlyneir7_flowchart-v2-circleStart"><circle style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid-2wuxlyneir7_flowchart-v2-crossEnd"><path style="stroke-width: 2px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid-2wuxlyneir7_flowchart-v2-crossStart"><path style="stroke-width: 2px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"><g data-look="classic" id="subGraph4" class="cluster"><rect height="337" width="237.98333740234375" y="291" x="8" style=""></rect><g transform="translate(73.7750015258789, 291)" class="cluster-label"><foreignObject height="24" width="106.43333435058594"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Network Layer</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph3" class="cluster"><rect height="104" width="606.25" y="678" x="643.954174041748" style=""></rect><g transform="translate(903.1291770935059, 678)" class="cluster-label"><foreignObject height="24" width="87.89999389648438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Media Layer</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph2" class="cluster"><rect height="337" width="480.4958305358887" y="291" x="717.979175567627" style=""></rect><g transform="translate(910.4020938873291, 291)" class="cluster-label"><foreignObject height="24" width="95.64999389648438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Service Layer</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph1" class="cluster"><rect height="233" width="431.9958381652832" y="162" x="265.98333740234375" style=""></rect><g transform="translate(429.37292671203613, 162)" class="cluster-label"><foreignObject height="24" width="105.21665954589844"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Protocol Layer</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph0" class="cluster"><rect height="104" width="466.68333435058594" y="8" x="233.45417404174805" style=""></rect><g transform="translate(423.7458381652832, 8)" class="cluster-label"><foreignObject height="24" width="86.10000610351562"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Client Layer</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_PC_RS_0" d="M359.396,87L359.396,91.167C359.396,95.333,359.396,103.667,359.396,112C359.396,120.333,359.396,128.667,359.396,137C359.396,145.333,359.396,153.667,360.406,161.359C361.416,169.052,363.436,176.103,364.446,179.629L365.456,183.155"></path><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_VC_RS_0" d="M532.489,87L524.735,91.167C516.98,95.333,501.471,103.667,493.717,112C485.963,120.333,485.963,128.667,485.963,137C485.963,145.333,485.963,153.667,477.619,161.719C469.275,169.77,452.588,177.541,444.244,181.426L435.901,185.311"></path><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_VC_HS_0" d="M587.93,87L588.731,91.167C589.532,95.333,591.135,103.667,591.936,112C592.738,120.333,592.738,128.667,592.738,137C592.738,145.333,592.738,153.667,592.738,161.333C592.738,169,592.738,176,592.738,179.5L592.738,183"></path><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_RS_LS_0" d="M447.6,228.602L478.893,234.835C510.186,241.068,572.772,253.534,604.065,263.934C635.358,274.333,635.358,282.667,674.76,293.419C714.161,304.171,792.964,317.341,832.366,323.926L871.767,330.512"></path><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_HS_LS_0" d="M625.252,241L630.27,245.167C635.288,249.333,645.323,257.667,650.341,266C655.358,274.333,655.358,282.667,691.428,293.276C727.497,303.885,799.636,316.77,835.705,323.213L871.775,329.655"></path><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_HS_FC_0" d="M592.738,241L592.738,245.167C592.738,249.333,592.738,257.667,592.738,266C592.738,274.333,592.738,282.667,592.738,290.333C592.738,298,592.738,305,592.738,308.5L592.738,312"></path><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_LS_SS_0" d="M946.488,370L946.488,374.167C946.488,378.333,946.488,386.667,946.488,395C946.488,403.333,946.488,411.667,946.488,419.333C946.488,427,946.488,434,946.488,437.5L946.488,441"></path><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_SS_ST_0" d="M946.488,499L946.488,503.167C946.488,507.333,946.488,515.667,946.488,523.333C946.488,531,946.488,538,946.488,541.5L946.488,545"></path><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_ST_CH_0" d="M890.379,591.477L868.313,597.565C846.246,603.652,802.113,615.826,780.046,626.08C757.979,636.333,757.979,644.667,757.979,653C757.979,661.333,757.979,669.667,757.979,677.333C757.979,685,757.979,692,757.979,695.5L757.979,699"></path><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_ST_GM_0" d="M946.488,603L946.488,607.167C946.488,611.333,946.488,619.667,946.488,628C946.488,636.333,946.488,644.667,946.488,653C946.488,661.333,946.488,669.667,946.488,677.333C946.488,685,946.488,692,946.488,695.5L946.488,699"></path><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_ST_PB_0" d="M1002.596,591.429L1024.761,597.524C1046.926,603.619,1091.257,615.81,1113.422,626.072C1135.588,636.333,1135.588,644.667,1135.588,653C1135.588,661.333,1135.588,669.667,1135.588,677.333C1135.588,685,1135.588,692,1135.588,695.5L1135.588,699"></path><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_RS_TS_0" d="M374.292,241L374.292,245.167C374.292,249.333,374.292,257.667,374.292,266C374.292,274.333,374.292,282.667,344.722,293.051C315.152,303.435,256.012,315.871,226.443,322.088L196.873,328.306"></path><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_HS_TS_0" d="M542.489,241L534.735,245.167C526.98,249.333,511.471,257.667,503.717,266C495.963,274.333,495.963,282.667,446.122,293.857C396.281,305.048,296.6,319.097,246.76,326.121L196.919,333.145"></path><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_TS_TC_0" d="M126.992,370L126.992,374.167C126.992,378.333,126.992,386.667,126.992,395C126.992,403.333,126.992,411.667,126.992,419.333C126.992,427,126.992,434,126.992,437.5L126.992,441"></path><path marker-end="url(#mermaid-2wuxlyneir7_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_TC_EL_0" d="M126.992,499L126.992,503.167C126.992,507.333,126.992,515.667,126.992,523.333C126.992,531,126.992,538,126.992,541.5L126.992,545"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(359.3958396911621, 60)" id="flowchart-PC-0" class="node default"><rect height="54" width="181.88333129882812" y="-27" x="-90.94166564941406" style="" class="basic label-container"></rect><g transform="translate(-60.94166564941406, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="121.88333129882812"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Publisher Clients</p></span></div></foreignObject></g></g><g transform="translate(582.7375068664551, 60)" id="flowchart-VC-1" class="node default"><rect height="54" width="164.8000030517578" y="-27" x="-82.4000015258789" style="" class="basic label-container"></rect><g transform="translate(-52.400001525878906, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="104.80000305175781"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Viewer Clients</p></span></div></foreignObject></g></g><g transform="translate(374.2916717529297, 214)" id="flowchart-RS-2" class="node default"><rect height="54" width="146.61666870117188" y="-27" x="-73.30833435058594" style="" class="basic label-container"></rect><g transform="translate(-43.30833435058594, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="86.61666870117188"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>RtmpServer</p></span></div></foreignObject></g></g><g transform="translate(592.7375068664551, 214)" id="flowchart-HS-3" class="node default"><rect height="54" width="140.48333740234375" y="-27" x="-70.24166870117188" style="" class="basic label-container"></rect><g transform="translate(-40.241668701171875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.48333740234375"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>HttpServer</p></span></div></foreignObject></g></g><g transform="translate(592.7375068664551, 343)" id="flowchart-FC-4" class="node default"><rect height="54" width="139.13333129882812" y="-27" x="-69.56666564941406" style="" class="basic label-container"></rect><g transform="translate(-39.56666564941406, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="79.13333129882812"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>FlvContext</p></span></div></foreignObject></g></g><g transform="translate(946.4875068664551, 343)" id="flowchart-LS-5" class="node default"><rect height="54" width="141.5500030517578" y="-27" x="-70.7750015258789" style="" class="basic label-container"></rect><g transform="translate(-40.775001525878906, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="81.55000305175781"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>LiveService</p></span></div></foreignObject></g></g><g transform="translate(946.4875068664551, 472)" id="flowchart-SS-6" class="node default"><rect height="54" width="114.39999389648438" y="-27" x="-57.19999694824219" style="" class="basic label-container"></rect><g transform="translate(-27.199996948242188, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="54.399993896484375"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Session</p></span></div></foreignObject></g></g><g transform="translate(946.4875068664551, 576)" id="flowchart-ST-7" class="node default"><rect height="54" width="112.21665954589844" y="-27" x="-56.10832977294922" style="" class="basic label-container"></rect><g transform="translate(-26.10832977294922, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="52.21665954589844"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Stream</p></span></div></foreignObject></g></g><g transform="translate(757.979175567627, 730)" id="flowchart-CH-8" class="node default"><rect height="54" width="158.0500030517578" y="-27" x="-79.0250015258789" style="" class="basic label-container"></rect><g transform="translate(-49.025001525878906, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="98.05000305175781"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>CodecHeader</p></span></div></foreignObject></g></g><g transform="translate(946.4875068664551, 730)" id="flowchart-GM-9" class="node default"><rect height="54" width="118.96665954589844" y="-27" x="-59.48332977294922" style="" class="basic label-container"></rect><g transform="translate(-29.48332977294922, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="58.96665954589844"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>GopMgr</p></span></div></foreignObject></g></g><g transform="translate(1135.5875053405762, 730)" id="flowchart-PB-10" class="node default"><rect height="54" width="159.23333740234375" y="-27" x="-79.61666870117188" style="" class="basic label-container"></rect><g transform="translate(-49.616668701171875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="99.23333740234375"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Packet Buffer</p></span></div></foreignObject></g></g><g transform="translate(126.99166870117188, 343)" id="flowchart-TS-11" class="node default"><rect height="54" width="131.93333435058594" y="-27" x="-65.96666717529297" style="" class="basic label-container"></rect><g transform="translate(-35.96666717529297, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="71.93333435058594"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>TcpServer</p></span></div></foreignObject></g></g><g transform="translate(126.99166870117188, 472)" id="flowchart-TC-12" class="node default"><rect height="54" width="167.98333740234375" y="-27" x="-83.99166870117188" style="" class="basic label-container"></rect><g transform="translate(-53.991668701171875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="107.98333740234375"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>TcpConnection</p></span></div></foreignObject></g></g><g transform="translate(126.99166870117188, 576)" id="flowchart-EL-13" class="node default"><rect height="54" width="137.5" y="-27" x="-68.75" style="" class="basic label-container"></rect><g transform="translate(-38.75, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="77.5"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>EventLoop</p></span></div></foreignObject></g></g></g></g></g></svg></div><div class="bg-input-dark absolute right-2 top-2 rounded-sm p-1 opacity-0 transition-opacity group-hover:opacity-100"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="light:text-gray-800 text-white dark:text-white"><path d="M216,48V96a8,8,0,0,1-16,0V67.31l-42.34,42.35a8,8,0,0,1-11.32-11.32L188.69,56H160a8,8,0,0,1,0-16h48A8,8,0,0,1,216,48ZM98.34,146.34,56,188.69V160a8,8,0,0,0-16,0v48a8,8,0,0,0,8,8H96a8,8,0,0,0,0-16H67.31l42.35-42.34a8,8,0,0,0-11.32-11.32ZM208,152a8,8,0,0,0-8,8v28.69l-42.34-42.35a8,8,0,0,0-11.32,11.32L188.69,200H160a8,8,0,0,0,0,16h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152ZM67.31,56H96a8,8,0,0,0,0-16H48a8,8,0,0,0-8,8V96a8,8,0,0,0,16,0V67.31l42.34,42.35a8,8,0,0,0,11.32-11.32Z"></path></svg></div></div></pre>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">资料来源：
src/live/liveservice.cc
1-376
src/mmedia/http/httpserver.h
1-32
src/mmedia/http/httpserver.cc
1-90</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<h2 id="key-components" class="group flex items-center" data-header="true"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">关键组件</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h2>
<h3 id="liveservice" class="group flex items-center" data-header="true"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">生命服务</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h3>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">Liveservice是系统的中心协调员，管理流媒体会议并处理媒体流的生命周期。</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><div class="group relative cursor-pointer overflow-x-auto rounded-md bg-[#f2f1f0] p-4 transition-colors hover:bg-[#ededed] dark:bg-[#1f1f1f] dark:hover:bg-[#242424]" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«r3»" data-state="closed"><div class="flex justify-center"><svg aria-roledescription="class" role="graphics-document document" viewBox="0 0 400.2916564941406 1052" style="max-width: 400.2916564941406px;" class="classDiagram" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-9fjaq5n8tgk"><style>#mermaid-9fjaq5n8tgk{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-9fjaq5n8tgk .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-9fjaq5n8tgk .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-9fjaq5n8tgk .error-icon{fill:#333;}#mermaid-9fjaq5n8tgk .error-text{fill:#cccccc;stroke:#cccccc;}#mermaid-9fjaq5n8tgk .edge-thickness-normal{stroke-width:1px;}#mermaid-9fjaq5n8tgk .edge-thickness-thick{stroke-width:3.5px;}#mermaid-9fjaq5n8tgk .edge-pattern-solid{stroke-dasharray:0;}#mermaid-9fjaq5n8tgk .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-9fjaq5n8tgk .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-9fjaq5n8tgk .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-9fjaq5n8tgk .marker{fill:#666;stroke:#666;}#mermaid-9fjaq5n8tgk .marker.cross{stroke:#666;}#mermaid-9fjaq5n8tgk svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-9fjaq5n8tgk p{margin:0;}#mermaid-9fjaq5n8tgk g.classGroup text{fill:#222;stroke:none;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:10px;}#mermaid-9fjaq5n8tgk g.classGroup text .title{font-weight:bolder;}#mermaid-9fjaq5n8tgk .nodeLabel,#mermaid-9fjaq5n8tgk .edgeLabel{color:#ccc;}#mermaid-9fjaq5n8tgk .edgeLabel .label rect{fill:#111;}#mermaid-9fjaq5n8tgk .label text{fill:#ccc;}#mermaid-9fjaq5n8tgk .labelBkg{background:#111;}#mermaid-9fjaq5n8tgk .edgeLabel .label span{background:#111;}#mermaid-9fjaq5n8tgk .classTitle{font-weight:bolder;}#mermaid-9fjaq5n8tgk .node rect,#mermaid-9fjaq5n8tgk .node circle,#mermaid-9fjaq5n8tgk .node ellipse,#mermaid-9fjaq5n8tgk .node polygon,#mermaid-9fjaq5n8tgk .node path{fill:#111;stroke:#222;stroke-width:1px;}#mermaid-9fjaq5n8tgk .divider{stroke:#222;stroke-width:1;}#mermaid-9fjaq5n8tgk g.clickable{cursor:pointer;}#mermaid-9fjaq5n8tgk g.classGroup rect{fill:#111;stroke:#222;}#mermaid-9fjaq5n8tgk g.classGroup line{stroke:#222;stroke-width:1;}#mermaid-9fjaq5n8tgk .classLabel .box{stroke:none;stroke-width:0;fill:#111;opacity:0.5;}#mermaid-9fjaq5n8tgk .classLabel .label{fill:#222;font-size:10px;}#mermaid-9fjaq5n8tgk .relation{stroke:#666;stroke-width:1;fill:none;}#mermaid-9fjaq5n8tgk .dashed-line{stroke-dasharray:3;}#mermaid-9fjaq5n8tgk .dotted-line{stroke-dasharray:1 2;}#mermaid-9fjaq5n8tgk #compositionStart,#mermaid-9fjaq5n8tgk .composition{fill:#666!important;stroke:#666!important;stroke-width:1;}#mermaid-9fjaq5n8tgk #compositionEnd,#mermaid-9fjaq5n8tgk .composition{fill:#666!important;stroke:#666!important;stroke-width:1;}#mermaid-9fjaq5n8tgk #dependencyStart,#mermaid-9fjaq5n8tgk .dependency{fill:#666!important;stroke:#666!important;stroke-width:1;}#mermaid-9fjaq5n8tgk #dependencyStart,#mermaid-9fjaq5n8tgk .dependency{fill:#666!important;stroke:#666!important;stroke-width:1;}#mermaid-9fjaq5n8tgk #extensionStart,#mermaid-9fjaq5n8tgk .extension{fill:transparent!important;stroke:#666!important;stroke-width:1;}#mermaid-9fjaq5n8tgk #extensionEnd,#mermaid-9fjaq5n8tgk .extension{fill:transparent!important;stroke:#666!important;stroke-width:1;}#mermaid-9fjaq5n8tgk #aggregationStart,#mermaid-9fjaq5n8tgk .aggregation{fill:transparent!important;stroke:#666!important;stroke-width:1;}#mermaid-9fjaq5n8tgk #aggregationEnd,#mermaid-9fjaq5n8tgk .aggregation{fill:transparent!important;stroke:#666!important;stroke-width:1;}#mermaid-9fjaq5n8tgk #lollipopStart,#mermaid-9fjaq5n8tgk .lollipop{fill:#111!important;stroke:#666!important;stroke-width:1;}#mermaid-9fjaq5n8tgk #lollipopEnd,#mermaid-9fjaq5n8tgk .lollipop{fill:#111!important;stroke:#666!important;stroke-width:1;}#mermaid-9fjaq5n8tgk .edgeTerminals{font-size:11px;line-height:initial;}#mermaid-9fjaq5n8tgk .classTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-9fjaq5n8tgk :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="18" class="marker aggregation class" id="mermaid-9fjaq5n8tgk_class-aggregationStart"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="1" class="marker aggregation class" id="mermaid-9fjaq5n8tgk_class-aggregationEnd"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="18" class="marker extension class" id="mermaid-9fjaq5n8tgk_class-extensionStart"><path d="M 1,7 L18,13 V 1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="1" class="marker extension class" id="mermaid-9fjaq5n8tgk_class-extensionEnd"><path d="M 1,1 V 13 L18,7 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="18" class="marker composition class" id="mermaid-9fjaq5n8tgk_class-compositionStart"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="1" class="marker composition class" id="mermaid-9fjaq5n8tgk_class-compositionEnd"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="6" class="marker dependency class" id="mermaid-9fjaq5n8tgk_class-dependencyStart"><path d="M 5,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="13" class="marker dependency class" id="mermaid-9fjaq5n8tgk_class-dependencyEnd"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="13" class="marker lollipop class" id="mermaid-9fjaq5n8tgk_class-lollipopStart"><circle r="6" cy="7" cx="7" fill="transparent" stroke="black"></circle></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="1" class="marker lollipop class" id="mermaid-9fjaq5n8tgk_class-lollipopEnd"><circle r="6" cy="7" cx="7" fill="transparent" stroke="black"></circle></marker></defs><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#mermaid-9fjaq5n8tgk_class-dependencyEnd)" style=";" class="edge-thickness-normal edge-pattern-solid relation" id="id_LiveService_Session_1" d="M200.146,368L200.146,374.167C200.146,380.333,200.146,392.667,200.146,404C200.146,415.333,200.146,425.667,200.146,430.833L200.146,436"></path><path marker-end="url(#mermaid-9fjaq5n8tgk_class-dependencyEnd)" style=";" class="edge-thickness-normal edge-pattern-solid relation" id="id_Session_Stream_2" d="M200.146,754L200.146,760.167C200.146,766.333,200.146,778.667,200.146,790C200.146,801.333,200.146,811.667,200.146,816.833L200.146,822"></path></g><g class="edgeLabels"><g transform="translate(200.1458282470703, 405)" class="edgeLabel"><g transform="translate(-32.5, -12)" class="label"><foreignObject height="24" width="65"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel" style=";display: inline-block"><p>manages</p></span></div></foreignObject></g></g><g transform="translate(200.1458282470703, 791)" class="edgeLabel"><g transform="translate(-18.991668701171875, -12)" class="label"><foreignObject height="24" width="37.98333740234375"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel" style=";display: inline-block"><p>owns</p></span></div></foreignObject></g></g><g transform="translate(185.14582912353518, 385.5000007512556)" class="edgeTerminals"><g transform="translate(0, 0)" class="inner"><foreignObject style="width: 9px; height: 12px;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; padding-right: 1px; white-space: nowrap;"><span style=";display: inline-block" class="edgeLabel">1</span></div></foreignObject></g></g><g transform="translate(185.14582912353518, 771.5000007512556)" class="edgeTerminals"><g transform="translate(0, 0)" class="inner"><foreignObject style="width: 9px; height: 12px;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; padding-right: 1px; white-space: nowrap;"><span style=";display: inline-block" class="edgeLabel">1</span></div></foreignObject></g></g><g transform="translate(210.14582912353512, 419.5000007512556)" class="edgeTerminals"><g transform="translate(0, 0)" class="inner"></g><foreignObject style="width: 9px; height: 12px;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; padding-right: 1px; white-space: nowrap;"><span style=";display: inline-block" class="edgeLabel">*</span></div></foreignObject></g><g transform="translate(210.14582912353512, 805.5000007512556)" class="edgeTerminals"><g transform="translate(0, 0)" class="inner"></g><foreignObject style="width: 9px; height: 12px;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; padding-right: 1px; white-space: nowrap;"><span style=";display: inline-block" class="edgeLabel">1</span></div></foreignObject></g></g><g class="nodes"><g transform="translate(200.1458282470703, 188)" id="classId-LiveService-12" class="node default"><g class="basic label-container"><path style="" fill="#111" stroke-width="0" stroke="none" d="M-176.77915954589844 -180 L176.77915954589844 -180 L176.77915954589844 180 L-176.77915954589844 180"></path><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-176.77915954589844 -180 C-76.82910795620444 -180, 23.12094363348956 -180, 176.77915954589844 -180 M-176.77915954589844 -180 C-96.07114511401332 -180, -15.363130682128201 -180, 176.77915954589844 -180 M176.77915954589844 -180 C176.77915954589844 -62.65434592772034, 176.77915954589844 54.691308144559315, 176.77915954589844 180 M176.77915954589844 -180 C176.77915954589844 -59.5690007801561, 176.77915954589844 60.861998439687795, 176.77915954589844 180 M176.77915954589844 180 C68.747189194955 180, -39.28478115598844 180, -176.77915954589844 180 M176.77915954589844 180 C91.73242252914682 180, 6.685685512395196 180, -176.77915954589844 180 M-176.77915954589844 180 C-176.77915954589844 45.49664179341573, -176.77915954589844 -89.00671641316853, -176.77915954589844 -180 M-176.77915954589844 180 C-176.77915954589844 48.49056088715875, -176.77915954589844 -83.0188782256825, -176.77915954589844 -180"></path></g><g transform="translate(0, -156)" class="annotation-group text"></g><g transform="translate(-43.791664123535156, -156)" class="label-group text"><g transform="translate(0,-12)" style="font-weight: bolder" class="label"><foreignObject height="24" width="87.58332824707031"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 134px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>LiveService</p></span></div></foreignObject></g></g><g transform="translate(-164.77915954589844, -108)" class="members-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="111.98333740234375"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 177px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-sessions_: map</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="118.94999694824219"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 181px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-servers_: vector</p></span></div></foreignObject></g><g transform="translate(0,36)" style="font-style:italic;" class="label"><foreignObject height="24" width="205.96665954589844"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 272px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-pool_: EventLoopThreadPool</p></span></div></foreignObject></g></g><g transform="translate(-164.77915954589844, -12)" class="methods-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="218.14999389648438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 280px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+CreateSession(sessionName)</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="200.78334045410156"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 263px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+FindSession(sessionName)</p></span></div></foreignObject></g><g transform="translate(0,36)" style="" class="label"><foreignObject height="24" width="209.3333282470703"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 273px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+CloseSession(sessionName)</p></span></div></foreignObject></g><g transform="translate(0,60)" style="" class="label"><foreignObject height="24" width="262.91668701171875"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 323px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+OnPlay(conn, sessionName, param)</p></span></div></foreignObject></g><g transform="translate(0,84)" style="" class="label"><foreignObject height="24" width="285.76666259765625"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 345px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+OnPublish(conn, sessionName, param)</p></span></div></foreignObject></g><g transform="translate(0,108)" style="" class="label"><foreignObject height="24" width="150.51666259765625"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 208px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+OnRecv(conn, data)</p></span></div></foreignObject></g><g transform="translate(0,132)" style="" class="label"><foreignObject height="24" width="56.58332824707031"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 111px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+Start()</p></span></div></foreignObject></g><g transform="translate(0,156)" style="" class="label"><foreignObject height="24" width="54.23333740234375"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 109px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+Stop()</p></span></div></foreignObject></g></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-176.77915954589844 -132 C-92.03231584889583 -132, -7.285472151893231 -132, 176.77915954589844 -132 M-176.77915954589844 -132 C-106.00813713480174 -132, -35.23711472370505 -132, 176.77915954589844 -132"></path></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-176.77915954589844 -36 C-44.68775442431843 -36, 87.40365069726158 -36, 176.77915954589844 -36 M-176.77915954589844 -36 C-53.23845531956073 -36, 70.30224890677698 -36, 176.77915954589844 -36"></path></g></g><g transform="translate(200.1458282470703, 598)" id="classId-Session-13" class="node default"><g class="basic label-container"><path style="" fill="#111" stroke-width="0" stroke="none" d="M-192.1458282470703 -156 L192.1458282470703 -156 L192.1458282470703 156 L-192.1458282470703 156"></path><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-192.1458282470703 -156 C-50.389756826044305 -156, 91.3663145949817 -156, 192.1458282470703 -156 M-192.1458282470703 -156 C-67.99605562348249 -156, 56.15371700010533 -156, 192.1458282470703 -156 M192.1458282470703 -156 C192.1458282470703 -42.40460073228705, 192.1458282470703 71.1907985354259, 192.1458282470703 156 M192.1458282470703 -156 C192.1458282470703 -46.56814190034598, 192.1458282470703 62.863716199308044, 192.1458282470703 156 M192.1458282470703 156 C79.53239013263176 156, -33.08104798180679 156, -192.1458282470703 156 M192.1458282470703 156 C62.609763120753456 156, -66.9263020055634 156, -192.1458282470703 156 M-192.1458282470703 156 C-192.1458282470703 60.13536299257355, -192.1458282470703 -35.729274014852905, -192.1458282470703 -156 M-192.1458282470703 156 C-192.1458282470703 59.78992641905721, -192.1458282470703 -36.42014716188558, -192.1458282470703 -156"></path></g><g transform="translate(0, -132)" class="annotation-group text"></g><g transform="translate(-28.974998474121094, -132)" class="label-group text"><g transform="translate(0,-12)" style="font-weight: bolder" class="label"><foreignObject height="24" width="57.94999694824219"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 108px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>Session</p></span></div></foreignObject></g></g><g transform="translate(-180.1458282470703, -84)" class="members-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="163.6666717529297"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 229px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-session_name_: string</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="145.68333435058594"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 209px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-stream_: StreamPtr</p></span></div></foreignObject></g><g transform="translate(0,36)" style="" class="label"><foreignObject height="24" width="143.73333740234375"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 206px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-publisher_: UserPtr</p></span></div></foreignObject></g><g transform="translate(0,60)" style="" class="label"><foreignObject height="24" width="94.91667175292969"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 158px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-players_: set</p></span></div></foreignObject></g></g><g transform="translate(-180.1458282470703, 36)" class="methods-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="331.316650390625"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 389px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+CreatePublishUser(conn, name, param, type)</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="323.6000061035156"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 381px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+CreatePlayerUser(conn, name, param, type)</p></span></div></foreignObject></g><g transform="translate(0,36)" style="" class="label"><foreignObject height="24" width="142.88333129882812"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 201px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+SetPublisher(user)</p></span></div></foreignObject></g><g transform="translate(0,60)" style="" class="label"><foreignObject height="24" width="125.36666870117188"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 182px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+AddPlayer(user)</p></span></div></foreignObject></g><g transform="translate(0,84)" style="" class="label"><foreignObject height="24" width="123.89999389648438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 183px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+CloseUser(user)</p></span></div></foreignObject></g></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-192.1458282470703 -108 C-90.24522125685297 -108, 11.65538573336437 -108, 192.1458282470703 -108 M-192.1458282470703 -108 C-66.11266951849332 -108, 59.92048921008367 -108, 192.1458282470703 -108"></path></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-192.1458282470703 12 C-90.0650487848723 12, 12.015730677325706 12, 192.1458282470703 12 M-192.1458282470703 12 C-113.51979328694566 12, -34.893758326821 12, 192.1458282470703 12"></path></g></g><g transform="translate(200.1458282470703, 936)" id="classId-Stream-14" class="node default"><g class="basic label-container"><path style="" fill="#111" stroke-width="0" stroke="none" d="M-139.14583587646484 -108 L139.14583587646484 -108 L139.14583587646484 108 L-139.14583587646484 108"></path><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-139.14583587646484 -108 C-33.061706524483725 -108, 73.0224228274974 -108, 139.14583587646484 -108 M-139.14583587646484 -108 C-79.63048230242276 -108, -20.115128728380682 -108, 139.14583587646484 -108 M139.14583587646484 -108 C139.14583587646484 -32.83296024099616, 139.14583587646484 42.334079518007684, 139.14583587646484 108 M139.14583587646484 -108 C139.14583587646484 -43.31069190853569, 139.14583587646484 21.378616182928624, 139.14583587646484 108 M139.14583587646484 108 C59.11866108508232 108, -20.908513706300198 108, -139.14583587646484 108 M139.14583587646484 108 C72.52057393104849 108, 5.895311985632134 108, -139.14583587646484 108 M-139.14583587646484 108 C-139.14583587646484 43.57543346142931, -139.14583587646484 -20.849133077141374, -139.14583587646484 -108 M-139.14583587646484 108 C-139.14583587646484 37.19230479930856, -139.14583587646484 -33.61539040138288, -139.14583587646484 -108"></path></g><g transform="translate(0, -84)" class="annotation-group text"></g><g transform="translate(-27.508331298828125, -84)" class="label-group text"><g transform="translate(0,-12)" style="font-weight: bolder" class="label"><foreignObject height="24" width="55.01666259765625"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 103px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>Stream</p></span></div></foreignObject></g></g><g transform="translate(-127.14583587646484, -36)" class="members-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="168.81666564941406"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 230px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-packet_buffer_: vector</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="144.43333435058594"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 207px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-gop_mgr_: GopMgr</p></span></div></foreignObject></g><g transform="translate(0,36)" style="" class="label"><foreignObject height="24" width="226.78334045410156"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 294px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-codec_headers_: CodecHeader</p></span></div></foreignObject></g></g><g transform="translate(-127.14583587646484, 60)" class="methods-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="145.64999389648438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 205px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+AddPacket(packet)</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="129.51666259765625"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 187px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+GetFrames(user)</p></span></div></foreignObject></g></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-139.14584350585938 -60 C-36.21333524140829 -60, 66.7191730230428 -60, 139.14584350585938 -60 M-139.14584350585938 -60 C-77.94049903770457 -60, -16.735154569549763 -60, 139.14584350585938 -60"></path></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-139.14584350585938 36 C-48.271341867333135 36, 42.603159771193106 36, 139.14584350585938 36 M-139.14584350585938 36 C-74.30116624563102 36, -9.456488985402672 36, 139.14584350585938 36"></path></g></g></g></g></g></svg></div><div class="bg-input-dark absolute right-2 top-2 rounded-sm p-1 opacity-0 transition-opacity group-hover:opacity-100"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="light:text-gray-800 text-white dark:text-white"><path d="M216,48V96a8,8,0,0,1-16,0V67.31l-42.34,42.35a8,8,0,0,1-11.32-11.32L188.69,56H160a8,8,0,0,1,0-16h48A8,8,0,0,1,216,48ZM98.34,146.34,56,188.69V160a8,8,0,0,0-16,0v48a8,8,0,0,0,8,8H96a8,8,0,0,0,0-16H67.31l42.35-42.34a8,8,0,0,0-11.32-11.32ZM208,152a8,8,0,0,0-8,8v28.69l-42.34-42.35a8,8,0,0,0-11.32,11.32L188.69,200H160a8,8,0,0,0,0,16h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152ZM67.31,56H96a8,8,0,0,0,0-16H48a8,8,0,0,0-8,8V96a8,8,0,0,0,16,0V67.31l42.34,42.35a8,8,0,0,0,11.32-11.32Z"></path></svg></div></div></pre>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">资料来源：
src/live/liveservice.cc
28-238</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<h3 id="protocol-support" class="group flex items-center" data-header="true"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">协议支持</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h3>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">流Mediaserver通过专门的服务器实现支持多个流媒体协议：</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><div class="group relative cursor-pointer overflow-x-auto rounded-md bg-[#f2f1f0] p-4 transition-colors hover:bg-[#ededed] dark:bg-[#1f1f1f] dark:hover:bg-[#242424]" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«r6»" data-state="closed"><div class="flex justify-center"><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 913.7000732421875 285" style="max-width: 913.7000732421875px;" class="flowchart" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-cdgl20c7j4f"><style>#mermaid-cdgl20c7j4f{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-cdgl20c7j4f .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-cdgl20c7j4f .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-cdgl20c7j4f .error-icon{fill:#333;}#mermaid-cdgl20c7j4f .error-text{fill:#cccccc;stroke:#cccccc;}#mermaid-cdgl20c7j4f .edge-thickness-normal{stroke-width:1px;}#mermaid-cdgl20c7j4f .edge-thickness-thick{stroke-width:3.5px;}#mermaid-cdgl20c7j4f .edge-pattern-solid{stroke-dasharray:0;}#mermaid-cdgl20c7j4f .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-cdgl20c7j4f .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-cdgl20c7j4f .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-cdgl20c7j4f .marker{fill:#666;stroke:#666;}#mermaid-cdgl20c7j4f .marker.cross{stroke:#666;}#mermaid-cdgl20c7j4f svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-cdgl20c7j4f p{margin:0;}#mermaid-cdgl20c7j4f .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#fff;}#mermaid-cdgl20c7j4f .cluster-label text{fill:#fff;}#mermaid-cdgl20c7j4f .cluster-label span{color:#fff;}#mermaid-cdgl20c7j4f .cluster-label span p{background-color:transparent;}#mermaid-cdgl20c7j4f .label text,#mermaid-cdgl20c7j4f span{fill:#fff;color:#fff;}#mermaid-cdgl20c7j4f .node rect,#mermaid-cdgl20c7j4f .node circle,#mermaid-cdgl20c7j4f .node ellipse,#mermaid-cdgl20c7j4f .node polygon,#mermaid-cdgl20c7j4f .node path{fill:#111;stroke:#222;stroke-width:1px;}#mermaid-cdgl20c7j4f .rough-node .label text,#mermaid-cdgl20c7j4f .node .label text,#mermaid-cdgl20c7j4f .image-shape .label,#mermaid-cdgl20c7j4f .icon-shape .label{text-anchor:middle;}#mermaid-cdgl20c7j4f .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-cdgl20c7j4f .rough-node .label,#mermaid-cdgl20c7j4f .node .label,#mermaid-cdgl20c7j4f .image-shape .label,#mermaid-cdgl20c7j4f .icon-shape .label{text-align:center;}#mermaid-cdgl20c7j4f .node.clickable{cursor:pointer;}#mermaid-cdgl20c7j4f .root .anchor path{fill:#666!important;stroke-width:0;stroke:#666;}#mermaid-cdgl20c7j4f .arrowheadPath{fill:#0b0b0b;}#mermaid-cdgl20c7j4f .edgePath .path{stroke:#666;stroke-width:2.0px;}#mermaid-cdgl20c7j4f .flowchart-link{stroke:#666;fill:none;}#mermaid-cdgl20c7j4f .edgeLabel{background-color:#161616;text-align:center;}#mermaid-cdgl20c7j4f .edgeLabel p{background-color:#161616;}#mermaid-cdgl20c7j4f .edgeLabel rect{opacity:0.5;background-color:#161616;fill:#161616;}#mermaid-cdgl20c7j4f .labelBkg{background-color:rgba(22, 22, 22, 0.5);}#mermaid-cdgl20c7j4f .cluster rect{fill:#161616;stroke:#222;stroke-width:1px;}#mermaid-cdgl20c7j4f .cluster text{fill:#fff;}#mermaid-cdgl20c7j4f .cluster span{color:#fff;}#mermaid-cdgl20c7j4f div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:#333;border:1px solid hsl(0, 0%, 10%);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-cdgl20c7j4f .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-cdgl20c7j4f rect.text{fill:none;stroke-width:0;}#mermaid-cdgl20c7j4f .icon-shape,#mermaid-cdgl20c7j4f .image-shape{background-color:#161616;text-align:center;}#mermaid-cdgl20c7j4f .icon-shape p,#mermaid-cdgl20c7j4f .image-shape p{background-color:#161616;padding:2px;}#mermaid-cdgl20c7j4f .icon-shape rect,#mermaid-cdgl20c7j4f .image-shape rect{opacity:0.5;background-color:#161616;fill:#161616;}#mermaid-cdgl20c7j4f :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-cdgl20c7j4f_flowchart-v2-pointEnd"><path style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-cdgl20c7j4f_flowchart-v2-pointStart"><path style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-cdgl20c7j4f_flowchart-v2-circleEnd"><circle style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-cdgl20c7j4f_flowchart-v2-circleStart"><circle style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid-cdgl20c7j4f_flowchart-v2-crossEnd"><path style="stroke-width: 2px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid-cdgl20c7j4f_flowchart-v2-crossStart"><path style="stroke-width: 2px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"><g data-look="classic" id="subGraph2" class="cluster"><rect height="226" width="191.5500030517578" y="20" x="714.1499938964844" style=""></rect><g transform="translate(764.7249984741211, 20)" class="cluster-label"><foreignObject height="24" width="90.39999389648438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Core Service</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph1" class="cluster"><rect height="269" width="409.5333251953125" y="8" x="254.61666870117188" style=""></rect><g transform="translate(394.09166717529297, 8)" class="cluster-label"><foreignObject height="24" width="130.5833282470703"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Protocol Handlers</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph0" class="cluster"><rect height="228" width="196.61666870117188" y="8" x="8" style=""></rect><g transform="translate(46.42500305175781, 8)" class="cluster-label"><foreignObject height="24" width="119.76666259765625"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Protocol Servers</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid-cdgl20c7j4f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_RS_RC_0" d="M179.617,70L183.783,70C187.95,70,196.283,70,204.617,70C212.95,70,221.283,70,229.617,70C237.95,70,246.283,70,267.258,70C288.233,70,321.85,70,355.467,70C389.083,70,422.7,70,443.008,70C463.317,70,470.317,70,473.817,70L477.317,70"></path><path marker-end="url(#mermaid-cdgl20c7j4f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_HS_HC_0" d="M176.55,174L181.228,174C185.906,174,195.261,174,204.106,174C212.95,174,221.283,174,229.617,174C237.95,174,246.283,174,253.95,174C261.617,174,268.617,174,272.117,174L275.617,174"></path><path marker-end="url(#mermaid-cdgl20c7j4f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_HC_FC_0" d="M421.88,201L427.62,203.333C433.359,205.667,444.838,210.333,455.636,212.667C466.433,215,476.55,215,481.608,215L486.667,215"></path><path marker-end="url(#mermaid-cdgl20c7j4f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_RC_LS_0" d="M639.15,70L643.317,70C647.483,70,655.817,70,664.15,70C672.483,70,680.817,70,689.15,70C697.483,70,705.817,70,720.249,78.897C734.682,87.793,755.214,105.587,765.48,114.484L775.746,123.38"></path><path marker-end="url(#mermaid-cdgl20c7j4f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_HC_LS_0" d="M431.317,158.206L435.483,157.338C439.65,156.471,447.983,154.735,469.469,153.868C490.956,153,525.594,153,560.233,153C594.872,153,629.511,153,650.997,153C672.483,153,680.817,153,689.15,153C697.483,153,705.817,153,713.483,153C721.15,153,728.15,153,731.65,153L735.15,153"></path><path marker-end="url(#mermaid-cdgl20c7j4f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_FC_LS_0" d="M629.8,215L635.525,215C641.25,215,652.7,215,662.592,215C672.483,215,680.817,215,689.15,215C697.483,215,705.817,215,718.435,209.529C731.053,204.058,747.956,193.116,756.407,187.645L764.859,182.174"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(106.30833435058594, 70)" id="flowchart-RS-0" class="node default"><rect height="54" width="146.61666870117188" y="-27" x="-73.30833435058594" style="" class="basic label-container"></rect><g transform="translate(-43.30833435058594, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="86.61666870117188"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>RtmpServer</p></span></div></foreignObject></g></g><g transform="translate(106.30833435058594, 174)" id="flowchart-HS-1" class="node default"><rect height="54" width="140.48333740234375" y="-27" x="-70.24166870117188" style="" class="basic label-container"></rect><g transform="translate(-40.241668701171875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="80.48333740234375"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>HttpServer</p></span></div></foreignObject></g></g><g transform="translate(560.2333297729492, 70)" id="flowchart-RC-2" class="node default"><rect height="54" width="157.8333282470703" y="-27" x="-78.91666412353516" style="" class="basic label-container"></rect><g transform="translate(-48.916664123535156, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="97.83332824707031"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>RtmpContext</p></span></div></foreignObject></g></g><g transform="translate(355.46666717529297, 174)" id="flowchart-HC-3" class="node default"><rect height="54" width="151.6999969482422" y="-27" x="-75.8499984741211" style="" class="basic label-container"></rect><g transform="translate(-45.849998474121094, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="91.69999694824219"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>HttpContext</p></span></div></foreignObject></g></g><g transform="translate(560.2333297729492, 215)" id="flowchart-FC-4" class="node default"><rect height="54" width="139.13333129882812" y="-27" x="-69.56666564941406" style="" class="basic label-container"></rect><g transform="translate(-39.56666564941406, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="79.13333129882812"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>FlvContext</p></span></div></foreignObject></g></g><g transform="translate(809.9249954223633, 153)" id="flowchart-LS-5" class="node default"><rect height="54" width="141.5500030517578" y="-27" x="-70.7750015258789" style="" class="basic label-container"></rect><g transform="translate(-40.775001525878906, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="81.55000305175781"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>LiveService</p></span></div></foreignObject></g></g></g></g></g></svg></div><div class="bg-input-dark absolute right-2 top-2 rounded-sm p-1 opacity-0 transition-opacity group-hover:opacity-100"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="light:text-gray-800 text-white dark:text-white"><path d="M216,48V96a8,8,0,0,1-16,0V67.31l-42.34,42.35a8,8,0,0,1-11.32-11.32L188.69,56H160a8,8,0,0,1,0-16h48A8,8,0,0,1,216,48ZM98.34,146.34,56,188.69V160a8,8,0,0,0-16,0v48a8,8,0,0,0,8,8H96a8,8,0,0,0,0-16H67.31l42.35-42.34a8,8,0,0,0-11.32-11.32ZM208,152a8,8,0,0,0-8,8v28.69l-42.34-42.35a8,8,0,0,0-11.32,11.32L188.69,200H160a8,8,0,0,0,0,16h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152ZM67.31,56H96a8,8,0,0,0,0-16H48a8,8,0,0,0-8,8V96a8,8,0,0,0,16,0V67.31l42.34,42.35a8,8,0,0,0,11.32-11.32Z"></path></svg></div></div></pre>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">资料来源：
src/live/liveservice.cc
196-227
src/mmedia/http/httpserver.cc
10-90</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<h3 id="media-data-flow" class="group flex items-center" data-header="true"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">媒体数据流</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h3>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">该图说明了媒体数据如何流过系统：</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><div class="group relative cursor-pointer overflow-x-auto rounded-md bg-[#f2f1f0] p-4 transition-colors hover:bg-[#ededed] dark:bg-[#1f1f1f] dark:hover:bg-[#242424]" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«r9»" data-state="closed"><div class="flex justify-center"><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 2079.60009765625 330" style="max-width: 2079.60009765625px;" class="flowchart" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-zv9purkkkc"><style>#mermaid-zv9purkkkc{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-zv9purkkkc .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-zv9purkkkc .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-zv9purkkkc .error-icon{fill:#333;}#mermaid-zv9purkkkc .error-text{fill:#cccccc;stroke:#cccccc;}#mermaid-zv9purkkkc .edge-thickness-normal{stroke-width:1px;}#mermaid-zv9purkkkc .edge-thickness-thick{stroke-width:3.5px;}#mermaid-zv9purkkkc .edge-pattern-solid{stroke-dasharray:0;}#mermaid-zv9purkkkc .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-zv9purkkkc .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-zv9purkkkc .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-zv9purkkkc .marker{fill:#666;stroke:#666;}#mermaid-zv9purkkkc .marker.cross{stroke:#666;}#mermaid-zv9purkkkc svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-zv9purkkkc p{margin:0;}#mermaid-zv9purkkkc .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#fff;}#mermaid-zv9purkkkc .cluster-label text{fill:#fff;}#mermaid-zv9purkkkc .cluster-label span{color:#fff;}#mermaid-zv9purkkkc .cluster-label span p{background-color:transparent;}#mermaid-zv9purkkkc .label text,#mermaid-zv9purkkkc span{fill:#fff;color:#fff;}#mermaid-zv9purkkkc .node rect,#mermaid-zv9purkkkc .node circle,#mermaid-zv9purkkkc .node ellipse,#mermaid-zv9purkkkc .node polygon,#mermaid-zv9purkkkc .node path{fill:#111;stroke:#222;stroke-width:1px;}#mermaid-zv9purkkkc .rough-node .label text,#mermaid-zv9purkkkc .node .label text,#mermaid-zv9purkkkc .image-shape .label,#mermaid-zv9purkkkc .icon-shape .label{text-anchor:middle;}#mermaid-zv9purkkkc .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-zv9purkkkc .rough-node .label,#mermaid-zv9purkkkc .node .label,#mermaid-zv9purkkkc .image-shape .label,#mermaid-zv9purkkkc .icon-shape .label{text-align:center;}#mermaid-zv9purkkkc .node.clickable{cursor:pointer;}#mermaid-zv9purkkkc .root .anchor path{fill:#666!important;stroke-width:0;stroke:#666;}#mermaid-zv9purkkkc .arrowheadPath{fill:#0b0b0b;}#mermaid-zv9purkkkc .edgePath .path{stroke:#666;stroke-width:2.0px;}#mermaid-zv9purkkkc .flowchart-link{stroke:#666;fill:none;}#mermaid-zv9purkkkc .edgeLabel{background-color:#161616;text-align:center;}#mermaid-zv9purkkkc .edgeLabel p{background-color:#161616;}#mermaid-zv9purkkkc .edgeLabel rect{opacity:0.5;background-color:#161616;fill:#161616;}#mermaid-zv9purkkkc .labelBkg{background-color:rgba(22, 22, 22, 0.5);}#mermaid-zv9purkkkc .cluster rect{fill:#161616;stroke:#222;stroke-width:1px;}#mermaid-zv9purkkkc .cluster text{fill:#fff;}#mermaid-zv9purkkkc .cluster span{color:#fff;}#mermaid-zv9purkkkc div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:#333;border:1px solid hsl(0, 0%, 10%);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-zv9purkkkc .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-zv9purkkkc rect.text{fill:none;stroke-width:0;}#mermaid-zv9purkkkc .icon-shape,#mermaid-zv9purkkkc .image-shape{background-color:#161616;text-align:center;}#mermaid-zv9purkkkc .icon-shape p,#mermaid-zv9purkkkc .image-shape p{background-color:#161616;padding:2px;}#mermaid-zv9purkkkc .icon-shape rect,#mermaid-zv9purkkkc .image-shape rect{opacity:0.5;background-color:#161616;fill:#161616;}#mermaid-zv9purkkkc :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-zv9purkkkc_flowchart-v2-pointEnd"><path style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-zv9purkkkc_flowchart-v2-pointStart"><path style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-zv9purkkkc_flowchart-v2-circleEnd"><circle style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-zv9purkkkc_flowchart-v2-circleStart"><circle style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid-zv9purkkkc_flowchart-v2-crossEnd"><path style="stroke-width: 2px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid-zv9purkkkc_flowchart-v2-crossStart"><path style="stroke-width: 2px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#mermaid-zv9purkkkc_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_PUB_RS_0" d="M136.15,191L143.881,191C151.611,191,167.072,191,181.867,191C196.661,191,210.789,191,217.853,191L224.917,191"></path><path marker-end="url(#mermaid-zv9purkkkc_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_RS_RC_0" d="M375.533,191L379.7,191C383.867,191,392.2,191,399.867,191C407.533,191,414.533,191,418.033,191L421.533,191"></path><path marker-end="url(#mermaid-zv9purkkkc_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_RC_LS_0" d="M583.367,191L587.533,191C591.7,191,600.033,191,607.7,191C615.367,191,622.367,191,625.867,191L629.367,191"></path><path marker-end="url(#mermaid-zv9purkkkc_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_LS_SS_0" d="M774.917,191L786.251,191C797.586,191,820.256,191,842.258,191C864.261,191,885.597,191,896.265,191L906.933,191"></path><path marker-end="url(#mermaid-zv9purkkkc_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_SS_ST_0" d="M1025.333,191L1037.568,191C1049.803,191,1074.272,191,1098.075,191C1121.878,191,1145.014,191,1156.582,191L1168.15,191"></path><path marker-end="url(#mermaid-zv9purkkkc_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_ST_PB_0" d="M1256.104,164L1269.34,151.167C1282.575,138.333,1309.046,112.667,1330.14,99.833C1351.233,87,1366.95,87,1374.808,87L1382.667,87"></path><path marker-end="url(#mermaid-zv9purkkkc_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_ST_GM_0" d="M1284.367,191L1292.892,191C1301.417,191,1318.467,191,1338.206,191C1357.944,191,1380.372,191,1391.586,191L1402.8,191"></path><path marker-end="url(#mermaid-zv9purkkkc_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_ST_CH_0" d="M1256.104,218L1269.34,230.833C1282.575,243.667,1309.046,269.333,1330.238,282.167C1351.431,295,1367.344,295,1375.301,295L1383.258,295"></path><path marker-end="url(#mermaid-zv9purkkkc_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_PB_RTMPP_0" d="M1520.604,60L1528.986,55.833C1537.369,51.667,1554.134,43.333,1566.017,39.167C1577.9,35,1584.9,35,1588.4,35L1591.9,35"></path><path marker-end="url(#mermaid-zv9purkkkc_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_PB_FLVP_0" d="M1520.604,114L1528.986,118.167C1537.369,122.333,1554.134,130.667,1567.576,134.833C1581.017,139,1591.133,139,1596.192,139L1601.25,139"></path><path marker-end="url(#mermaid-zv9purkkkc_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_RTMPP_RTMPC_0" d="M1774.167,35L1784.201,35C1794.236,35,1814.306,35,1836.012,35C1857.719,35,1881.064,35,1892.736,35L1904.408,35"></path><path marker-end="url(#mermaid-zv9purkkkc_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_FLVP_FLVC_0" d="M1764.817,139L1776.41,139C1788.003,139,1811.189,139,1832.15,139C1853.111,139,1871.847,139,1881.215,139L1890.583,139"></path></g><g class="edgeLabels"><g transform="translate(182.5333251953125, 191)" class="edgeLabel"><g transform="translate(-21.383331298828125, -12)" class="label"><foreignObject height="24" width="42.76666259765625"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>RTMP</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(842.9249877929688, 191)" class="edgeLabel"><g transform="translate(-43.008331298828125, -12)" class="label"><foreignObject height="24" width="86.01666259765625"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>Create/Find</p></span></div></foreignObject></g></g><g transform="translate(1098.7416458129883, 191)" class="edgeLabel"><g transform="translate(-48.40833282470703, -12)" class="label"><foreignObject height="24" width="96.81666564941406"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>Add media to</p></span></div></foreignObject></g></g><g transform="translate(1335.5166397094727, 87)" class="edgeLabel"><g transform="translate(-19.64167022705078, -12)" class="label"><foreignObject height="24" width="39.28334045410156"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>Store</p></span></div></foreignObject></g></g><g transform="translate(1335.5166397094727, 191)" class="edgeLabel"><g transform="translate(-24.308334350585938, -12)" class="label"><foreignObject height="24" width="48.616668701171875"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>Create</p></span></div></foreignObject></g></g><g transform="translate(1335.5166397094727, 295)" class="edgeLabel"><g transform="translate(-26.150001525878906, -12)" class="label"><foreignObject height="24" width="52.30000305175781"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>Extract</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(1834.3749771118164, 35)" class="edgeLabel"><g transform="translate(-21.383331298828125, -12)" class="label"><foreignObject height="24" width="42.76666259765625"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>RTMP</p></span></div></foreignObject></g></g><g transform="translate(1834.3749771118164, 139)" class="edgeLabel"><g transform="translate(-35.208335876464844, -12)" class="label"><foreignObject height="24" width="70.41667175292969"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"><p>HTTP/FLV</p></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(72.07499694824219, 191)" id="flowchart-PUB-0" class="node default"><rect height="54" width="128.14999389648438" y="-27" x="-64.07499694824219" style="" class="basic label-container"></rect><g transform="translate(-34.07499694824219, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="68.14999389648438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Publisher</p></span></div></foreignObject></g></g><g transform="translate(302.22499084472656, 191)" id="flowchart-RS-1" class="node default"><rect height="54" width="146.61666870117188" y="-27" x="-73.30833435058594" style="" class="basic label-container"></rect><g transform="translate(-43.30833435058594, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="86.61666870117188"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>RtmpServer</p></span></div></foreignObject></g></g><g transform="translate(504.44998931884766, 191)" id="flowchart-RC-3" class="node default"><rect height="54" width="157.8333282470703" y="-27" x="-78.91666412353516" style="" class="basic label-container"></rect><g transform="translate(-48.916664123535156, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="97.83332824707031"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>RtmpContext</p></span></div></foreignObject></g></g><g transform="translate(704.1416549682617, 191)" id="flowchart-LS-5" class="node default"><rect height="54" width="141.5500030517578" y="-27" x="-70.7750015258789" style="" class="basic label-container"></rect><g transform="translate(-40.775001525878906, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="81.55000305175781"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>LiveService</p></span></div></foreignObject></g></g><g transform="translate(968.1333160400391, 191)" id="flowchart-SS-7" class="node default"><rect height="54" width="114.39999389648438" y="-27" x="-57.19999694824219" style="" class="basic label-container"></rect><g transform="translate(-27.199996948242188, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="54.399993896484375"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Session</p></span></div></foreignObject></g></g><g transform="translate(1228.2583084106445, 191)" id="flowchart-ST-9" class="node default"><rect height="54" width="112.21665954589844" y="-27" x="-56.10832977294922" style="" class="basic label-container"></rect><g transform="translate(-26.10832977294922, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="52.21665954589844"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Stream</p></span></div></foreignObject></g></g><g transform="translate(1466.2833099365234, 87)" id="flowchart-PB-11" class="node default"><rect height="54" width="159.23333740234375" y="-27" x="-79.61666870117188" style="" class="basic label-container"></rect><g transform="translate(-49.616668701171875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="99.23333740234375"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Packet Buffer</p></span></div></foreignObject></g></g><g transform="translate(1466.2833099365234, 191)" id="flowchart-GM-13" class="node default"><rect height="54" width="118.96665954589844" y="-27" x="-59.48332977294922" style="" class="basic label-container"></rect><g transform="translate(-29.48332977294922, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="58.96665954589844"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>GopMgr</p></span></div></foreignObject></g></g><g transform="translate(1466.2833099365234, 295)" id="flowchart-CH-15" class="node default"><rect height="54" width="158.0500030517578" y="-27" x="-79.0250015258789" style="" class="basic label-container"></rect><g transform="translate(-49.025001525878906, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="98.05000305175781"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>CodecHeader</p></span></div></foreignObject></g></g><g transform="translate(1685.0333099365234, 35)" id="flowchart-RTMPP-17" class="node default"><rect height="54" width="178.26666259765625" y="-27" x="-89.13333129882812" style="" class="basic label-container"></rect><g transform="translate(-59.133331298828125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="118.26666259765625"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>RtmpPlayerUser</p></span></div></foreignObject></g></g><g transform="translate(1685.0333099365234, 139)" id="flowchart-FLVP-19" class="node default"><rect height="54" width="159.56666564941406" y="-27" x="-79.78333282470703" style="" class="basic label-container"></rect><g transform="translate(-49.78333282470703, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="99.56666564941406"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>FlvPlayerUser</p></span></div></foreignObject></g></g><g transform="translate(1983.0916442871094, 35)" id="flowchart-RTMPC-21" class="node default"><rect height="54" width="149.36666870117188" y="-27" x="-74.68333435058594" style="" class="basic label-container"></rect><g transform="translate(-44.68333435058594, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="89.36666870117188"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>RTMP Client</p></span></div></foreignObject></g></g><g transform="translate(1983.0916442871094, 139)" id="flowchart-FLVC-23" class="node default"><rect height="54" width="177.01666259765625" y="-27" x="-88.50833129882812" style="" class="basic label-container"></rect><g transform="translate(-58.508331298828125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="117.01666259765625"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>HTTP/FLV Client</p></span></div></foreignObject></g></g></g></g></g></svg></div><div class="bg-input-dark absolute right-2 top-2 rounded-sm p-1 opacity-0 transition-opacity group-hover:opacity-100"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="light:text-gray-800 text-white dark:text-white"><path d="M216,48V96a8,8,0,0,1-16,0V67.31l-42.34,42.35a8,8,0,0,1-11.32-11.32L188.69,56H160a8,8,0,0,1,0-16h48A8,8,0,0,1,216,48ZM98.34,146.34,56,188.69V160a8,8,0,0,0-16,0v48a8,8,0,0,0,8,8H96a8,8,0,0,0,0-16H67.31l42.35-42.34a8,8,0,0,0-11.32-11.32ZM208,152a8,8,0,0,0-8,8v28.69l-42.34-42.35a8,8,0,0,0-11.32,11.32L188.69,200H160a8,8,0,0,0,0,16h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152ZM67.31,56H96a8,8,0,0,0,0-16H48a8,8,0,0,0-8,8V96a8,8,0,0,0,16,0V67.31l42.34,42.35a8,8,0,0,0,11.32-11.32Z"></path></svg></div></div></pre>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">资料来源：
src/live/liveservice.cc
156-195
src/live/liveservice.cc
249-328</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<h2 id="system-initialization-and-startup" class="group flex items-center" data-header="true"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">系统初始化和启动</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h2>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">系统是在主函数中初始化的，该功能设置日志记录，加载配置并启动Liveservice：</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><div class="group relative cursor-pointer overflow-x-auto rounded-md bg-[#f2f1f0] p-4 transition-colors hover:bg-[#ededed] dark:bg-[#1f1f1f] dark:hover:bg-[#242424]" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«rc»" data-state="closed"><div class="flex justify-center"><svg aria-roledescription="sequence" role="graphics-document document" viewBox="-59 -10 1225 897" style="max-width: 1225px;" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-37yia84qml7"><g><rect class="actor actor-bottom" ry="3" rx="3" name="LiveService" height="65" width="150" stroke="#666" fill="#eaeaea" y="811" x="920"></rect><text class="actor actor-box" alignment-baseline="central" dominant-baseline="central" style="text-anchor: middle; font-size: 16px; font-weight: 400;" y="843.5" x="995"><tspan dy="0" x="995">"LiveService"</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="TaskMgr" height="65" width="150" stroke="#666" fill="#eaeaea" y="811" x="720"></rect><text class="actor actor-box" alignment-baseline="central" dominant-baseline="central" style="text-anchor: middle; font-size: 16px; font-weight: 400;" y="843.5" x="795"><tspan dy="0" x="795">"TaskMgr"</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Logger" height="65" width="150" stroke="#666" fill="#eaeaea" y="811" x="520"></rect><text class="actor actor-box" alignment-baseline="central" dominant-baseline="central" style="text-anchor: middle; font-size: 16px; font-weight: 400;" y="843.5" x="595"><tspan dy="0" x="595">"Logger"</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Config" height="65" width="150" stroke="#666" fill="#eaeaea" y="811" x="320"></rect><text class="actor actor-box" alignment-baseline="central" dominant-baseline="central" style="text-anchor: middle; font-size: 16px; font-weight: 400;" y="843.5" x="395"><tspan dy="0" x="395">"ConfigMgr"</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Main" height="65" width="150" stroke="#666" fill="#eaeaea" y="811" x="0"></rect><text class="actor actor-box" alignment-baseline="central" dominant-baseline="central" style="text-anchor: middle; font-size: 16px; font-weight: 400;" y="843.5" x="75"><tspan dy="0" x="75">"main()"</tspan></text></g><g><line name="LiveService" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="811" x2="995" y1="65" x1="995" id="actor9"></line><g id="root-9"><rect class="actor actor-top" ry="3" rx="3" name="LiveService" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="920"></rect><text class="actor actor-box" alignment-baseline="central" dominant-baseline="central" style="text-anchor: middle; font-size: 16px; font-weight: 400;" y="32.5" x="995"><tspan dy="0" x="995">"LiveService"</tspan></text></g></g><g><line name="TaskMgr" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="811" x2="795" y1="65" x1="795" id="actor8"></line><g id="root-8"><rect class="actor actor-top" ry="3" rx="3" name="TaskMgr" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="720"></rect><text class="actor actor-box" alignment-baseline="central" dominant-baseline="central" style="text-anchor: middle; font-size: 16px; font-weight: 400;" y="32.5" x="795"><tspan dy="0" x="795">"TaskMgr"</tspan></text></g></g><g><line name="Logger" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="811" x2="595" y1="65" x1="595" id="actor7"></line><g id="root-7"><rect class="actor actor-top" ry="3" rx="3" name="Logger" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="520"></rect><text class="actor actor-box" alignment-baseline="central" dominant-baseline="central" style="text-anchor: middle; font-size: 16px; font-weight: 400;" y="32.5" x="595"><tspan dy="0" x="595">"Logger"</tspan></text></g></g><g><line name="Config" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="811" x2="395" y1="65" x1="395" id="actor6"></line><g id="root-6"><rect class="actor actor-top" ry="3" rx="3" name="Config" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="320"></rect><text class="actor actor-box" alignment-baseline="central" dominant-baseline="central" style="text-anchor: middle; font-size: 16px; font-weight: 400;" y="32.5" x="395"><tspan dy="0" x="395">"ConfigMgr"</tspan></text></g></g><g><line name="Main" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="811" x2="75" y1="65" x1="75" id="actor5"></line><g id="root-5"><rect class="actor actor-top" ry="3" rx="3" name="Main" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="0"></rect><text class="actor actor-box" alignment-baseline="central" dominant-baseline="central" style="text-anchor: middle; font-size: 16px; font-weight: 400;" y="32.5" x="75"><tspan dy="0" x="75">"main()"</tspan></text></g></g><style>#mermaid-37yia84qml7{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-37yia84qml7 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-37yia84qml7 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-37yia84qml7 .error-icon{fill:#333;}#mermaid-37yia84qml7 .error-text{fill:#cccccc;stroke:#cccccc;}#mermaid-37yia84qml7 .edge-thickness-normal{stroke-width:1px;}#mermaid-37yia84qml7 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-37yia84qml7 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-37yia84qml7 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-37yia84qml7 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-37yia84qml7 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-37yia84qml7 .marker{fill:#666;stroke:#666;}#mermaid-37yia84qml7 .marker.cross{stroke:#666;}#mermaid-37yia84qml7 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-37yia84qml7 p{margin:0;}#mermaid-37yia84qml7 .actor{stroke:#444;fill:#161616;}#mermaid-37yia84qml7 text.actor&gt;tspan{fill:#fff;stroke:none;}#mermaid-37yia84qml7 .actor-line{stroke:#444;}#mermaid-37yia84qml7 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#666;}#mermaid-37yia84qml7 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#666;}#mermaid-37yia84qml7 #arrowhead path{fill:#666;stroke:#666;}#mermaid-37yia84qml7 .sequenceNumber{fill:#999999;}#mermaid-37yia84qml7 #sequencenumber{fill:#666;}#mermaid-37yia84qml7 #crosshead path{fill:#666;stroke:#666;}#mermaid-37yia84qml7 .messageText{fill:#ccc;stroke:none;}#mermaid-37yia84qml7 .labelBox{stroke:#222;fill:#111;}#mermaid-37yia84qml7 .labelText,#mermaid-37yia84qml7 .labelText&gt;tspan{fill:#ccc;stroke:none;}#mermaid-37yia84qml7 .loopText,#mermaid-37yia84qml7 .loopText&gt;tspan{fill:#fff;stroke:none;}#mermaid-37yia84qml7 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#222;fill:#222;}#mermaid-37yia84qml7 .note{stroke:#333;fill:#222;}#mermaid-37yia84qml7 .noteText,#mermaid-37yia84qml7 .noteText&gt;tspan{fill:#ccc;stroke:none;}#mermaid-37yia84qml7 .activation0{fill:hsl(-120, 0%, 13.3333333333%);stroke:hsl(-120, 0%, 3.3333333333%);}#mermaid-37yia84qml7 .activation1{fill:hsl(-120, 0%, 13.3333333333%);stroke:hsl(-120, 0%, 3.3333333333%);}#mermaid-37yia84qml7 .activation2{fill:hsl(-120, 0%, 13.3333333333%);stroke:hsl(-120, 0%, 3.3333333333%);}#mermaid-37yia84qml7 .actorPopupMenu{position:absolute;}#mermaid-37yia84qml7 .actorPopupMenuPanel{position:absolute;fill:#161616;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-37yia84qml7 .actor-man line{stroke:#444;fill:#161616;}#mermaid-37yia84qml7 .actor-man circle,#mermaid-37yia84qml7 line{stroke:#444;fill:#161616;stroke-width:2px;}#mermaid-37yia84qml7 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g></g><defs><symbol height="24" width="24" id="computer"><path d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z" transform="scale(.5)"></path></symbol></defs><defs><symbol clip-rule="evenodd" fill-rule="evenodd" id="database"><path d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z" transform="scale(.5)"></path></symbol></defs><defs><symbol height="24" width="24" id="clock"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z" transform="scale(.5)"></path></symbol></defs><defs><marker orient="auto-start-reverse" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="7.9" id="arrowhead"><path d="M -1 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker refY="4.5" refX="4" orient="auto" markerHeight="8" markerWidth="15" id="crosshead"><path d="M 1,2 L 6,7 M 6,2 L 1,7" stroke-width="1pt" style="stroke-dasharray: 0px, 0px;" stroke="#000000" fill="none"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="15.5" id="filled-head"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="40" markerWidth="60" refY="15" refX="15" id="sequencenumber"><circle r="6" cy="15" cx="15"></circle></marker></defs><g><line class="loopLine" y2="581" x2="806" y1="581" x1="-9"></line><line class="loopLine" y2="791" x2="806" y1="581" x1="806"></line><line class="loopLine" y2="791" x2="806" y1="791" x1="-9"></line><line class="loopLine" y2="791" x2="-9" y1="581" x1="-9"></line><polygon class="labelBox" points="-9,581 41,581 41,594 32.6,601 -9,601"></polygon><text class="labelText" style="font-size: 16px; font-weight: 400;" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="594" x="16">loop</text><text class="loopText" style="font-size: 16px; font-weight: 400;" text-anchor="middle" y="599" x="423.5"><tspan x="423.5">[Main Loop]</tspan></text></g><text dy="1em" class="messageText" style="font-size: 16px; font-weight: 400;" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="80" x="234">LoadConfig("../config/config.json")</text><line marker-end="url(#arrowhead)" style="fill: none;" stroke="none" stroke-width="2" class="messageLine0" y2="117" x2="391" y1="117" x1="76"></line><text dy="1em" class="messageText" style="font-size: 16px; font-weight: 400;" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="132" x="237">Return ConfigPtr</text><line marker-end="url(#arrowhead)" stroke="none" stroke-width="2" class="messageLine1" style="stroke-dasharray: 3px, 3px; fill: none;" y2="169" x2="79" y1="169" x1="394"></line><text dy="1em" class="messageText" style="font-size: 16px; font-weight: 400;" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="184" x="334">Create and configure Logger</text><line marker-end="url(#arrowhead)" style="fill: none;" stroke="none" stroke-width="2" class="messageLine0" y2="221" x2="591" y1="221" x1="76"></line><text dy="1em" class="messageText" style="font-size: 16px; font-weight: 400;" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="236" x="434">Add file check task</text><line marker-end="url(#arrowhead)" style="fill: none;" stroke="none" stroke-width="2" class="messageLine0" y2="273" x2="791" y1="273" x1="76"></line><text dy="1em" class="messageText" style="font-size: 16px; font-weight: 400;" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="288" x="534">Start()</text><line marker-end="url(#arrowhead)" style="fill: none;" stroke="none" stroke-width="2" class="messageLine0" y2="325" x2="991" y1="325" x1="76"></line><text dy="1em" class="messageText" style="font-size: 16px; font-weight: 400;" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="340" x="996">Create EventLoopThreadPool</text><path marker-end="url(#arrowhead)" style="fill: none;" stroke="none" stroke-width="2" class="messageLine0" d="M 996,377 C 1056,367 1056,407 996,397"></path><text dy="1em" class="messageText" style="font-size: 16px; font-weight: 400;" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="422" x="996">Start DNS service</text><path marker-end="url(#arrowhead)" style="fill: none;" stroke="none" stroke-width="2" class="messageLine0" d="M 996,459 C 1056,449 1056,489 996,479"></path><text dy="1em" class="messageText" style="font-size: 16px; font-weight: 400;" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="504" x="996">Create and start protocol servers</text><path marker-end="url(#arrowhead)" style="fill: none;" stroke="none" stroke-width="2" class="messageLine0" d="M 996,541 C 1056,531 1056,571 996,561"></path><text dy="1em" class="messageText" style="font-size: 16px; font-weight: 400;" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="632" x="434">OnWork()</text><line marker-end="url(#arrowhead)" style="fill: none;" stroke="none" stroke-width="2" class="messageLine0" y2="669" x2="791" y1="669" x1="76"></line><text dy="1em" class="messageText" style="font-size: 16px; font-weight: 400;" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="684" x="76">Sleep for 50ms</text><path marker-end="url(#arrowhead)" style="fill: none;" stroke="none" stroke-width="2" class="messageLine0" d="M 76,721 C 136,711 136,751 76,741"></path></svg></div><div class="bg-input-dark absolute right-2 top-2 rounded-sm p-1 opacity-0 transition-opacity group-hover:opacity-100"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="light:text-gray-800 text-white dark:text-white"><path d="M216,48V96a8,8,0,0,1-16,0V67.31l-42.34,42.35a8,8,0,0,1-11.32-11.32L188.69,56H160a8,8,0,0,1,0-16h48A8,8,0,0,1,216,48ZM98.34,146.34,56,188.69V160a8,8,0,0,0-16,0v48a8,8,0,0,0,8,8H96a8,8,0,0,0,0-16H67.31l42.35-42.34a8,8,0,0,0-11.32-11.32ZM208,152a8,8,0,0,0-8,8v28.69l-42.34-42.35a8,8,0,0,0-11.32,11.32L188.69,200H160a8,8,0,0,0,0,16h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152ZM67.31,56H96a8,8,0,0,0,0-16H48a8,8,0,0,0-8,8V96a8,8,0,0,0,16,0V67.31l42.34,42.35a8,8,0,0,0,11.32-11.32Z"></path></svg></div></div></pre>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">资料来源：
src/main/main.cc
15-55
src/live/liveservice.cc
197-230</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<h2 id="session-and-stream-management" class="group flex items-center" data-header="true"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">会话和流管理</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h2>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">流媒体系统的核心是会话和流管理：</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><div class="group relative cursor-pointer overflow-x-auto rounded-md bg-[#f2f1f0] p-4 transition-colors hover:bg-[#ededed] dark:bg-[#1f1f1f] dark:hover:bg-[#242424]" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«rf»" data-state="closed"><div class="flex justify-center"><svg aria-roledescription="class" role="graphics-document document" viewBox="0 0 835.1416625976562 794" style="max-width: 835.1416625976562px;" class="classDiagram" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-xncgb0fsk9o"><style>#mermaid-xncgb0fsk9o{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-xncgb0fsk9o .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-xncgb0fsk9o .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-xncgb0fsk9o .error-icon{fill:#333;}#mermaid-xncgb0fsk9o .error-text{fill:#cccccc;stroke:#cccccc;}#mermaid-xncgb0fsk9o .edge-thickness-normal{stroke-width:1px;}#mermaid-xncgb0fsk9o .edge-thickness-thick{stroke-width:3.5px;}#mermaid-xncgb0fsk9o .edge-pattern-solid{stroke-dasharray:0;}#mermaid-xncgb0fsk9o .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-xncgb0fsk9o .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-xncgb0fsk9o .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-xncgb0fsk9o .marker{fill:#666;stroke:#666;}#mermaid-xncgb0fsk9o .marker.cross{stroke:#666;}#mermaid-xncgb0fsk9o svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-xncgb0fsk9o p{margin:0;}#mermaid-xncgb0fsk9o g.classGroup text{fill:#222;stroke:none;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:10px;}#mermaid-xncgb0fsk9o g.classGroup text .title{font-weight:bolder;}#mermaid-xncgb0fsk9o .nodeLabel,#mermaid-xncgb0fsk9o .edgeLabel{color:#ccc;}#mermaid-xncgb0fsk9o .edgeLabel .label rect{fill:#111;}#mermaid-xncgb0fsk9o .label text{fill:#ccc;}#mermaid-xncgb0fsk9o .labelBkg{background:#111;}#mermaid-xncgb0fsk9o .edgeLabel .label span{background:#111;}#mermaid-xncgb0fsk9o .classTitle{font-weight:bolder;}#mermaid-xncgb0fsk9o .node rect,#mermaid-xncgb0fsk9o .node circle,#mermaid-xncgb0fsk9o .node ellipse,#mermaid-xncgb0fsk9o .node polygon,#mermaid-xncgb0fsk9o .node path{fill:#111;stroke:#222;stroke-width:1px;}#mermaid-xncgb0fsk9o .divider{stroke:#222;stroke-width:1;}#mermaid-xncgb0fsk9o g.clickable{cursor:pointer;}#mermaid-xncgb0fsk9o g.classGroup rect{fill:#111;stroke:#222;}#mermaid-xncgb0fsk9o g.classGroup line{stroke:#222;stroke-width:1;}#mermaid-xncgb0fsk9o .classLabel .box{stroke:none;stroke-width:0;fill:#111;opacity:0.5;}#mermaid-xncgb0fsk9o .classLabel .label{fill:#222;font-size:10px;}#mermaid-xncgb0fsk9o .relation{stroke:#666;stroke-width:1;fill:none;}#mermaid-xncgb0fsk9o .dashed-line{stroke-dasharray:3;}#mermaid-xncgb0fsk9o .dotted-line{stroke-dasharray:1 2;}#mermaid-xncgb0fsk9o #compositionStart,#mermaid-xncgb0fsk9o .composition{fill:#666!important;stroke:#666!important;stroke-width:1;}#mermaid-xncgb0fsk9o #compositionEnd,#mermaid-xncgb0fsk9o .composition{fill:#666!important;stroke:#666!important;stroke-width:1;}#mermaid-xncgb0fsk9o #dependencyStart,#mermaid-xncgb0fsk9o .dependency{fill:#666!important;stroke:#666!important;stroke-width:1;}#mermaid-xncgb0fsk9o #dependencyStart,#mermaid-xncgb0fsk9o .dependency{fill:#666!important;stroke:#666!important;stroke-width:1;}#mermaid-xncgb0fsk9o #extensionStart,#mermaid-xncgb0fsk9o .extension{fill:transparent!important;stroke:#666!important;stroke-width:1;}#mermaid-xncgb0fsk9o #extensionEnd,#mermaid-xncgb0fsk9o .extension{fill:transparent!important;stroke:#666!important;stroke-width:1;}#mermaid-xncgb0fsk9o #aggregationStart,#mermaid-xncgb0fsk9o .aggregation{fill:transparent!important;stroke:#666!important;stroke-width:1;}#mermaid-xncgb0fsk9o #aggregationEnd,#mermaid-xncgb0fsk9o .aggregation{fill:transparent!important;stroke:#666!important;stroke-width:1;}#mermaid-xncgb0fsk9o #lollipopStart,#mermaid-xncgb0fsk9o .lollipop{fill:#111!important;stroke:#666!important;stroke-width:1;}#mermaid-xncgb0fsk9o #lollipopEnd,#mermaid-xncgb0fsk9o .lollipop{fill:#111!important;stroke:#666!important;stroke-width:1;}#mermaid-xncgb0fsk9o .edgeTerminals{font-size:11px;line-height:initial;}#mermaid-xncgb0fsk9o .classTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-xncgb0fsk9o :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="18" class="marker aggregation class" id="mermaid-xncgb0fsk9o_class-aggregationStart"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="1" class="marker aggregation class" id="mermaid-xncgb0fsk9o_class-aggregationEnd"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="18" class="marker extension class" id="mermaid-xncgb0fsk9o_class-extensionStart"><path d="M 1,7 L18,13 V 1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="1" class="marker extension class" id="mermaid-xncgb0fsk9o_class-extensionEnd"><path d="M 1,1 V 13 L18,7 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="18" class="marker composition class" id="mermaid-xncgb0fsk9o_class-compositionStart"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="1" class="marker composition class" id="mermaid-xncgb0fsk9o_class-compositionEnd"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="6" class="marker dependency class" id="mermaid-xncgb0fsk9o_class-dependencyStart"><path d="M 5,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="13" class="marker dependency class" id="mermaid-xncgb0fsk9o_class-dependencyEnd"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="13" class="marker lollipop class" id="mermaid-xncgb0fsk9o_class-lollipopStart"><circle r="6" cy="7" cx="7" fill="transparent" stroke="black"></circle></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="1" class="marker lollipop class" id="mermaid-xncgb0fsk9o_class-lollipopEnd"><circle r="6" cy="7" cx="7" fill="transparent" stroke="black"></circle></marker></defs><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#mermaid-xncgb0fsk9o_class-dependencyEnd)" style=";" class="edge-thickness-normal edge-pattern-solid relation" id="id_LiveService_Session_1" d="M354.829,182L354.829,188.167C354.829,194.333,354.829,206.667,354.829,218C354.829,229.333,354.829,239.667,354.829,244.833L354.829,250"></path><path marker-end="url(#mermaid-xncgb0fsk9o_class-dependencyEnd)" style=";" class="edge-thickness-normal edge-pattern-solid relation" id="id_Session_Stream_2" d="M246.508,457.886L229.948,470.405C213.388,482.924,180.267,507.962,163.706,525.648C147.146,543.333,147.146,553.667,147.146,558.833L147.146,564"></path><path marker-end="url(#mermaid-xncgb0fsk9o_class-dependencyEnd)" style=";" class="edge-thickness-normal edge-pattern-solid relation" id="id_Session_Publisher_3" d="M356.767,496L356.867,502.167C356.966,508.333,357.165,520.667,362.799,539.583C368.432,558.499,379.499,583.997,385.033,596.747L390.567,609.496"></path><path marker-end="url(#mermaid-xncgb0fsk9o_class-dependencyEnd)" style=";" class="edge-thickness-normal edge-pattern-solid relation" id="id_Session_PlayerUser_4" d="M463.15,448.183L484.364,462.319C505.577,476.455,548.004,504.728,578.973,531.734C609.943,558.739,629.454,584.479,639.21,597.349L648.965,610.218"></path><path marker-start="url(#mermaid-xncgb0fsk9o_class-extensionStart)" style=";" class="edge-thickness-normal edge-pattern-solid relation" id="id_User_Publisher_5" d="M596.092,472.207L585.112,482.339C574.133,492.471,552.174,512.736,530.834,536.535C509.495,560.333,488.776,587.667,478.416,601.333L468.056,615"></path><path marker-start="url(#mermaid-xncgb0fsk9o_class-extensionStart)" style=";" class="edge-thickness-normal edge-pattern-solid relation" id="id_User_PlayerUser_6" d="M700.346,478L700.346,487.167C700.346,496.333,700.346,514.667,700.346,537.5C700.346,560.333,700.346,587.667,700.346,601.333L700.346,615"></path></g><g class="edgeLabels"><g transform="translate(354.8291778564453, 219)" class="edgeLabel"><g transform="translate(-32.5, -12)" class="label"><foreignObject height="24" width="65"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel" style=";display: inline-block"><p>manages</p></span></div></foreignObject></g></g><g transform="translate(147.14584350585938, 533)" class="edgeLabel"><g transform="translate(-18.991668701171875, -12)" class="label"><foreignObject height="24" width="37.98333740234375"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel" style=";display: inline-block"><p>owns</p></span></div></foreignObject></g></g><g transform="translate(357.36459732055664, 533)" class="edgeLabel"><g transform="translate(-48.07499694824219, -12)" class="label"><foreignObject height="24" width="96.14999389648438"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel" style=";display: inline-block"><p>has publisher</p></span></div></foreignObject></g></g><g transform="translate(590.431266784668, 533)" class="edgeLabel"><g transform="translate(-40.21666717529297, -12)" class="label"><foreignObject height="24" width="80.43333435058594"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel" style=";display: inline-block"><p>has players</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, -12)" class="label"><foreignObject height="24" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel" style=";display: inline-block"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, -12)" class="label"><foreignObject height="24" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel" style=";display: inline-block"></span></div></foreignObject></g></g><g transform="translate(339.82917892822263, 199.5000009186663)" class="edgeTerminals"><g transform="translate(0, 0)" class="inner"><foreignObject style="width: 9px; height: 12px;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; padding-right: 1px; white-space: nowrap;"><span style=";display: inline-block" class="edgeLabel">1</span></div></foreignObject></g></g><g transform="translate(223.502808858451, 456.4735301569894)" class="edgeTerminals"><g transform="translate(0, 0)" class="inner"><foreignObject style="width: 9px; height: 12px;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; padding-right: 1px; white-space: nowrap;"><span style=";display: inline-block" class="edgeLabel">1</span></div></foreignObject></g></g><g transform="translate(342.05160965895885, 513.739927942589)" class="edgeTerminals"><g transform="translate(0, 0)" class="inner"><foreignObject style="width: 9px; height: 12px;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; padding-right: 1px; white-space: nowrap;"><span style=";display: inline-block" class="edgeLabel">1</span></div></foreignObject></g></g><g transform="translate(469.3948221857425, 470.3693559935267)" class="edgeTerminals"><g transform="translate(0, 0)" class="inner"><foreignObject style="width: 9px; height: 12px;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; padding-right: 1px; white-space: nowrap;"><span style=";display: inline-block" class="edgeLabel">1</span></div></foreignObject></g></g><g transform="translate(364.82917892822263, 233.5000009186663)" class="edgeTerminals"><g transform="translate(0, 0)" class="inner"></g><foreignObject style="width: 9px; height: 12px;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; padding-right: 1px; white-space: nowrap;"><span style=";display: inline-block" class="edgeLabel">*</span></div></foreignObject></g><g transform="translate(157.1458417529296, 547.4999984974888)" class="edgeTerminals"><g transform="translate(0, 0)" class="inner"></g><foreignObject style="width: 9px; height: 12px;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; padding-right: 1px; white-space: nowrap;"><span style=";display: inline-block" class="edgeLabel">1</span></div></foreignObject></g><g transform="translate(394.7478131786008, 587.9746361562937)" class="edgeTerminals"><g transform="translate(0, 0)" class="inner"></g><foreignObject style="width: 36px; height: 12px;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; padding-right: 1px; white-space: nowrap;"><span style=";display: inline-block" class="edgeLabel">0..1</span></div></foreignObject></g><g transform="translate(648.9720668247674, 586.9926217892145)" class="edgeTerminals"><g transform="translate(0, 0)" class="inner"></g><foreignObject style="width: 9px; height: 12px;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; padding-right: 1px; white-space: nowrap;"><span style=";display: inline-block" class="edgeLabel">*</span></div></foreignObject></g></g><g class="nodes"><g transform="translate(354.8291778564453, 95)" id="classId-LiveService-15" class="node default"><g class="basic label-container"><path style="" fill="#111" stroke-width="0" stroke="none" d="M-142.9708251953125 -87 L142.9708251953125 -87 L142.9708251953125 87 L-142.9708251953125 87"></path><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-142.9708251953125 -87 C-60.45064000267382 -87, 22.069545189964856 -87, 142.9708251953125 -87 M-142.9708251953125 -87 C-41.24766982556416 -87, 60.47548554418418 -87, 142.9708251953125 -87 M142.9708251953125 -87 C142.9708251953125 -28.298360049064506, 142.9708251953125 30.403279901870988, 142.9708251953125 87 M142.9708251953125 -87 C142.9708251953125 -38.50702478306932, 142.9708251953125 9.985950433861362, 142.9708251953125 87 M142.9708251953125 87 C62.72051210870944 87, -17.529800977893615 87, -142.9708251953125 87 M142.9708251953125 87 C45.60639528930554 87, -51.75803461670142 87, -142.9708251953125 87 M-142.9708251953125 87 C-142.9708251953125 32.715205729944955, -142.9708251953125 -21.56958854011009, -142.9708251953125 -87 M-142.9708251953125 87 C-142.9708251953125 39.9461162547547, -142.9708251953125 -7.107767490490602, -142.9708251953125 -87"></path></g><g transform="translate(0, -63)" class="annotation-group text"></g><g transform="translate(-43.791664123535156, -63)" class="label-group text"><g transform="translate(0,-12)" style="font-weight: bolder" class="label"><foreignObject height="24" width="87.58332824707031"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 134px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>LiveService</p></span></div></foreignObject></g></g><g transform="translate(-130.9708251953125, -15)" class="members-group text"></g><g transform="translate(-130.9708251953125, 15)" class="methods-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="218.14999389648438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 280px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+CreateSession(sessionName)</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="200.78334045410156"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 263px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+FindSession(sessionName)</p></span></div></foreignObject></g><g transform="translate(0,36)" style="" class="label"><foreignObject height="24" width="209.3333282470703"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 273px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+CloseSession(sessionName)</p></span></div></foreignObject></g></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-142.9708251953125 -39 C-66.1849623400001 -39, 10.600900515312304 -39, 142.9708251953125 -39 M-142.9708251953125 -39 C-61.754804729160654 -39, 19.461215736991193 -39, 142.9708251953125 -39"></path></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-142.9708251953125 -15 C-78.96711529569036 -15, -14.963405396068225 -15, 142.9708251953125 -15 M-142.9708251953125 -15 C-74.92959691496127 -15, -6.888368634610032 -15, 142.9708251953125 -15"></path></g></g><g transform="translate(354.8291778564453, 376)" id="classId-Session-16" class="node default"><g class="basic label-container"><path style="" fill="#111" stroke-width="0" stroke="none" d="M-108.32083129882812 -120 L108.32083129882812 -120 L108.32083129882812 120 L-108.32083129882812 120"></path><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-108.32083129882812 -120 C-43.76223178932695 -120, 20.79636772017423 -120, 108.32083129882812 -120 M-108.32083129882812 -120 C-56.82647391822478 -120, -5.332116537621431 -120, 108.32083129882812 -120 M108.32083129882812 -120 C108.32083129882812 -67.8959532965502, 108.32083129882812 -15.791906593100421, 108.32083129882812 120 M108.32083129882812 -120 C108.32083129882812 -54.80251665870918, 108.32083129882812 10.39496668258164, 108.32083129882812 120 M108.32083129882812 120 C30.940823823582093 120, -46.43918365166394 120, -108.32083129882812 120 M108.32083129882812 120 C43.598557545522524 120, -21.123716207783076 120, -108.32083129882812 120 M-108.32083129882812 120 C-108.32083129882812 32.92886591304057, -108.32083129882812 -54.142268173918865, -108.32083129882812 -120 M-108.32083129882812 120 C-108.32083129882812 48.558794634969544, -108.32083129882812 -22.88241073006091, -108.32083129882812 -120"></path></g><g transform="translate(0, -96)" class="annotation-group text"></g><g transform="translate(-28.974998474121094, -96)" class="label-group text"><g transform="translate(0,-12)" style="font-weight: bolder" class="label"><foreignObject height="24" width="57.94999694824219"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 108px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>Session</p></span></div></foreignObject></g></g><g transform="translate(-96.32083129882812, -48)" class="members-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="163.6666717529297"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 229px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-session_name_: string</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="145.68333435058594"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 209px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-stream_: StreamPtr</p></span></div></foreignObject></g><g transform="translate(0,36)" style="" class="label"><foreignObject height="24" width="143.73333740234375"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 206px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-publisher_: UserPtr</p></span></div></foreignObject></g><g transform="translate(0,60)" style="" class="label"><foreignObject height="24" width="94.91667175292969"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 158px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-players_: set</p></span></div></foreignObject></g></g><g transform="translate(-96.32083129882812, 72)" class="methods-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="125.36666870117188"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 182px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+AddPlayer(user)</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="142.88333129882812"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 201px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+SetPublisher(user)</p></span></div></foreignObject></g></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-108.32083129882812 -72 C-36.33504971405945 -72, 35.65073187070922 -72, 108.32083129882812 -72 M-108.32083129882812 -72 C-63.77499065024175 -72, -19.22915000165537 -72, 108.32083129882812 -72"></path></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-108.32083129882812 48 C-48.493020590820606 48, 11.334790117186913 48, 108.32083129882812 48 M-108.32083129882812 48 C-50.665149263538716 48, 6.9905327717506935 48, 108.32083129882812 48"></path></g></g><g transform="translate(147.14584350585938, 678)" id="classId-Stream-17" class="node default"><g class="basic label-container"><path style="" fill="#111" stroke-width="0" stroke="none" d="M-139.14583587646484 -108 L139.14583587646484 -108 L139.14583587646484 108 L-139.14583587646484 108"></path><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-139.14583587646484 -108 C-72.51966473190608 -108, -5.893493587347308 -108, 139.14583587646484 -108 M-139.14583587646484 -108 C-55.01359353847178 -108, 29.11864879952128 -108, 139.14583587646484 -108 M139.14583587646484 -108 C139.14583587646484 -31.89016742019929, 139.14583587646484 44.21966515960142, 139.14583587646484 108 M139.14583587646484 -108 C139.14583587646484 -40.16212929032989, 139.14583587646484 27.675741419340227, 139.14583587646484 108 M139.14583587646484 108 C29.033200326312254 108, -81.07943522384033 108, -139.14583587646484 108 M139.14583587646484 108 C52.05598541469385 108, -35.03386504707714 108, -139.14583587646484 108 M-139.14583587646484 108 C-139.14583587646484 63.62470661094723, -139.14583587646484 19.249413221894457, -139.14583587646484 -108 M-139.14583587646484 108 C-139.14583587646484 54.75201057093181, -139.14583587646484 1.5040211418636176, -139.14583587646484 -108"></path></g><g transform="translate(0, -84)" class="annotation-group text"></g><g transform="translate(-27.508331298828125, -84)" class="label-group text"><g transform="translate(0,-12)" style="font-weight: bolder" class="label"><foreignObject height="24" width="55.01666259765625"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 103px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>Stream</p></span></div></foreignObject></g></g><g transform="translate(-127.14583587646484, -36)" class="members-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="168.81666564941406"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 230px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-packet_buffer_: vector</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="144.43333435058594"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 207px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-gop_mgr_: GopMgr</p></span></div></foreignObject></g><g transform="translate(0,36)" style="" class="label"><foreignObject height="24" width="226.78334045410156"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 294px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-codec_headers_: CodecHeader</p></span></div></foreignObject></g></g><g transform="translate(-127.14583587646484, 60)" class="methods-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="145.64999389648438"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 205px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+AddPacket(packet)</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="129.51666259765625"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 187px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+GetFrames(user)</p></span></div></foreignObject></g></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-139.14584350585938 -60 C-66.1672772067431 -60, 6.811289092373187 -60, 139.14584350585938 -60 M-139.14584350585938 -60 C-40.11814249451017 -60, 58.90955851683904 -60, 139.14584350585938 -60"></path></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-139.14584350585938 36 C-74.1945111248206 36, -9.243178743781812 36, 139.14584350585938 36 M-139.14584350585938 36 C-58.78330483095826 36, 21.57923384394286 36, 139.14584350585938 36"></path></g></g><g transform="translate(700.3458480834961, 376)" id="classId-User-18" class="node default"><g class="basic label-container"><path style="" fill="#111" stroke-width="0" stroke="none" d="M-126.79583740234375 -84 L126.79583740234375 -84 L126.79583740234375 84 L-126.79583740234375 84"></path><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-126.79583740234375 -84 C-54.274551040114986 -84, 18.24673532211378 -84, 126.79583740234375 -84 M-126.79583740234375 -84 C-72.42671576874818 -84, -18.057594135152613 -84, 126.79583740234375 -84 M126.79583740234375 -84 C126.79583740234375 -34.19322971580017, 126.79583740234375 15.613540568399657, 126.79583740234375 84 M126.79583740234375 -84 C126.79583740234375 -45.61789851396322, 126.79583740234375 -7.235797027926438, 126.79583740234375 84 M126.79583740234375 84 C60.91405719510459 84, -4.96772301213457 84, -126.79583740234375 84 M126.79583740234375 84 C57.913052595654776 84, -10.969732211034199 84, -126.79583740234375 84 M-126.79583740234375 84 C-126.79583740234375 43.011275053395046, -126.79583740234375 2.022550106790092, -126.79583740234375 -84 M-126.79583740234375 84 C-126.79583740234375 31.470240398334127, -126.79583740234375 -21.059519203331746, -126.79583740234375 -84"></path></g><g transform="translate(0, -60)" class="annotation-group text"></g><g transform="translate(-17.59166717529297, -60)" class="label-group text"><g transform="translate(0,-12)" style="font-weight: bolder" class="label"><foreignObject height="24" width="35.18333435058594"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 84px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>User</p></span></div></foreignObject></g></g><g transform="translate(-114.79583740234375, -12)" class="members-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="212"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 270px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>#connection_: ConnectionPtr</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="155.93333435058594"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 219px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>#session_: SessionPtr</p></span></div></foreignObject></g><g transform="translate(0,36)" style="" class="label"><foreignObject height="24" width="151.56666564941406"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 210px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>#stream_: StreamPtr</p></span></div></foreignObject></g></g><g transform="translate(-114.79583740234375, 84)" class="methods-group text"></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-126.79583740234375 -36 C-47.957342325955594 -36, 30.881152750432562 -36, 126.79583740234375 -36 M-126.79583740234375 -36 C-54.229383404894534 -36, 18.33707059255468 -36, 126.79583740234375 -36"></path></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-126.79583740234375 60 C-59.890393714953476 60, 7.015049972436799 60, 126.79583740234375 60 M-126.79583740234375 60 C-27.065806766220987 60, 72.66422386990178 60, 126.79583740234375 60"></path></g></g><g transform="translate(420.3000183105469, 678)" id="classId-Publisher-19" class="node default"><g class="basic label-container"><path style="" fill="#111" stroke-width="0" stroke="none" d="M-84.00833129882812 -63 L84.00833129882812 -63 L84.00833129882812 63 L-84.00833129882812 63"></path><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-84.00833129882812 -63 C-44.63440350818918 -63, -5.260475717550236 -63, 84.00833129882812 -63 M-84.00833129882812 -63 C-28.895009815405416 -63, 26.218311668017293 -63, 84.00833129882812 -63 M84.00833129882812 -63 C84.00833129882812 -20.695238786808403, 84.00833129882812 21.609522426383194, 84.00833129882812 63 M84.00833129882812 -63 C84.00833129882812 -32.87059816777651, 84.00833129882812 -2.7411963355530204, 84.00833129882812 63 M84.00833129882812 63 C17.224014456840692 63, -49.56030238514674 63, -84.00833129882812 63 M84.00833129882812 63 C43.13578948232655 63, 2.263247665824977 63, -84.00833129882812 63 M-84.00833129882812 63 C-84.00833129882812 14.427655489419472, -84.00833129882812 -34.14468902116106, -84.00833129882812 -63 M-84.00833129882812 63 C-84.00833129882812 23.94774405859659, -84.00833129882812 -15.104511882806818, -84.00833129882812 -63"></path></g><g transform="translate(0, -39)" class="annotation-group text"></g><g transform="translate(-36.166664123535156, -39)" class="label-group text"><g transform="translate(0,-12)" style="font-weight: bolder" class="label"><foreignObject height="24" width="72.33332824707031"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 118px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>Publisher</p></span></div></foreignObject></g></g><g transform="translate(-72.00833129882812, 9)" class="members-group text"></g><g transform="translate(-72.00833129882812, 39)" class="methods-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="107.85000610351562"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 165px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+OnRecv(data)</p></span></div></foreignObject></g></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-84.00833129882812 -15 C-47.291433427287444 -15, -10.574535555746763 -15, 84.00833129882812 -15 M-84.00833129882812 -15 C-20.24517973272519 -15, 43.51797183337774 -15, 84.00833129882812 -15"></path></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-84.00833129882812 9 C-45.7095123132262 9, -7.410693327624273 9, 84.00833129882812 9 M-84.00833129882812 9 C-29.995564358420758 9, 24.01720258198661 9, 84.00833129882812 9"></path></g></g><g transform="translate(700.3458480834961, 678)" id="classId-PlayerUser-20" class="node default"><g class="basic label-container"><path style="" fill="#111" stroke-width="0" stroke="none" d="M-85.82083129882812 -63 L85.82083129882812 -63 L85.82083129882812 63 L-85.82083129882812 63"></path><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-85.82083129882812 -63 C-28.52194151444565 -63, 28.776948269936824 -63, 85.82083129882812 -63 M-85.82083129882812 -63 C-26.24897674217732 -63, 33.322877814473486 -63, 85.82083129882812 -63 M85.82083129882812 -63 C85.82083129882812 -27.509432707955092, 85.82083129882812 7.981134584089816, 85.82083129882812 63 M85.82083129882812 -63 C85.82083129882812 -12.622777565799076, 85.82083129882812 37.75444486840185, 85.82083129882812 63 M85.82083129882812 63 C43.90527176508283 63, 1.9897122313375348 63, -85.82083129882812 63 M85.82083129882812 63 C48.639098292494175 63, 11.457365286160226 63, -85.82083129882812 63 M-85.82083129882812 63 C-85.82083129882812 35.404633773049326, -85.82083129882812 7.809267546098653, -85.82083129882812 -63 M-85.82083129882812 63 C-85.82083129882812 31.743962779026294, -85.82083129882812 0.48792555805258786, -85.82083129882812 -63"></path></g><g transform="translate(0, -39)" class="annotation-group text"></g><g transform="translate(-42.025001525878906, -39)" class="label-group text"><g transform="translate(0,-12)" style="font-weight: bolder" class="label"><foreignObject height="24" width="84.05000305175781"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 130px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>PlayerUser</p></span></div></foreignObject></g></g><g transform="translate(-73.82083129882812, 9)" class="members-group text"></g><g transform="translate(-73.82083129882812, 39)" class="methods-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="105.61666870117188"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 162px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+PostFrames()</p></span></div></foreignObject></g></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-85.82083129882812 -15 C-22.896176616658522 -15, 40.02847806551108 -15, 85.82083129882812 -15 M-85.82083129882812 -15 C-36.105405342788806 -15, 13.610020613250512 -15, 85.82083129882812 -15"></path></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-85.82083129882812 9 C-29.978614259099395 9, 25.863602780629336 9, 85.82083129882812 9 M-85.82083129882812 9 C-40.05426754358348 9, 5.712296211661169 9, 85.82083129882812 9"></path></g></g></g></g></g></svg></div><div class="bg-input-dark absolute right-2 top-2 rounded-sm p-1 opacity-0 transition-opacity group-hover:opacity-100"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="light:text-gray-800 text-white dark:text-white"><path d="M216,48V96a8,8,0,0,1-16,0V67.31l-42.34,42.35a8,8,0,0,1-11.32-11.32L188.69,56H160a8,8,0,0,1,0-16h48A8,8,0,0,1,216,48ZM98.34,146.34,56,188.69V160a8,8,0,0,0-16,0v48a8,8,0,0,0,8,8H96a8,8,0,0,0,0-16H67.31l42.35-42.34a8,8,0,0,0-11.32-11.32ZM208,152a8,8,0,0,0-8,8v28.69l-42.34-42.35a8,8,0,0,0-11.32,11.32L188.69,200H160a8,8,0,0,0,0,16h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152ZM67.31,56H96a8,8,0,0,0,0-16H48a8,8,0,0,0-8,8V96a8,8,0,0,0,16,0V67.31l42.34,42.35a8,8,0,0,0,11.32-11.32Z"></path></svg></div></div></pre>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">资料来源：
src/live/liveservice.cc
28-85</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<h2 id="configuration-system" class="group flex items-center" data-header="true"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">配置系统</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h2>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">StreamMediaserver使用基于JSON的配置系统：</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><div class="group relative cursor-pointer overflow-x-auto rounded-md bg-[#f2f1f0] p-4 transition-colors hover:bg-[#ededed] dark:bg-[#1f1f1f] dark:hover:bg-[#242424]" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«ri»" data-state="closed"><div class="flex justify-center"><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 738.5333862304688 482" style="max-width: 738.5333862304688px;" class="flowchart" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-sfc898ve619"><style>#mermaid-sfc898ve619{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-sfc898ve619 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-sfc898ve619 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-sfc898ve619 .error-icon{fill:#333;}#mermaid-sfc898ve619 .error-text{fill:#cccccc;stroke:#cccccc;}#mermaid-sfc898ve619 .edge-thickness-normal{stroke-width:1px;}#mermaid-sfc898ve619 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-sfc898ve619 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-sfc898ve619 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-sfc898ve619 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-sfc898ve619 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-sfc898ve619 .marker{fill:#666;stroke:#666;}#mermaid-sfc898ve619 .marker.cross{stroke:#666;}#mermaid-sfc898ve619 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-sfc898ve619 p{margin:0;}#mermaid-sfc898ve619 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#fff;}#mermaid-sfc898ve619 .cluster-label text{fill:#fff;}#mermaid-sfc898ve619 .cluster-label span{color:#fff;}#mermaid-sfc898ve619 .cluster-label span p{background-color:transparent;}#mermaid-sfc898ve619 .label text,#mermaid-sfc898ve619 span{fill:#fff;color:#fff;}#mermaid-sfc898ve619 .node rect,#mermaid-sfc898ve619 .node circle,#mermaid-sfc898ve619 .node ellipse,#mermaid-sfc898ve619 .node polygon,#mermaid-sfc898ve619 .node path{fill:#111;stroke:#222;stroke-width:1px;}#mermaid-sfc898ve619 .rough-node .label text,#mermaid-sfc898ve619 .node .label text,#mermaid-sfc898ve619 .image-shape .label,#mermaid-sfc898ve619 .icon-shape .label{text-anchor:middle;}#mermaid-sfc898ve619 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-sfc898ve619 .rough-node .label,#mermaid-sfc898ve619 .node .label,#mermaid-sfc898ve619 .image-shape .label,#mermaid-sfc898ve619 .icon-shape .label{text-align:center;}#mermaid-sfc898ve619 .node.clickable{cursor:pointer;}#mermaid-sfc898ve619 .root .anchor path{fill:#666!important;stroke-width:0;stroke:#666;}#mermaid-sfc898ve619 .arrowheadPath{fill:#0b0b0b;}#mermaid-sfc898ve619 .edgePath .path{stroke:#666;stroke-width:2.0px;}#mermaid-sfc898ve619 .flowchart-link{stroke:#666;fill:none;}#mermaid-sfc898ve619 .edgeLabel{background-color:#161616;text-align:center;}#mermaid-sfc898ve619 .edgeLabel p{background-color:#161616;}#mermaid-sfc898ve619 .edgeLabel rect{opacity:0.5;background-color:#161616;fill:#161616;}#mermaid-sfc898ve619 .labelBkg{background-color:rgba(22, 22, 22, 0.5);}#mermaid-sfc898ve619 .cluster rect{fill:#161616;stroke:#222;stroke-width:1px;}#mermaid-sfc898ve619 .cluster text{fill:#fff;}#mermaid-sfc898ve619 .cluster span{color:#fff;}#mermaid-sfc898ve619 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:#333;border:1px solid hsl(0, 0%, 10%);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-sfc898ve619 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-sfc898ve619 rect.text{fill:none;stroke-width:0;}#mermaid-sfc898ve619 .icon-shape,#mermaid-sfc898ve619 .image-shape{background-color:#161616;text-align:center;}#mermaid-sfc898ve619 .icon-shape p,#mermaid-sfc898ve619 .image-shape p{background-color:#161616;padding:2px;}#mermaid-sfc898ve619 .icon-shape rect,#mermaid-sfc898ve619 .image-shape rect{opacity:0.5;background-color:#161616;fill:#161616;}#mermaid-sfc898ve619 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-sfc898ve619_flowchart-v2-pointEnd"><path style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-sfc898ve619_flowchart-v2-pointStart"><path style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-sfc898ve619_flowchart-v2-circleEnd"><circle style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-sfc898ve619_flowchart-v2-circleStart"><circle style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid-sfc898ve619_flowchart-v2-crossEnd"><path style="stroke-width: 2px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid-sfc898ve619_flowchart-v2-crossStart"><path style="stroke-width: 2px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"><g data-look="classic" id="subGraph1" class="cluster"><rect height="312" width="545.9833374023438" y="162" x="8" style=""></rect><g transform="translate(202.32500457763672, 162)" class="cluster-label"><foreignObject height="24" width="157.3333282470703"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Configuration Classes</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph0" class="cluster"><rect height="104" width="404.5500030517578" y="8" x="76.10000228881836" style=""></rect><g transform="translate(209.65000534057617, 8)" class="cluster-label"><foreignObject height="24" width="137.4499969482422"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Configuration Files</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid-sfc898ve619_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CF_CM_0" d="M180.658,87L180.658,91.167C180.658,95.333,180.658,103.667,180.658,112C180.658,120.333,180.658,128.667,180.658,137C180.658,145.333,180.658,153.667,187.422,161.671C194.186,169.675,207.714,177.351,214.478,181.188L221.242,185.026"></path><path marker-end="url(#mermaid-sfc898ve619_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_DF_CM_0" d="M372.933,87L372.933,91.167C372.933,95.333,372.933,103.667,372.933,112C372.933,120.333,372.933,128.667,372.933,137C372.933,145.333,372.933,153.667,365.463,161.694C357.992,169.721,343.051,177.442,335.58,181.303L328.109,185.164"></path><path marker-end="url(#mermaid-sfc898ve619_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CM_CO_0" d="M272.308,241L272.308,245.167C272.308,249.333,272.308,257.667,272.984,265.345C273.659,273.024,275.01,280.048,275.685,283.56L276.361,287.072"></path><path marker-end="url(#mermaid-sfc898ve619_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CO_AP_0" d="M228.392,333.572L207.371,339.644C186.35,345.715,144.308,357.857,123.288,367.429C102.267,377,102.267,384,102.267,387.5L102.267,391"></path><path marker-end="url(#mermaid-sfc898ve619_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CO_SI_0" d="M282.308,345L282.308,349.167C282.308,353.333,282.308,361.667,282.308,369.333C282.308,377,282.308,384,282.308,387.5L282.308,391"></path><path marker-end="url(#mermaid-sfc898ve619_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CO_LI_0" d="M336.225,333.687L357.026,339.739C377.828,345.791,419.431,357.896,440.232,367.448C461.033,377,461.033,384,461.033,387.5L461.033,391"></path><path marker-end="url(#mermaid-sfc898ve619_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_LS_CO_0" d="M588.983,236.683L573.738,241.569C558.492,246.455,528,256.228,486.522,267.453C445.043,278.677,392.578,291.355,366.346,297.694L340.113,304.032"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(180.6583366394043, 60)" id="flowchart-CF-0" class="node default"><rect height="54" width="139.11666870117188" y="-27" x="-69.55833435058594" style="" class="basic label-container"></rect><g transform="translate(-39.55833435058594, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="79.11666870117188"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>config.json</p></span></div></foreignObject></g></g><g transform="translate(372.9333381652832, 60)" id="flowchart-DF-1" class="node default"><rect height="54" width="145.43333435058594" y="-27" x="-72.71666717529297" style="" class="basic label-container"></rect><g transform="translate(-42.71666717529297, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="85.43333435058594"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>hx.com.json</p></span></div></foreignObject></g></g><g transform="translate(272.30834197998047, 214)" id="flowchart-CM-2" class="node default"><rect height="54" width="137.1999969482422" y="-27" x="-68.5999984741211" style="" class="basic label-container"></rect><g transform="translate(-38.599998474121094, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="77.19999694824219"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>ConfigMgr</p></span></div></foreignObject></g></g><g transform="translate(282.30834197998047, 318)" id="flowchart-CO-3" class="node default"><rect height="54" width="107.83332824707031" y="-27" x="-53.916664123535156" style="" class="basic label-container"></rect><g transform="translate(-23.916664123535156, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="47.83332824707031"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Config</p></span></div></foreignObject></g></g><g transform="translate(102.26667022705078, 422)" id="flowchart-AP-4" class="node default"><rect height="54" width="118.53334045410156" y="-27" x="-59.26667022705078" style="" class="basic label-container"></rect><g transform="translate(-29.26667022705078, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="58.53334045410156"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>AppInfo</p></span></div></foreignObject></g></g><g transform="translate(282.30834197998047, 422)" id="flowchart-SI-5" class="node default"><rect height="54" width="141.5500030517578" y="-27" x="-70.7750015258789" style="" class="basic label-container"></rect><g transform="translate(-40.775001525878906, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="81.55000305175781"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>ServiceInfo</p></span></div></foreignObject></g></g><g transform="translate(461.03334045410156, 422)" id="flowchart-LI-6" class="node default"><rect height="54" width="115.89999389648438" y="-27" x="-57.94999694824219" style="" class="basic label-container"></rect><g transform="translate(-27.949996948242188, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="55.899993896484375"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>LogInfo</p></span></div></foreignObject></g></g><g transform="translate(659.7583389282227, 214)" id="flowchart-LS-19" class="node default"><rect height="54" width="141.5500030517578" y="-27" x="-70.7750015258789" style="" class="basic label-container"></rect><g transform="translate(-40.775001525878906, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="81.55000305175781"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>LiveService</p></span></div></foreignObject></g></g></g></g></g></svg></div><div class="bg-input-dark absolute right-2 top-2 rounded-sm p-1 opacity-0 transition-opacity group-hover:opacity-100"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="light:text-gray-800 text-white dark:text-white"><path d="M216,48V96a8,8,0,0,1-16,0V67.31l-42.34,42.35a8,8,0,0,1-11.32-11.32L188.69,56H160a8,8,0,0,1,0-16h48A8,8,0,0,1,216,48ZM98.34,146.34,56,188.69V160a8,8,0,0,0-16,0v48a8,8,0,0,0,8,8H96a8,8,0,0,0,0-16H67.31l42.35-42.34a8,8,0,0,0-11.32-11.32ZM208,152a8,8,0,0,0-8,8v28.69l-42.34-42.35a8,8,0,0,0-11.32,11.32L188.69,200H160a8,8,0,0,0,0,16h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152ZM67.31,56H96a8,8,0,0,0,0-16H48a8,8,0,0,0-8,8V96a8,8,0,0,0,16,0V67.31l42.34,42.35a8,8,0,0,0,11.32-11.32Z"></path></svg></div></div></pre>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">资料来源：
src/main/main.cc
19-39
bin/config/publish/hx.com.json
1-19</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<h2 id="logging-system" class="group flex items-center" data-header="true"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">记录系统</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h2>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">该系统使用层次记录系统：</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><div class="group relative cursor-pointer overflow-x-auto rounded-md bg-[#f2f1f0] p-4 transition-colors hover:bg-[#ededed] dark:bg-[#1f1f1f] dark:hover:bg-[#242424]" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«rl»" data-state="closed"><div class="flex justify-center"><svg aria-roledescription="class" role="graphics-document document" viewBox="0 0 259.2250061035156 740" style="max-width: 259.2250061035156px;" class="classDiagram" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-n3ac9n4yqam"><style>#mermaid-n3ac9n4yqam{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-n3ac9n4yqam .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-n3ac9n4yqam .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-n3ac9n4yqam .error-icon{fill:#333;}#mermaid-n3ac9n4yqam .error-text{fill:#cccccc;stroke:#cccccc;}#mermaid-n3ac9n4yqam .edge-thickness-normal{stroke-width:1px;}#mermaid-n3ac9n4yqam .edge-thickness-thick{stroke-width:3.5px;}#mermaid-n3ac9n4yqam .edge-pattern-solid{stroke-dasharray:0;}#mermaid-n3ac9n4yqam .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-n3ac9n4yqam .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-n3ac9n4yqam .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-n3ac9n4yqam .marker{fill:#666;stroke:#666;}#mermaid-n3ac9n4yqam .marker.cross{stroke:#666;}#mermaid-n3ac9n4yqam svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-n3ac9n4yqam p{margin:0;}#mermaid-n3ac9n4yqam g.classGroup text{fill:#222;stroke:none;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:10px;}#mermaid-n3ac9n4yqam g.classGroup text .title{font-weight:bolder;}#mermaid-n3ac9n4yqam .nodeLabel,#mermaid-n3ac9n4yqam .edgeLabel{color:#ccc;}#mermaid-n3ac9n4yqam .edgeLabel .label rect{fill:#111;}#mermaid-n3ac9n4yqam .label text{fill:#ccc;}#mermaid-n3ac9n4yqam .labelBkg{background:#111;}#mermaid-n3ac9n4yqam .edgeLabel .label span{background:#111;}#mermaid-n3ac9n4yqam .classTitle{font-weight:bolder;}#mermaid-n3ac9n4yqam .node rect,#mermaid-n3ac9n4yqam .node circle,#mermaid-n3ac9n4yqam .node ellipse,#mermaid-n3ac9n4yqam .node polygon,#mermaid-n3ac9n4yqam .node path{fill:#111;stroke:#222;stroke-width:1px;}#mermaid-n3ac9n4yqam .divider{stroke:#222;stroke-width:1;}#mermaid-n3ac9n4yqam g.clickable{cursor:pointer;}#mermaid-n3ac9n4yqam g.classGroup rect{fill:#111;stroke:#222;}#mermaid-n3ac9n4yqam g.classGroup line{stroke:#222;stroke-width:1;}#mermaid-n3ac9n4yqam .classLabel .box{stroke:none;stroke-width:0;fill:#111;opacity:0.5;}#mermaid-n3ac9n4yqam .classLabel .label{fill:#222;font-size:10px;}#mermaid-n3ac9n4yqam .relation{stroke:#666;stroke-width:1;fill:none;}#mermaid-n3ac9n4yqam .dashed-line{stroke-dasharray:3;}#mermaid-n3ac9n4yqam .dotted-line{stroke-dasharray:1 2;}#mermaid-n3ac9n4yqam #compositionStart,#mermaid-n3ac9n4yqam .composition{fill:#666!important;stroke:#666!important;stroke-width:1;}#mermaid-n3ac9n4yqam #compositionEnd,#mermaid-n3ac9n4yqam .composition{fill:#666!important;stroke:#666!important;stroke-width:1;}#mermaid-n3ac9n4yqam #dependencyStart,#mermaid-n3ac9n4yqam .dependency{fill:#666!important;stroke:#666!important;stroke-width:1;}#mermaid-n3ac9n4yqam #dependencyStart,#mermaid-n3ac9n4yqam .dependency{fill:#666!important;stroke:#666!important;stroke-width:1;}#mermaid-n3ac9n4yqam #extensionStart,#mermaid-n3ac9n4yqam .extension{fill:transparent!important;stroke:#666!important;stroke-width:1;}#mermaid-n3ac9n4yqam #extensionEnd,#mermaid-n3ac9n4yqam .extension{fill:transparent!important;stroke:#666!important;stroke-width:1;}#mermaid-n3ac9n4yqam #aggregationStart,#mermaid-n3ac9n4yqam .aggregation{fill:transparent!important;stroke:#666!important;stroke-width:1;}#mermaid-n3ac9n4yqam #aggregationEnd,#mermaid-n3ac9n4yqam .aggregation{fill:transparent!important;stroke:#666!important;stroke-width:1;}#mermaid-n3ac9n4yqam #lollipopStart,#mermaid-n3ac9n4yqam .lollipop{fill:#111!important;stroke:#666!important;stroke-width:1;}#mermaid-n3ac9n4yqam #lollipopEnd,#mermaid-n3ac9n4yqam .lollipop{fill:#111!important;stroke:#666!important;stroke-width:1;}#mermaid-n3ac9n4yqam .edgeTerminals{font-size:11px;line-height:initial;}#mermaid-n3ac9n4yqam .classTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-n3ac9n4yqam :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="18" class="marker aggregation class" id="mermaid-n3ac9n4yqam_class-aggregationStart"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="1" class="marker aggregation class" id="mermaid-n3ac9n4yqam_class-aggregationEnd"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="18" class="marker extension class" id="mermaid-n3ac9n4yqam_class-extensionStart"><path d="M 1,7 L18,13 V 1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="1" class="marker extension class" id="mermaid-n3ac9n4yqam_class-extensionEnd"><path d="M 1,1 V 13 L18,7 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="18" class="marker composition class" id="mermaid-n3ac9n4yqam_class-compositionStart"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="1" class="marker composition class" id="mermaid-n3ac9n4yqam_class-compositionEnd"><path d="M 18,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="6" class="marker dependency class" id="mermaid-n3ac9n4yqam_class-dependencyStart"><path d="M 5,7 L9,13 L1,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="13" class="marker dependency class" id="mermaid-n3ac9n4yqam_class-dependencyEnd"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="13" class="marker lollipop class" id="mermaid-n3ac9n4yqam_class-lollipopStart"><circle r="6" cy="7" cx="7" fill="transparent" stroke="black"></circle></marker></defs><defs><marker orient="auto" markerHeight="240" markerWidth="190" refY="7" refX="1" class="marker lollipop class" id="mermaid-n3ac9n4yqam_class-lollipopEnd"><circle r="6" cy="7" cx="7" fill="transparent" stroke="black"></circle></marker></defs><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#mermaid-n3ac9n4yqam_class-dependencyEnd)" style=";" class="edge-thickness-normal edge-pattern-solid relation" id="id_Logger_FileLog_1" d="M129.613,418L129.613,424.167C129.613,430.333,129.613,442.667,129.613,454C129.613,465.333,129.613,475.667,129.613,480.833L129.613,486"></path><path marker-end="url(#mermaid-n3ac9n4yqam_class-dependencyEnd)" style=";" class="edge-thickness-normal edge-pattern-solid relation" id="id_LogStream_Logger_2" d="M129.613,152L129.613,158.167C129.613,164.333,129.613,176.667,129.613,188C129.613,199.333,129.613,209.667,129.613,214.833L129.613,220"></path></g><g class="edgeLabels"><g transform="translate(129.6125030517578, 455)" class="edgeLabel"><g transform="translate(-16.199996948242188, -12)" class="label"><foreignObject height="24" width="32.399993896484375"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel" style=";display: inline-block"><p>uses</p></span></div></foreignObject></g></g><g transform="translate(129.6125030517578, 189)" class="edgeLabel"><g transform="translate(-32.17500305175781, -12)" class="label"><foreignObject height="24" width="64.35000610351562"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel" style=";display: inline-block"><p>writes to</p></span></div></foreignObject></g></g><g transform="translate(114.61250152587897, 435.4999986921038)" class="edgeTerminals"><g transform="translate(0, 0)" class="inner"><foreignObject style="width: 9px; height: 12px;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; padding-right: 1px; white-space: nowrap;"><span style=";display: inline-block" class="edgeLabel">1</span></div></foreignObject></g></g><g transform="translate(139.61250152587886, 469.4999986921038)" class="edgeTerminals"><g transform="translate(0, 0)" class="inner"></g><foreignObject style="width: 9px; height: 12px;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; padding-right: 1px; white-space: nowrap;"><span style=";display: inline-block" class="edgeLabel">1</span></div></foreignObject></g></g><g class="nodes"><g transform="translate(129.6125030517578, 322)" id="classId-Logger-21" class="node default"><g class="basic label-container"><path style="" fill="#111" stroke-width="0" stroke="none" d="M-96.80416870117188 -96 L96.80416870117188 -96 L96.80416870117188 96 L-96.80416870117188 96"></path><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-96.80416870117188 -96 C-43.85825237348387 -96, 9.087663954204132 -96, 96.80416870117188 -96 M-96.80416870117188 -96 C-56.50276931480524 -96, -16.20136992843861 -96, 96.80416870117188 -96 M96.80416870117188 -96 C96.80416870117188 -20.32684025896934, 96.80416870117188 55.34631948206132, 96.80416870117188 96 M96.80416870117188 -96 C96.80416870117188 -48.6631378960179, 96.80416870117188 -1.3262757920358013, 96.80416870117188 96 M96.80416870117188 96 C20.62281969748176 96, -55.55852930620836 96, -96.80416870117188 96 M96.80416870117188 96 C28.672060118371874 96, -39.46004846442813 96, -96.80416870117188 96 M-96.80416870117188 96 C-96.80416870117188 25.225553801641837, -96.80416870117188 -45.548892396716326, -96.80416870117188 -96 M-96.80416870117188 96 C-96.80416870117188 51.676487812828555, -96.80416870117188 7.352975625657109, -96.80416870117188 -96"></path></g><g transform="translate(0, -72)" class="annotation-group text"></g><g transform="translate(-26.90833282470703, -72)" class="label-group text"><g transform="translate(0,-12)" style="font-weight: bolder" class="label"><foreignObject height="24" width="53.81666564941406"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 101px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>Logger</p></span></div></foreignObject></g></g><g transform="translate(-84.80416870117188, -24)" class="members-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="119.69999694824219"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 181px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-level_: LogLevel</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="118.44999694824219"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 180px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-log_: FileLogPtr</p></span></div></foreignObject></g></g><g transform="translate(-84.80416870117188, 48)" class="methods-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="142.6999969482422"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+SetLogLevel(level)</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="89.53334045410156"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 145px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+Write(msg)</p></span></div></foreignObject></g></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-96.80416870117188 -48 C-19.6545409983775 -48, 57.49508670441688 -48, 96.80416870117188 -48 M-96.80416870117188 -48 C-31.32541155044406 -48, 34.15334560028376 -48, 96.80416870117188 -48"></path></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-96.80416870117188 24 C-50.020893721561116 24, -3.2376187419503566 24, 96.80416870117188 24 M-96.80416870117188 24 C-50.961251604039916 24, -5.118334506907956 24, 96.80416870117188 24"></path></g></g><g transform="translate(129.6125030517578, 612)" id="classId-FileLog-22" class="node default"><g class="basic label-container"><path style="" fill="#111" stroke-width="0" stroke="none" d="M-121.61250305175781 -120 L121.61250305175781 -120 L121.61250305175781 120 L-121.61250305175781 120"></path><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-121.61250305175781 -120 C-64.11849077868271 -120, -6.624478505607627 -120, 121.61250305175781 -120 M-121.61250305175781 -120 C-60.784599258398856 -120, 0.04330453496010023 -120, 121.61250305175781 -120 M121.61250305175781 -120 C121.61250305175781 -32.301232608197736, 121.61250305175781 55.39753478360453, 121.61250305175781 120 M121.61250305175781 -120 C121.61250305175781 -69.70830666811403, 121.61250305175781 -19.416613336228068, 121.61250305175781 120 M121.61250305175781 120 C65.9968221468117 120, 10.381141241865578 120, -121.61250305175781 120 M121.61250305175781 120 C34.368770597602435 120, -52.87496185655294 120, -121.61250305175781 120 M-121.61250305175781 120 C-121.61250305175781 67.8684146400739, -121.61250305175781 15.736829280147802, -121.61250305175781 -120 M-121.61250305175781 120 C-121.61250305175781 29.378305820929924, -121.61250305175781 -61.24338835814015, -121.61250305175781 -120"></path></g><g transform="translate(0, -96)" class="annotation-group text"></g><g transform="translate(-28.208335876464844, -96)" class="label-group text"><g transform="translate(0,-12)" style="font-weight: bolder" class="label"><foreignObject height="24" width="56.41667175292969"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 103px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>FileLog</p></span></div></foreignObject></g></g><g transform="translate(-109.61250305175781, -48)" class="members-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="55.55000305175781"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 116px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-fd_: int</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="127.31666564941406"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 189px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-file_path_: string</p></span></div></foreignObject></g><g transform="translate(0,36)" style="" class="label"><foreignObject height="24" width="191.01666259765625"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 249px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-rotate_type_: RotateType</p></span></div></foreignObject></g></g><g transform="translate(-109.61250305175781, 48)" class="methods-group text"><g transform="translate(0,-12)" style="" class="label"><foreignObject height="24" width="115.93333435058594"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 171px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+Open(filePath)</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="116.33332824707031"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 172px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+WriteLog(msg)</p></span></div></foreignObject></g><g transform="translate(0,36)" style="" class="label"><foreignObject height="24" width="92.48333740234375"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 147px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>+Rotate(file)</p></span></div></foreignObject></g></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-121.61250305175781 -72 C-38.24217342250111 -72, 45.12815620675559 -72, 121.61250305175781 -72 M-121.61250305175781 -72 C-51.15728188378944 -72, 19.297939284178938 -72, 121.61250305175781 -72"></path></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-121.61250305175781 24 C-38.29383840935121 24, 45.02482623305539 24, 121.61250305175781 24 M-121.61250305175781 24 C-64.66076197613745 24, -7.709020900517089 24, 121.61250305175781 24"></path></g></g><g transform="translate(129.6125030517578, 80)" id="classId-LogStream-23" class="node default"><g class="basic label-container"><path style="" fill="#111" stroke-width="0" stroke="none" d="M-114.9000015258789 -72 L114.9000015258789 -72 L114.9000015258789 72 L-114.9000015258789 72"></path><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-114.9000015258789 -72 C-43.25718327346087 -72, 28.38563497895717 -72, 114.9000015258789 -72 M-114.9000015258789 -72 C-29.61913929631342 -72, 55.661722933252065 -72, 114.9000015258789 -72 M114.9000015258789 -72 C114.9000015258789 -37.326679365219896, 114.9000015258789 -2.653358730439791, 114.9000015258789 72 M114.9000015258789 -72 C114.9000015258789 -14.803043654817351, 114.9000015258789 42.3939126903653, 114.9000015258789 72 M114.9000015258789 72 C35.37515622010052 72, -44.14968908567786 72, -114.9000015258789 72 M114.9000015258789 72 C51.55465339570036 72, -11.79069473447818 72, -114.9000015258789 72 M-114.9000015258789 72 C-114.9000015258789 27.47495767432636, -114.9000015258789 -17.050084651347277, -114.9000015258789 -72 M-114.9000015258789 72 C-114.9000015258789 41.67735124832932, -114.9000015258789 11.354702496658646, -114.9000015258789 -72"></path></g><g transform="translate(0, -48)" class="annotation-group text"></g><g transform="translate(-41.616668701171875, -48)" class="label-group text"><g transform="translate(0,-12)" style="font-weight: bolder" class="label"><foreignObject height="24" width="83.23333740234375"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 131px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>LogStream</p></span></div></foreignObject></g></g><g transform="translate(-102.9000015258789, 0)" class="members-group text"><g transform="translate(0,-12)" style="font-style:italic;" class="label"><foreignObject height="24" width="113.38333129882812"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 180px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-logger_: Logger</p></span></div></foreignObject></g><g transform="translate(0,12)" style="" class="label"><foreignObject height="24" width="164.18333435058594"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 227px; text-align: center;"><span style="" class="nodeLabel markdown-node-label"><p>-stream_: stringstream</p></span></div></foreignObject></g></g><g transform="translate(-102.9000015258789, 72)" class="methods-group text"></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-114.9000015258789 -24 C-33.52383340328325 -24, 47.85233471931241 -24, 114.9000015258789 -24 M-114.9000015258789 -24 C-45.19939009920304 -24, 24.50122132747282 -24, 114.9000015258789 -24"></path></g><g style="" class="divider"><path style="" fill="none" stroke-width="1.3" stroke="#222" d="M-114.9000015258789 48 C-30.707825668290198 48, 53.48435018929851 48, 114.9000015258789 48 M-114.9000015258789 48 C-33.035345320189904 48, 48.8293108854991 48, 114.9000015258789 48"></path></g></g></g></g></g></svg></div><div class="bg-input-dark absolute right-2 top-2 rounded-sm p-1 opacity-0 transition-opacity group-hover:opacity-100"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="light:text-gray-800 text-white dark:text-white"><path d="M216,48V96a8,8,0,0,1-16,0V67.31l-42.34,42.35a8,8,0,0,1-11.32-11.32L188.69,56H160a8,8,0,0,1,0-16h48A8,8,0,0,1,216,48ZM98.34,146.34,56,188.69V160a8,8,0,0,0-16,0v48a8,8,0,0,0,8,8H96a8,8,0,0,0,0-16H67.31l42.35-42.34a8,8,0,0,0-11.32-11.32ZM208,152a8,8,0,0,0-8,8v28.69l-42.34-42.35a8,8,0,0,0-11.32,11.32L188.69,200H160a8,8,0,0,0,0,16h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152ZM67.31,56H96a8,8,0,0,0,0-16H48a8,8,0,0,0-8,8V96a8,8,0,0,0,16,0V67.31l42.34,42.35a8,8,0,0,0,11.32-11.32Z"></path></svg></div></div></pre>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">资料来源：
src/base/logger.h
1-30
src/base/logger.cc
1-26
src/base/logstream.cc
1-52
src/base/filelog.cc
1-65</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<h2 id="build-system" class="group flex items-center" data-header="true"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">构建系统</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h2>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">StreamMediaserver使用CMAKE进行构建系统：</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><div class="group relative cursor-pointer overflow-x-auto rounded-md bg-[#f2f1f0] p-4 transition-colors hover:bg-[#ededed] dark:bg-[#1f1f1f] dark:hover:bg-[#242424]" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«ro»" data-state="closed"><div class="flex justify-center"><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1091.949951171875 611" style="max-width: 1091.949951171875px;" class="flowchart" xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-sjswefjm40d"><style>#mermaid-sjswefjm40d{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-sjswefjm40d .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-sjswefjm40d .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-sjswefjm40d .error-icon{fill:#333;}#mermaid-sjswefjm40d .error-text{fill:#cccccc;stroke:#cccccc;}#mermaid-sjswefjm40d .edge-thickness-normal{stroke-width:1px;}#mermaid-sjswefjm40d .edge-thickness-thick{stroke-width:3.5px;}#mermaid-sjswefjm40d .edge-pattern-solid{stroke-dasharray:0;}#mermaid-sjswefjm40d .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-sjswefjm40d .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-sjswefjm40d .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-sjswefjm40d .marker{fill:#666;stroke:#666;}#mermaid-sjswefjm40d .marker.cross{stroke:#666;}#mermaid-sjswefjm40d svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-sjswefjm40d p{margin:0;}#mermaid-sjswefjm40d .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#fff;}#mermaid-sjswefjm40d .cluster-label text{fill:#fff;}#mermaid-sjswefjm40d .cluster-label span{color:#fff;}#mermaid-sjswefjm40d .cluster-label span p{background-color:transparent;}#mermaid-sjswefjm40d .label text,#mermaid-sjswefjm40d span{fill:#fff;color:#fff;}#mermaid-sjswefjm40d .node rect,#mermaid-sjswefjm40d .node circle,#mermaid-sjswefjm40d .node ellipse,#mermaid-sjswefjm40d .node polygon,#mermaid-sjswefjm40d .node path{fill:#111;stroke:#222;stroke-width:1px;}#mermaid-sjswefjm40d .rough-node .label text,#mermaid-sjswefjm40d .node .label text,#mermaid-sjswefjm40d .image-shape .label,#mermaid-sjswefjm40d .icon-shape .label{text-anchor:middle;}#mermaid-sjswefjm40d .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-sjswefjm40d .rough-node .label,#mermaid-sjswefjm40d .node .label,#mermaid-sjswefjm40d .image-shape .label,#mermaid-sjswefjm40d .icon-shape .label{text-align:center;}#mermaid-sjswefjm40d .node.clickable{cursor:pointer;}#mermaid-sjswefjm40d .root .anchor path{fill:#666!important;stroke-width:0;stroke:#666;}#mermaid-sjswefjm40d .arrowheadPath{fill:#0b0b0b;}#mermaid-sjswefjm40d .edgePath .path{stroke:#666;stroke-width:2.0px;}#mermaid-sjswefjm40d .flowchart-link{stroke:#666;fill:none;}#mermaid-sjswefjm40d .edgeLabel{background-color:#161616;text-align:center;}#mermaid-sjswefjm40d .edgeLabel p{background-color:#161616;}#mermaid-sjswefjm40d .edgeLabel rect{opacity:0.5;background-color:#161616;fill:#161616;}#mermaid-sjswefjm40d .labelBkg{background-color:rgba(22, 22, 22, 0.5);}#mermaid-sjswefjm40d .cluster rect{fill:#161616;stroke:#222;stroke-width:1px;}#mermaid-sjswefjm40d .cluster text{fill:#fff;}#mermaid-sjswefjm40d .cluster span{color:#fff;}#mermaid-sjswefjm40d div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:#333;border:1px solid hsl(0, 0%, 10%);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-sjswefjm40d .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-sjswefjm40d rect.text{fill:none;stroke-width:0;}#mermaid-sjswefjm40d .icon-shape,#mermaid-sjswefjm40d .image-shape{background-color:#161616;text-align:center;}#mermaid-sjswefjm40d .icon-shape p,#mermaid-sjswefjm40d .image-shape p{background-color:#161616;padding:2px;}#mermaid-sjswefjm40d .icon-shape rect,#mermaid-sjswefjm40d .image-shape rect{opacity:0.5;background-color:#161616;fill:#161616;}#mermaid-sjswefjm40d :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-sjswefjm40d_flowchart-v2-pointEnd"><path style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-sjswefjm40d_flowchart-v2-pointStart"><path style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-sjswefjm40d_flowchart-v2-circleEnd"><circle style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mermaid-sjswefjm40d_flowchart-v2-circleStart"><circle style="stroke-width: 1px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid-sjswefjm40d_flowchart-v2-crossEnd"><path style="stroke-width: 2px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mermaid-sjswefjm40d_flowchart-v2-crossStart"><path style="stroke-width: 2px; stroke-dasharray: 1px, 0px;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"><g data-look="classic" id="Components" class="cluster"><rect height="233" width="859.6958351135254" y="370" x="8" style=""></rect><g transform="translate(391.53125190734863, 370)" class="cluster-label"><foreignObject height="24" width="92.63333129882812"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Components</p></span></div></foreignObject></g></g><g data-look="classic" id="Dependencies" class="cluster"><rect height="104" width="186.06666564941406" y="370" x="887.6958351135254" style=""></rect><g transform="translate(929.2208366394043, 370)" class="cluster-label"><foreignObject height="24" width="103.01666259765625"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Dependencies</p></span></div></foreignObject></g></g><g data-look="classic" id="subGraph0" class="cluster"><rect height="312" width="1042.3541679382324" y="8" x="41.59583282470703" style=""></rect><g transform="translate(515.9729137420654, 8)" class="cluster-label"><foreignObject height="24" width="93.60000610351562"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Build System</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#mermaid-sjswefjm40d_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CMR_CMS_0" d="M668.421,84.411L648.976,89.009C629.532,93.607,590.643,102.804,571.199,110.902C551.754,119,551.754,126,551.754,129.5L551.754,133"></path><path marker-end="url(#mermaid-sjswefjm40d_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CMS_CMM_0" d="M551.754,191L551.754,195.167C551.754,199.333,551.754,207.667,551.754,215.333C551.754,223,551.754,230,551.754,233.5L551.754,237"></path><path marker-end="url(#mermaid-sjswefjm40d_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CMR_JP_0" d="M874.871,84.501L894.181,89.084C913.49,93.667,952.11,102.834,971.419,116.083C990.729,129.333,990.729,146.667,990.729,164C990.729,181.333,990.729,198.667,990.729,216C990.729,233.333,990.729,250.667,990.729,268C990.729,285.333,990.729,302.667,990.729,315.5C990.729,328.333,990.729,336.667,990.729,345C990.729,353.333,990.729,361.667,990.054,369.345C989.378,377.024,988.028,384.048,987.352,387.56L986.677,391.072"></path><path marker-end="url(#mermaid-sjswefjm40d_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CMM_BA_0" d="M434.071,282.3L382.364,288.584C330.657,294.867,227.243,307.433,175.536,317.883C123.829,328.333,123.829,336.667,123.829,345C123.829,353.333,123.829,361.667,123.829,369.333C123.829,377,123.829,384,123.829,387.5L123.829,391"></path><path marker-end="url(#mermaid-sjswefjm40d_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CMM_NE_0" d="M437.48,295L419.845,299.167C402.21,303.333,366.941,311.667,349.306,320C331.671,328.333,331.671,336.667,331.671,345C331.671,353.333,331.671,361.667,331.671,369.333C331.671,377,331.671,384,331.671,387.5L331.671,391"></path><path marker-end="url(#mermaid-sjswefjm40d_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CMM_MM_0" d="M551.754,295L551.754,299.167C551.754,303.333,551.754,311.667,551.754,320C551.754,328.333,551.754,336.667,551.754,345C551.754,353.333,551.754,361.667,551.754,369.333C551.754,377,551.754,384,551.754,387.5L551.754,391"></path><path marker-end="url(#mermaid-sjswefjm40d_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CMM_LI_0" d="M656.786,295L672.995,299.167C689.203,303.333,721.62,311.667,737.829,320C754.038,328.333,754.038,336.667,754.038,345C754.038,353.333,754.038,361.667,754.038,369.333C754.038,377,754.038,384,754.038,387.5L754.038,391"></path><path marker-end="url(#mermaid-sjswefjm40d_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CMM_JP_0" d="M669.438,283.205L716.9,289.338C764.363,295.47,859.288,307.735,906.75,318.034C954.213,328.333,954.213,336.667,954.213,345C954.213,353.333,954.213,361.667,956.034,369.406C957.856,377.146,961.5,384.291,963.322,387.864L965.144,391.437"></path><path marker-end="url(#mermaid-sjswefjm40d_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_BA_MA_0" d="M123.829,449L123.829,453.167C123.829,457.333,123.829,465.667,123.829,474C123.829,482.333,123.829,490.667,157.091,500.737C190.352,510.807,256.876,522.614,290.137,528.518L323.399,534.422"></path><path marker-end="url(#mermaid-sjswefjm40d_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_NE_MA_0" d="M331.671,449L331.671,453.167C331.671,457.333,331.671,465.667,331.671,474C331.671,482.333,331.671,490.667,337.923,498.652C344.176,506.638,356.681,514.277,362.934,518.096L369.187,521.915"></path><path marker-end="url(#mermaid-sjswefjm40d_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_MM_MA_0" d="M551.754,449L551.754,453.167C551.754,457.333,551.754,465.667,551.754,474C551.754,482.333,551.754,490.667,541.563,498.76C531.372,506.854,510.989,514.708,500.798,518.635L490.607,522.562"></path><path marker-end="url(#mermaid-sjswefjm40d_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_LI_MA_0" d="M754.038,449L754.038,453.167C754.038,457.333,754.038,465.667,754.038,474C754.038,482.333,754.038,490.667,713.402,501.099C672.766,511.532,591.495,524.063,550.86,530.329L510.224,536.595"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div class="labelBkg" xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(771.6458358764648, 60)" id="flowchart-CMR-0" class="node default"><rect height="54" width="206.4499969482422" y="-27" x="-103.2249984741211" style="" class="basic label-container"></rect><g transform="translate(-73.2249984741211, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="146.4499969482422"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>Root CMakeLists.txt</p></span></div></foreignObject></g></g><g transform="translate(551.7541694641113, 164)" id="flowchart-CMS-1" class="node default"><rect height="54" width="193.85000610351562" y="-27" x="-96.92500305175781" style="" class="basic label-container"></rect><g transform="translate(-66.92500305175781, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="133.85000610351562"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>src/CMakeLists.txt</p></span></div></foreignObject></g></g><g transform="translate(551.7541694641113, 268)" id="flowchart-CMM-2" class="node default"><rect height="54" width="235.36666870117188" y="-27" x="-117.68333435058594" style="" class="basic label-container"></rect><g transform="translate(-87.68333435058594, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="175.36666870117188"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>src/main/CMakeLists.txt</p></span></div></foreignObject></g></g><g transform="translate(980.7291679382324, 422)" id="flowchart-JP-3" class="node default"><rect height="54" width="116.06666564941406" y="-27" x="-58.03333282470703" style="" class="basic label-container"></rect><g transform="translate(-28.03333282470703, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="56.06666564941406"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>jsoncpp</p></span></div></foreignObject></g></g><g transform="translate(123.82916641235352, 422)" id="flowchart-BA-4" class="node default"><rect height="54" width="144.38333129882812" y="-27" x="-72.19166564941406" style="" class="basic label-container"></rect><g transform="translate(-42.19166564941406, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="84.38333129882812"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>base library</p></span></div></foreignObject></g></g><g transform="translate(331.6708335876465, 422)" id="flowchart-NE-5" class="node default"><rect height="54" width="171.3000030517578" y="-27" x="-85.6500015258789" style="" class="basic label-container"></rect><g transform="translate(-55.650001525878906, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="111.30000305175781"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>network library</p></span></div></foreignObject></g></g><g transform="translate(551.7541694641113, 422)" id="flowchart-MM-6" class="node default"><rect height="54" width="168.86666870117188" y="-27" x="-84.43333435058594" style="" class="basic label-container"></rect><g transform="translate(-54.43333435058594, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="108.86666870117188"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>mmedia library</p></span></div></foreignObject></g></g><g transform="translate(754.0375022888184, 422)" id="flowchart-LI-7" class="node default"><rect height="54" width="135.6999969482422" y="-27" x="-67.8499984741211" style="" class="basic label-container"></rect><g transform="translate(-37.849998474121094, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="75.69999694824219"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>live library</p></span></div></foreignObject></g></g><g transform="translate(416.8041687011719, 551)" id="flowchart-MA-8" class="node default"><rect height="54" width="178.93333435058594" y="-27" x="-89.46666717529297" style="" class="basic label-container"></rect><g transform="translate(-59.46666717529297, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="118.93333435058594"><div xmlns="http://www.w3.org/1999/xhtml" style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;"><span class="nodeLabel"><p>main executable</p></span></div></foreignObject></g></g></g></g></g></svg></div><div class="bg-input-dark absolute right-2 top-2 rounded-sm p-1 opacity-0 transition-opacity group-hover:opacity-100"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="light:text-gray-800 text-white dark:text-white"><path d="M216,48V96a8,8,0,0,1-16,0V67.31l-42.34,42.35a8,8,0,0,1-11.32-11.32L188.69,56H160a8,8,0,0,1,0-16h48A8,8,0,0,1,216,48ZM98.34,146.34,56,188.69V160a8,8,0,0,0-16,0v48a8,8,0,0,0,8,8H96a8,8,0,0,0,0-16H67.31l42.35-42.34a8,8,0,0,0-11.32-11.32ZM208,152a8,8,0,0,0-8,8v28.69l-42.34-42.35a8,8,0,0,0-11.32,11.32L188.69,200H160a8,8,0,0,0,0,16h48a8,8,0,0,0,8-8V160A8,8,0,0,0,208,152ZM67.31,56H96a8,8,0,0,0,0-16H48a8,8,0,0,0-8,8V96a8,8,0,0,0,16,0V67.31l42.34,42.35a8,8,0,0,0,11.32-11.32Z"></path></svg></div></div></pre>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">资料来源：
cmakelists.txt
1-56
src/cmakelists.txt
1-6
src/main/cmakelists.txt
1-8</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<h2 id="streaming-protocols" class="group flex items-center" data-header="true"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">流协议</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h2>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">该系统支持多个流媒体协议：</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>

































<table><thead><tr><th><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">协议</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></th><th><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">服务器</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></th><th><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">语境</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></th><th><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">处理程序</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></th><th><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">描述</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></th></tr></thead><tbody><tr><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">RTMP</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">rtmpserver</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">RTMPContext</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">生命服务</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">低延迟流的实时消息协议</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td></tr><tr><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">http/flv</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">httpserver</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">httpcontext，flvContext</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">生命服务</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">通过HTTP浏览浏览器兼容性的闪光视频</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td></tr><tr><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">HLS</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">httpserver</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">httpcontext</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">生命服务</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td><td><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">HTTP实时流媒体用于广泛的设备支持</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></td></tr></tbody></table>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">资料来源：
src/live/liveservice.cc
196-227
src/mmedia/http/httpserver.cc
1-90</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<h2 id="summary" class="group flex items-center" data-header="true"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">概括</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h2>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">StreamMediaserver是一个具有模块化体系结构的综合媒体流媒体平台：</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p>
<ol>
<li><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">网络层：使用事件驱动的模型提供非阻滞I/O的TCP通信</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></li>
<li><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">协议层：实施流协议（RTMP，HTTP/FLV，HLS）</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></li>
<li><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">服务层：管理会议和流分布</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></li>
<li><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">媒体层：过程和缓冲媒体数据</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></li>
</ol>
<p><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">该系统旨在处理具有高效资源使用和低延迟的多个并发流。它的模块化设计可轻松扩展和维护。</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p></div></div></div></div></div></div><div class="hidden overflow-hidden transition-[border-radius] xl:sticky xl:right-0 xl:top-20 xl:block xl:h-[calc(100vh-82px)] xl:w-64 xl:flex-shrink-0 2xl:w-72" style="scrollbar-width:none"><div class="flex max-h-full w-full flex-shrink-0 flex-col py-6 pt-0 text-sm lg:pb-4 lg:pt-8 xl:w-64 2xl:w-72" style="scrollbar-color:var(--color-night) transparent"><div><div class="mx-4 mb-3 rounded-md border border-neutral-200 bg-neutral-100 p-3 text-sm text-neutral-600 dark:border-neutral-800 dark:bg-neutral-900 dark:text-neutral-400"><p class="text-sm font-medium"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">使用Devin在私人代码库上尝试DeepWiki</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></p></div></div><h3 class="px-4 pb-5 text-lg font-medium leading-none"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">在此页面上</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></h3><ul style="scrollbar-width:none" class="min-h-0 flex-1 space-y-3 overflow-y-auto p-4 pt-0"><li class=""><a href="#streammediaserver-overview" class="hover:text-primary pr-1 transition-all text-primary font-medium"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">StreamMediaserver概述</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li class="ml-3"><a href="#purpose-and-scope" class="hover:text-primary pr-1 font-normal transition-all text-secondary"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">目的和范围</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li class="ml-3"><a href="#system-architecture" class="hover:text-primary pr-1 font-normal transition-all text-secondary"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">系统体系结构</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li class="ml-3"><a href="#key-components" class="hover:text-primary pr-1 font-normal transition-all text-secondary"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">关键组件</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li class="ml-6"><a href="#liveservice" class="hover:text-primary pr-1 font-normal transition-all text-secondary"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">生命服务</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li class="ml-6"><a href="#protocol-support" class="hover:text-primary pr-1 font-normal transition-all text-secondary"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">协议支持</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li class="ml-6"><a href="#media-data-flow" class="hover:text-primary pr-1 font-normal transition-all text-secondary"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">媒体数据流</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li class="ml-3"><a href="#system-initialization-and-startup" class="hover:text-primary pr-1 font-normal transition-all text-secondary"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">系统初始化和启动</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li class="ml-3"><a href="#session-and-stream-management" class="hover:text-primary pr-1 font-normal transition-all text-secondary"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">会话和流管理</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li class="ml-3"><a href="#configuration-system" class="hover:text-primary pr-1 font-normal transition-all text-secondary"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">配置系统</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li class="ml-3"><a href="#logging-system" class="hover:text-primary pr-1 font-normal transition-all text-secondary"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">记录系统</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li class="ml-3"><a href="#build-system" class="hover:text-primary pr-1 font-normal transition-all text-secondary"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">构建系统</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li class="ml-3"><a href="#streaming-protocols" class="hover:text-primary pr-1 font-normal transition-all text-secondary"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">流协议</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li><li class="ml-3"><a href="#summary" class="hover:text-primary pr-1 font-normal transition-all text-secondary"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">概括</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></a></li></ul></div></div><div class="pointer-events-none fixed bottom-2 left-2 right-2 mt-2 md:bottom-4 md:left-0 md:right-0"><div class="z-10 mx-auto max-w-3xl"><form class="z-20 w-full rounded-md ring-[0.5px] ring-[#353535] backdrop-blur-md transition-shadow [pointer-events:all] focus-within:ring-neutral-700 bg-component/70 border border-indigo-300/20 shadow-lg shadow-indigo-500/20 [backdrop-filter:blur(8px)]"><div class=""><div class="relative text-base font-normal"><div class="relative px-3 pt-3"><div class="pointer-events-none absolute left-3 right-3 top-3 ml-px flex w-full overflow-hidden text-[#8F8F8F] text-base" aria-hidden="true"><div class="flex items-center gap-1 overflow-hidden text-wrap opacity-60">Ask Devin about Algorithm-zh/StreamMediaServer</div></div><textarea placeholder="" rows="2" class="w-full resize-none rounded-none bg-transparent text-white focus:outline-none text-base" style="height: 48px;"></textarea></div></div></div><div class="flex h-12 items-center justify-between border-t-[0.5px] border-t-[#8f8f8f] dark:border-t-[#353535] p-3"><div class="flex items-center text-sm gap-4"><div class="flex items-center gap-1 sm:gap-2"><div class="flex gap-2 sm:items-center"><label for="useDeep" class="text-text-dark dark:text-text-light flex cursor-text items-center gap-1 text-sm"><hcfy-result style="display: inline-block;" class=""><hcfy-result-content style="visibility: visible;">深入研究</hcfy-result-content><hcfy-result-actions style="visibility: visible;"></hcfy-result-actions></hcfy-result></label><div id="useDeep" class="relative inline-flex h-6 w-11 items-center rounded-full cursor-pointer border-[1px] border-[#b0b0b0] p-[1px] shadow-none dark:border-[#535353] dark:data-[state=checked]:bg-[#ef9541]/30 dark:data-[state=unchecked]:bg-[#181818]"><div class="absolute bottom-0 top-0 my-auto h-5 w-5 rounded-full bg-white shadow-md data-[state=unchecked]:bg-[#535353] data-[state=checked]:bg-[#ef9541]/80 cursor-pointer" style="transform: translateX(18px);"></div><div class="h-full w-full rounded-full transition-colors duration-200 ease-in-out bg-[#ef9541]/80 dark:bg-[#ef9541]/80"></div></div></div></div></div><div class="flex items-center gap-2"><button class="rounded-full bg-[#e0e0e0] p-1 text-neutral-400 transition-colors dark:bg-neutral-700" disabled="disabled"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256"><path d="M221.66,133.66l-72,72a8,8,0,0,1-11.32-11.32L196.69,136H40a8,8,0,0,1,0-16H196.69L138.34,61.66a8,8,0,0,1,11.32-11.32l72,72A8,8,0,0,1,221.66,133.66Z"></path></svg></button></div></div></form></div></div></div></div></div><!--/$--></div><script src="%E7%AE%97%E6%B3%95-ZH_streamMediaserver%20_%20Deepwiki_files/webpack-acbbbb548492d4a6.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[54276,[\"9453\",\"static/chunks/b1298b8d-549c141f97a3b262.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"8970\",\"static/chunks/378e5a93-3b0f971d3611a8a5.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"1585\",\"static/chunks/f7f68e2d-40290491c524df5c.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5009\",\"static/chunks/5009-cf1c1739f4eccbfa.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"3377\",\"static/chunks/3377-d302682beb4206f6.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"6671\",\"static/chunks/6671-b0da8a89e8d16b02.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"3852\",\"static/chunks/3852-f786c46570f1c37a.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"7177\",\"static/chunks/app/layout-069cb77866786652.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\"],\"RootProvider\"]\n3:I[87555,[],\"\"]\n4:I[31295,[],\"\"]\n6:I[90894,[],\"ClientPageRoot\"]\n7:I[87667,[\"9453\",\"static/chunks/b1298b8d-549c141f97a3b262.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"8970\",\"static/chunks/378e5a93-3b0f971d3611a8a5.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"1585\",\"static/chunks/f7f68e2d-40290491c524df5c.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"2545\",\"static/chunks/c16f53c3-c80d3b6d0c4af7a0.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"537\",\"static/chunks/537-d9d5e9261de3e69c.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5009\",\"static/chunks/5009-cf1c1739f4eccbfa.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"3377\",\"static/chunks/3377-d302682beb4206f6.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"2136\",\"static/chunks/2136-0f8d797058c844d4.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"6671\",\"static/chunks/6671-b0da8a89e8d16b02.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5217\",\"static/chunks/5217-9d83ca492e50c5ed.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"9514\",\"static/chunks/9514-78acba0a55208c16.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"168\",\"static/chunks/168-d8e567d7acd9a9f8.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5938\",\"static/chunks/5938-755c17b2f8b25b9d.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"7111\",\"static/chunks/7111-6aae15bf6bffbdb1.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"3285\",\"static/chunks/a"])</script><script>self.__next_f.push([1,"pp/%5Borg%5D/%5Brepo%5D/%5B%5B...wikiRoutes%5D%5D/page-25509e5272dc1f93.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\"],\"default\"]\na:I[59665,[],\"OutletBoundary\"]\nd:I[59665,[],\"ViewportBoundary\"]\nf:I[59665,[],\"MetadataBoundary\"]\n11:I[26614,[],\"\"]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/f30152c0704fba31.css?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"style\"]\n:HL[\"/_next/static/css/69dc9a343a8d610c.css?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"e5kxxiZUYhUhY690n1QD4\",\"p\":\"\",\"c\":[\"\",\"Algorithm-zh\",\"StreamMediaServer\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[[\"org\",\"Algorithm-zh\",\"d\"],{\"children\":[[\"repo\",\"StreamMediaServer\",\"d\"],{\"children\":[[\"wikiRoutes\",\"\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/f30152c0704fba31.css?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/69dc9a343a8d610c.css?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{}],[\"$\",\"body\",null,{\"className\":\"__variable_5cfdac font-geist-sans relative min-h-screen __variable_9a8899 bg-background antialiased\",\"children\":[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}]]}],{\"children\":[[\"org\",\"Algorithm-zh\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"repo\",\"StreamMediaServer\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,\"$L5\"]}],{\"children\":[[\"wikiRoutes\",\"\",\"oc\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[\"$\",\"$L6\",null,{\"Component\":\"$7\",\"searchParams\":{},\"params\":{\"org\":\"Algorithm-zh\",\"repo\":\"StreamMediaServer\"},\"promises\":[\"$@8\",\"$@9\"]}],\"$undefined\",null,[\"$\",\"$La\",null,{\"children\":[\"$Lb\",\"$Lc\",null]}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"TPHIlhs_lrAt_4OTNF_fh\",{\"children\":[[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$11\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"12:I[93691,[\"9453\",\"static/chunks/b1298b8d-549c141f97a3b262.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"8970\",\"static/chunks/378e5a93-3b0f971d3611a8a5.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"1585\",\"static/chunks/f7f68e2d-40290491c524df5c.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"4129\",\"static/chunks/7bf36345-20a79815585d2583.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"537\",\"static/chunks/537-d9d5e9261de3e69c.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5009\",\"static/chunks/5009-cf1c1739f4eccbfa.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"3377\",\"static/chunks/3377-d302682beb4206f6.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"2136\",\"static/chunks/2136-0f8d797058c844d4.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"6671\",\"static/chunks/6671-b0da8a89e8d16b02.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5217\",\"static/chunks/5217-9d83ca492e50c5ed.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"9514\",\"static/chunks/9514-78acba0a55208c16.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"6422\",\"static/chunks/6422-90b4a59eb579f66b.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5064\",\"static/chunks/5064-137f55ae34938805.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"3239\",\"static/chunks/3239-098acbc71a0d78b2.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"2933\",\"static/chunks/app/%5Borg%5D/%5Brepo%5D/layout-d98b8102d1f9bae6.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\"],\"CodebaseWikiHeader\"]\n13:I[6874,[\"9453\",\"static/chunks/b1298b8d-549c141f97a3b262.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"8970\",\"static/chunks/378e5a93-3b0f971d3611a8a5.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"1585\",\"static/chunks/f7f68e2d-40290491c524df5c.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"4129\",\"static/chunks/7bf36345-20a79815585d2583.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"537\",\"static/chunks/537-d9d5e9261de3e69c.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5009\",\"static/chunks/5009-cf1c1739f4eccbfa.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"3377\",\"static/chunks/3377-d302682beb4206f6.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"2136\",\"static/chunks/2136-0f8d797058c844d4.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHA"])</script><script>self.__next_f.push([1,"o3NNdH\",\"6671\",\"static/chunks/6671-b0da8a89e8d16b02.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5217\",\"static/chunks/5217-9d83ca492e50c5ed.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"9514\",\"static/chunks/9514-78acba0a55208c16.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"6422\",\"static/chunks/6422-90b4a59eb579f66b.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5064\",\"static/chunks/5064-137f55ae34938805.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"3239\",\"static/chunks/3239-098acbc71a0d78b2.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"2933\",\"static/chunks/app/%5Borg%5D/%5Brepo%5D/layout-d98b8102d1f9bae6.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\"],\"\"]\n14:\"$Sreact.suspense\"\n15:I[67807,[\"9453\",\"static/chunks/b1298b8d-549c141f97a3b262.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"8970\",\"static/chunks/378e5a93-3b0f971d3611a8a5.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"1585\",\"static/chunks/f7f68e2d-40290491c524df5c.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"4129\",\"static/chunks/7bf36345-20a79815585d2583.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"537\",\"static/chunks/537-d9d5e9261de3e69c.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5009\",\"static/chunks/5009-cf1c1739f4eccbfa.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"3377\",\"static/chunks/3377-d302682beb4206f6.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"2136\",\"static/chunks/2136-0f8d797058c844d4.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"6671\",\"static/chunks/6671-b0da8a89e8d16b02.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5217\",\"static/chunks/5217-9d83ca492e50c5ed.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"9514\",\"static/chunks/9514-78acba0a55208c16.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"6422\",\"static/chunks/6422-90b4a59eb579f66b.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5064\",\"static/chunks/5064-137f55ae34938805.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"3239\",\"static/chunks/3239-098acbc71a0d78b2.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"2933\",\"static/chunks/app/%5Borg%5D/%5Brepo%5D/layout-d98b8102d1f9bae6.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\"],\"ShinyText\"]\n8:{}\n9:{\"org\":\"Algorithm-zh\",\"repo\":\"StreamMediaS"])</script><script>self.__next_f.push([1,"erver\"}\n5:[\"$\",\"div\",null,{\"className\":\"flex min-h-screen w-full flex-col text-white\",\"id\":\"codebase-wiki-repo-page\",\"children\":[[\"$\",\"$L12\",null,{\"hideOnSm\":true,\"children\":[\"$\",\"div\",null,{\"className\":\"flex flex-col gap-1\",\"children\":[[\"$\",\"$L13\",null,{\"href\":\"/\",\"className\":\"block text-xs font-medium leading-none text-white sm:hidden md:text-lg\",\"children\":\"DeepWiki\"}],[\"$\",\"p\",null,{\"className\":\"text-text-secondary text-sm font-normal leading-none md:text-lg\",\"children\":[\"$\",\"a\",null,{\"href\":\"https://github.com/Algorithm-zh/StreamMediaServer\",\"target\":\"_blank\",\"rel\":\"noopener noreferrer\",\"className\":\"text-[#8f8f8f] transition-colors hover:text-black dark:hover:text-white\",\"children\":\"Algorithm-zh/StreamMediaServer\"}]}]]}]}],[\"$\",\"$14\",null,{\"fallback\":[\"$\",\"div\",null,{\"className\":\"container-wrapper flex flex-1 items-center justify-center px-4\",\"children\":[\"$\",\"$L15\",null,{\"className\":\"text-center text-lg\",\"text\":\"Loading Algorithm-zh/StreamMediaServer...\",\"speed\":1}]}],\"children\":\"$L16\"}]]}]\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"17:I[60168,[\"9453\",\"static/chunks/b1298b8d-549c141f97a3b262.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"8970\",\"static/chunks/378e5a93-3b0f971d3611a8a5.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"1585\",\"static/chunks/f7f68e2d-40290491c524df5c.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"4129\",\"static/chunks/7bf36345-20a79815585d2583.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"537\",\"static/chunks/537-d9d5e9261de3e69c.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5009\",\"static/chunks/5009-cf1c1739f4eccbfa.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"3377\",\"static/chunks/3377-d302682beb4206f6.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"2136\",\"static/chunks/2136-0f8d797058c844d4.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"6671\",\"static/chunks/6671-b0da8a89e8d16b02.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5217\",\"static/chunks/5217-9d83ca492e50c5ed.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"9514\",\"static/chunks/9514-78acba0a55208c16.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"6422\",\"static/chunks/6422-90b4a59eb579f66b.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"5064\",\"static/chunks/5064-137f55ae34938805.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"3239\",\"static/chunks/3239-098acbc71a0d78b2.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\",\"2933\",\"static/chunks/app/%5Borg%5D/%5Brepo%5D/layout-d98b8102d1f9bae6.js?dpl=dpl_FhUiusEoodFgjHKGcDyrHAo3NNdH\"],\"WikiLayout\"]\n18:T2a67,"])</script><script>self.__next_f.push([1,"# StreamMediaServer Overview\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [CMakeLists.txt](CMakeLists.txt)\n- [bin/config/publish/hx.com.json](bin/config/publish/hx.com.json)\n- [bin/log/tmms.log](bin/log/tmms.log)\n- [src/CMakeLists.txt](src/CMakeLists.txt)\n- [src/base/FileLog.cc](src/base/FileLog.cc)\n- [src/base/LogStream.cc](src/base/LogStream.cc)\n- [src/base/Logger.cc](src/base/Logger.cc)\n- [src/base/Logger.h](src/base/Logger.h)\n- [src/live/LiveService.cc](src/live/LiveService.cc)\n- [src/main/CMakeLists.txt](src/main/CMakeLists.txt)\n- [src/main/TestLog.cc](src/main/TestLog.cc)\n- [src/main/main.cc](src/main/main.cc)\n- [src/mmedia/http/HttpRequest.cc](src/mmedia/http/HttpRequest.cc)\n- [src/mmedia/http/HttpServer.cc](src/mmedia/http/HttpServer.cc)\n- [src/mmedia/http/HttpServer.h](src/mmedia/http/HttpServer.h)\n\n\u003c/details\u003e\n\n\n\nStreamMediaServer is a multimedia streaming system that supports multiple streaming protocols for live media distribution. This document introduces the system architecture, key components, and their interactions.\n\n## Purpose and Scope\n\nStreamMediaServer is designed to receive media streams from publishers and distribute them to multiple viewers in real-time. It supports various streaming protocols including RTMP (Real-Time Messaging Protocol), HTTP/FLV (Flash Video over HTTP), and HLS (HTTP Live Streaming).\n\nThis page provides a high-level overview of the entire system. For details about specific components:\n- For Network Layer details, see [Network Layer](#2)\n- For Media Processing details, see [Media Processing System](#3)\n- For Live Streaming functionality, see [Live Streaming System](#4)\n- For Configuration and Logging, see [Configuration and Logging](#5)\n\n## System Architecture\n\nStreamMediaServer is built with a modular, event-driven architecture designed for high performance and scalability. The system is organized into several layers that work together to provide media streaming services.\n\n```mermaid\ngraph TD\n    subgraph \"Client Layer\"\n        PC[\"Publisher Clients\"]\n        VC[\"Viewer Clients\"]\n    end\n\n    subgraph \"Protocol Layer\"\n        RS[\"RtmpServer\"]\n        HS[\"HttpServer\"]\n        FC[\"FlvContext\"]\n    end\n\n    subgraph \"Service Layer\"\n        LS[\"LiveService\"]\n        SS[\"Session\"]\n        ST[\"Stream\"]\n    end\n\n    subgraph \"Media Layer\"\n        CH[\"CodecHeader\"]\n        GM[\"GopMgr\"]\n        PB[\"Packet Buffer\"]\n    end\n\n    subgraph \"Network Layer\"\n        TS[\"TcpServer\"]\n        TC[\"TcpConnection\"]\n        EL[\"EventLoop\"]\n    end\n\n    PC --\u003e RS\n    VC --\u003e RS\n    VC --\u003e HS\n    \n    RS --\u003e LS\n    HS --\u003e LS\n    HS --\u003e FC\n    \n    LS --\u003e SS\n    SS --\u003e ST\n    \n    ST --\u003e CH\n    ST --\u003e GM\n    ST --\u003e PB\n    \n    RS --\u003e TS\n    HS --\u003e TS\n    \n    TS --\u003e TC\n    TC --\u003e EL\n```\n\nSources: [src/live/LiveService.cc:1-376](), [src/mmedia/http/HttpServer.h:1-32](), [src/mmedia/http/HttpServer.cc:1-90]()\n\n## Key Components\n\n### LiveService\n\nLiveService is the central coordinator of the system, managing streaming sessions and handling the lifecycle of media streams.\n\n```mermaid\nclassDiagram\n    class LiveService {\n        -sessions_: map\u003cstring, SessionPtr\u003e\n        -servers_: vector\u003cTcpServer*\u003e\n        -pool_: EventLoopThreadPool*\n        +CreateSession(sessionName)\n        +FindSession(sessionName)\n        +CloseSession(sessionName)\n        +OnPlay(conn, sessionName, param)\n        +OnPublish(conn, sessionName, param)\n        +OnRecv(conn, data)\n        +Start()\n        +Stop()\n    }\n    \n    class Session {\n        -session_name_: string\n        -stream_: StreamPtr\n        -publisher_: UserPtr\n        -players_: set\u003cPlayerUserPtr\u003e\n        +CreatePublishUser(conn, name, param, type)\n        +CreatePlayerUser(conn, name, param, type)\n        +SetPublisher(user)\n        +AddPlayer(user)\n        +CloseUser(user)\n    }\n    \n    class Stream {\n        -packet_buffer_: vector\u003cPacketPtr\u003e\n        -gop_mgr_: GopMgr\n        -codec_headers_: CodecHeader\n        +AddPacket(packet)\n        +GetFrames(user)\n    }\n    \n    LiveService \"1\" --\u003e \"*\" Session : manages\n    Session \"1\" --\u003e \"1\" Stream : owns\n```\n\nSources: [src/live/LiveService.cc:28-238]()\n\n### Protocol Support\n\nStreamMediaServer supports multiple streaming protocols through specialized server implementations:\n\n```mermaid\ngraph LR\n    subgraph \"Protocol Servers\"\n        RS[\"RtmpServer\"]\n        HS[\"HttpServer\"]\n    end\n    \n    subgraph \"Protocol Handlers\"\n        RC[\"RtmpContext\"]\n        HC[\"HttpContext\"]\n        FC[\"FlvContext\"]\n    end\n    \n    subgraph \"Core Service\"\n        LS[\"LiveService\"]\n    end\n    \n    RS --\u003e RC\n    HS --\u003e HC\n    HC --\u003e FC\n    \n    RC --\u003e LS\n    HC --\u003e LS\n    FC --\u003e LS\n```\n\nSources: [src/live/LiveService.cc:196-227](), [src/mmedia/http/HttpServer.cc:10-90]()\n\n### Media Data Flow\n\nThis diagram illustrates how media data flows through the system:\n\n```mermaid\nflowchart LR\n    PUB[\"Publisher\"] --\u003e |\"RTMP\"| RS[\"RtmpServer\"]\n    RS --\u003e RC[\"RtmpContext\"]\n    RC --\u003e LS[\"LiveService\"]\n    LS --\u003e |\"Create/Find\"| SS[\"Session\"]\n    SS --\u003e |\"Add media to\"| ST[\"Stream\"]\n    \n    ST --\u003e |\"Store\"| PB[\"Packet Buffer\"]\n    ST --\u003e |\"Create\"| GM[\"GopMgr\"]\n    ST --\u003e |\"Extract\"| CH[\"CodecHeader\"]\n    \n    PB --\u003e RTMPP[\"RtmpPlayerUser\"]\n    PB --\u003e FLVP[\"FlvPlayerUser\"]\n    \n    RTMPP --\u003e |\"RTMP\"| RTMPC[\"RTMP Client\"]\n    FLVP --\u003e |\"HTTP/FLV\"| FLVC[\"HTTP/FLV Client\"]\n```\n\nSources: [src/live/LiveService.cc:156-195](), [src/live/LiveService.cc:249-328]()\n\n## System Initialization and Startup\n\nThe system is initialized in the main function, which sets up logging, loads configuration, and starts the LiveService:\n\n```mermaid\nsequenceDiagram\n    participant Main as \"main()\"\n    participant Config as \"ConfigMgr\"\n    participant Logger as \"Logger\"\n    participant TaskMgr as \"TaskMgr\"\n    participant LiveService as \"LiveService\"\n    \n    Main-\u003e\u003eConfig: LoadConfig(\"../config/config.json\")\n    Config--\u003e\u003eMain: Return ConfigPtr\n    \n    Main-\u003e\u003eLogger: Create and configure Logger\n    \n    Main-\u003e\u003eTaskMgr: Add file check task\n    \n    Main-\u003e\u003eLiveService: Start()\n    \n    LiveService-\u003e\u003eLiveService: Create EventLoopThreadPool\n    LiveService-\u003e\u003eLiveService: Start DNS service\n    LiveService-\u003e\u003eLiveService: Create and start protocol servers\n    \n    loop Main Loop\n        Main-\u003e\u003eTaskMgr: OnWork()\n        Main-\u003e\u003eMain: Sleep for 50ms\n    end\n```\n\nSources: [src/main/main.cc:15-55](), [src/live/LiveService.cc:197-230]()\n\n## Session and Stream Management\n\nAt the core of the streaming system is session and stream management:\n\n```mermaid\nclassDiagram\n    class LiveService {\n        +CreateSession(sessionName)\n        +FindSession(sessionName)\n        +CloseSession(sessionName)\n    }\n    \n    class Session {\n        -session_name_: string\n        -stream_: StreamPtr\n        -publisher_: UserPtr\n        -players_: set\u003cPlayerUserPtr\u003e\n        +AddPlayer(user)\n        +SetPublisher(user)\n    }\n    \n    class Stream {\n        -packet_buffer_: vector\u003cPacketPtr\u003e\n        -gop_mgr_: GopMgr\n        -codec_headers_: CodecHeader\n        +AddPacket(packet)\n        +GetFrames(user)\n    }\n    \n    class User {\n        #connection_: ConnectionPtr\n        #session_: SessionPtr\n        #stream_: StreamPtr\n    }\n    \n    class Publisher {\n        +OnRecv(data)\n    }\n    \n    class PlayerUser {\n        +PostFrames()\n    }\n    \n    LiveService \"1\" --\u003e \"*\" Session : manages\n    Session \"1\" --\u003e \"1\" Stream : owns\n    Session \"1\" --\u003e \"0..1\" Publisher : has publisher\n    Session \"1\" --\u003e \"*\" PlayerUser : has players\n    User \u003c|-- Publisher\n    User \u003c|-- PlayerUser\n```\n\nSources: [src/live/LiveService.cc:28-85]()\n\n## Configuration System\n\nStreamMediaServer uses a JSON-based configuration system:\n\n```mermaid\ngraph TD\n    subgraph \"Configuration Files\"\n        CF[\"config.json\"]\n        DF[\"hx.com.json\"]\n    end\n    \n    subgraph \"Configuration Classes\"\n        CM[\"ConfigMgr\"]\n        CO[\"Config\"]\n        AP[\"AppInfo\"]\n        SI[\"ServiceInfo\"]\n        LI[\"LogInfo\"]\n    end\n    \n    CF --\u003e CM\n    DF --\u003e CM\n    CM --\u003e CO\n    CO --\u003e AP\n    CO --\u003e SI\n    CO --\u003e LI\n    \n    LS[\"LiveService\"] --\u003e CO\n```\n\nSources: [src/main/main.cc:19-39](), [bin/config/publish/hx.com.json:1-19]()\n\n## Logging System\n\nThe system uses a hierarchical logging system:\n\n```mermaid\nclassDiagram\n    class Logger {\n        -level_: LogLevel\n        -log_: FileLogPtr\n        +SetLogLevel(level)\n        +Write(msg)\n    }\n    \n    class FileLog {\n        -fd_: int\n        -file_path_: string\n        -rotate_type_: RotateType\n        +Open(filePath)\n        +WriteLog(msg)\n        +Rotate(file)\n    }\n    \n    class LogStream {\n        -logger_: Logger*\n        -stream_: stringstream\n    }\n    \n    Logger \"1\" --\u003e \"1\" FileLog : uses\n    LogStream --\u003e Logger : writes to\n```\n\nSources: [src/base/Logger.h:1-30](), [src/base/Logger.cc:1-26](), [src/base/LogStream.cc:1-52](), [src/base/FileLog.cc:1-65]()\n\n## Build System\n\nStreamMediaServer uses CMake for its build system:\n\n```mermaid\ngraph TD\n    subgraph \"Build System\"\n        CMR[\"Root CMakeLists.txt\"]\n        CMS[\"src/CMakeLists.txt\"]\n        CMM[\"src/main/CMakeLists.txt\"]\n    end\n    \n    subgraph \"Dependencies\"\n        JP[\"jsoncpp\"]\n    end\n    \n    subgraph \"Components\"\n        BA[\"base library\"]\n        NE[\"network library\"]\n        MM[\"mmedia library\"]\n        LI[\"live library\"]\n        MA[\"main executable\"]\n    end\n    \n    CMR --\u003e CMS\n    CMS --\u003e CMM\n    \n    CMR --\u003e JP\n    \n    CMM --\u003e BA\n    CMM --\u003e NE\n    CMM --\u003e MM\n    CMM --\u003e LI\n    CMM --\u003e JP\n    \n    BA --\u003e MA\n    NE --\u003e MA\n    MM --\u003e MA\n    LI --\u003e MA\n```\n\nSources: [CMakeLists.txt:1-56](), [src/CMakeLists.txt:1-6](), [src/main/CMakeLists.txt:1-8]()\n\n## Streaming Protocols\n\nThe system supports multiple streaming protocols:\n\n| Protocol | Server | Context | Handler | Description |\n|----------|--------|---------|---------|-------------|\n| RTMP | RtmpServer | RtmpContext | LiveService | Real-Time Messaging Protocol for low-latency streaming |\n| HTTP/FLV | HttpServer | HttpContext, FlvContext | LiveService | Flash Video over HTTP for browser compatibility |\n| HLS | HttpServer | HttpContext | LiveService | HTTP Live Streaming for wide device support |\n\nSources: [src/live/LiveService.cc:196-227](), [src/mmedia/http/HttpServer.cc:1-90]()\n\n## Summary\n\nStreamMediaServer is a comprehensive media streaming platform with a modular architecture:\n\n1. **Network Layer**: Provides TCP communication with non-blocking I/O using an event-driven model\n2. **Protocol Layer**: Implements streaming protocols (RTMP, HTTP/FLV, HLS)\n3. **Service Layer**: Manages sessions and stream distribution\n4. **Media Layer**: Processes and buffers media data\n\nThe system is designed to handle multiple concurrent streams with efficient resource usage and low latency. Its modular design allows for easy extension and maintenance."])</script><script>self.__next_f.push([1,"19:T32e4,"])</script><script>self.__next_f.push([1,"# Architecture Overview\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [bin/log/tmms.log](bin/log/tmms.log)\n- [src/live/LiveService.cc](src/live/LiveService.cc)\n- [src/live/tmp/LiveService.cc](src/live/tmp/LiveService.cc)\n- [src/live/tmp/LiveService.h](src/live/tmp/LiveService.h)\n- [src/mmedia/CMakeLists.txt](src/mmedia/CMakeLists.txt)\n- [src/mmedia/base/AVTypes.h](src/mmedia/base/AVTypes.h)\n- [src/mmedia/base/MMediaLog.h](src/mmedia/base/MMediaLog.h)\n- [src/mmedia/demux/VideoDemux.cc](src/mmedia/demux/VideoDemux.cc)\n- [src/mmedia/demux/VideoDemux.h](src/mmedia/demux/VideoDemux.h)\n- [src/mmedia/flv/FlvContext.cc](src/mmedia/flv/FlvContext.cc)\n- [src/mmedia/http/HttpRequest.cc](src/mmedia/http/HttpRequest.cc)\n- [src/mmedia/http/HttpServer.cc](src/mmedia/http/HttpServer.cc)\n- [src/mmedia/http/HttpServer.h](src/mmedia/http/HttpServer.h)\n- [src/network/net/TimingWheel.cc](src/network/net/TimingWheel.cc)\n\n\u003c/details\u003e\n\n\n\nThis document provides a comprehensive overview of the StreamMediaServer architecture, explaining the major components and their interactions. The StreamMediaServer is a high-performance multimedia streaming server that supports multiple protocols (RTMP, HTTP/FLV) for live video streaming applications.\n\n## System Architecture\n\nStreamMediaServer is built as a modular, event-driven system with a layered architecture that separates protocol handling, session management, media processing, and network communication concerns.\n\n```mermaid\ngraph TD\n    subgraph \"Client Layer\"\n        Publisher[\"Publisher Clients\"]\n        Player[\"Player Clients\"]\n    end\n\n    subgraph \"Protocol Layer\"\n        RTMP[\"RTMP Service\"]\n        HTTP[\"HTTP Service\"]\n        FLV[\"FLV Handler\"]\n    end\n\n    subgraph \"Media Management Layer\"\n        LiveService[\"LiveService\"]\n        Session[\"Session\"]\n        Stream[\"Stream\"]\n        GopMgr[\"GOP Manager\"]\n        CodecHeader[\"Codec Headers\"]\n    end\n\n    subgraph \"Network Layer\"\n        TcpServer[\"TcpServer\"]\n        EventLoop[\"EventLoop\"]\n        Connection[\"Connection\"]\n    end\n\n    Publisher --\u003e RTMP\n    Player --\u003e RTMP\n    Player --\u003e HTTP\n    \n    RTMP --\u003e LiveService\n    HTTP --\u003e LiveService\n    FLV --\u003e HTTP\n    \n    LiveService --\u003e Session\n    Session --\u003e Stream\n    Stream --\u003e GopMgr\n    Stream --\u003e CodecHeader\n    \n    RTMP --\u003e TcpServer\n    HTTP --\u003e TcpServer\n    TcpServer --\u003e Connection\n    Connection --\u003e EventLoop\n```\n\nSources: [src/live/LiveService.cc:197-226](), [src/mmedia/http/HttpServer.cc:10-28]()\n\n## Core Components\n\nThe system consists of several key components that work together to provide streaming functionality:\n\n| Component | Description | Key Responsibilities |\n|-----------|-------------|---------------------|\n| LiveService | Central coordinator | Manages streaming sessions, handles client connections |\n| Session | Streaming session | Manages publisher and players for a stream |\n| Stream | Media stream | Manages media data, GOP structure, and codec information |\n| RtmpServer | RTMP protocol handler | Processes RTMP connections and protocol messages |\n| HttpServer | HTTP protocol handler | Processes HTTP connections and requests |\n| FlvContext | FLV format handler | Creates and delivers FLV formatted content |\n| EventLoop | Event processor | Handles asynchronous events and callbacks |\n| TcpServer | Connection manager | Accepts and manages TCP connections |\n\nSources: [src/live/LiveService.cc:22-89](), [src/mmedia/http/HttpServer.h:11-29]()\n\n## Protocol Support\n\nStreamMediaServer supports multiple streaming protocols to accommodate different client requirements:\n\n```mermaid\ngraph TD\n    subgraph \"Client Applications\"\n        RtmpPublisher[\"RTMP Publisher\"]\n        RtmpPlayer[\"RTMP Player\"]\n        HttpFlvPlayer[\"HTTP/FLV Player\"]\n    end\n\n    subgraph \"Protocol Handlers\"\n        RtmpServer[\"RtmpServer\"]\n        HttpServer[\"HttpServer\"]\n        RtmpContext[\"RtmpContext\"]\n        HttpContext[\"HttpContext\"]\n        FlvContext[\"FlvContext\"]\n    end\n\n    subgraph \"Media Management\"\n        LiveService[\"LiveService\"]\n    end\n\n    RtmpPublisher --\u003e RtmpServer\n    RtmpPlayer --\u003e RtmpServer\n    HttpFlvPlayer --\u003e HttpServer\n    \n    RtmpServer --\u003e RtmpContext\n    HttpServer --\u003e HttpContext\n    HttpServer --\u003e FlvContext\n    \n    RtmpContext --\u003e LiveService\n    HttpContext --\u003e LiveService\n    FlvContext --\u003e LiveService\n```\n\nSources: [src/live/LiveService.cc:204-224](), [src/mmedia/http/HttpServer.cc:36-44](), [src/mmedia/flv/FlvContext.cc:48-52]()\n\n### RTMP Protocol\n\nThe Real-Time Messaging Protocol (RTMP) is supported for both publishing and playing streams. The RTMP implementation includes:\n\n- RTMP handshake process\n- RTMP chunk stream handling\n- AMF message encoding/decoding\n- RTMP command processing (connect, play, publish)\n\nSources: [bin/log/tmms.log:1-12]()\n\n### HTTP/FLV Protocol\n\nHTTP/FLV allows players to receive streams over HTTP, with content delivered in FLV format:\n\n- HTTP request parsing\n- HTTP response creation\n- FLV header generation\n- FLV tag formatting\n\nSources: [src/mmedia/http/HttpRequest.cc:59-85](), [src/mmedia/flv/FlvContext.cc:54-89]()\n\n## Session Management\n\nThe session management system is responsible for coordinating publishers and players for each stream:\n\n```mermaid\nclassDiagram\n    class LiveService {\n        -sessions_: Map\u003cstring, Session\u003e\n        +CreateSession(sessionName): SessionPtr\n        +FindSession(sessionName): SessionPtr\n        +CloseSession(sessionName): bool\n        +OnPlay(conn, sessionName, param): bool\n        +OnPublish(conn, sessionName, param): bool\n    }\n    \n    class Session {\n        -session_name_: string\n        -stream_: StreamPtr\n        -publisher_: UserPtr\n        -players_: Set\u003cPlayerUserPtr\u003e\n        +CreatePublishUser(conn, name, param, type): UserPtr\n        +CreatePlayerUser(conn, name, param, type): UserPtr\n        +SetPublisher(user): void\n        +AddPlayer(user): void\n        +CloseUser(user): void\n    }\n    \n    class Stream {\n        -packet_buffer_: vector\u003cPacketPtr\u003e\n        -gop_mgr_: GopMgr\n        -codec_headers_: CodecHeader\n        +AddPacket(packet): void\n        +GetFrames(user): bool\n    }\n    \n    class User {\n        #connection_: ConnectionPtr\n        #stream_: StreamPtr\n        #session_: SessionPtr\n        +GetUserType(): UserType\n        +Close(): void\n    }\n    \n    class PlayerUser {\n        +PostFrames(): void\n    }\n    \n    LiveService \"1\" --\u003e \"*\" Session: manages\n    Session \"1\" --\u003e \"1\" Stream: owns\n    Session \"1\" --\u003e \"0..1\" User: publisher\n    Session \"1\" --\u003e \"*\" PlayerUser: players\n    User \u003c|-- PlayerUser: inherits\n```\n\nSources: [src/live/LiveService.cc:28-66](), [src/live/LiveService.cc:130-182]()\n\nWhen a client connects to publish or play a stream:\n\n1. LiveService creates a Session with the requested stream name\n2. The Session creates the appropriate User object (publisher or player)\n3. For publishers, media data is added to the Stream\n4. For players, media data is retrieved from the Stream and sent to the client\n\nSources: [src/live/LiveService.cc:154-182]()\n\n## Network Layer\n\nThe networking layer handles all TCP connections and event-driven I/O:\n\n```mermaid\nclassDiagram\n    class EventLoop {\n        +Loop(): void\n        +RunInLoop(func): void\n        +RunAfter(delay, func): void\n    }\n    \n    class EventLoopThreadPool {\n        -loops_: vector\u003cEventLoop*\u003e\n        +Start(): void\n        +GetNextLoop(): EventLoop*\n    }\n    \n    class TcpServer {\n        -event_loop_: EventLoop*\n        -connections_: Map\u003cstring, TcpConnection\u003e\n        +Start(): void\n        +SetMessageCallback(func): void\n        +SetNewConnectionCallback(func): void\n    }\n    \n    class TcpConnection {\n        -event_loop_: EventLoop*\n        -socket_: Socket\n        -buffer_: Buffer\n        +Send(data): void\n        +ForceClose(): void\n        +SetContext(key, value): void\n    }\n    \n    class TimingWheel {\n        -wheels_: vector\u003cWheel\u003e\n        +OnTimer(now): void\n        +RunAfter(delay, func): void\n    }\n    \n    EventLoopThreadPool \"1\" --\u003e \"*\" EventLoop: contains\n    TcpServer --\u003e \"1\" EventLoop: uses\n    TcpServer \"1\" --\u003e \"*\" TcpConnection: manages\n    EventLoop --\u003e TimingWheel: uses\n```\n\nSources: [src/live/LiveService.cc:197-215](), [src/network/net/TimingWheel.cc:5-152]()\n\nThe network layer is built on an event-driven architecture:\n\n1. The EventLoopThreadPool creates multiple EventLoop instances running in separate threads\n2. Each EventLoop manages I/O events and callbacks for a subset of connections\n3. TcpServer accepts incoming connections and creates TcpConnection objects\n4. TimingWheel provides timing functionality for timeouts and scheduled tasks\n\nSources: [src/live/LiveService.cc:197-215](), [src/network/net/TimingWheel.cc:15-43]()\n\n## Media Processing\n\nThe media processing system handles audio and video data demuxing, codec information, and GOP (Group of Pictures) management:\n\n```mermaid\ngraph TD\n    subgraph \"Media Input\"\n        Packet[\"RTMP/HTTP Packet\"]\n    end\n    \n    subgraph \"Media Processing\"\n        Demuxer[\"Video/Audio Demuxer\"]\n        CodecInfo[\"Codec Information\"]\n        GopManager[\"GOP Manager\"]\n    end\n    \n    subgraph \"Media Storage\"\n        Buffer[\"Media Buffer\"]\n    end\n    \n    subgraph \"Media Output\"\n        RtmpOut[\"RTMP Output\"]\n        FlvOut[\"FLV Output\"]\n    end\n    \n    Packet --\u003e Demuxer\n    Demuxer --\u003e CodecInfo\n    Demuxer --\u003e GopManager\n    GopManager --\u003e Buffer\n    CodecInfo --\u003e Buffer\n    \n    Buffer --\u003e RtmpOut\n    Buffer --\u003e FlvOut\n```\n\nSources: [src/mmedia/demux/VideoDemux.cc:7-246](), [src/mmedia/flv/FlvContext.cc:91-130]()\n\n### Video Processing\n\nThe video processing system primarily handles H.264/AVC streams:\n\n1. Video frames are received in RTMP packets\n2. VideoDemux extracts NAL units from the video data\n3. NAL units are analyzed to identify frame types (IDR, non-IDR, SPS, PPS)\n4. Codec information is extracted from sequence headers\n5. Frames are organized into GOPs for efficient streaming\n\nSources: [src/mmedia/demux/VideoDemux.cc:17-117](), [src/mmedia/base/AVTypes.h:69-82]()\n\n### FLV Output\n\nFor HTTP/FLV players, the system formats media data as FLV:\n\n1. FLV header is created based on available media types\n2. Media data is encapsulated in FLV tags\n3. Tags include type, size, and timestamp information\n4. FLV data is sent over HTTP connections\n\nSources: [src/mmedia/flv/FlvContext.cc:54-130]()\n\n## Data Flow\n\nThe complete data flow through the system for a live streaming session:\n\n```mermaid\nsequenceDiagram\n    participant Publisher\n    participant RtmpServer\n    participant LiveService\n    participant Session\n    participant Stream\n    participant Player\n    \n    Publisher-\u003e\u003eRtmpServer: Connect (RTMP)\n    RtmpServer-\u003e\u003eRtmpServer: Handshake\n    Publisher-\u003e\u003eRtmpServer: Publish command\n    RtmpServer-\u003e\u003eLiveService: OnPublish(conn, session_name)\n    LiveService-\u003e\u003eSession: CreateSession(session_name)\n    LiveService-\u003e\u003eSession: CreatePublishUser(conn)\n    Session-\u003e\u003eSession: SetPublisher(user)\n    \n    Publisher-\u003e\u003eRtmpServer: Send media packet\n    RtmpServer-\u003e\u003eLiveService: OnRecv(conn, packet)\n    LiveService-\u003e\u003eStream: AddPacket(packet)\n    Stream-\u003e\u003eStream: Process and buffer\n    \n    Player-\u003e\u003eRtmpServer: Connect (RTMP)\n    RtmpServer-\u003e\u003eRtmpServer: Handshake\n    Player-\u003e\u003eRtmpServer: Play command\n    RtmpServer-\u003e\u003eLiveService: OnPlay(conn, session_name)\n    LiveService-\u003e\u003eSession: FindSession(session_name)\n    LiveService-\u003e\u003eSession: CreatePlayerUser(conn)\n    Session-\u003e\u003eSession: AddPlayer(user)\n    \n    LiveService-\u003e\u003ePlayer: OnActive\n    Player-\u003e\u003eStream: GetFrames\n    Stream-\u003e\u003ePlayer: Return media packets\n    Player-\u003e\u003ePlayer: Send to client\n```\n\nSources: [src/live/LiveService.cc:130-195](), [bin/log/tmms.log:85-148]()\n\n## Configuration and Logging\n\nThe system includes comprehensive configuration and logging facilities:\n\n1. Configuration system loads settings for:\n   - Network parameters (address, port)\n   - Protocol settings\n   - Session timeouts\n   - Thread pool size\n\n2. Logging system provides debug information with different levels:\n   - TRACE for detailed protocol-level debugging\n   - DEBUG for operational information\n   - INFO for general status\n   - WARN and ERROR for issues\n\nSources: [src/mmedia/base/MMediaLog.h:1-52](), [src/live/LiveService.cc:197-215]()\n\n## Summary\n\nThe StreamMediaServer architecture follows a modular, layered design that separates concerns between protocol handling, session management, media processing, and network communication. This design enables:\n\n1. Support for multiple streaming protocols (RTMP, HTTP/FLV)\n2. Efficient handling of media data with GOP-based stream management\n3. Scalable connection handling through an event-driven thread pool\n4. Clear separation between different components of the system\n\nFor more details on specific components, refer to the following pages:\n- Network Layer details: [Network Layer](#2)\n- Media Processing System: [Media Processing System](#3)\n- Live Streaming System: [Live Streaming System](#4)"])</script><script>self.__next_f.push([1,"1a:T2033,"])</script><script>self.__next_f.push([1,"# Build System\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [CMakeLists.txt](CMakeLists.txt)\n- [bin/config/publish/hx.com.json](bin/config/publish/hx.com.json)\n- [src/CMakeLists.txt](src/CMakeLists.txt)\n- [src/base/FileLog.cc](src/base/FileLog.cc)\n- [src/base/LogStream.cc](src/base/LogStream.cc)\n- [src/base/Logger.cc](src/base/Logger.cc)\n- [src/base/Logger.h](src/base/Logger.h)\n- [src/main/CMakeLists.txt](src/main/CMakeLists.txt)\n- [src/main/TestLog.cc](src/main/TestLog.cc)\n- [src/main/main.cc](src/main/main.cc)\n- [src/mmedia/CMakeLists.txt](src/mmedia/CMakeLists.txt)\n- [src/mmedia/base/AVTypes.h](src/mmedia/base/AVTypes.h)\n- [src/mmedia/base/MMediaLog.h](src/mmedia/base/MMediaLog.h)\n- [src/mmedia/demux/VideoDemux.cc](src/mmedia/demux/VideoDemux.cc)\n- [src/mmedia/demux/VideoDemux.h](src/mmedia/demux/VideoDemux.h)\n- [src/mmedia/flv/FlvContext.cc](src/mmedia/flv/FlvContext.cc)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Overview\n\nThis document describes the build system used by StreamMediaServer, detailing the project structure, dependencies, and build configuration. The StreamMediaServer uses CMake as its primary build tool and organizes code into modular components that can be independently compiled and linked.\n\nFor information about the overall architecture, see [Architecture Overview](#1.1).\n\n## Project Structure\n\nThe StreamMediaServer project is organized into multiple components with a hierarchical directory structure, where each component has its own CMakeLists.txt file defining build requirements.\n\n### Component Organization Diagram\n\n```mermaid\ngraph TD\n    subgraph \"StreamMediaServer\"\n        ProjectRoot[\"Project Root\"]\n        SrcDir[\"src/\"]\n        BaseLib[\"base library\"]\n        NetworkLib[\"network library\"]\n        MmediaLib[\"mmedia library\"]\n        LiveLib[\"live library\"]\n        MainExe[\"main executable\"]\n        ConfigDir[\"bin/config/\"]\n        ThirdParty[\"third_party/\"]\n    end\n    \n    ProjectRoot --\u003e SrcDir\n    ProjectRoot --\u003e ConfigDir\n    ProjectRoot --\u003e ThirdParty\n    \n    SrcDir --\u003e BaseLib\n    SrcDir --\u003e NetworkLib\n    SrcDir --\u003e MmediaLib\n    SrcDir --\u003e LiveLib\n    SrcDir --\u003e MainExe\n    \n    MmediaLib --\u003e MmediaBaseDir[\"mmedia/base/\"]\n    MmediaLib --\u003e RtmpDir[\"mmedia/rtmp/\"]\n    MmediaLib --\u003e HttpDir[\"mmedia/http/\"]\n    MmediaLib --\u003e FlvDir[\"mmedia/flv/\"]\n    MmediaLib --\u003e DemuxDir[\"mmedia/demux/\"]\n```\n\nSources: [CMakeLists.txt:51-55](), [src/CMakeLists.txt:1-6](), [src/mmedia/CMakeLists.txt:1-10]()\n\n## Component Dependencies\n\nThe components in StreamMediaServer have specific dependencies on each other and external libraries. Understanding these relationships is crucial for maintaining and extending the codebase.\n\n### Component Dependency Diagram\n\n```mermaid\ngraph TD\n    subgraph \"Component Dependencies\"\n        Main[\"tmms (executable)\"]\n        Base[\"base\"]\n        Network[\"network\"]\n        Mmedia[\"mmedia\"]\n        Live[\"live\"]\n        Jsoncpp[\"jsoncpp.a (external)\"]\n        Crypto[\"crypto (external)\"]\n    end\n    \n    Main --\u003e Base\n    Main --\u003e Network\n    Main --\u003e Mmedia\n    Main --\u003e Live\n    Main --\u003e Jsoncpp\n    Main --\u003e Crypto\n    \n    Mmedia --\u003e Base\n    Mmedia --\u003e Network\n    Mmedia --\u003e Crypto\n    \n    Live --\u003e Base\n    Live --\u003e Network\n    Live --\u003e Mmedia\n    \n    Network --\u003e Base\n```\n\nSources: [src/main/CMakeLists.txt:1-8](), [src/mmedia/CMakeLists.txt:8-9]()\n\n## CMake Configuration\n\nThe build system uses CMake version 3.1 or higher and provides configurations for different build types.\n\n### Main CMake Settings\n\n1. **Minimum CMake version**: 3.1\n2. **Project name**: tmms\n3. **Installation path**: `../bin`\n4. **Default build type**: Debug\n\nSources: [CMakeLists.txt:2-4](), [CMakeLists.txt:5-6](), [CMakeLists.txt:28]()\n\n### Build Types\n\nThe project supports two build types with different optimization levels:\n\n| Build Type | Compiler Flags | Description |\n|------------|----------------|-------------|\n| Debug | `-std=c++17 -O0 -g -pipe -Wall -Werror -Wno-unused-variable -lrt -pthread` | Includes debug symbols, no optimization |\n| Release | `-std=c++17 -O3 -g -pipe -Wall -Werror -Wno-unused-variable -lrt -pthread` | Highest optimization level with some debug info |\n\nAdditional compiler flags applied to both modes:\n```\n-fno-strict-aliasing -Wno-error=shadow -Wno-sign-compare\n```\n\nFor GCC versions greater than 7.2.9, these additional flags are applied:\n```\n-Wno-error=unused-result -Werror=return-type\n```\n\nSources: [CMakeLists.txt:28-40](), [CMakeLists.txt:42-49]()\n\n## External Dependencies\n\n### jsoncpp\n\nThe build system configures jsoncpp as an external dependency:\n\n```mermaid\nflowchart TD\n    A[\"ExternalProject_Add(jsoncpp)\"] --\u003e B[\"Configure jsoncpp\"]\n    B --\u003e C[\"Build jsoncpp\"]\n    C --\u003e D[\"Install jsoncpp to lib/jsoncpp/\"]\n    D --\u003e E[\"Include and link jsoncpp\"]\n```\n\nThe jsoncpp library is configured with these steps:\n1. **Source directory**: `${PROJECT_SOURCE_DIR}/third_party/jsoncpp`\n2. **Build configuration**: Uses CMake to configure in `../jsoncpp-build`\n3. **Installation path**: `${PROJECT_SOURCE_DIR}/lib/jsoncpp/`\n4. **Include paths**: Added to the project via `include_directories`\n5. **Link paths**: Added via `link_directories`\n\nSources: [CMakeLists.txt:12-24](), [src/main/CMakeLists.txt:5-6]()\n\n## Build Process\n\nThe build process for StreamMediaServer follows these steps:\n\n```mermaid\nflowchart TD\n    A[\"CMake Configuration\"] --\u003e B[\"Build External Dependencies (jsoncpp)\"]\n    B --\u003e C[\"Compile Base Library\"]\n    C --\u003e D[\"Compile Network Library\"]\n    D --\u003e E[\"Compile Media Library (mmedia)\"]\n    E --\u003e F[\"Compile Live Library\"]\n    F --\u003e G[\"Compile Main Executable\"]\n    G --\u003e H[\"Install Binary to bin/sbin/\"]\n```\n\nEach component is built according to its CMakeLists.txt file:\n\n1. **Base Library**: Core utilities including logging system\n2. **Network Library**: TCP server, connections, and event loop\n3. **Media Library (mmedia)**: Media processing including:\n   - Base media types\n   - RTMP protocol handling\n   - HTTP protocol handling\n   - FLV format handling\n   - Media demuxing\n4. **Live Library**: Live streaming service\n5. **Main Executable**: Final program (tmms)\n\nSources: [src/CMakeLists.txt:1-6](), [src/mmedia/CMakeLists.txt:1-10](), [src/main/CMakeLists.txt:1-8]()\n\n## Building The Project\n\n### Prerequisites\n\n1. CMake 3.1 or higher\n2. C++ compiler with C++17 support\n3. Required development libraries:\n   - libcrypto\n   - pthread\n\n### Build Commands\n\nTo build the project:\n\n```bash\n# From the project root directory\nmkdir build\ncd build\ncmake ..\nmake\n```\n\nThe final executable will be generated as `tmms` and installed to `../bin/sbin/` when using `make install`.\n\nSources: [CMakeLists.txt:2-6](), [src/main/CMakeLists.txt:7]()\n\n## Component Details\n\n### Media Library (mmedia)\n\nThe mmedia library is built from multiple source directories:\n\n```\n./                   # Root directory\nbase/                # Base media types and utilities\nrtmp/                # RTMP protocol implementation\nhttp/                # HTTP protocol implementation\nflv/                 # FLV format handling\ndemux/               # Media demuxing\nrtmp/amf/            # AMF encoding/decoding for RTMP\n```\n\nAll source files from these directories are compiled into a single `mmedia` library, which depends on the `base`, `network`, and `crypto` libraries.\n\nSources: [src/mmedia/CMakeLists.txt:1-9]()\n\n### Main Executable\n\nThe main executable (`tmms`) is built from the sources in the `src/main/` directory and links against all the project libraries:\n\n- base\n- network\n- mmedia\n- live\n- jsoncpp.a\n- crypto\n\nThe executable is installed to `bin/sbin/` when using `make install`.\n\nSources: [src/main/CMakeLists.txt:1-8]()\n\n## Configuration Files\n\nThe StreamMediaServer uses JSON configuration files located in the `bin/config/` directory. These files define server behavior, domains, and applications.\n\nExample configuration includes files like:\n- `bin/config/config.json`: Main configuration file loaded at startup\n- `bin/config/publish/hx.com.json`: Domain-specific configuration\n\nThe application loads configuration files at runtime, not during the build process.\n\nSources: [src/main/main.cc:19-26](), [bin/config/publish/hx.com.json:1-18]()"])</script><script>self.__next_f.push([1,"1b:T4155,"])</script><script>self.__next_f.push([1,"# Network Layer\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/mmedia/http/HttpClient.cc](src/mmedia/http/HttpClient.cc)\n- [src/mmedia/http/HttpClient.h](src/mmedia/http/HttpClient.h)\n- [src/mmedia/http/HttpUtils.h](src/mmedia/http/HttpUtils.h)\n- [src/mmedia/tests/HttpClientTest.cpp](src/mmedia/tests/HttpClientTest.cpp)\n- [src/network/DnsService.cc](src/network/DnsService.cc)\n- [src/network/DnsService.h](src/network/DnsService.h)\n- [src/network/TcpClient.cc](src/network/TcpClient.cc)\n- [src/network/net/Connection.h](src/network/net/Connection.h)\n- [src/network/net/EventLoop.cc](src/network/net/EventLoop.cc)\n- [src/network/net/TcpConnection.cc](src/network/net/TcpConnection.cc)\n- [src/network/net/tests/CMakeLists.txt](src/network/net/tests/CMakeLists.txt)\n- [src/network/net/tests/DnsServiceTest.cpp](src/network/net/tests/DnsServiceTest.cpp)\n- [src/network/net/tests/TcpClientTest.cpp](src/network/net/tests/TcpClientTest.cpp)\n- [src/network/net/tests/TcpServerTest.cpp](src/network/net/tests/TcpServerTest.cpp)\n\n\u003c/details\u003e\n\n\n\nThe Network Layer forms the foundation of the StreamMediaServer's communication capabilities. This layer is responsible for handling all TCP connections, event-driven I/O operations, and network address resolution. It provides the essential infrastructure that higher-level protocol implementations like RTMP and HTTP rely upon.\n\nFor specific information about individual protocols built on top of this layer, see [RTMP Protocol Implementation](#3.1) and [HTTP Protocol Implementation](#3.2). For details about the event-driven architecture, see [Event Loop System](#2.1).\n\n## Network Layer Architecture\n\nThe Network Layer implements an event-driven, non-blocking I/O model. It consists of several core components that work together to provide efficient network communication capabilities:\n\n```mermaid\nclassDiagram\n    class EventLoop {\n        -epoll_fd_: int\n        -events_: Map\u003cint, EventPtr\u003e\n        -wheel_: TimerWheel\n        +Loop()\n        +Quit()\n        +RunInLoop(func)\n        +EnableEventReading()\n        +EnableEventWriting()\n        +RunAfter(delay, func)\n    }\n    \n    class Connection {\n        #local_addr_: InetAddress\n        #peer_addr_: InetAddress\n        -contexts_: Map\u003cint, ContextPtr\u003e\n        +SetContext(type, context)\n        +GetContext(type)\n        +ForceClose()\n    }\n    \n    class TcpConnection {\n        -message_buffer_: MsgBuffer\n        -message_cb_: MessageCallback\n        -close_cb_: CloseConnectionCallback\n        -write_complete_cb_: WriteCompleteCallback\n        -io_vec_list_: List\u003ciovec\u003e\n        -closed_: bool\n        +Send(buf, size)\n        +OnRead()\n        +OnWrite()\n        +OnClose()\n        +EnableCheckIdleTimeout()\n    }\n    \n    class TcpServer {\n        -loop_: EventLoop\n        -acceptor_: Acceptor\n        -connections_: Map\u003cstring, TcpConnection\u003e\n        -new_connection_cb_: NewConnectionCallback\n        -message_cb_: MessageCallback\n        +Start()\n        +SetNewConnectionCallback()\n        +SetMessageCallback()\n    }\n    \n    class TcpClient {\n        -server_addr_: InetAddress\n        -status_: TcpConnectionStatus\n        -connected_cb_: ConnectionCallback\n        +Connect()\n        +SetConnectCallback()\n    }\n    \n    class DnsService {\n        -hosts_info_: Map\u003cstring, List\u003cInetAddressPtr\u003e\u003e\n        -running_: bool\n        -thread_: Thread\n        +AddHost(host)\n        +GetHostAddress(host)\n        +Start()\n        +Stop()\n        +OnWork()\n    }\n    \n    EventLoop \u003c-- TcpServer: uses\n    EventLoop \u003c-- TcpConnection: uses\n    Connection \u003c|-- TcpConnection: inherits\n    TcpServer --\u003e TcpConnection: creates\n    TcpConnection \u003c|-- TcpClient: inherits\n    TcpClient --\u003e DnsService: uses for resolution\n```\n\nSources: [src/network/net/EventLoop.cc](), [src/network/net/TcpConnection.cc](), [src/network/net/Connection.h](), [src/network/TcpClient.cc](), [src/network/DnsService.h]()\n\n## Event Loop System\n\nAt the core of the network layer is the `EventLoop` class, which implements an event-driven I/O model using the Linux epoll mechanism. Each `EventLoop` instance is tied to a single thread, ensuring that all event handlers are executed in a thread-safe manner.\n\n### Event Loop Operation\n\nThe `EventLoop` manages a collection of file descriptors (sockets) and their associated events. When a socket becomes readable, writable, or encounters an error, the appropriate callback is triggered. This approach allows the server to handle thousands of connections efficiently without spawning a thread per connection.\n\n```mermaid\nflowchart TB\n    subgraph \"EventLoop\"\n        Poll[\"epoll_wait()\"]\n        Process[\"Process Events\"]\n        CallbackA[\"Execute Read Callback\"]\n        CallbackB[\"Execute Write Callback\"]\n        CallbackC[\"Execute Error Callback\"]\n        PendingTasks[\"Run Pending Tasks\"]\n        TimerEvents[\"Process Timer Events\"]\n    end\n    \n    Init[\"Initialize EventLoop\"] --\u003e Poll\n    Poll --\u003e Process\n    Process --\u003e CallbackA\n    Process --\u003e CallbackB\n    Process --\u003e CallbackC\n    Process --\u003e PendingTasks\n    Process --\u003e TimerEvents\n    TimerEvents --\u003e Poll\n    PendingTasks --\u003e Poll\n```\n\nThe event loop executes the following key operations:\n\n1. Wait for events using `epoll_wait()` [src/network/net/EventLoop.cc:42]()\n2. Process events (read, write, error, hangup) [src/network/net/EventLoop.cc:45-74]()\n3. Execute pending tasks added via `RunInLoop()` [src/network/net/EventLoop.cc:80]()\n4. Process timer events [src/network/net/EventLoop.cc:82]()\n5. Repeat the cycle\n\nSources: [src/network/net/EventLoop.cc:35-89]()\n\n### Cross-Thread Task Execution\n\nThe `EventLoop` provides a mechanism to safely execute tasks from other threads:\n\n```mermaid\nsequenceDiagram\n    participant OtherThread\n    participant EventLoopThread\n    participant EventLoop\n    \n    OtherThread-\u003e\u003eEventLoop: RunInLoop(task)\n    alt In Loop Thread\n        EventLoop-\u003e\u003eEventLoop: Execute task immediately\n    else In Other Thread\n        EventLoop-\u003e\u003eEventLoop: Queue task\n        EventLoop-\u003e\u003eEventLoop: WakeUp()\n        EventLoopThread-\u003e\u003eEventLoop: Process events\n        EventLoop-\u003e\u003eEventLoop: Execute queued tasks\n    end\n```\n\nWhen a task is submitted via `RunInLoop()`, the event loop checks if the call is made from the loop's thread. If yes, it executes the task immediately. Otherwise, it queues the task and wakes up the event loop to process it. This ensures that all operations on the loop's resources are thread-safe.\n\nSources: [src/network/net/EventLoop.cc:183-216]()\n\n## Connection Management\n\nThe network layer provides a comprehensive connection management system based on two key classes: `Connection` (the abstract base class) and `TcpConnection` (the TCP implementation).\n\n### Connection Lifecycle\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e \"Initialization\": Constructor\n    \"Initialization\" --\u003e \"Connected\": TCP Connection Established\n    \"Connected\" --\u003e \"Active\": Data Transmission\n    \"Active\" --\u003e \"Connected\": Idle\n    \"Connected\" --\u003e \"Closing\": Close Requested\n    \"Active\" --\u003e \"Closing\": Close Requested\n    \"Closing\" --\u003e \"Closed\": Resources Released\n    \"Closed\" --\u003e [*]: Destructor\n```\n\nThe `TcpConnection` class manages the entire lifecycle of a TCP connection, from establishment to closure. Key aspects include:\n\n1. **Initialization**: Connection objects are created with an `EventLoop`, socket file descriptor, and address information\n2. **Data Reception**: Handled by the `OnRead()` method, which reads data into a buffer and triggers the message callback\n3. **Data Transmission**: Accomplished via the `Send()` method, which efficiently handles data using scatter-gather I/O\n4. **Closure**: Managed by the `OnClose()` method, which triggers close callbacks and releases resources\n\nSources: [src/network/net/TcpConnection.cc:9-16](), [src/network/net/TcpConnection.cc:47-77](), [src/network/net/TcpConnection.cc:166-241](), [src/network/net/TcpConnection.cc:18-30]()\n\n### Context Management\n\nThe `Connection` class provides a flexible context system that allows protocol-specific handlers to associate data with connections:\n\n```mermaid\nclassDiagram\n    class Connection {\n        -contexts_: Map\u003cint, ContextPtr\u003e\n        +SetContext(type, context)\n        +GetContext~T~(type): shared_ptr~T~\n    }\n    \n    class ContextTypes {\n        \u003c\u003cenumeration\u003e\u003e\n        kNormalContext = 0\n        kRtmpContext = 1\n        kHttpContext = 2\n        kUserContext = 3\n        kFlvContext = 4\n    }\n    \n    class RtmpContext {\n        +ProcessPacket()\n    }\n    \n    class HttpContext {\n        +Parse()\n        +WriteComplete()\n    }\n    \n    class FlvContext {\n        +HandleRequest()\n    }\n    \n    Connection --\u003e ContextTypes: uses\n    Connection --\u003e \"0..n\" RtmpContext: stores\n    Connection --\u003e \"0..n\" HttpContext: stores\n    Connection --\u003e \"0..n\" FlvContext: stores\n```\n\nThis context system allows higher-level protocol implementations to associate protocol-specific data and behavior with a connection. For example, the HTTP protocol implementation can store an `HttpContext` in a connection, which can then be retrieved to process HTTP messages.\n\nSources: [src/network/net/Connection.h:44-57]()\n\n## TCP Server and Client\n\nThe network layer provides both server and client implementations for TCP communication.\n\n### TCP Server\n\nThe `TcpServer` class implements a TCP server that:\n\n1. Binds to a listening address\n2. Accepts incoming connections\n3. Creates a `TcpConnection` object for each accepted connection\n4. Manages the lifecycle of these connections\n\n```mermaid\nsequenceDiagram\n    participant Client\n    participant Acceptor\n    participant TcpServer\n    participant TcpConnection\n    participant EventLoop\n    \n    Client-\u003e\u003eAcceptor: Connect\n    Acceptor-\u003e\u003eTcpServer: NewConnection callback\n    TcpServer-\u003e\u003eTcpConnection: Create new connection\n    TcpServer-\u003e\u003eTcpConnection: Configure callbacks\n    TcpConnection-\u003e\u003eEventLoop: Register for events\n    EventLoop-\u003e\u003eTcpConnection: OnRead (data available)\n    TcpConnection-\u003e\u003eTcpServer: Message callback\n    TcpServer-\u003e\u003eProtocol Handler: Pass data to protocol\n```\n\nSources: [src/network/net/tests/TcpServerTest.cpp:23-40]()\n\n### TCP Client\n\nThe `TcpClient` class extends `TcpConnection` to implement client-side connection establishment:\n\n1. Creates a non-blocking socket\n2. Initiates a connection attempt to the server\n3. Monitors for connection completion (successful or failed)\n4. Provides the same data sending/receiving capabilities as `TcpConnection`\n\n```mermaid\nflowchart TD\n    Start[\"Create TcpClient\"] --\u003e Connect[\"Connect()\"]\n    Connect --\u003e CreateSocket[\"Create Non-blocking Socket\"]\n    CreateSocket --\u003e Attempt[\"Attempt Connection\"]\n    Attempt --\u003e Monitor[\"Monitor Connection Status\"]\n    \n    Monitor --\u003e Success[\"Connection Successful\"]\n    Monitor --\u003e Failure[\"Connection Failed\"]\n    \n    Success --\u003e Connected[\"Connected State\"]\n    Failure --\u003e Disconnected[\"Disconnected State\"]\n    \n    Connected --\u003e Send[\"Send/Receive Data\"]\n    Connected --\u003e Close[\"OnClose()\"]\n    \n    Close --\u003e Disconnected\n```\n\nThe `TcpClient` uses a state machine to track the connection status:\n\n- `kTcpConStatusInit`: Initial state\n- `kTcpConStatusConnecting`: Connection in progress\n- `kTcpConStatusConnected`: Connection established\n- `kTcpConStatusDisConnected`: Connection closed\n\nSources: [src/network/TcpClient.cc:7-22](), [src/network/TcpClient.cc:23-62](), [src/network/net/tests/TcpClientTest.cpp:24-55]()\n\n## DNS Service\n\nThe `DnsService` component provides asynchronous domain name resolution for the network layer. It maintains a cache of resolved hostnames to reduce DNS lookup overhead.\n\n### DNS Resolution Process\n\n```mermaid\nflowchart LR\n    Client[\"Client Code\"] --\u003e AddHost[\"AddHost(domain)\"]\n    AddHost --\u003e Cache[\"Check Cache\"]\n    \n    subgraph \"Cache Operations\"\n        Cache --\u003e Found[\"Found in Cache\"]\n        Cache --\u003e NotFound[\"Not in Cache\"]\n        NotFound --\u003e Resolve[\"Resolve DNS\"]\n        Resolve --\u003e UpdateCache[\"Update Cache\"]\n    end\n    \n    Found --\u003e Return[\"Return Cached IP(s)\"]\n    UpdateCache --\u003e Return\n    \n    subgraph \"Background Thread\"\n        Periodically[\"Periodically\"] --\u003e ReResolve[\"Re-resolve All Hosts\"]\n        ReResolve --\u003e RefreshCache[\"Refresh Cache\"]\n    end\n```\n\nKey features of the DNS service:\n\n1. **Background Resolution**: Uses a dedicated thread to periodically refresh DNS information\n2. **Caching**: Maintains a cache of resolved addresses to avoid repeated lookups\n3. **IPv4/IPv6 Support**: Handles both IPv4 and IPv6 address resolution\n4. **Multiple Address Support**: Returns all resolved addresses for a hostname, enabling client-side load balancing\n\nSources: [src/network/DnsService.cc:69-103](), [src/network/DnsService.cc:105-140](), [src/network/net/tests/DnsServiceTest.cpp:7-22]()\n\n### Integration with HTTP Client\n\nThe DNS service is particularly important for HTTP clients that need to resolve domain names before establishing connections:\n\n```mermaid\nsequenceDiagram\n    participant Application\n    participant HttpClient\n    participant DnsService\n    participant TcpClient\n    \n    Application-\u003e\u003eHttpClient: Get(\"http://example.com\")\n    HttpClient-\u003e\u003eHttpClient: ParseUrl()\n    HttpClient-\u003e\u003eDnsService: GetHostAddress(\"example.com\")\n    alt Found in Cache\n        DnsService-\u003e\u003eHttpClient: Return cached IP(s)\n    else Not in Cache\n        DnsService-\u003e\u003eDnsService: AddHost(\"example.com\")\n        DnsService-\u003e\u003eDnsService: GetHostInfo(\"example.com\")\n        DnsService-\u003e\u003eHttpClient: Return resolved IP(s)\n    end\n    HttpClient-\u003e\u003eTcpClient: Create with resolved IP\n    TcpClient-\u003e\u003eTcpClient: Connect()\n```\n\nThe `HttpClient` class leverages the DNS service to convert domain names in URLs to IP addresses before establishing the TCP connection. This ensures that the client can connect to servers identified by domain names rather than just IP addresses.\n\nSources: [src/mmedia/http/HttpClient.cc:71-148](), [src/mmedia/http/HttpClient.cc:182-193](), [src/mmedia/tests/HttpClientTest.cpp:69-75]()\n\n## Integration with Protocol Handlers\n\nThe Network Layer serves as the foundation for protocol-specific implementations. It provides the necessary abstractions for these higher-level components to handle their specific protocols without worrying about the details of network communication.\n\n```mermaid\nflowchart TD\n    subgraph \"Network Layer\"\n        EventLoop[\"EventLoop\"]\n        TcpServer[\"TcpServer\"]\n        TcpConnection[\"TcpConnection\"]\n        Connection[\"Connection\"]\n    end\n    \n    subgraph \"Protocol Handlers\"\n        RtmpContext[\"RtmpContext\"]\n        HttpContext[\"HttpContext\"]\n        FlvContext[\"FlvContext\"]\n    end\n    \n    subgraph \"Media Layer\"\n        LiveService[\"LiveService\"]\n        Session[\"Session\"]\n        Stream[\"Stream\"]\n    end\n    \n    TcpServer --\u003e TcpConnection: creates\n    TcpConnection --\u003e Connection: inherits from\n    \n    Connection --\u003e RtmpContext: stores via SetContext\n    Connection --\u003e HttpContext: stores via SetContext\n    Connection --\u003e FlvContext: stores via SetContext\n    \n    RtmpContext --\u003e LiveService: forwards requests\n    HttpContext --\u003e LiveService: forwards requests\n    FlvContext --\u003e LiveService: forwards data\n    \n    LiveService --\u003e Session: manages\n    Session --\u003e Stream: owns\n```\n\nKey integration points:\n\n1. **Context System**: Protocol handlers store their state in connection contexts using the `Connection::SetContext()` method\n2. **Callback Mechanism**: Protocol handlers register callbacks with connections to be notified of network events\n3. **Event-driven Processing**: Protocol handlers process data in response to events from the network layer\n\nThis design allows for a clean separation of concerns, with the network layer handling the low-level details of network communication and the protocol handlers focusing on protocol-specific logic.\n\nSources: [src/network/net/Connection.h:14-21](), [src/mmedia/http/HttpClient.cc:31-45]()\n\n## Summary\n\nThe Network Layer provides the foundation for all communication within the StreamMediaServer. Its event-driven, non-blocking I/O model allows the server to efficiently handle thousands of concurrent connections. Key components include:\n\n- **EventLoop**: Manages event-driven I/O using epoll\n- **TcpConnection**: Handles TCP connections and data transfer\n- **TcpServer/TcpClient**: Provides server and client implementations\n- **DnsService**: Resolves domain names to IP addresses\n- **Connection Context System**: Enables integration with protocol-specific handlers\n\nThis layer is designed to be highly efficient, thread-safe, and flexible, providing the necessary infrastructure for the higher-level protocol implementations like RTMP and HTTP."])</script><script>self.__next_f.push([1,"1c:T2495,"])</script><script>self.__next_f.push([1,"# Event Loop System\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/network/net/EventLoop.cc](src/network/net/EventLoop.cc)\n- [src/network/net/TcpConnection.cc](src/network/net/TcpConnection.cc)\n\n\u003c/details\u003e\n\n\n\nThe Event Loop System is a core component of the StreamMediaServer's network layer, providing an efficient, event-driven architecture for handling asynchronous I/O operations. This document explains the design, implementation, and usage of the event loop system that powers the server's networking capabilities. For information about TCP server implementation that builds upon this event loop, see [TCP Server and Client](#2.2).\n\n## Purpose and Core Functionality\n\nThe Event Loop System serves as the foundation for non-blocking, asynchronous network operations in the StreamMediaServer by:\n\n1. Monitoring file descriptors for I/O readiness\n2. Dispatching events to appropriate handlers\n3. Executing user-defined callbacks in a thread-safe manner\n4. Providing timer functionality for delayed and repeated task execution\n\nThe implementation uses Linux's `epoll` mechanism for efficient I/O multiplexing, enabling the server to handle numerous connections simultaneously with minimal overhead.\n\nSources: [src/network/net/EventLoop.cc:15-30]()\n\n## Architecture Overview\n\n```mermaid\nclassDiagram\n    class EventLoop {\n        -epoll_fd_: int\n        -events_: Map\u003cint, EventPtr\u003e\n        -functions_: Queue\u003cFunc\u003e\n        -wheel_: TimerWheel\n        +Loop()\n        +Quit()\n        +RunInLoop(Func)\n        +RunAfter(delay, Func)\n        +RunEvery(interval, Func)\n        +AddEvent(EventPtr)\n        +DelEvent(EventPtr)\n    }\n    \n    class Event {\n        #fd_: int\n        #event_: int\n        #loop_: EventLoop*\n        +OnRead()\n        +OnWrite()\n        +OnError()\n        +OnClose()\n        +EnableWriting(bool)\n        +EnableReading(bool)\n    }\n    \n    class TcpConnection {\n        -message_buffer_: Buffer\n        -io_vec_list_: vector\u003ciovec\u003e\n        -close_cb_: CloseConnectionCallback\n        -message_cb_: MessageCallback\n        -timeout_entry_: weak_ptr\u003cTimeoutEntry\u003e\n        +Send(buf, size)\n        +ForceClose()\n        +OnRead()\n        +OnWrite()\n        +OnTimeout()\n    }\n    \n    class PipeEvent {\n        +Write(data, size)\n        +OnRead()\n    }\n    \n    class TimerWheel {\n        +InsertEntry(delay, EntryPtr)\n        +RunAfter(delay, Func)\n        +RunEvery(interval, Func)\n        +OnTimer(now)\n    }\n    \n    Event \u003c|-- TcpConnection : inherits\n    Event \u003c|-- PipeEvent : inherits\n    EventLoop --\u003e Event : manages\n    EventLoop --\u003e TimerWheel : contains\n    EventLoop --\u003e PipeEvent : wakeup\n    TcpConnection --\u003e EventLoop : uses\n```\n\nThe Event Loop System follows a classic event-driven architecture pattern, where the EventLoop continuously waits for events and dispatches them to appropriate handlers.\n\nSources: [src/network/net/EventLoop.cc:18-33](), [src/network/net/EventLoop.cc:35-89]()\n\n## Core Components\n\n### EventLoop Class\n\nThe `EventLoop` class is the central component that:\n\n1. Maintains the event loop in a single thread\n2. Manages event registration and dispatching\n3. Schedules tasks for execution\n4. Provides timer capabilities\n\nEach thread in the StreamMediaServer that performs I/O operations has its own `EventLoop` instance, ensuring thread safety and separation of concerns.\n\n```mermaid\nflowchart TD\n    subgraph \"EventLoop Operation\"\n        A[\"Initialize epoll\"] --\u003e B[\"Loop Start\"]\n        B --\u003e C[\"Wait for Events (epoll_wait)\"]\n        C --\u003e D[\"Process I/O Events\"]\n        D --\u003e E[\"Execute Pending Tasks\"]\n        E --\u003e F[\"Process Timer Events\"]\n        F --\u003e C\n        G[\"External Thread\\nRunInLoop(task)\"] --\u003e |\"Queue task\\nWake up loop\"| C\n    end\n```\n\nThe `EventLoop` uses a thread-local variable to ensure that one thread has only one associated event loop instance:\n\n```cpp\nstatic thread_local EventLoop * t_local_eventloop = nullptr;\n```\n\nThis design prevents race conditions and synchronization issues that could occur with multiple event loops in the same thread.\n\nSources: [src/network/net/EventLoop.cc:15-30](), [src/network/net/EventLoop.cc:35-89]()\n\n### Event Handling\n\nEvents are managed through the `Event` class hierarchy, with each subclass implementing specific event handling:\n\n1. **Event**: Base class for all event types\n2. **TcpConnection**: Handles TCP connection events\n3. **PipeEvent**: Used for waking up the event loop from other threads\n\nThe event loop registers these events with the Linux epoll system and monitors them for activity. When an event becomes ready (e.g., data available to read, buffer space available to write), the event loop calls the appropriate handler method (`OnRead()`, `OnWrite()`, etc.).\n\nSources: [src/network/net/EventLoop.cc:94-168](), [src/network/net/TcpConnection.cc:47-78](), [src/network/net/TcpConnection.cc:93-156]()\n\n## Thread Safety Mechanisms\n\nThe event loop runs in a single thread, but it can be accessed from other threads. To ensure thread safety:\n\n1. The `RunInLoop()` method is used to execute tasks in the event loop thread\n2. If called from the event loop thread itself, the task is executed immediately\n3. If called from another thread, the task is queued and the event loop is woken up\n4. The `AssertInLoopThread()` method is used to verify that code is running in the correct thread\n\n```mermaid\nsequenceDiagram\n    participant OtherThread as \"External Thread\"\n    participant EventLoop as \"EventLoop Thread\"\n    participant EpollWait as \"epoll_wait()\"\n    \n    Note over EventLoop: Running Loop()\n    EventLoop-\u003e\u003eEpollWait: Wait for events\n    \n    OtherThread-\u003e\u003eEventLoop: RunInLoop(task)\n    \n    Note over EventLoop: Queue task\n    OtherThread-\u003e\u003eEventLoop: WakeUp()\n    OtherThread-\u003e\u003eEventLoop: Write to pipe\n    \n    EpollWait--\u003e\u003eEventLoop: Pipe readable\n    EventLoop-\u003e\u003eEventLoop: Process pending tasks\n    EventLoop-\u003e\u003eEventLoop: Execute task\n    \n    EventLoop-\u003e\u003eEpollWait: Wait for events\n```\n\nThe `WakeUp()` method uses a special pipe (`PipeEvent`) to interrupt the `epoll_wait()` call when new tasks are queued from other threads.\n\nSources: [src/network/net/EventLoop.cc:170-228]()\n\n## Timer Functionality\n\nThe `EventLoop` provides timer capabilities through a `TimerWheel` implementation:\n\n1. **RunAfter**: Executes a task after a specified delay\n2. **RunEvery**: Executes a task repeatedly at specified intervals\n3. **InsertEntry**: Adds a new timer entry to the timer wheel\n\nThese methods ensure thread safety by redirecting calls from non-event-loop threads to the event loop thread using `RunInLoop()`.\n\nThe `TimerWheel` is processed in each iteration of the event loop, executing any tasks whose timers have expired.\n\nSources: [src/network/net/EventLoop.cc:233-300]()\n\n## TcpConnection Integration\n\nThe `TcpConnection` class utilizes the `EventLoop` for handling TCP connection events:\n\n1. Reading from the connection (`OnRead()`)\n2. Writing to the connection (`OnWrite()`)\n3. Handling errors and connection closure\n4. Managing timeouts\n\n```mermaid\nsequenceDiagram\n    participant Client as \"Client\"\n    participant EL as \"EventLoop\"\n    participant TC as \"TcpConnection\"\n    participant CB as \"User Callbacks\"\n    \n    Client-\u003e\u003eTC: Send data\n    EL-\u003e\u003eTC: OnRead()\n    TC-\u003e\u003eTC: Read from socket\n    TC-\u003e\u003eCB: Invoke message_cb_\n    \n    Note over TC: Application processes data\n    \n    CB-\u003e\u003eTC: Send(response)\n    TC-\u003e\u003eTC: SendInLoop(data)\n    TC-\u003e\u003eTC: Write to socket or queue\n    EL-\u003e\u003eTC: OnWrite()\n    TC-\u003e\u003eTC: Write remaining data\n    TC-\u003e\u003eCB: Invoke write_complete_cb_\n```\n\nThe `TcpConnection` uses the event loop's thread safety mechanisms to ensure that operations like sending data and closing the connection are executed in the event loop thread:\n\n```cpp\nvoid TcpConnection::Send(const char *buf, size_t size) {\n  loop_-\u003eRunInLoop([this, buf, size](){\n    SendInLoop(buf, size);\n  });\n}\n\nvoid TcpConnection::ForceClose() {\n  loop_-\u003eRunInLoop([this](){\n    OnClose();\n  });\n}\n```\n\nSources: [src/network/net/TcpConnection.cc:166-263]()\n\n## Timeout Management\n\nThe `TcpConnection` class provides idle connection timeout management:\n\n1. `EnableCheckIdleTimeout()`: Starts monitoring for connection inactivity\n2. `ExtendLife()`: Called on connection activity to reset the timeout\n3. `OnTimeout()`: Called when a connection times out\n\nThis mechanism allows the server to automatically clean up idle connections, freeing resources for active connections.\n\n```mermaid\nflowchart TD\n    A[\"Connection established\"] --\u003e B[\"EnableCheckIdleTimeout()\"]\n    B --\u003e C[\"Add TimeoutEntry to TimerWheel\"]\n    D[\"Activity on connection\"] --\u003e E[\"ExtendLife()\"]\n    E --\u003e F[\"Reset timeout in TimerWheel\"]\n    G[\"No activity for max_idle_time_\"] --\u003e H[\"OnTimeout()\"]\n    H --\u003e I[\"Close connection\"]\n```\n\nSources: [src/network/net/TcpConnection.cc:244-281]()\n\n## Summary\n\nThe Event Loop System provides a robust, efficient foundation for the StreamMediaServer's networking capabilities. By using Linux's epoll mechanism, thread-local storage, and careful thread synchronization, it enables high-performance, non-blocking I/O operations essential for a media streaming server.\n\nThe event-driven design minimizes resource usage while maximizing throughput, allowing the server to handle many concurrent connections with minimal overhead."])</script><script>self.__next_f.push([1,"1d:T2f94,"])</script><script>self.__next_f.push([1,"# TCP Server and Client\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/mmedia/http/HttpClient.cc](src/mmedia/http/HttpClient.cc)\n- [src/mmedia/http/HttpClient.h](src/mmedia/http/HttpClient.h)\n- [src/mmedia/http/HttpUtils.h](src/mmedia/http/HttpUtils.h)\n- [src/mmedia/tests/HttpClientTest.cpp](src/mmedia/tests/HttpClientTest.cpp)\n- [src/network/DnsService.cc](src/network/DnsService.cc)\n- [src/network/DnsService.h](src/network/DnsService.h)\n- [src/network/TcpClient.cc](src/network/TcpClient.cc)\n- [src/network/net/Connection.h](src/network/net/Connection.h)\n- [src/network/net/tests/CMakeLists.txt](src/network/net/tests/CMakeLists.txt)\n- [src/network/net/tests/DnsServiceTest.cpp](src/network/net/tests/DnsServiceTest.cpp)\n- [src/network/net/tests/TcpClientTest.cpp](src/network/net/tests/TcpClientTest.cpp)\n- [src/network/net/tests/TcpServerTest.cpp](src/network/net/tests/TcpServerTest.cpp)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document details the TCP server and client implementation in the StreamMediaServer codebase. The TCP layer provides the network communication foundation for all protocol-specific handlers in the system, including RTMP and HTTP streaming services. It handles connection establishment, data transmission, and connection lifecycle management.\n\nFor information about the event-driven architecture that powers the TCP communication, see [Event Loop System](#2.1). For DNS resolution used by the network layer, see [DNS Service](#2.3).\n\n## Architecture Overview\n\nThe TCP Server and Client components are part of the network layer that provides reliable connection-oriented communication services to higher-level protocol implementations. This layer abstracts socket operations, event handling, and connection management into a unified interface.\n\n```mermaid\nclassDiagram\n    class EventLoop {\n        +Loop()\n        +Quit()\n        +RunInLoop(func)\n        +RunAfter(delay, func)\n    }\n    \n    class TcpServer {\n        -event_loop_: EventLoop\n        -acceptor_: Acceptor\n        -connections_: Map~string, TcpConnection~\n        +Start()\n        +SetMessageCallback()\n        +SetNewConnectionCallback()\n    }\n    \n    class TcpConnection {\n        -loop_: EventLoop\n        -socket_: Socket\n        -state_: State\n        -message_buffer_: Buffer\n        +Send(data)\n        +ForceClose()\n        +SetContext()\n    }\n    \n    class Connection {\n        +SetContext()\n        +GetContext()\n        +SetActiveCallback()\n        +Active()\n        +Deactive()\n    }\n    \n    class TcpClient {\n        -server_addr_: InetAddress\n        -status_: Status\n        +Connect()\n        +ConnectInLoop()\n        +Send(data)\n        +SetConnectCallback()\n    }\n    \n    EventLoop --\u003e TcpServer : \"provides\"\n    TcpServer --\u003e TcpConnection : \"creates\"\n    Connection \u003c|-- TcpConnection : \"inherits\"\n    TcpConnection \u003c|-- TcpClient : \"inherits\"\n```\n\nSources: [src/network/net/Connection.h](), [src/network/TcpClient.cc]()\n\n## Data Flow\n\nThe following diagram illustrates how data flows through the TCP server and client components:\n\n```mermaid\nflowchart LR\n    subgraph \"Client Side\"\n        ClientApp[\"Application Layer\"]\n        TcpClient[\"TcpClient\"]\n        EventLoopClient[\"EventLoop\"]\n    end\n    \n    subgraph \"Server Side\"\n        TcpServer[\"TcpServer\"]\n        EventLoopServer[\"EventLoop\"]\n        ServerApp[\"Application Layer\"]\n        Acceptor[\"Acceptor\"]\n    end\n    \n    ClientApp --\u003e|\"1. Connect()/ Send()\"| TcpClient\n    TcpClient --\u003e|\"2. RunInLoop()\"| EventLoopClient\n    EventLoopClient --\u003e|\"3. Network I/O\"| Network[\"Network\"]\n    \n    Network --\u003e|\"4. Accept connection\"| Acceptor\n    Acceptor --\u003e|\"5. New connection\"| TcpServer\n    TcpServer --\u003e|\"6. Create TcpConnection\"| ServerTcpCon[\"TcpConnection\"]\n    ServerTcpCon --\u003e|\"7. Message callback\"| ServerApp\n    \n    ServerApp --\u003e|\"8. Send response\"| ServerTcpCon\n    ServerTcpCon --\u003e|\"9. Write to socket\"| EventLoopServer\n    EventLoopServer --\u003e|\"10. Network I/O\"| Network\n    \n    Network --\u003e|\"11. Read data\"| EventLoopClient\n    EventLoopClient --\u003e|\"12. OnRead()\"| TcpClient\n    TcpClient --\u003e|\"13. Message callback\"| ClientApp\n```\n\nSources: [src/network/TcpClient.cc](), [src/network/net/tests/TcpServerTest.cpp](), [src/network/net/tests/TcpClientTest.cpp]()\n\n## Connection Class\n\nThe `Connection` class serves as the base class for network connections in the system. It provides common functionality for managing connection context, addressing, and activity state.\n\n### Key Features\n\n- Context management system for protocol-specific data\n- Address management for local and peer endpoints\n- Activity tracking and callback system\n\n### Connection Context System\n\nThe context system allows different protocol handlers to attach their own data to a connection:\n\n```mermaid\nclassDiagram\n    class Connection {\n        -contexts_: unordered_map~int, ContextPtr~\n        +SetContext(type, context)\n        +GetContext~T~(type)\n        +ClearContext(type)\n        +ClearContext()\n    }\n    \n    class ContextTypes {\n        \u003c\u003cenumeration\u003e\u003e\n        kNormalContext = 0\n        kRtmpContext = 1\n        kHttpContext = 2\n        kUserContext = 3\n        kFlvContext = 4\n    }\n    \n    Connection --\u003e ContextTypes : \"uses\"\n```\n\nSources: [src/network/net/Connection.h:43-57]()\n\n## TcpConnection Class\n\nThe `TcpConnection` class represents an established TCP connection and handles data transmission and reception. It inherits from the `Connection` class and adds TCP-specific functionality.\n\n### Key Features\n\n- Event-based I/O handling\n- Buffer management for sending and receiving data\n- Connection lifecycle management\n\n## TcpServer Implementation\n\nThe `TcpServer` class manages listener sockets and accepts incoming connections. It creates `TcpConnection` objects for each new connection and provides callback mechanisms for connection and message handling.\n\n### Usage Example\n\n```cpp\n// Create server on specified address\nInetAddress listenAddr(\"10.17.1.19:34444\");\nTcpServer server(loop, listenAddr);\n\n// Set callback for new connections\nserver.SetNewConnectionCallback([](const TcpConnectionPtr\u0026 con){\n    // Setup connection context and callbacks\n    TestContextPtr context = std::make_shared\u003cTestContext\u003e(con);\n    con-\u003eSetContext(kNormalContext, context);\n});\n\n// Set callback for incoming messages\nserver.SetMessageCallback([](const TcpConnectionPtr\u0026 con, MsgBuffer \u0026buf){\n    // Process received data\n    TestContextPtr context = con-\u003eGetContext\u003cTestContext\u003e(kNormalContext);\n    context-\u003eParseMessage(buf);\n});\n\n// Start the server\nserver.Start();\n```\n\nSources: [src/network/net/tests/TcpServerTest.cpp:21-40]()\n\n## TcpClient Implementation\n\nThe `TcpClient` class inherits from `TcpConnection` and provides client-side connection functionality. It manages connection establishment and status tracking.\n\n### Connection Status Management\n\nThe `TcpClient` maintains a connection status that tracks the current state of the connection:\n\n| Status | Description |\n|--------|-------------|\n| `kTcpConStatusInit` | Initial state before connection attempt |\n| `kTcpConStatusConnecting` | Connection in progress |\n| `kTcpConStatusConnected` | Connection established |\n| `kTcpConStatusDisConnected` | Connection closed |\n\n### Connect Process\n\nThe connection process in `TcpClient` follows these steps:\n\n1. Client creates a non-blocking socket\n2. Client initiates connection to server address\n3. Client monitors socket for write readiness (connection completion)\n4. On successful connection, status is updated and connection callback is invoked\n5. Data can be sent and received after connection is established\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e \"Init\" : \"Create TcpClient\"\n    \"Init\" --\u003e \"Connecting\" : \"Connect()\"\n    \"Connecting\" --\u003e \"Connected\" : \"Connection success\"\n    \"Connecting\" --\u003e \"Disconnected\" : \"Connection error\"\n    \"Connected\" --\u003e \"Disconnected\" : \"Close()/Error\"\n    \"Disconnected\" --\u003e [*]\n```\n\nSources: [src/network/TcpClient.cc:17-51](), [src/network/TcpClient.cc:69-113]()\n\n### Usage Example\n\n```cpp\n// Create client with target server address\nInetAddress serverAddr(\"10.17.1.19:34444\");\nstd::shared_ptr\u003cTcpClient\u003e client = std::make_shared\u003cTcpClient\u003e(loop, serverAddr);\n\n// Set callback for receiving data\nclient-\u003eSetRecvMsgCallback([](const TcpConnectionPtr\u0026 con, MsgBuffer \u0026buf){\n    std::cout \u003c\u003c \"recv msg:\" \u003c\u003c buf.Peek() \u003c\u003c std::endl;\n    buf.RetrieveAll();\n});\n\n// Set callback for connection events\nclient-\u003eSetConnectCallback([](const TcpConnectionPtr\u0026 con, bool connected){\n    if(connected) {\n        // Send data after connection established\n        con-\u003eSend(http_request, strlen(http_request));\n    }\n});\n\n// Initiate connection\nclient-\u003eConnect();\n```\n\nSources: [src/network/net/tests/TcpClientTest.cpp:24-54]()\n\n## Integration with Higher-Level Protocols\n\nThe TCP Server and Client components serve as building blocks for higher-level protocol implementations like HTTP and RTMP. The following diagram illustrates this integration:\n\n```mermaid\nflowchart TD\n    subgraph \"Network Layer\"\n        TcpServer[\"TcpServer\"]\n        TcpClient[\"TcpClient\"]\n        TcpConnection[\"TcpConnection\"]\n    end\n    \n    subgraph \"Protocol Layer\"\n        HttpClient[\"HttpClient\"]\n        RtmpServer[\"RtmpServer\"]\n        HttpServer[\"HttpServer\"]\n    end\n    \n    subgraph \"Application Layer\"\n        LiveService[\"LiveService\"]\n        Stream[\"Stream Management\"]\n    end\n    \n    HttpClient --\u003e|\"uses\"| TcpClient\n    RtmpServer --\u003e|\"uses\"| TcpServer\n    HttpServer --\u003e|\"uses\"| TcpServer\n    \n    TcpServer --\u003e|\"creates\"| TcpConnection\n    TcpClient --\u003e|\"inherits from\"| TcpConnection\n    \n    RtmpServer --\u003e|\"handles RTMP\"| LiveService\n    HttpServer --\u003e|\"handles HTTP\"| LiveService\n    LiveService --\u003e|\"manages\"| Stream\n```\n\nSources: [src/mmedia/http/HttpClient.cc:174-179](), [src/mmedia/http/HttpClient.h:14-44]()\n\n### HTTP Client Implementation Example\n\nThe HTTP client implementation demonstrates how the TCP client is utilized for higher-level protocols:\n\n```cpp\n// HTTP client creates a TCP client to the resolved address\ntcp_client_ = std::make_shared\u003cTcpClient\u003e(loop_, addr_);\n\n// Set callbacks for TCP events\ntcp_client_-\u003eSetWriteCompleteCallback(std::bind(\u0026HttpClient::OnWriteComplete, this, std::placeholders::_1));\ntcp_client_-\u003eSetRecvMsgCallback(std::bind(\u0026HttpClient::OnMessage, this, std::placeholders::_1, std::placeholders::_2));\ntcp_client_-\u003eSetCloseCallback(close_cb_);\ntcp_client_-\u003eSetConnectCallback(std::bind(\u0026HttpClient::OnConnection, this, std::placeholders::_1, std::placeholders::_2));\n\n// Connect to the server\ntcp_client_-\u003eConnect();\n```\n\nSources: [src/mmedia/http/HttpClient.cc:150-179]()\n\n## DNS Integration\n\nThe TCP Client integrates with the DNS service for hostname resolution before establishing connections. The TCP Server typically binds to a specific IP address and port without requiring DNS resolution.\n\nThe HTTP client example shows this integration:\n\n```cpp\n// Get domain IP from DNS service\nauto list = sDnsService-\u003eGetHostAddress(addr_.IP());\nif(list.size() \u003e 0) {\n    for(auto const \u0026l : list) {\n        if(!l-\u003eIsIpV6()) {\n            addr_.SetAddr(l-\u003eIP());\n            break;\n        }\n    }\n} else {\n    // Resolve domain if not in cache\n    sDnsService-\u003eAddHost(addr_.IP());\n    std::vector\u003cInetAddressPtr\u003e list2;\n    sDnsService-\u003eGetHostInfo(addr_.IP(), list2);\n    // Use resolved IP\n}\n```\n\nSources: [src/mmedia/http/HttpClient.cc:113-143](), [src/network/DnsService.h:14-42]()\n\n## Summary\n\nThe TCP Server and Client implementation forms the foundation of the network communication layer in the StreamMediaServer. It provides a flexible, event-driven approach to handle TCP connections with the following key features:\n\n1. Event-driven I/O model for efficient network operations\n2. Context system for protocol-specific data handling\n3. Callback mechanism for connection and message events\n4. Integration with DNS for hostname resolution\n5. Support for non-blocking operations through EventLoop\n\nThese components enable higher-level protocol implementations like RTMP, HTTP, and FLV to efficiently handle media streaming over the network."])</script><script>self.__next_f.push([1,"1e:T1cf6,"])</script><script>self.__next_f.push([1,"# DNS Service\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/mmedia/http/HttpClient.cc](src/mmedia/http/HttpClient.cc)\n- [src/mmedia/http/HttpClient.h](src/mmedia/http/HttpClient.h)\n- [src/mmedia/http/HttpUtils.h](src/mmedia/http/HttpUtils.h)\n- [src/mmedia/tests/HttpClientTest.cpp](src/mmedia/tests/HttpClientTest.cpp)\n- [src/network/DnsService.h](src/network/DnsService.h)\n- [src/network/TcpClient.cc](src/network/TcpClient.cc)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Overview\n\nThis page documents the DNS Service component of StreamMediaServer that provides domain name resolution functionality for the network layer. The DNS Service is responsible for resolving domain names to IP addresses, maintaining a cache of resolved addresses, and supporting both synchronous and asynchronous resolution methods. It is primarily used by components like the HTTP client when establishing outbound connections.\n\nSources: [src/network/DnsService.h:1-45]()\n\n## Architecture\n\nThe DNS Service is implemented as a singleton that maintains a thread-safe cache of hostname-to-IP address mappings. It runs in a dedicated background thread to perform DNS resolutions without blocking the application's main execution path.\n\n### Component Structure\n\n```mermaid\nclassDiagram\n    class \"DnsService\" {\n        -thread_: std::thread\n        -running_: bool\n        -lock_: std::mutex\n        -interval_: int32_t\n        -sleep_: int32_t\n        -retry_: int32_t\n        -hosts_info_: unordered_map\n        -loop_: EventLoop*\n        +AddHost(host: string)\n        +GetHostAddress(host: string, index: int): InetAddressPtr\n        +GetHostAddress(host: string): vector\u003cInetAddressPtr\u003e\n        +UpdateHost(host: string, list: vector\u003cInetAddressPtr\u003e)\n        +GetHosts(): unordered_map\n        +SetDnsServiceParam(interval, sleep, retry)\n        +Start()\n        +Stop()\n        +OnWork()\n        +GetHostInfo(host, list): static\n    }\n    \n    class \"InetAddress\" {\n        -ip_: string\n        -port_: uint16_t\n        -ipv6_: bool\n        +IP(): string\n        +Port(): uint16_t\n        +IsIpV6(): bool\n        +SetAddr(ip: string)\n        +SetPort(port: uint16_t)\n        +ToIpPort(): string\n    }\n    \n    class \"Singleton\" {\n        +Instance(): T\u0026\n    }\n    \n    \"Singleton\" --\u003e \"DnsService\" : creates\n    \"DnsService\" --\u003e \"InetAddress\" : resolves to\n```\n\nSources: [src/network/DnsService.h:14-42]()\n\n## Core Features\n\n### Host Management Functions\n\nThe DNS Service provides several methods for managing hostname resolutions:\n\n| Method | Description |\n|--------|-------------|\n| `AddHost` | Adds a hostname to be resolved |\n| `GetHostAddress` | Retrieves resolved IP addresses for a hostname |\n| `UpdateHost` | Updates the IP addresses associated with a hostname |\n| `GetHosts` | Returns all hostname to IP address mappings |\n| `GetHostInfo` | Static method for synchronous DNS resolution |\n\nSources: [src/network/DnsService.h:20-31]()\n\n### Configuration Parameters\n\nThe DNS Service can be configured using the following parameters:\n\n| Parameter | Default Value | Description |\n|-----------|---------------|-------------|\n| `interval_` | 180000 ms (3 minutes) | Time between periodic DNS resolution cycles |\n| `sleep_` | 200 ms | Sleep time between resolution attempts |\n| `retry_` | 3 | Number of retry attempts for resolution |\n\nThese parameters can be adjusted using the `SetDnsServiceParam` method.\n\nSources: [src/network/DnsService.h:27-38]()\n\n### Resolution Process\n\nThe DNS resolution process in the StreamMediaServer follows this pattern:\n\n```mermaid\nsequenceDiagram\n    participant \"Client\" as C\n    participant \"DnsService\" as DNS\n    participant \"System DNS\" as SYS\n    \n    C-\u003e\u003eDNS: \"GetHostAddress(domain)\"\n    alt \"Domain already resolved\"\n        DNS--\u003e\u003eC: \"Return cached IP addresses\"\n    else \"Domain not resolved\"\n        C-\u003e\u003eDNS: \"AddHost(domain)\"\n        Note over DNS: \"Domain added to resolution list\"\n        C-\u003e\u003eDNS: \"GetHostInfo(domain, list)\"\n        DNS-\u003e\u003eSYS: \"DNS lookup\"\n        SYS--\u003e\u003eDNS: \"IP addresses\"\n        DNS--\u003e\u003eC: \"Return IP addresses\"\n    end\n    C-\u003e\u003eC: \"Select IP (prefer IPv4)\"\n```\n\nSources: [src/network/DnsService.h:20-31](), [src/mmedia/http/HttpClient.cc:113-143]()\n\n## Usage in HTTP Client\n\nThe HTTP client component demonstrates how to use the DNS Service when establishing connections:\n\n```mermaid\nflowchart TD\n    A[\"HttpClient::ParseUrl()\"] --\u003e B[\"Extract domain from URL\"]\n    B --\u003e C[\"sDnsService-\u003eGetHostAddress(domain)\"]\n    C --\u003e|\"Domain in cache\"| D[\"Get IP addresses from cache\"]\n    C --\u003e|\"Domain not in cache\"| E[\"sDnsService-\u003eAddHost(domain)\"]\n    E --\u003e F[\"sDnsService-\u003eGetHostInfo(domain, list)\"]\n    F --\u003e G[\"Select IPv4 address if available\"]\n    D --\u003e G\n    G --\u003e H[\"Set IP address in InetAddress\"]\n    H --\u003e I[\"Create TCP connection\"]\n```\n\nThe client first attempts to retrieve a domain's IP addresses from the DNS cache. If not found, it adds the domain to the resolution list and performs an immediate lookup using `GetHostInfo()`. The client then selects an IPv4 address (if available) to establish the connection.\n\nSources: [src/mmedia/http/HttpClient.cc:113-143]()\n\n## Implementation Details\n\n### Thread Safety\n\nThe DNS Service employs a mutex (`lock_`) to ensure thread-safe access to its hostname-to-IP address map. This protection is necessary since the map can be accessed concurrently from both the background resolution thread and client threads.\n\nSources: [src/network/DnsService.h:35]()\n\n### Singleton Implementation\n\nThe DNS Service is implemented as a singleton and accessed through the `sDnsService` macro:\n\n```cpp\n#define sDnsService tmms::base::Singleton\u003ctmms::network::DnsService\u003e::Instance()\n```\n\nThis design ensures only one instance of the DNS resolver exists within the application.\n\nSources: [src/network/DnsService.h:44]()\n\n### Background Thread Operation\n\nWhen started, the DNS Service runs a background thread that periodically:\n\n1. Iterates through all registered hostnames\n2. Attempts to resolve each hostname\n3. Updates the internal cache with the results\n4. Sleeps for the configured interval before the next cycle\n\nThe `OnWork()` method is the main function executed by this background thread.\n\nSources: [src/network/DnsService.h:30-35]()\n\n## Integration with Other Components\n\nThe DNS Service interacts with several other components in the StreamMediaServer:\n\n1. **HTTP Client**: Uses the DNS Service to resolve domain names when making HTTP requests\n2. **TCP Client**: Establishes connections using the resolved IP addresses\n3. **Event Loop**: Can be used by the DNS Service for executing resolution tasks\n\nFor more information about the TCP Server and Client implementation, see [TCP Server and Client](#2.2).\nFor details about the Event Loop System, see [Event Loop System](#2.1).\n\nSources: [src/mmedia/http/HttpClient.cc:113-143](), [src/network/TcpClient.cc:1-140]()\n\n## Performance Considerations\n\n- The default resolution interval (3 minutes) balances freshness of DNS information with system resource usage\n- For high-traffic scenarios with connections to many domains, consider increasing the interval to reduce overhead\n- For applications requiring real-time DNS updates, the interval can be decreased\n- The DNS Service caches results to minimize the impact of frequent lookups for the same hostnames\n\nSources: [src/network/DnsService.h:36-38]()"])</script><script>self.__next_f.push([1,"1f:T2a22,"])</script><script>self.__next_f.push([1,"# Media Processing System\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/mmedia/CMakeLists.txt](src/mmedia/CMakeLists.txt)\n- [src/mmedia/base/AVTypes.h](src/mmedia/base/AVTypes.h)\n- [src/mmedia/base/MMediaLog.h](src/mmedia/base/MMediaLog.h)\n- [src/mmedia/base/NalBitStream.cc](src/mmedia/base/NalBitStream.cc)\n- [src/mmedia/base/NalBitStream.h](src/mmedia/base/NalBitStream.h)\n- [src/mmedia/demux/AudioDemux.cc](src/mmedia/demux/AudioDemux.cc)\n- [src/mmedia/demux/AudioDemux.h](src/mmedia/demux/AudioDemux.h)\n- [src/mmedia/demux/VideoDemux.cc](src/mmedia/demux/VideoDemux.cc)\n- [src/mmedia/demux/VideoDemux.h](src/mmedia/demux/VideoDemux.h)\n- [src/mmedia/flv/FlvContext.cc](src/mmedia/flv/FlvContext.cc)\n\n\u003c/details\u003e\n\n\n\nThe Media Processing System is responsible for handling media demuxing, codec handling, and packaging within the StreamMediaServer. This subsystem sits between the protocol handlers and the session management layer, providing essential functionality for processing and preparing media streams for delivery.\n\nThis document focuses on the core media processing capabilities of the server. For protocol-specific implementations, see [RTMP Protocol Implementation](#3.1) and [HTTP Protocol Implementation](#3.2). For stream management details, see [Stream and GOP Management](#4.4).\n\n## System Overview\n\nThe Media Processing System is designed to handle various media formats and codecs, providing a unified interface for demuxing, processing, and packaging media content. It supports both audio and video processing with focus on common streaming formats.\n\n```mermaid\nclassDiagram\n    class VideoDemux {\n        +OnDemux(data, size, outputs) int32_t\n        +HasIdr() bool\n        +HasAud() bool\n        +HasSpsPps() bool\n        -DemuxAVC() int32_t\n        -DecodeAVCNalu() int32_t\n        -DecodeAVCSeqHeader() int32_t\n    }\n    \n    class AudioDemux {\n        +OnDemux(data, size, outputs) int32_t\n        -DemuxAAC() int32_t\n        -DemuxMP3() int32_t\n        -DemuxAACSequenceHeader() int32_t\n    }\n    \n    class NalBitStream {\n        +GetBit() uint8_t\n        +GetWord(bits) uint16_t\n        +GetUE() uint32_t\n        +GetSE() int32_t\n    }\n    \n    class FlvContext {\n        +SendFlvHttpHeader(has_video, has_audio)\n        +WriteFlvHeader(has_video, has_audio)\n        +BuildFlvFrame(packet, timestamp) bool\n        +Send()\n    }\n    \n    VideoDemux --\u003e NalBitStream : uses\n    AudioDemux --\u003e NalBitStream : uses\n    FlvContext ..\u003e VideoDemux : processes output\n    FlvContext ..\u003e AudioDemux : processes output\n```\n\nSources: [src/mmedia/CMakeLists.txt](), [src/mmedia/base/MMediaLog.h]()\n\n## Supported Media Formats\n\nThe system supports various audio and video formats as defined in the AVTypes header file.\n\n### Audio Formats\n\nThe primary supported audio codecs are:\n\n| Codec ID | Name | Description |\n|----------|------|-------------|\n| 2 | MP3 | MPEG-1/2 Audio Layer III |\n| 10 | AAC | Advanced Audio Coding |\n\nAudio properties include:\n- Sample rates (5.5kHz to 48kHz)\n- Bit depths (8-bit or 16-bit)\n- Channels (mono or stereo)\n\n### Video Formats\n\nThe primary supported video codec is:\n\n| Codec ID | Name | Description |\n|----------|------|-------------|\n| 7 | AVC | Advanced Video Coding (H.264) |\n\nThe system is designed to handle various NAL unit types, including:\n- IDR frames (key frames)\n- Sequence Parameter Sets (SPS)\n- Picture Parameter Sets (PPS)\n- Access Unit Delimiters (AUD)\n\nSources: [src/mmedia/base/AVTypes.h]()\n\n## Demuxing System\n\nThe demuxing system extracts elementary streams from container formats. It consists of two main components: the Audio Demuxer and the Video Demuxer.\n\n### Audio Demuxing\n\nThe `AudioDemux` class parses and processes audio streams, extracting relevant metadata and raw audio samples.\n\n```mermaid\nflowchart TD\n    AD[\"AudioDemux::OnDemux()\"]\n    AD --\u003e SF[\"Identify Sound Format\"]\n    SF --\u003e AAC[\"sound_format_ == AAC?\"]\n    SF --\u003e MP3[\"sound_format_ == MP3?\"]\n    \n    AAC -- \"Yes\" --\u003e DAAC[\"DemuxAAC()\"]\n    MP3 -- \"Yes\" --\u003e DMP3[\"DemuxMP3()\"]\n    \n    DAAC --\u003e PT[\"Check AAC Packet Type\"]\n    PT --\u003e SH[\"Sequence Header?\"]\n    PT --\u003e RAW[\"Raw AAC?\"]\n    \n    SH -- \"Yes\" --\u003e DSH[\"DemuxAACSequenceHeader()\"]\n    DSH --\u003e PSC[\"Parse AAC Config\"]\n    \n    RAW -- \"Yes\" --\u003e EXRAW[\"Extract Raw AAC Data\"]\n    \n    DMP3 --\u003e EMP3[\"Extract MP3 Data\"]\n```\n\nThe audio demuxing process involves:\n\n1. Identifying the audio format from the packet header\n2. For AAC:\n   - Processing sequence headers to extract codec configuration\n   - Extracting raw AAC frames\n3. For MP3:\n   - Directly extracting MP3 frames\n\nSources: [src/mmedia/demux/AudioDemux.h](), [src/mmedia/demux/AudioDemux.cc]()\n\n### Video Demuxing\n\nThe `VideoDemux` class handles video stream processing, focusing on AVC/H.264 content.\n\n```mermaid\nflowchart TD\n    VD[\"VideoDemux::OnDemux()\"]\n    VD --\u003e ID[\"Identify Codec ID\"]\n    ID --\u003e AVC[\"codec_id_ == AVC?\"]\n    \n    AVC -- \"Yes\" --\u003e DAVC[\"DemuxAVC()\"]\n    DAVC --\u003e CPT[\"Check AVC Packet Type\"]\n    \n    CPT --\u003e SH[\"Sequence Header (0)\"]\n    CPT --\u003e NALU[\"NALU Data (1)\"]\n    \n    SH --\u003e DSH[\"DecodeAVCSeqHeader()\"]\n    DSH --\u003e PSH[\"Parse SPS/PPS\"]\n    \n    NALU --\u003e DN[\"DecodeAVCNalu()\"]\n    DN --\u003e PF[\"Detect Payload Format\"]\n    \n    PF --\u003e AVCC[\"DecodeAVCNaluAvcc()\"]\n    PF --\u003e ANNEXB[\"DecodeAVCNaluAnnexb()\"]\n```\n\nThe video demuxing process handles:\n\n1. Identifying the video codec (currently only AVC/H.264 is fully supported)\n2. Processing AVC sequence headers to extract codec parameters\n3. Handling NAL units in both AVCC (length-prefixed) and Annex B (start code prefixed) formats\n4. Detecting key frames (IDR) and other special frames\n\nSources: [src/mmedia/demux/VideoDemux.h](), [src/mmedia/demux/VideoDemux.cc]()\n\n### Bitstream Processing\n\nThe `NalBitStream` class provides low-level bit manipulation utilities for parsing codec-specific data structures:\n\n```mermaid\nclassDiagram\n    class NalBitStream {\n        -data_: const char*\n        -len_: int\n        -bits_count_: int\n        -byte_idx_: int\n        -byte_: char\n        +GetBit() uint8_t\n        +GetWord(bits) uint16_t\n        +GetBitLong(bits) uint32_t\n        +GetBit64(bits) uint64_t\n        +GetUE() uint32_t\n        +GetSE() int32_t\n        -GetByte() char\n    }\n```\n\nThis class provides essential functionality for:\n- Reading individual bits from a byte stream\n- Parsing multi-bit values\n- Handling Exp-Golomb coded values (common in video codecs)\n- Skipping emulation prevention bytes in NAL units\n\nSources: [src/mmedia/base/NalBitStream.h](), [src/mmedia/base/NalBitStream.cc]()\n\n## Media Packaging\n\nAfter processing, media needs to be packaged for delivery via different protocols. The FLV packaging is a key component for HTTP-based delivery.\n\n### FLV Packaging\n\nThe `FlvContext` class handles packaging media into FLV format for HTTP delivery:\n\n```mermaid\nflowchart TD\n    FC[\"FlvContext\"]\n    FC --\u003e SFHH[\"SendFlvHttpHeader()\"]\n    SFHH --\u003e WH[\"WriteFlvHeader()\"]\n    SFHH --\u003e S[\"Send()\"]\n    \n    FC --\u003e BFF[\"BuildFlvFrame()\"]\n    BFF --\u003e WPS[\"Write Previous Size\"]\n    BFF --\u003e WPT[\"Write Packet Type\"]\n    BFF --\u003e WTS[\"Write Timestamp\"]\n    BFF --\u003e WPD[\"Write Packet Data\"]\n    \n    FC --\u003e WC[\"WriteComplete()\"]\n    WC --\u003e RST[\"Reset Buffer State\"]\n    WC --\u003e CB[\"Call Handler::OnActive()\"]\n```\n\nThe FLV packaging process involves:\n1. Generating HTTP headers with appropriate MIME types\n2. Creating a valid FLV file header based on stream properties\n3. Converting individual media packets into FLV tags\n4. Managing tag sizes, timestamps, and sequencing\n5. Sending the packaged data over HTTP connections\n\nSources: [src/mmedia/flv/FlvContext.cc]()\n\n## Media Data Flow\n\nThe following diagram illustrates how media data flows through the system from input to output:\n\n```mermaid\nflowchart LR\n    subgraph \"Input Sources\"\n        RTMP[\"RTMP Publisher\"]\n    end\n    \n    subgraph \"Protocol Layer\"\n        RTMPP[\"RTMP Protocol Handler\"]\n    end\n    \n    subgraph \"Media Processing\"\n        DEMUX[\"Media Demuxers\"]\n        CODEC[\"Codec Headers\"]\n        BUFFER[\"Packet Buffer\"]\n    end\n    \n    subgraph \"Packaging\"\n        RTMPKG[\"RTMP Packaging\"]\n        FLVPKG[\"FLV Packaging\"]\n    end\n    \n    subgraph \"Output\"\n        RTMPOUT[\"RTMP Players\"]\n        FLVOUT[\"HTTP/FLV Players\"]\n    end\n    \n    RTMP --\u003e RTMPP\n    RTMPP --\u003e DEMUX\n    DEMUX --\u003e CODEC\n    DEMUX --\u003e BUFFER\n    BUFFER --\u003e RTMPKG\n    BUFFER --\u003e FLVPKG\n    RTMPKG --\u003e RTMPOUT\n    FLVPKG --\u003e FLVOUT\n```\n\nThis data flow illustrates how:\n1. Media data enters the system through protocol handlers\n2. Demuxers process and extract media frames\n3. Codec information and media frames are stored\n4. Different packaging components prepare media for delivery\n5. Media is delivered to players through appropriate protocols\n\nSources: [src/mmedia/demux/VideoDemux.cc](), [src/mmedia/demux/AudioDemux.cc](), [src/mmedia/flv/FlvContext.cc]()\n\n## Integration with the Streaming System\n\nThe Media Processing System integrates with other components of the StreamMediaServer architecture:\n\n```mermaid\nflowchart TD\n    subgraph \"Protocol Layer\"\n        RTMP[\"RTMP Service\"]\n        HTTP[\"HTTP Service\"]\n    end\n    \n    subgraph \"Session Management\"\n        LS[\"LiveService\"]\n        SESSION[\"Session\"]\n        STREAM[\"Stream\"]\n    end\n    \n    subgraph \"Media Processing\"\n        DEMUX[\"Media Demuxers\"]\n        GOP[\"GOP Management\"]\n        CODEC[\"Codec Headers\"]\n    end\n    \n    RTMP --\u003e LS\n    HTTP --\u003e LS\n    LS --\u003e SESSION\n    SESSION --\u003e STREAM\n    STREAM --\u003e DEMUX\n    STREAM --\u003e GOP\n    STREAM --\u003e CODEC\n```\n\nThe Media Processing System:\n1. Receives raw media data from protocol handlers\n2. Processes this data through appropriate demuxers\n3. Extracts and stores codec information\n4. Organizes media into logical groups (GOPs)\n5. Provides processed media to the session management system\n6. Prepares media for delivery to clients\n\nThis integrated approach ensures efficient media processing while maintaining separation between protocol handling, media processing, and session management.\n\nSources: [src/mmedia/CMakeLists.txt]()\n\n## Key Components Summary\n\n| Component | Purpose | Key Functions |\n|-----------|---------|--------------|\n| VideoDemux | Processes video streams | `OnDemux()`, `DecodeAVCNalu()`, `DecodeAVCSeqHeader()` |\n| AudioDemux | Processes audio streams | `OnDemux()`, `DemuxAAC()`, `DemuxMP3()` |\n| NalBitStream | Parses bitstream data | `GetBit()`, `GetWord()`, `GetUE()`, `GetSE()` |\n| FlvContext | Creates FLV packages | `SendFlvHttpHeader()`, `BuildFlvFrame()`, `Send()` |\n\nThe Media Processing System provides the core functionality for handling media data in the StreamMediaServer, enabling efficient processing and delivery of audio and video streams."])</script><script>self.__next_f.push([1,"20:T31b4,"])</script><script>self.__next_f.push([1,"# RTMP Protocol Implementation\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/live/RtmpPlayerUser.cc](src/live/RtmpPlayerUser.cc)\n- [src/live/RtmpPlayerUser.h](src/live/RtmpPlayerUser.h)\n- [src/mmedia/rtmp/RtmpContext.cc](src/mmedia/rtmp/RtmpContext.cc)\n- [src/mmedia/rtmp/RtmpContext.h](src/mmedia/rtmp/RtmpContext.h)\n- [src/mmedia/rtmp/RtmpHandShake.cc](src/mmedia/rtmp/RtmpHandShake.cc)\n- [src/mmedia/rtmp/RtmpHandler.h](src/mmedia/rtmp/RtmpHandler.h)\n- [src/mmedia/rtmp/RtmpServer.cc](src/mmedia/rtmp/RtmpServer.cc)\n\n\u003c/details\u003e\n\n\n\nThis document details the Real-Time Messaging Protocol (RTMP) implementation in the StreamMediaServer codebase. It covers the protocol's architecture, handshake process, message handling, and media delivery mechanisms. For HTTP-based media delivery, see [HTTP Protocol Implementation](#3.2).\n\n## 1. RTMP Protocol Overview\n\nThe RTMP implementation provides a complete solution for streaming media using the RTMP protocol, supporting both publishing (ingest) and playback functions. The implementation follows Adobe's RTMP specification with support for both simple and complex (encrypted) handshakes.\n\n```mermaid\nflowchart TD\n    subgraph \"Client Applications\"\n        Publisher[\"Publisher (RTMP Ingest)\"]\n        Player[\"Player (RTMP Playback)\"]\n    end\n    \n    subgraph \"RTMP Protocol Layer\"\n        RtmpServer[\"RtmpServer\"]\n        RtmpContext[\"RtmpContext\"]\n        RtmpHandshake[\"RtmpHandShake\"]\n    end\n    \n    subgraph \"Media Integration Layer\"\n        LiveService[\"LiveService\"]\n        Session[\"Session\"]\n        RtmpPlayerUser[\"RtmpPlayerUser\"]\n    end\n    \n    Publisher --\u003e|\"TCP Connection\"| RtmpServer\n    Player --\u003e|\"TCP Connection\"| RtmpServer\n    RtmpServer --\u003e|\"Creates\"| RtmpContext\n    RtmpContext ---|\"Uses\"| RtmpHandshake\n    RtmpContext --\u003e|\"OnPlay/OnPublish\"| LiveService\n    LiveService --\u003e|\"Manages\"| Session\n    Session --\u003e|\"Creates\"| RtmpPlayerUser\n    RtmpPlayerUser --\u003e|\"Sends Media\"| Player\n```\n\nSources: [src/mmedia/rtmp/RtmpContext.h:35-134](), [src/mmedia/rtmp/RtmpServer.cc:7-86](), [src/live/RtmpPlayerUser.h:10-23]()\n\n## 2. RTMP Core Components\n\nThe RTMP implementation consists of several key components working together:\n\n| Component | Description | Key Responsibilities |\n|-----------|-------------|---------------------|\n| RtmpServer | Entry point for RTMP connections | Connection management, protocol initialization |\n| RtmpContext | Core protocol implementation | Message parsing, chunk handling, command processing |\n| RtmpHandShake | Handshake implementation | RTMP handshake protocol (C0/S0, C1/S1, C2/S2) |\n| RtmpHandler | Interface for RTMP events | Callback methods for play, publish events |\n| RtmpPlayerUser | Media delivery for playback | Sends media data to RTMP clients |\n\nSources: [src/mmedia/rtmp/RtmpContext.h:35-134](), [src/mmedia/rtmp/RtmpHandShake.cc:108-401](), [src/mmedia/rtmp/RtmpHandler.h:8-16](), [src/live/RtmpPlayerUser.h:10-23]()\n\n## 3. RTMP Connection Lifecycle\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e TCP_Connect\n    TCP_Connect --\u003e Handshake\n    Handshake --\u003e RTMP_Commands\n    RTMP_Commands --\u003e Media_Streaming\n    Media_Streaming --\u003e [*]\n    \n    state Handshake {\n        [*] --\u003e kRtmpHandShake\n        kRtmpHandShake --\u003e kRtmpWaitingDone\n        kRtmpWaitingDone --\u003e kRtmpMessage\n    }\n    \n    state RTMP_Commands {\n        [*] --\u003e Connect\n        Connect --\u003e CreateStream\n        CreateStream --\u003e Play_or_Publish\n        Play_or_Publish --\u003e [*]\n    }\n    \n    state Media_Streaming {\n        [*] --\u003e Metadata\n        Metadata --\u003e CodecHeaders\n        CodecHeaders --\u003e MediaFrames\n        MediaFrames --\u003e [*]\n    }\n```\n\nSources: [src/mmedia/rtmp/RtmpContext.cc:20-54](), [src/mmedia/rtmp/RtmpContext.h:17-22]()\n\n## 4. RTMP Handshake Process\n\nThe RTMP protocol begins with a handshake process that establishes the connection between client and server. The implementation supports both simple and complex (encrypted) handshake mechanisms.\n\n```mermaid\nsequenceDiagram\n    participant Client\n    participant Server as \"RtmpHandShake\"\n    \n    Note over Client,Server: Simple or Complex Handshake\n    \n    Client-\u003e\u003eServer: C0 (version) + C1 (1536 bytes)\n    Server-\u003e\u003eClient: S0 (version) + S1 (1536 bytes)\n    Client-\u003e\u003eServer: C2 (1536 bytes)\n    Server-\u003e\u003eClient: S2 (1536 bytes)\n    \n    Note over Client,Server: Handshake Complete\n    \n    Server-\u003e\u003eServer: state_ = kRtmpMessage\n```\n\nThe handshake implementation includes:\n\n1. **Version exchange** (C0/S0) - Single byte indicating protocol version (typically 3)\n2. **Initial handshake packets** (C1/S1) - 1536 bytes with timestamp, version, and random data\n3. **Final handshake packets** (C2/S2) - 1536 bytes echoing the peer's timestamp\n\nFor complex handshakes, digest calculations are performed using HMAC-SHA256 for security verification.\n\nSources: [src/mmedia/rtmp/RtmpHandShake.cc:108-401](), [src/mmedia/rtmp/RtmpContext.cc:20-77]()\n\n## 5. RTMP Chunk Format and Processing\n\nRTMP transmits messages as chunks for efficient bandwidth utilization. The implementation handles the RTMP chunk protocol according to the specification.\n\n```mermaid\ngraph LR\n    subgraph \"Chunk Header\"\n        BasicHeader[\"Basic Header (1-3 bytes)\"]\n        MessageHeader[\"Message Header (0-11 bytes)\"]\n        ExtTimestamp[\"Extended Timestamp (0-4 bytes)\"]\n    end\n    \n    subgraph \"Chunk Data\"\n        ChunkData[\"Chunk Data (≤ chunk_size bytes)\"]\n    end\n    \n    subgraph \"Message Formats (fmt)\"\n        Fmt0[\"Format 0: Full Header\"]\n        Fmt1[\"Format 1: Same Stream, New Message\"]\n        Fmt2[\"Format 2: Same Length/Type\"]\n        Fmt3[\"Format 3: Continue\"]\n    end\n    \n    BasicHeader --\u003e MessageHeader\n    MessageHeader --\u003e ExtTimestamp\n    ExtTimestamp --\u003e ChunkData\n```\n\nThe chunk processing includes:\n\n1. **Parsing Basic Header** - Extract format type and chunk stream ID\n2. **Processing Message Header** - Based on format type (0-3)\n3. **Assembling Chunks** - Reconstruct complete messages from multiple chunks\n4. **Chunk Size Control** - Manage chunk sizes for optimal network usage\n\nSources: [src/mmedia/rtmp/RtmpContext.cc:79-261](), [src/mmedia/rtmp/RtmpContext.cc:334-644]()\n\n## 6. RTMP Message Types\n\nThe implementation supports various RTMP message types for protocol control and media transmission:\n\n| Message Type | ID | Description | Handler Method |\n|--------------|-------|-------------|---------------|\n| Set Chunk Size | 1 | Changes chunk size | HandleChunkSize() |\n| Bytes Read | 3 | Acknowledgment of bytes received | (Internal) |\n| User Control | 4 | Various event notifications | HandleUserMessage() |\n| Window ACK Size | 5 | Window size for acknowledgment | HandleAckWindowSize() |\n| AMF3 Message | 17 | AMF3-encoded commands | HandleAmfCommand() |\n| AMF Message | 20 | AMF0-encoded commands | HandleAmfCommand() |\n| Audio | 8 | Audio data | (Passed to handler) |\n| Video | 9 | Video data | (Passed to handler) |\n| AMF0 Metadata | 18 | Stream metadata | (Passed to handler) |\n| AMF3 Metadata | 15 | Stream metadata (AMF3) | (Passed to handler) |\n\nSources: [src/mmedia/rtmp/RtmpContext.cc:262-332](), [src/mmedia/rtmp/RtmpContext.h:24-33]()\n\n## 7. RTMP Command Processing\n\nThe RtmpContext handles various RTMP commands using a command map that binds command names to handler functions:\n\n```mermaid\nflowchart TD\n    AMF[\"AMF Command Message\"] --\u003e Decode[\"Decode AMF Object\"]\n    Decode --\u003e GetMethod[\"Extract Method Name\"]\n    GetMethod --\u003e CommandsMap[\"commands_ Map Lookup\"]\n    \n    CommandsMap --\u003e|\"connect\"| HandleConnect[\"HandleConnect()\"]\n    CommandsMap --\u003e|\"createStream\"| HandleCreateStream[\"HandleCreateStream()\"]\n    CommandsMap --\u003e|\"play\"| HandlePlay[\"HandlePlay()\"]\n    CommandsMap --\u003e|\"publish\"| HandlePublish[\"HandlePublish()\"]\n    CommandsMap --\u003e|\"_result\"| HandleResult[\"HandleResult()\"]\n    CommandsMap --\u003e|\"_error\"| HandleError[\"HandleError()\"]\n    \n    HandlePlay --\u003e|\"Session Name\"| LiveService[\"LiveService::OnPlay()\"]\n    HandlePublish --\u003e|\"Session Name\"| LiveService[\"LiveService::OnPublish()\"]\n```\n\nKey command implementations:\n\n1. **connect** - Establishes the RTMP connection with application name\n2. **createStream** - Creates a logical channel for media streaming\n3. **play** - Initiates media playback of a stream\n4. **publish** - Starts publishing a media stream\n\nSources: [src/mmedia/rtmp/RtmpContext.cc:904-1189](), [src/mmedia/rtmp/RtmpContext.h:126-128]()\n\n## 8. Media Delivery Implementation\n\nFor media playback, the RtmpPlayerUser component handles sending media data to RTMP clients with proper timing and format:\n\n```mermaid\nflowchart LR\n    subgraph \"Stream Management\"\n        Stream[\"Stream\"]\n        CodecHeaders[\"CodecHeaders\"]\n        GopMgr[\"GopMgr\"]\n    end\n    \n    subgraph \"Player Components\"\n        PlayerUser[\"PlayerUser\"]\n        RtmpPlayerUser[\"RtmpPlayerUser\"]\n        TimeCorrector[\"TimeCorrector\"]\n    end\n    \n    subgraph \"RTMP Protocol\"\n        RtmpContext[\"RtmpContext\"]\n        BuildChunk[\"BuildChunk()\"]\n        Send[\"Send()\"]\n    end\n    \n    Stream --\u003e|\"GetFrames()\"| RtmpPlayerUser\n    RtmpPlayerUser --\u003e|\"PushFrame()\"| TimeCorrector\n    TimeCorrector --\u003e|\"CorrectTimestamp()\"| BuildChunk\n    BuildChunk --\u003e Send\n    Send --\u003e|\"TCP Connection\"| Client[\"RTMP Client\"]\n```\n\nThe media delivery process:\n\n1. **Sequence ordering** - Send metadata, audio header, video header, then media frames\n2. **Timestamp correction** - Adjust timestamps for synchronized playback\n3. **Chunk formatting** - Convert media packets to RTMP chunks with proper headers\n4. **Buffer management** - Control buffer size for optimal streaming\n\nSources: [src/live/RtmpPlayerUser.cc:14-104](), [src/mmedia/rtmp/RtmpContext.cc:334-644]()\n\n## 9. RTMP Protocol States\n\nThe RTMP implementation manages different states throughout the connection lifecycle:\n\n| State | Description | Transition Condition |\n|-------|-------------|---------------------|\n| kRtmpHandShake | Initial handshake process | Completes when handshake succeeds |\n| kRtmpWaitingDone | Waiting for handshake completion | Transitions when writes complete |\n| kRtmpMessage | Normal message processing | Active during media streaming |\n\nThe state transitions are managed in the `Parse()` and `OnWriteComplete()` methods of RtmpContext.\n\nSources: [src/mmedia/rtmp/RtmpContext.h:17-22](), [src/mmedia/rtmp/RtmpContext.cc:20-73]()\n\n## 10. Integration with Stream Management\n\nThe RTMP implementation integrates with the streaming system through the following interfaces:\n\n```mermaid\nflowchart TD\n    RtmpContext[\"RtmpContext\"] --\u003e|\"OnPlay()\"| LiveService[\"LiveService\"]\n    RtmpContext[\"RtmpContext\"] --\u003e|\"OnPublish()\"| LiveService\n    \n    LiveService --\u003e|\"FindSession()\"| Session[\"Session\"]\n    LiveService --\u003e|\"CreateSession()\"| Session\n    \n    Session --\u003e|\"CreatePlayerUser()\"| RtmpPlayerUser[\"RtmpPlayerUser\"]\n    Session --\u003e|\"CreatePublishUser()\"| PublishUser[\"PublishUser\"]\n    \n    RtmpPlayerUser --\u003e|\"PostFrames()\"| Stream[\"Stream\"]\n    Stream --\u003e|\"GetFrames()\"| RtmpPlayerUser\n```\n\nThe connection between RTMP protocol and media management:\n\n1. RTMP commands trigger callbacks to the LiveService\n2. Sessions are created or found based on stream names\n3. Player and publisher users are created for media handling\n4. Media flows through the Stream component to/from RTMP clients\n\nSources: [src/mmedia/rtmp/RtmpHandler.h:8-16](), [src/live/RtmpPlayerUser.cc:14-104]()\n\n## 11. Error Handling and Recovery\n\nThe RTMP implementation includes several mechanisms for error handling:\n\n1. **Handshake verification** - Validates protocol integrity\n2. **Timeout management** - Handles connection issues\n3. **Command error responses** - Communicates errors to clients\n4. **Logging** - Detailed logging for troubleshooting\n\nWhen errors occur during handshake or message processing, the implementation can safely close connections and free resources.\n\nSources: [src/mmedia/rtmp/RtmpContext.cc:39-54](), [src/mmedia/rtmp/RtmpHandShake.cc:271-357]()\n\n## 12. Summary\n\nThe RTMP protocol implementation in StreamMediaServer provides a comprehensive solution for live streaming with support for both publishing and playback. It follows the RTMP specification with efficient chunk handling and integrates seamlessly with the system's session and stream management components.\n\nKey features include:\n- Complete handshake process with security features\n- Efficient chunk formatting and processing\n- Full command set support\n- Media delivery with timestamp synchronization\n- Integration with the larger streaming architecture\n\nThis implementation enables the server to communicate with a wide range of RTMP clients including streaming software, hardware encoders, and media players."])</script><script>self.__next_f.push([1,"21:T36f8,"])</script><script>self.__next_f.push([1,"# HTTP Protocol Implementation\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [bin/config/config.json](bin/config/config.json)\n- [src/live/CodecHeader.cc](src/live/CodecHeader.cc)\n- [src/live/FlvPlayerUser.cc](src/live/FlvPlayerUser.cc)\n- [src/live/FlvPlayerUser.h](src/live/FlvPlayerUser.h)\n- [src/live/LiveService.h](src/live/LiveService.h)\n- [src/live/PlayerUser.h](src/live/PlayerUser.h)\n- [src/live/Stream.h](src/live/Stream.h)\n- [src/mmedia/flv/FlvContext.h](src/mmedia/flv/FlvContext.h)\n- [src/mmedia/http/HttpContext.cc](src/mmedia/http/HttpContext.cc)\n- [src/mmedia/http/HttpContext.h](src/mmedia/http/HttpContext.h)\n- [src/mmedia/http/HttpHandler.h](src/mmedia/http/HttpHandler.h)\n- [src/mmedia/http/HttpParser.cc](src/mmedia/http/HttpParser.cc)\n- [src/mmedia/http/HttpParser.h](src/mmedia/http/HttpParser.h)\n- [src/mmedia/http/HttpRequest.h](src/mmedia/http/HttpRequest.h)\n- [src/mmedia/http/HttpTypes.h](src/mmedia/http/HttpTypes.h)\n- [src/mmedia/http/HttpUtils.cc](src/mmedia/http/HttpUtils.cc)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document details the HTTP protocol implementation in the StreamMediaServer system. It covers the HTTP parsing, request/response handling, and how HTTP is used for media delivery, particularly for HTTP/FLV streaming. This is a critical component in the system's protocol layer, enabling clients to access media streams through standard web protocols.\n\nFor information about the RTMP protocol implementation, see [RTMP Protocol Implementation](#3.1).\n\n## Architecture Overview\n\nThe HTTP implementation in StreamMediaServer consists of several key components working together to handle HTTP connections, parse HTTP messages, and deliver media content to clients. It sits in the Protocol Layer of the overall system architecture, interacting with the Session Management and Network Layer components.\n\n```mermaid\nclassDiagram\n    class HttpParser {\n        -state_: HttpParserState\n        -header_: string\n        -req_: HttpRequestPtr\n        -chunk_: PacketPtr\n        +Parse(buf): HttpParserState\n        +ParseHeaders()\n        +ParseNormalBody(buf)\n        +ParseChunk(buf)\n        +ParseStream(buf)\n    }\n    \n    class HttpContext {\n        -connection_: TcpConnectionPtr\n        -http_parser_: HttpParser\n        -post_state_: HttpContextPostState\n        -handler_: HttpHandler*\n        +Parse(buf): int32_t\n        +PostRequest(header, packet): bool\n        +PostChunk(chunk): void\n        +PostStreamChunk(packet): bool\n        +WriteComplete(conn): void\n    }\n    \n    class HttpRequest {\n        -method_: HttpMethod\n        -path_: string\n        -headers_: map\n        -body_: string\n        +AddHeader(key, value): void\n        +SetBody(body): void\n        +MakeHeaders(): string\n        +AppendToBuffer(): string\n    }\n    \n    class LiveService {\n        +OnRequest(conn, req, packet)\n        +OnSent(conn)\n        +OnSentNextChunk(conn)\n    }\n    \n    class FlvContext {\n        +SendFlvHttpHeader(has_video, has_audio)\n        +BuildFlvFrame(pkt, timestamp)\n        +Send()\n    }\n    \n    class FlvPlayerUser {\n        +PostFrames(): bool\n        +PushFlvHttpHeader()\n    }\n    \n    HttpContext --\u003e HttpParser : uses\n    HttpContext --\u003e HttpRequest : processes\n    HttpContext --\u003e LiveService : calls handlers\n    LiveService --\u003e FlvPlayerUser : creates for players\n    FlvPlayerUser --\u003e FlvContext : manages\n    FlvPlayerUser --\u003e Stream : gets frames from\n```\n\nSources: [src/mmedia/http/HttpParser.h](), [src/mmedia/http/HttpContext.h](), [src/mmedia/http/HttpRequest.h](), [src/live/LiveService.h](), [src/live/FlvPlayerUser.h](), [src/mmedia/flv/FlvContext.h]()\n\n## HTTP Message Flow\n\nThe following diagram illustrates how HTTP messages flow through the system:\n\n```mermaid\nsequenceDiagram\n    participant Client as \"HTTP Client\"\n    participant Server as \"TCP Server\"\n    participant Context as \"HttpContext\"\n    participant Parser as \"HttpParser\"\n    participant LiveService as \"LiveService\"\n    participant FlvUser as \"FlvPlayerUser\"\n    participant Stream as \"Stream\"\n    \n    Client-\u003e\u003eServer: HTTP Request\n    Server-\u003e\u003eContext: OnMessage (data buffer)\n    Context-\u003e\u003eParser: Parse(buffer)\n    Parser--\u003e\u003eContext: ParsedRequest + State\n    Context-\u003e\u003eLiveService: OnRequest(conn, req, packet)\n    \n    Note over LiveService: Process request (Find session, etc.)\n    \n    LiveService-\u003e\u003eFlvUser: Create FlvPlayerUser\n    FlvUser-\u003e\u003eContext: PushFlvHttpHeader()\n    Context--\u003e\u003eClient: HTTP Response Headers\n    \n    loop For each media frame\n        FlvUser-\u003e\u003eStream: GetFrames()\n        Stream--\u003e\u003eFlvUser: Media packets\n        FlvUser-\u003e\u003eContext: PushFrames()\n        Context--\u003e\u003eClient: Media Data\n    end\n```\n\nSources: [src/mmedia/http/HttpContext.cc](), [src/mmedia/http/HttpParser.cc](), [src/live/FlvPlayerUser.cc]()\n\n## HTTP Parser\n\nThe HTTP parser is implemented as a state machine that handles different parts of HTTP messages. It's responsible for parsing headers, body content, and handling different transfer encodings like chunked encoding.\n\n### Parser States\n\nThe main parser states are defined in `HttpParserState` enum:\n\n| State | Description |\n|-------|-------------|\n| `kExpectHeaders` | Waiting for HTTP headers |\n| `kExpectNormalBody` | Reading a body with Content-Length |\n| `kExpectStreamBody` | Reading a streaming body |\n| `kExpectChunkLen` | Reading chunked encoding length |\n| `kExpectChunkBody` | Reading chunked encoding body |\n| `kExpectHttpComplete` | HTTP message is complete |\n| `kExpectChunkComplete` | Chunk is complete |\n| `kExpectError` | Error occurred during parsing |\n\nThe parser transitions between these states as it processes HTTP messages.\n\n### Parsing Process\n\nThe main parsing function `Parse()` [src/mmedia/http/HttpParser.cc:17-141]() drives the state machine based on the current state and incoming data. It:\n\n1. Looks for headers ending with `\\r\\n\\r\\n`\n2. Extracts and processes header fields\n3. Determines the message type and how to handle the body\n4. Processes the body according to its type (normal, chunked, or streaming)\n\nHeaders are parsed in the `ParseHeaders()` method [src/mmedia/http/HttpParser.cc:193-270](), which:\n- Extracts the method/status line\n- Processes individual header fields\n- Determines content length or transfer encoding\n- Sets the next state based on message characteristics\n\nBody content is handled by specialized methods:\n- `ParseNormalBody()` [src/mmedia/http/HttpParser.cc:159-173]() for Content-Length bodies\n- `ParseChunk()` [src/mmedia/http/HttpParser.cc:175-191]() for chunked transfer encoding\n- `ParseStream()` [src/mmedia/http/HttpParser.cc:143-157]() for streaming bodies\n\nSources: [src/mmedia/http/HttpParser.cc](), [src/mmedia/http/HttpParser.h]()\n\n## HTTP Context\n\nThe HTTP context manages the lifecycle of HTTP connections and handles request/response processing.\n\n### Context States\n\nThe HTTP context has different states for sending responses, defined in `HttpContextPostState` enum:\n\n| State | Description |\n|-------|-------------|\n| `kHttpContextPostInit` | Initial state |\n| `kHttpContextPostHttp` | Sending complete HTTP message |\n| `kHttpContextPostHttpHeader` | Sending HTTP header |\n| `kHttpContextPostHttpBody` | Sending HTTP body |\n| `kHttpContextPostChunkHeader` | Sending chunked encoding header |\n| `kHttpContextPostChunkLen` | Sending chunk length |\n| `kHttpContextPostChunkBody` | Sending chunk body |\n| `kHttpContextPostHttpStreamHeader` | Sending stream header |\n| `kHttpContextPostHttpStreamChunk` | Sending stream chunk |\n\n### Request Processing\n\nThe `Parse()` method [src/mmedia/http/HttpContext.cc:15-34]() processes incoming HTTP messages:\n1. Uses `HttpParser` to parse the buffer\n2. Checks the parser state\n3. Notifies the handler when a request is complete or a chunk is received\n\n### Response Sending\n\nThe HTTP context provides multiple ways to send responses:\n- `PostRequest()` [src/mmedia/http/HttpContext.cc:36-76]() for complete HTTP messages\n- `PostChunk()` [src/mmedia/http/HttpContext.cc:92-108]() for chunked encoding\n- `PostStreamChunk()` [src/mmedia/http/HttpContext.cc:129-148]() for streaming responses\n\nThe `WriteComplete()` method [src/mmedia/http/HttpContext.cc:150-212]() manages the state machine for sending responses, transitioning to the next state and sending the next part of the message when appropriate.\n\nSources: [src/mmedia/http/HttpContext.cc](), [src/mmedia/http/HttpContext.h]()\n\n## HTTP Request and Response Model\n\nBoth HTTP requests and responses are represented by the `HttpRequest` class. This class provides a unified interface for building and processing HTTP messages.\n\n### Key Features\n\n- Header management (add, remove, retrieve)\n- Method and path handling\n- Query parameter parsing\n- Status code setting\n- Body content management\n- Support for different HTTP versions\n\n### Request Creation\n\nThe `HttpRequest` class provides methods to create different types of HTTP messages:\n- `SetMethod()` for setting the request method (GET, POST, etc.)\n- `SetPath()` for setting the request path\n- `SetQuery()` for setting query parameters\n- `SetStatusCode()` for setting response status codes\n- `SetBody()` for setting message body\n\n### Message Formatting\n\nThe `MakeHeaders()` method generates the HTTP headers, and `AppendToBuffer()` creates the complete HTTP message including headers and body.\n\nSources: [src/mmedia/http/HttpRequest.h]()\n\n## HTTP Content Types\n\nThe system supports various content types for HTTP messages, defined in the `ContentType` enum:\n\n| Content Type | Description |\n|--------------|-------------|\n| `kContentTypeTextHTML` | HTML content (text/html) |\n| `kContentTypeAppJson` | JSON content (application/json) |\n| `kContentTypeVideoXFlv` | FLV video (video/x-flv) |\n| `kContentTypeVideoMP2T` | MPEG-2 Transport Stream (video/MP2T) |\n| `kContentTypeAppMpegUrl` | HLS playlist (application/vnd.apple.mpegurl) |\n\nThe `HttpUtils` class provides utilities for working with content types, including:\n- Mapping file extensions to content types\n- Converting content types to HTTP header strings\n- Parsing content type strings\n\nSources: [src/mmedia/http/HttpTypes.h](), [src/mmedia/http/HttpUtils.cc]()\n\n## Media Delivery over HTTP\n\nThe main use of HTTP in the StreamMediaServer is for delivering media content, particularly through HTTP/FLV streaming.\n\n### HTTP/FLV Streaming\n\nHTTP/FLV streaming works by:\n1. Client connects via HTTP and requests an FLV stream\n2. Server sends an HTTP response with appropriate headers\n3. Server sends the FLV header\n4. Server continuously sends FLV tags with audio and video data\n\n```mermaid\nflowchart TB\n    Client[\"HTTP Client\"]\n    HTTP[\"HTTP Context\"]\n    Parser[\"HTTP Parser\"]\n    LiveService[\"LiveService\"]\n    Session[\"Session\"]\n    Stream[\"Stream\"]\n    FlvUser[\"FlvPlayerUser\"]\n    FlvContext[\"FlvContext\"]\n    \n    Client --\u003e|\"HTTP Request\"| HTTP\n    HTTP --\u003e|\"Parse\"| Parser\n    HTTP --\u003e|\"OnRequest\"| LiveService\n    LiveService --\u003e|\"FindSession\"| Session\n    LiveService --\u003e|\"CreatePlayerUser\"| FlvUser\n    FlvUser --\u003e|\"GetFrames\"| Stream\n    FlvUser --\u003e|\"PushFlvHttpHeader\"| FlvContext\n    FlvUser --\u003e|\"PushFrame\"| FlvContext\n    FlvContext --\u003e|\"SendFlvHttpHeader\"| HTTP\n    FlvContext --\u003e|\"BuildFlvFrame\"| HTTP\n    FlvContext --\u003e|\"Send\"| HTTP\n    HTTP --\u003e|\"HTTP Response + FLV Data\"| Client\n```\n\nSources: [src/live/FlvPlayerUser.cc](), [src/mmedia/flv/FlvContext.h]()\n\n### FlvPlayerUser Implementation\n\nThe `FlvPlayerUser` class is responsible for delivering FLV content to HTTP clients:\n\n1. `PushFlvHttpHeader()` [src/live/FlvPlayerUser.cc:112-121]() sends the initial HTTP and FLV headers\n2. `PostFrames()` [src/live/FlvPlayerUser.cc:14-70]() manages the delivery of media frames:\n   - First sends metadata and codec headers\n   - Then sends media frames in order\n3. `PushFrame()` [src/live/FlvPlayerUser.cc:76-91]() and `PushFrames()` [src/live/FlvPlayerUser.cc:93-110]() handle the actual sending of frames:\n   - Correct timestamps for streaming\n   - Build FLV frames\n   - Send data to the client\n\nSources: [src/live/FlvPlayerUser.h](), [src/live/FlvPlayerUser.cc]()\n\n### FlvContext Implementation\n\nThe `FlvContext` class handles the low-level details of FLV delivery:\n\n1. `SendFlvHttpHeader()` creates and sends the HTTP headers with content type `video/x-flv`\n2. `WriteFlvHeader()` creates and sends the FLV file header\n3. `BuildFlvFrame()` converts media packets to FLV format\n4. `Send()` transmits the data to the client\n\nSources: [src/mmedia/flv/FlvContext.h]()\n\n## Integration with Live Streaming System\n\nThe HTTP implementation integrates with the Live Streaming System through the `LiveService` class, which implements the `HttpHandler` interface.\n\n### LiveService HTTP Handling\n\nThe `LiveService` class implements these HTTP handler methods:\n- `OnRequest()` - Processes incoming HTTP requests\n- `OnSent()` - Called when an HTTP response is fully sent\n- `OnSentNextChunk()` - Called after each chunk is sent, for chunked/streaming responses\n\nWhen a client requests an HTTP/FLV stream, the LiveService:\n1. Finds the requested session\n2. Creates a `FlvPlayerUser` for the client\n3. Adds the player to the session\n4. Begins streaming media content\n\nSources: [src/live/LiveService.h]()\n\n## Configuration\n\nThe HTTP service is configured in the server configuration file:\n\n```json\n{\n  \"services\": [\n    {\n      \"addr\": \"0.0.0.0\",\n      \"port\": 8080,\n      \"protocol\": \"http\",\n      \"transport\": \"tcp\"\n    }\n  ]\n}\n```\n\nThis configures the HTTP server to listen on port 8080 on all interfaces.\n\nSources: [bin/config/config.json]()\n\n## Summary\n\nThe HTTP protocol implementation in StreamMediaServer provides:\n\n1. Complete HTTP request and response handling\n2. Support for different transfer encodings (normal, chunked, streaming)\n3. Integration with the media streaming system\n4. HTTP/FLV delivery for live streams\n\nThis implementation enables clients to access media streams using standard HTTP clients like web browsers, making the streaming content more accessible compared to specialized protocols like RTMP."])</script><script>self.__next_f.push([1,"22:T2e7d,"])</script><script>self.__next_f.push([1,"# Media Demuxing\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/mmedia/CMakeLists.txt](src/mmedia/CMakeLists.txt)\n- [src/mmedia/base/AVTypes.h](src/mmedia/base/AVTypes.h)\n- [src/mmedia/base/MMediaLog.h](src/mmedia/base/MMediaLog.h)\n- [src/mmedia/base/NalBitStream.cc](src/mmedia/base/NalBitStream.cc)\n- [src/mmedia/base/NalBitStream.h](src/mmedia/base/NalBitStream.h)\n- [src/mmedia/demux/AudioDemux.cc](src/mmedia/demux/AudioDemux.cc)\n- [src/mmedia/demux/AudioDemux.h](src/mmedia/demux/AudioDemux.h)\n- [src/mmedia/demux/VideoDemux.cc](src/mmedia/demux/VideoDemux.cc)\n- [src/mmedia/demux/VideoDemux.h](src/mmedia/demux/VideoDemux.h)\n- [src/mmedia/flv/FlvContext.cc](src/mmedia/flv/FlvContext.cc)\n\n\u003c/details\u003e\n\n\n\n## Overview\n\nThe Media Demuxing subsystem is responsible for parsing and extracting raw audio and video data from incoming media streams. This process involves separating multiplexed media content into individual elementary streams, parsing codec-specific headers, and preparing the media for further processing and delivery.\n\nThe system primarily supports demuxing of H.264/AVC video and AAC/MP3 audio formats, which are commonly used in streaming applications.\n\nSources: [src/mmedia/demux/VideoDemux.h](), [src/mmedia/demux/AudioDemux.h](), [src/mmedia/base/AVTypes.h]()\n\n## Demuxing Architecture\n\nThe demuxing subsystem consists of two primary components: the `AudioDemux` and `VideoDemux` classes, which handle the demuxing of audio and video streams respectively. These components work alongside utility classes like `NalBitStream` to process media data at the bit level.\n\n```mermaid\nclassDiagram\n    class AudioDemux {\n        -sound_format_: int32_t\n        -sound_rate_: int32_t\n        -sound_size_: int32_t\n        -sound_type_: int32_t\n        -aac_object_: AACObjectType\n        -aac_sample_rate_: int32_t\n        -aac_channel_: uint8_t\n        -aac_ok_: bool\n        +OnDemux(data, size, list): int32_t\n        -DemuxAAC(data, size, list): int32_t\n        -DemuxMP3(data, size, list): int32_t\n        -DemuxAACSequenceHeader(data, size): int32_t\n    }\n    \n    class VideoDemux {\n        -codec_id_: VideoCodecID\n        -composition_time_: int32_t\n        -nalu_unit_length_: uint8_t\n        -payload_format_: AVCPayloadFormat\n        -has_aud_: bool\n        -has_idr_: bool\n        -has_sps_pps_: bool\n        -sps_: string\n        -pps_: string\n        +OnDemux(data, size, outs): int32_t\n        +HasIdr(): bool\n        +HasAud(): bool\n        +HasSpsPps(): bool\n        -DemuxAVC(data, size, outs): int32_t\n        -FindAnnexbNalu(p, end): const char*\n        -DecodeAVCNaluAnnexb(data, size, outs): int32_t\n        -DecodeAVCNaluAvcc(data, size, outs): int32_t\n        -DecodeAVCSeqHeader(data, size, outs): int32_t\n        -DecodeAVCNalu(data, size, outs): int32_t\n        -CheckNaluType(data): void\n    }\n    \n    class NalBitStream {\n        -data_: const char*\n        -len_: int\n        -bits_count_: int\n        -byte_idx_: int\n        -byte_: char\n        +GetBit(): uint8_t\n        +GetWord(bits): uint16_t\n        +GetBitLong(bits): uint32_t\n        +GetBit64(bits): uint64_t\n        +GetUE(): uint32_t\n        +GetSE(): int32_t\n        -GetByte(): char\n    }\n    \n    class SampleBuf {\n        +addr: const char*\n        +size: size_t\n        +SampleBuf(buf, s)\n    }\n    \n    VideoDemux --\u003e SampleBuf: outputs\n    AudioDemux --\u003e SampleBuf: outputs\n    AudioDemux --\u003e NalBitStream: uses for AAC parsing\n```\n\n**Diagram: Media Demuxing Class Structure**\n\nSources: [src/mmedia/demux/AudioDemux.h](), [src/mmedia/demux/VideoDemux.h](), [src/mmedia/base/NalBitStream.h](), [src/mmedia/base/AVTypes.h]()\n\n## Media Demuxing Process\n\nThe following diagram illustrates how media data flows through the demuxing system:\n\n```mermaid\nflowchart TD\n    subgraph \"Input Media Stream\"\n        IN[\"Incoming Media Packet\"]\n    end\n    \n    subgraph \"Media Type Detection\"\n        DET[\"Determine Media Type\"]\n        IN --\u003e DET\n        DET --\u003e VTYPE[\"Video Packet\"]\n        DET --\u003e ATYPE[\"Audio Packet\"]\n    end\n    \n    subgraph \"Video Demuxing\"\n        VTYPE --\u003e VCODEC[\"Identify Video Codec\"]\n        VCODEC --\u003e AVC[\"AVC/H.264\"]\n        AVC --\u003e AVCTYPE[\"Determine AVC Packet Type\"]\n        AVCTYPE --\u003e SEQ[\"Sequence Header (0)\"]\n        AVCTYPE --\u003e NALU[\"NALU Data (1)\"]\n        SEQ --\u003e PARSE_SEQ[\"Parse SPS/PPS\"]\n        NALU --\u003e FORMAT[\"Determine Format\"]\n        FORMAT --\u003e AVCC[\"AVCC Format\"]\n        FORMAT --\u003e ANNEXB[\"Annex-B Format\"]\n        AVCC --\u003e EXTRACT_AVCC[\"Extract NALUs\\nby Length Prefix\"]\n        ANNEXB --\u003e EXTRACT_ANNEXB[\"Extract NALUs\\nby Start Code\"]\n    end\n    \n    subgraph \"Audio Demuxing\"\n        ATYPE --\u003e ACODEC[\"Identify Audio Codec\"]\n        ACODEC --\u003e AAC[\"AAC\"]\n        ACODEC --\u003e MP3[\"MP3\"]\n        AAC --\u003e AACTYPE[\"Determine AAC Packet Type\"]\n        AACTYPE --\u003e AACSEQ[\"Sequence Header (0)\"]\n        AACTYPE --\u003e AACRAW[\"Raw AAC Data (1)\"]\n        AACSEQ --\u003e PARSE_AACSEQ[\"Parse AAC Config\"]\n        AACRAW --\u003e EXTRACT_AAC[\"Extract AAC Frames\"]\n        MP3 --\u003e EXTRACT_MP3[\"Extract MP3 Frames\"]\n    end\n    \n    subgraph \"Output\"\n        PARSE_SEQ --\u003e OUT[\"SampleBuf List\"]\n        EXTRACT_AVCC --\u003e OUT\n        EXTRACT_ANNEXB --\u003e OUT\n        PARSE_AACSEQ --\u003e OUT\n        EXTRACT_AAC --\u003e OUT\n        EXTRACT_MP3 --\u003e OUT\n    end\n```\n\n**Diagram: Media Demuxing Data Flow**\n\nSources: [src/mmedia/demux/VideoDemux.cc](), [src/mmedia/demux/AudioDemux.cc]()\n\n## Audio Demuxing\n\nThe `AudioDemux` class handles the demuxing of audio streams, primarily AAC and MP3 formats. The process begins by examining the first byte of the audio packet to determine the audio format, sample rate, sample size, and channel configuration.\n\n### Supported Audio Formats\n\n| Format ID | Format Name | Description |\n|-----------|-------------|-------------|\n| 2 | MP3 | MPEG-1 Audio Layer III |\n| 10 | AAC | Advanced Audio Coding |\n\nSources: [src/mmedia/base/AVTypes.h:10-27]()\n\n### AAC Demuxing Process\n\nAAC demuxing involves two main steps:\n\n1. **Sequence Header Processing**: When an AAC sequence header packet is received (packet type 0), the demuxer extracts important configuration information including:\n   - AAC Object Type\n   - Sample Rate\n   - Channel Configuration\n\n2. **Raw Data Extraction**: For AAC raw data packets (packet type 1), the demuxer extracts the raw AAC frames, but only if a valid sequence header has been previously processed.\n\nThe `NalBitStream` utility class is used to parse the bit-level information in the AAC sequence header.\n\nSources: [src/mmedia/demux/AudioDemux.cc:34-54](), [src/mmedia/demux/AudioDemux.cc:63-78]()\n\n### MP3 Demuxing Process\n\nMP3 demuxing is simpler, as it only needs to skip the RTMP header byte to extract the raw MP3 data:\n\n```\nlist.emplace_back(SampleBuf(data + 1, size - 1));\n```\n\nSources: [src/mmedia/demux/AudioDemux.cc:56-61]()\n\n## Video Demuxing\n\nThe `VideoDemux` class is responsible for demuxing video streams, with primary support for AVC/H.264. The video demuxing process is more complex than audio demuxing due to the various container formats and NAL unit structures.\n\n### Video Demuxing Workflow\n\n1. **Codec Identification**: The demuxer first identifies the video codec from the packet header. Currently, only AVC/H.264 (codec ID 7) is supported.\n\n2. **AVC Packet Type Detection**: For AVC, the demuxer determines the packet type:\n   - Type 0: Sequence Header (contains SPS and PPS)\n   - Type 1: NALU data (contains actual video frame data)\n\n3. **Handling AVC Sequence Headers**: If the packet is a sequence header, the demuxer extracts:\n   - Configuration Version\n   - Profile Indication\n   - Profile Compatibility\n   - Level Indication\n   - NALU Length Size\n   - SPS (Sequence Parameter Set)\n   - PPS (Picture Parameter Set)\n\n4. **Handling NALU Data**: For NALU data, the demuxer supports two formats:\n   - AVCC: NALUs are prefixed with their length (1-4 bytes)\n   - Annex-B: NALUs are separated by start codes (0x000001 or 0x00000001)\n\nThe demuxer tries to automatically detect the format if not yet known, or uses the previously detected format.\n\nSources: [src/mmedia/demux/VideoDemux.cc:7-38](), [src/mmedia/demux/VideoDemux.cc:186-217]()\n\n### NALU Types\n\nNAL Unit Types are defined in the H.264 specification and are used to identify the type of data contained in each NALU. Important types include:\n\n| NALU Type ID | Type Name | Description |\n|--------------|-----------|-------------|\n| 1 | NonIDR | Non-IDR coded slice |\n| 5 | IDR | IDR (Instantaneous Decoder Refresh) coded slice |\n| 6 | SEI | Supplemental Enhancement Information |\n| 7 | SPS | Sequence Parameter Set |\n| 8 | PPS | Picture Parameter Set |\n| 9 | AccessUnitDelimiter | Access Unit Delimiter |\n\nThe VideoDemux keeps track of whether it has received IDR frames, AUD (Access Unit Delimiter), and SPS/PPS information, which is important for stream initialization and keyframe detection.\n\nSources: [src/mmedia/base/AVTypes.h:106-127](), [src/mmedia/demux/VideoDemux.cc:219-234]()\n\n## Payload Formats\n\nThe video demuxer supports two main payload formats for H.264:\n\n```mermaid\nflowchart LR\n    subgraph \"AVC/H.264 Payload Formats\"\n        AVCC[\"AVCC Format\"]\n        ANNEXB[\"Annex-B Format\"]\n    end\n    \n    subgraph \"AVCC Format Structure\"\n        AVCC --\u003e LENGTH[\"Length Prefix\\n(1-4 bytes)\"]\n        LENGTH --\u003e NAL1[\"NAL Unit\"]\n        NAL1 --\u003e LENGTH2[\"Length Prefix\"]\n        LENGTH2 --\u003e NAL2[\"NAL Unit\"]\n    end\n    \n    subgraph \"Annex-B Format Structure\"\n        ANNEXB --\u003e SC1[\"Start Code\\n(0x000001 or 0x00000001)\"]\n        SC1 --\u003e BNAL1[\"NAL Unit\"]\n        BNAL1 --\u003e SC2[\"Start Code\"]\n        SC2 --\u003e BNAL2[\"NAL Unit\"]\n    end\n```\n\n**Diagram: AVC/H.264 Payload Format Comparison**\n\nSources: [src/mmedia/demux/VideoDemux.cc:84-115](), [src/mmedia/demux/VideoDemux.cc:52-82]()\n\n## Integration with Other Components\n\nThe Media Demuxing subsystem interfaces with other components in the StreamMediaServer architecture:\n\n```mermaid\nflowchart TD\n    subgraph \"Protocol Layer\"\n        RTMP[\"RTMP Service\"]\n        HTTP[\"HTTP Service\"]\n    end\n    \n    subgraph \"Session Management\"\n        LS[\"LiveService\"]\n        SS[\"Session\"]\n        ST[\"Stream\"]\n    end\n    \n    subgraph \"Media Processing\"\n        DEMUX[\"Media Demuxer\"]\n        CODEC[\"Codec Headers\"]\n        GOP[\"GOP Management\"]\n    end\n    \n    subgraph \"Output Format\"\n        FLV[\"FLV Handler\"]\n    end\n    \n    RTMP --\u003e LS\n    HTTP --\u003e LS\n    LS --\u003e SS\n    SS --\u003e ST\n    ST --\u003e DEMUX\n    DEMUX --\u003e CODEC\n    DEMUX --\u003e GOP\n    DEMUX --\u003e FLV\n```\n\n**Diagram: Media Demuxing in System Context**\n\nSources: [src/mmedia/CMakeLists.txt](), [src/mmedia/flv/FlvContext.cc]()\n\n### Integration with FLV\n\nThe demuxed media data is often packaged into the FLV (Flash Video) format for delivery to clients. The `FlvContext` class takes the raw demuxed media and formats it according to the FLV specification:\n\n1. It creates an appropriate FLV header based on whether audio and/or video is present\n2. It structures the media data into FLV tags with appropriate headers\n3. It sends the formatted FLV data to clients over HTTP\n\nSources: [src/mmedia/flv/FlvContext.cc:47-130]()\n\n## Summary\n\nThe Media Demuxing subsystem provides critical functionality for parsing and extracting media data from incoming streams. It supports:\n\n- Audio demuxing for AAC and MP3 formats\n- Video demuxing for AVC/H.264 in both AVCC and Annex-B formats\n- Extraction of essential codec configuration information like SPS/PPS for video and AAC sequence headers\n- Preparation of raw media data for further processing and delivery\n\nThe system is designed to handle different media formats, track important frame information, and provide a clean interface to other components in the StreamMediaServer architecture.\n\nSources: [src/mmedia/demux/VideoDemux.h](), [src/mmedia/demux/AudioDemux.h](), [src/mmedia/base/AVTypes.h]()"])</script><script>self.__next_f.push([1,"23:T2946,"])</script><script>self.__next_f.push([1,"# Live Streaming System\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [bin/log/tmms.log](bin/log/tmms.log)\n- [src/live/LiveService.cc](src/live/LiveService.cc)\n- [src/live/tmp/LiveService.cc](src/live/tmp/LiveService.cc)\n- [src/live/tmp/LiveService.h](src/live/tmp/LiveService.h)\n- [src/mmedia/http/HttpRequest.cc](src/mmedia/http/HttpRequest.cc)\n- [src/mmedia/http/HttpServer.cc](src/mmedia/http/HttpServer.cc)\n- [src/mmedia/http/HttpServer.h](src/mmedia/http/HttpServer.h)\n- [src/network/net/TimingWheel.cc](src/network/net/TimingWheel.cc)\n\n\u003c/details\u003e\n\n\n\nThe Live Streaming System is the core component of StreamMediaServer that handles the management and distribution of live media streams. It coordinates the flow of media data from publishers to players across multiple streaming protocols, manages streaming sessions, and ensures efficient delivery of audio and video content.\n\nThis page provides an overview of the live streaming functionality. For details about specific components, see [LiveService](#4.1), [Session Management](#4.2), [User Management](#4.3), and [Stream and GOP Management](#4.4).\n\n## Architecture Overview\n\nThe Live Streaming System bridges the protocol layer with the media processing layer, providing session management and content distribution services.\n\n```mermaid\nflowchart TB\n    subgraph \"Protocol Layer\"\n        RTMP[\"RTMP Protocol\"]\n        HTTP[\"HTTP Protocol\"]\n        FLV[\"FLV Handler\"]\n    end\n\n    subgraph \"Live Streaming System\"\n        LS[\"LiveService\"]\n        SM[\"Session Management\"]\n        UM[\"User Management\"]\n    end\n\n    subgraph \"Media Processing\"\n        ST[\"Stream\"]\n        CH[\"Codec Headers\"]\n        GOP[\"GOP Management\"]\n    end\n\n    RTMP --\u003e LS\n    HTTP --\u003e LS\n    FLV --\u003e LS\n    \n    LS --\u003e SM\n    SM --\u003e UM\n    UM --\u003e ST\n    \n    ST --\u003e CH\n    ST --\u003e GOP\n```\n\nSources: [src/live/LiveService.cc:1-376](), [src/mmedia/http/HttpServer.cc:1-90]()\n\n## Session Management\n\nThe Live Streaming System manages streaming sessions, which represent the content distribution channel between a publisher and multiple players. Each session is uniquely identified by a name (typically in the format `domain/app/stream`).\n\n```mermaid\nclassDiagram\n    class LiveService {\n        -sessions_: map\u003cstring, SessionPtr\u003e\n        -lock_: mutex\n        +CreateSession(session_name): SessionPtr\n        +FindSession(session_name): SessionPtr\n        +CloseSession(session_name): bool\n        +OnTimer(task): void\n    }\n    \n    class Session {\n        -session_name_: string\n        -stream_: StreamPtr\n        -publisher_: UserPtr\n        -players_: set\u003cPlayerUserPtr\u003e\n        +CreatePublishUser(): UserPtr\n        +CreatePlayerUser(): UserPtr\n        +SetPublisher(user): void\n        +AddPlayer(user): void\n        +CloseUser(user): void\n        +IsTimeout(): bool\n    }\n    \n    LiveService \"1\" --\u003e \"*\" Session: manages\n```\n\nSessions are created when a publisher connects and are maintained until they timeout due to inactivity. The system supports monitoring and cleanup of stale sessions through a timing mechanism.\n\nSources: [src/live/LiveService.cc:28-85](), [src/live/LiveService.cc:87-105]()\n\n## User Management\n\nThe system distinguishes between two types of users:\n1. **Publishers**: Sources of media content that push audio and video streams to the server\n2. **Players**: Consumers of media content that pull streams from the server\n\n```mermaid\nclassDiagram\n    class User {\n        #connection_: ConnectionPtr\n        #session_: SessionPtr\n        #stream_: StreamPtr\n        #user_type_: UserType\n        +GetUserType(): UserType\n        +GetSession(): SessionPtr\n        +GetStream(): StreamPtr\n    }\n    \n    class PlayerUser {\n        #meta_: PacketPtr\n        #audio_header_: PacketPtr\n        #video_header_: PacketPtr\n        +PostFrames(): void\n    }\n    \n    class Session {\n        -publisher_: UserPtr\n        -players_: set\u003cPlayerUserPtr\u003e\n        +SetPublisher(user): void\n        +AddPlayer(user): void\n    }\n    \n    User \u003c|-- PlayerUser: inherits\n    Session \"1\" --\u003e \"0..1\" User: has publisher\n    Session \"1\" --\u003e \"*\" PlayerUser: has players\n```\n\nUser connections are managed through the network layer, and their context is maintained in TcpConnection objects. When a connection is closed, the associated user is removed from the session.\n\nSources: [src/live/LiveService.cc:107-133](), [src/live/LiveService.cc:134-157](), [src/live/LiveService.cc:158-195]()\n\n## Media Stream Flow\n\nMedia data flows from publishers to players through sessions and streams, with protocol handlers mediating the communication.\n\n```mermaid\nflowchart LR\n    subgraph \"Publisher\"\n        RTMPP[\"RTMP Publisher\"]\n    end\n    \n    subgraph \"Protocol Handlers\"\n        RS[\"RtmpServer\"]\n        HS[\"HttpServer\"]\n    end\n    \n    subgraph \"Live Streaming System\"\n        LS[\"LiveService\"]\n        S[\"Session\"]\n        STR[\"Stream\"]\n    end\n    \n    subgraph \"Players\"\n        RTMPC[\"RTMP Client\"]\n        FLVC[\"FLV Client\"]\n    end\n    \n    RTMPP --\u003e RS\n    RS --\u003e LS\n    LS --\u003e S\n    S --\u003e STR\n    \n    STR --\u003e RTMPC\n    STR --\u003e FLVC\n    \n    HS --\u003e LS\n    FLVC -.-\u003e HS\n```\n\nSources: [src/live/LiveService.cc:184-195](), [src/mmedia/http/HttpServer.cc:55-66]()\n\n## Protocol Support\n\nThe Live Streaming System supports multiple streaming protocols:\n\n1. **RTMP (Real-Time Messaging Protocol)**: Used for both publishing and playing streams\n2. **HTTP/FLV**: Allows stream playback through HTTP connections\n\n```mermaid\nflowchart TB\n    subgraph \"Client Applications\"\n        PUB[\"Publisher\\n(OBS, FFmpeg)\"]\n        RTMPCL[\"RTMP Player\"]\n        FLVCL[\"FLV Player\"]\n    end\n    \n    subgraph \"Protocol Handlers\"\n        RS[\"RtmpServer\"]\n        HS[\"HttpServer\"]\n        FC[\"FlvContext\"]\n    end\n    \n    subgraph \"Live Streaming System\"\n        LS[\"LiveService\"]\n    end\n    \n    PUB --\u003e RS\n    RTMPCL --\u003e RS\n    FLVCL --\u003e HS\n    \n    RS --\u003e LS\n    HS --\u003e LS\n    HS --\u003e FC\n    FC --\u003e LS\n```\n\nThe system handles protocol-specific operations through specialized handlers, which are integrated with the LiveService component.\n\nSources: [src/live/LiveService.cc:196-230](), [src/mmedia/http/HttpServer.cc:20-34]()\n\n## Session Lifecycle\n\nSessions in the Live Streaming System follow a defined lifecycle, from creation to destruction:\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Created: Publisher connects\n    Created --\u003e Active: Media streaming begins\n    Active --\u003e PlayerJoined: Player connects\n    PlayerJoined --\u003e PlayerLeft: Player disconnects\n    PlayerLeft --\u003e Active: Other players remain\n    Active --\u003e Inactive: Publisher disconnects\n    Inactive --\u003e [*]: Session timeout\n    \n    Active --\u003e Active: Media data flowing\n    PlayerJoined --\u003e PlayerJoined: More players connect\n```\n\nThe system manages session timeouts through a timer mechanism, periodically checking for and removing inactive sessions.\n\nSources: [src/live/LiveService.cc:87-105](), [src/network/net/TimingWheel.cc:16-43]()\n\n## Connection Handling\n\nThe Live Streaming System processes connections through event-driven callbacks:\n\n```mermaid\nsequenceDiagram\n    participant Client\n    participant Server as \"TcpServer (RTMP/HTTP)\"\n    participant LS as \"LiveService\"\n    participant Session\n    participant Stream\n    \n    Client-\u003e\u003eServer: Connect\n    Server-\u003e\u003eLS: OnNewConnection\n    Client-\u003e\u003eServer: Publish/Play Request\n    Server-\u003e\u003eLS: OnPublish/OnPlay\n    LS-\u003e\u003eSession: CreateSession\n    LS-\u003e\u003eSession: CreatePublishUser/CreatePlayerUser\n    Client-\u003e\u003eServer: Media Data\n    Server-\u003e\u003eLS: OnRecv\n    LS-\u003e\u003eStream: AddPacket\n    Stream--\u003e\u003eSession: Notify data available\n    Session--\u003e\u003eClient: Stream data to players\n```\n\nWhen a client connects, the appropriate protocol handler processes the connection and forwards requests to the LiveService, which manages the session and user creation.\n\nSources: [src/live/LiveService.cc:107-118](), [src/live/LiveService.cc:134-157](), [src/live/LiveService.cc:184-195]()\n\n## HTTP Integration\n\nThe system supports HTTP-based streaming through integration with the HTTP server and request handling:\n\n```mermaid\nflowchart TB\n    subgraph \"HTTP Components\"\n        HS[\"HttpServer\"]\n        HC[\"HttpContext\"]\n        FR[\"HttpRequest\"]\n        FC[\"FlvContext\"]\n    end\n    \n    subgraph \"Live Streaming System\"\n        LS[\"LiveService\"]\n        S[\"Session\"]\n        PU[\"PlayerUser\"]\n    end\n    \n    HS --\u003e HC\n    HC --\u003e FR\n    HC --\u003e LS: \"OnRequest\"\n    LS --\u003e S: \"CreateSession\"\n    S --\u003e PU: \"CreatePlayerUser\"\n    PU --\u003e FC: \"Set context\"\n```\n\nHTTP requests for FLV streams are parsed and processed, creating appropriate player sessions and setting up contexts for streaming.\n\nSources: [src/live/LiveService.cc:249-376](), [src/mmedia/http/HttpServer.cc:35-66](), [src/mmedia/http/HttpRequest.cc:59-85]()\n\n## Configuration and Initialization\n\nThe Live Streaming System initializes by creating server instances for supported protocols and setting up the thread pool for handling connections:\n\n```mermaid\nflowchart TB\n    subgraph \"Configuration\"\n        CM[\"ConfigMgr\"]\n        CF[\"Config\"]\n    end\n    \n    subgraph \"Network Layer\"\n        TP[\"EventLoopThreadPool\"]\n        EL[\"EventLoops\"]\n        DNS[\"DnsService\"]\n    end\n    \n    subgraph \"Server Components\"\n        RS[\"RTMP Servers\"]\n        HS[\"HTTP Servers\"]\n    end\n    \n    subgraph \"Live Streaming System\"\n        LS[\"LiveService\"]\n        TM[\"TaskMgr\"]\n    end\n    \n    LS --\u003e CM: \"Get config\"\n    CM --\u003e CF\n    CF --\u003e LS: \"Returns config\"\n    LS --\u003e TP: \"Create pool\"\n    TP --\u003e EL: \"Create loops\"\n    LS --\u003e DNS: \"Start DNS service\"\n    LS --\u003e RS: \"Create RTMP servers\"\n    LS --\u003e HS: \"Create HTTP servers\"\n    LS --\u003e TM: \"Schedule timeout task\"\n```\n\nThe startup process involves loading configuration, initializing the network layer, and creating server instances for each configured protocol and address.\n\nSources: [src/live/LiveService.cc:196-230]()\n\n## Summary\n\nThe Live Streaming System provides a flexible, protocol-agnostic framework for managing live media streaming. Key features include:\n\n- Multi-protocol support (RTMP, HTTP/FLV)\n- Session-based management with publisher/player model\n- Event-driven architecture for efficient processing\n- Timeout management for resource cleanup\n- Flexible configuration through configuration files\n\nThe system serves as the core coordinator for all streaming activities, bridging the protocol handlers with the media processing components and ensuring efficient delivery of live media content.\n\nSources: [src/live/LiveService.cc:1-376]()"])</script><script>self.__next_f.push([1,"24:T2d0a,"])</script><script>self.__next_f.push([1,"# LiveService\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [bin/config/config.json](bin/config/config.json)\n- [bin/log/tmms.log](bin/log/tmms.log)\n- [src/live/LiveService.cc](src/live/LiveService.cc)\n- [src/live/LiveService.h](src/live/LiveService.h)\n- [src/live/tmp/LiveService.cc](src/live/tmp/LiveService.cc)\n- [src/live/tmp/LiveService.h](src/live/tmp/LiveService.h)\n- [src/mmedia/http/HttpContext.cc](src/mmedia/http/HttpContext.cc)\n- [src/mmedia/http/HttpContext.h](src/mmedia/http/HttpContext.h)\n- [src/mmedia/http/HttpRequest.cc](src/mmedia/http/HttpRequest.cc)\n- [src/mmedia/http/HttpServer.cc](src/mmedia/http/HttpServer.cc)\n- [src/mmedia/http/HttpServer.h](src/mmedia/http/HttpServer.h)\n- [src/network/net/TimingWheel.cc](src/network/net/TimingWheel.cc)\n\n\u003c/details\u003e\n\n\n\nThe LiveService component is the central coordination system that manages all live streaming sessions in the StreamMediaServer. It acts as a bridge between protocol handlers (RTMP, HTTP/FLV) and the underlying session and stream management systems. This document explains its architecture, responsibilities, and core functionality.\n\nFor information about the specific session management implementation, see [Session Management](#4.2). For details on stream and GOP management, see [Stream and GOP Management](#4.4).\n\n## Overview\n\nLiveService is a singleton class that implements both RtmpHandler and HttpHandler interfaces, allowing it to process both RTMP and HTTP-based streaming protocols. Its primary responsibilities include:\n\n1. Creating and managing streaming sessions\n2. Handling protocol-specific events (play, publish)\n3. Routing media data from publishers to players\n4. Managing user connections and network I/O\n5. Monitoring session timeouts\n\nSources: [src/live/LiveService.h:22-57](), [src/live/LiveService.cc:28-248]()\n\n## Architecture\n\n### Component Relationships\n\nLiveService sits at the center of the live streaming subsystem, connecting protocol handlers with session and stream management.\n\n```mermaid\nflowchart TD\n    subgraph \"Protocol Layer\"\n        RTMPS[\"RtmpServer\"]\n        HTTPS[\"HttpServer\"]\n    end\n\n    subgraph \"LiveService\"\n        LS[\"LiveService\"]\n        SM[\"Session Manager\"]\n    end\n\n    subgraph \"Session Layer\"\n        S[\"Session\"]\n        PUB[\"Publisher User\"]\n        PLAY[\"Player Users\"]\n        STR[\"Stream\"]\n    end\n\n    subgraph \"Network Layer\"\n        TCP[\"TcpServer\"]\n        EL[\"EventLoopThreadPool\"]\n    end\n\n    RTMPS --\u003e LS\n    HTTPS --\u003e LS\n    LS --\u003e SM\n    SM --\u003e S\n    S --\u003e PUB\n    S --\u003e PLAY\n    S --\u003e STR\n    LS --\u003e TCP\n    TCP --\u003e EL\n```\n\nSources: [src/live/LiveService.h:22-57](), [src/live/LiveService.cc:197-238]()\n\n### Class Structure\n\nLiveService inherits from both RtmpHandler and HttpHandler to support multiple protocols and implements numerous methods to manage the lifecycle of streaming sessions.\n\n```mermaid\nclassDiagram\n    class RtmpHandler {\n        +OnPlay(conn, sessionName, param)\n        +OnPublish(conn, sessionName, param)\n        +OnRecv(conn, data)\n        +OnConnectionDestroy(conn)\n    }\n    \n    class HttpHandler {\n        +OnRequest(conn, req, packet)\n        +OnSent(conn)\n        +OnSentNextChunk(conn)\n        +OnActive(conn)\n    }\n    \n    class LiveService {\n        -sessions_: Map\u003cstring, SessionPtr\u003e\n        -servers_: vector\u003cTcpServer*\u003e\n        -pool_: EventLoopThreadPool*\n        -lock_: mutex\n        +CreateSession(sessionName)\n        +FindSession(sessionName)\n        +CloseSession(sessionName)\n        +Start()\n        +Stop()\n        +OnTimer(task)\n        +GetNextLoop()\n    }\n    \n    RtmpHandler \u003c|-- LiveService : implements\n    HttpHandler \u003c|-- LiveService : implements\n```\n\nSources: [src/live/LiveService.h:22-57]()\n\n## Session Management\n\nLiveService manages streaming sessions through a central registry stored in a thread-safe map. Each session is identified by a unique session name typically in the format `domain/app/stream`.\n\n### Session Lifecycle\n\n1. **Creation**: Sessions are created on demand when a publisher or player connects\n2. **Management**: LiveService maintains active sessions and routes data appropriately\n3. **Timeout**: Sessions that are inactive for a configured period are automatically closed\n4. **Closure**: Sessions are closed when the publisher disconnects and all players have left\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Created: CreateSession()\n    Created --\u003e Active: SetPublisher()\n    Active --\u003e Inactive: Publisher disconnects\n    Inactive --\u003e [*]: Timeout or CloseSession()\n    Active --\u003e [*]: CloseSession()\n```\n\nSources: [src/live/LiveService.cc:28-85](), [src/live/LiveService.cc:87-105]()\n\n### Key Session Operations\n\n#### Session Creation\n\nWhen a publisher or player connects, LiveService creates a session if it doesn't exist:\n\n```mermaid\nflowchart TD\n    START[\"CreateSession(session_name)\"] --\u003e LOCK[\"Lock mutex\"]\n    LOCK --\u003e CHECK[\"Check if session exists\"]\n    CHECK --\u003e|\"Yes\"| RETURN[\"Return existing session\"]\n    CHECK --\u003e|\"No\"| PARSE[\"Parse session name (domain/app/stream)\"]\n    PARSE --\u003e CONFIG[\"Find app configuration\"]\n    CONFIG --\u003e|\"Not found\"| ERROR[\"Return error\"]\n    CONFIG --\u003e|\"Found\"| CREATE[\"Create new Session\"]\n    CREATE --\u003e STORE[\"Store in sessions_ map\"]\n    STORE --\u003e UNLOCK[\"Unlock mutex\"]\n    UNLOCK --\u003e SUCCESS[\"Return new session\"]\n    ERROR --\u003e UNLOCK2[\"Unlock mutex\"]\n    UNLOCK2 --\u003e FAIL[\"Return null session\"]\n```\n\nSources: [src/live/LiveService.cc:28-56]()\n\n## Protocol Handling\n\nLiveService implements handlers for both RTMP and HTTP protocols, allowing it to support multiple streaming formats.\n\n### RTMP Protocol Support\n\nLiveService handles RTMP play and publish requests, creating appropriate user objects and attaching them to sessions:\n\n1. **OnPublish**: Creates a publisher user and attaches it to a session\n2. **OnPlay**: Creates a player user and attaches it to a session\n3. **OnRecv**: Processes incoming media data and routes it to the appropriate stream\n\nSources: [src/live/LiveService.cc:135-195]()\n\n### HTTP Protocol Support\n\nLiveService processes HTTP requests, particularly for HTTP-FLV streaming:\n\n1. Parses the request URL to extract session information\n2. Creates a session and player user for HTTP clients\n3. Sets up the appropriate context for FLV streaming\n\nSources: [src/live/LiveService.cc:249-376]()\n\n## Network Integration\n\nLiveService seamlessly integrates with the network layer to manage connections and process network events.\n\n### Server Setup\n\nLiveService initializes and manages TCP servers for different protocols based on configuration:\n\n```mermaid\nflowchart TD\n    START[\"Start()\"] --\u003e CONFIG[\"Load configuration\"]\n    CONFIG --\u003e THREAD[\"Create EventLoopThreadPool\"]\n    THREAD --\u003e START_POOL[\"Start thread pool\"]\n    START_POOL --\u003e DNS[\"Start DNS service\"]\n    DNS --\u003e SERVICES[\"Get service configurations\"]\n    SERVICES --\u003e LOOPS[\"Get event loops\"]\n    LOOPS --\u003e ITERATE[\"Iterate through services\"]\n    ITERATE --\u003e CHECK[\"Check protocol type\"]\n    CHECK --\u003e|\"RTMP\"| RTMP[\"Create RtmpServer\"]\n    CHECK --\u003e|\"HTTP\"| HTTP[\"Create HttpServer\"] \n    RTMP --\u003e ADD_SERVER[\"Add to servers_ vector\"]\n    HTTP --\u003e ADD_SERVER\n    ADD_SERVER --\u003e START_SERVER[\"Start server\"]\n    START_SERVER --\u003e TIMER[\"Create timeout check timer\"]\n    TIMER --\u003e END[\"End\"]\n```\n\nSources: [src/live/LiveService.cc:197-230]()\n\n### Connection Management\n\nLiveService manages the lifecycle of connections through various callbacks:\n\n1. **OnNewConnection**: Sets up a new connection\n2. **OnConnectionDestroy**: Handles user cleanup when a connection is closed\n3. **OnActive**: Processes active connections and sends data to players\n\nSources: [src/live/LiveService.cc:107-133]()\n\n## Data Flow\n\nThe flow of media data through LiveService follows a clear path from publishers to players:\n\n```mermaid\nflowchart LR\n    PUB[\"Publisher Client\"] --\u003e RTMPS[\"RtmpServer\"]\n    RTMPS --\u003e PUB_LS[\"LiveService::OnPublish\"]\n    PUB_LS --\u003e CREATE_S[\"CreateSession\"]\n    CREATE_S --\u003e SET_PUB[\"Session::SetPublisher\"]\n    \n    PUB_CLIENT[\"Publisher\"] --\u003e SEND[\"Send Media Data\"]\n    SEND --\u003e RECV[\"LiveService::OnRecv\"]\n    RECV --\u003e STREAM[\"Stream::AddPacket\"]\n    \n    PLAYER[\"Player Client\"] --\u003e PLAY_REQ[\"Play Request\"]\n    PLAY_REQ --\u003e PLAY_LS[\"LiveService::OnPlay\"]\n    PLAY_LS --\u003e FIND_S[\"FindSession\"]\n    FIND_S --\u003e ADD_PLAYER[\"Session::AddPlayer\"]\n    \n    STREAM --\u003e GOP[\"GOP Management\"]\n    STREAM --\u003e ACTIVE[\"OnActive Callback\"]\n    ACTIVE --\u003e POST_FRAMES[\"PlayerUser::PostFrames\"]\n    POST_FRAMES --\u003e PLAYER_CLIENT[\"Player Client\"]\n```\n\nSources: [src/live/LiveService.cc:135-195]()\n\n## Timeout Handling\n\nLiveService implements a periodic timer to check for and clean up timed-out sessions:\n\n```mermaid\nflowchart TD\n    START[\"OnTimer(task)\"] --\u003e LOCK[\"Lock mutex\"]\n    LOCK --\u003e ITERATE[\"Iterate through sessions\"]\n    ITERATE --\u003e CHECK[\"Check if session is timed out\"]\n    CHECK --\u003e|\"Yes\"| LOG[\"Log timeout\"]\n    LOG --\u003e CLEAR[\"Call session.Clear()\"]\n    CLEAR --\u003e REMOVE[\"Remove from sessions map\"]\n    CHECK --\u003e|\"No\"| NEXT[\"Continue to next session\"]\n    NEXT --\u003e ITERATE\n    REMOVE --\u003e ITERATE\n    ITERATE --\u003e|\"Done\"| RESTART[\"Restart timer\"]\n    RESTART --\u003e UNLOCK[\"Unlock mutex\"]\n```\n\nSources: [src/live/LiveService.cc:87-105]()\n\n## Configuration\n\nLiveService uses the global configuration system to determine:\n\n1. Number of worker threads\n2. Protocol service bindings (address, port)\n3. Session timeout values\n\nExample configuration (from `config.json`):\n\n```json\n{\n  \"threads\": 4,\n  \"services\": [\n    {\n      \"addr\": \"0.0.0.0\",\n      \"port\": 1935,\n      \"protocol\": \"rtmp\",\n      \"transport\": \"tcp\"\n    },\n    {\n      \"addr\": \"0.0.0.0\",\n      \"port\": 8080,\n      \"protocol\": \"http\",\n      \"transport\": \"tcp\"\n    }\n  ]\n}\n```\n\nSources: [bin/config/config.json:1-32]()\n\n## Error Handling\n\nLiveService implements robust error handling to maintain system stability:\n\n1. Invalid session names are rejected and logged\n2. Missing configurations result in session creation failure\n3. Connection errors are handled gracefully with proper cleanup\n4. HTTP errors return appropriate status codes (400, 404, etc.)\n\nSources: [src/live/LiveService.cc:135-195](), [src/live/LiveService.cc:249-376]()\n\n## Usage Examples\n\n### Creating an RTMP Publishing Session\n\nWhen a client connects to publish an RTMP stream:\n\n1. RtmpServer receives the connection and RTMP handshake\n2. The publish command is processed and routed to LiveService::OnPublish\n3. LiveService creates a session and publisher user\n4. Media data flows from the client to the server through LiveService::OnRecv\n5. Stream metadata and codec information are processed and stored\n\nSources: [src/live/LiveService.cc:154-182]()\n\n### Creating an HTTP-FLV Player Session\n\nWhen a client connects to play an HTTP-FLV stream:\n\n1. HttpServer receives the HTTP request\n2. LiveService::OnRequest parses the URL path to extract the session name\n3. LiveService creates or finds the session and creates a player user\n4. A FlvContext is set up to handle the FLV protocol specifics\n5. Media data is sent to the client as it becomes available\n\nSources: [src/live/LiveService.cc:249-326]()\n\n## Conclusion\n\nLiveService serves as the central coordination point in the StreamMediaServer's live streaming system. By implementing handlers for both RTMP and HTTP protocols and managing the lifecycle of streaming sessions, it enables the seamless flow of media data from publishers to players while maintaining system stability and resource efficiency."])</script><script>self.__next_f.push([1,"25:T33fa,"])</script><script>self.__next_f.push([1,"# Session Management\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [bin/log/tmms.log](bin/log/tmms.log)\n- [src/live/LiveService.cc](src/live/LiveService.cc)\n- [src/live/Session.cc](src/live/Session.cc)\n- [src/live/Stream.cc](src/live/Stream.cc)\n- [src/mmedia/http/HttpRequest.cc](src/mmedia/http/HttpRequest.cc)\n- [src/mmedia/http/HttpServer.cc](src/mmedia/http/HttpServer.cc)\n- [src/mmedia/http/HttpServer.h](src/mmedia/http/HttpServer.h)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis page documents the Session Management system within the StreamMediaServer, which is responsible for creating, tracking, and terminating live streaming sessions. A session represents a logical connection between publishers and players for a particular stream. The Session Management system handles user connection management, stream association, and session lifecycle including timeout and cleanup processes.\n\nFor information about the overall live streaming system, see [Live Streaming System](#4), and for details about user management within sessions, see [User Management](#4.3).\n\n## Session Management Overview\n\nThe Session Management system is a core component that bridges the protocol layer and the media processing layer. It maintains the relationship between publishers who provide media content and players who consume it, ensuring that media data flows correctly between them.\n\n### Key Components and Relationships\n\n```mermaid\nclassDiagram\n    class LiveService {\n        -sessions_: Map\u003cstring, Session\u003e\n        +CreateSession(sessionName): SessionPtr\n        +FindSession(sessionName): SessionPtr\n        +CloseSession(sessionName): bool\n        +OnPlay(conn, sessionName, param): bool\n        +OnPublish(conn, sessionName, param): bool\n    }\n    \n    class Session {\n        -session_name_: string\n        -stream_: StreamPtr\n        -publisher_: UserPtr\n        -players_: Set\u003cPlayerUserPtr\u003e\n        +CreatePublishUser(...): UserPtr\n        +CreatePlayerUser(...): UserPtr\n        +SetPublisher(user): void\n        +AddPlayer(user): void\n        +CloseUser(user): void\n        +IsTimeout(): bool\n    }\n    \n    class Stream {\n        -packet_buffer_: vector\u003cPacketPtr\u003e\n        -gop_mgr_: GopMgr\n        -codec_headers_: CodecHeader\n        +AddPacket(packet): void\n        +GetFrames(user): void\n        +HasMedia(): bool\n        +Timeout(): bool\n    }\n    \n    LiveService \"1\" --\u003e \"*\" Session : manages\n    Session \"1\" --\u003e \"1\" Stream : owns\n    Session \"1\" --\u003e \"0..1\" User : publisher\n    Session \"1\" --\u003e \"*\" PlayerUser : players\n```\n\nSources: [src/live/LiveService.cc:28-66](), [src/live/Session.cc:17-22](), [src/live/Stream.cc:9-14]()\n\n## Session Lifecycle\n\n### Session Creation and Naming Convention\n\nSessions are created when a client attempts to play or publish a stream. Each session is identified by a unique name following the pattern: `domain/app/streamName`. For example: `hx.com/live/test`.\n\nThe LiveService is responsible for creating sessions and manages their lifecycle. When a session is created, an associated Stream object is also created to handle the media data for that session.\n\n```mermaid\nflowchart TD\n    A[\"Client Request:\n    Play or Publish\"] --\u003e B[\"LiveService.CreateSession()\"]\n    B --\u003e C{\"Session\n    exists?\"}\n    C -- \"Yes\" --\u003e D[\"Return existing\n    Session\"]\n    C -- \"No\" --\u003e E[\"Parse session name:\n    domain/app/stream\"]\n    E --\u003e F[\"Look up AppInfo\n    in config\"]\n    F --\u003e G{\"Valid\n    config?\"}\n    G -- \"No\" --\u003e H[\"Return null\"]\n    G -- \"Yes\" --\u003e I[\"Create new Session\n    and Stream\"]\n    I --\u003e J[\"Store in sessions_ map\"]\n    J --\u003e K[\"Return new Session\"]\n```\n\nSources: [src/live/LiveService.cc:28-56](), [src/live/Session.cc:17-22]()\n\n### Session Operation Flow\n\nThe session management flow depends on whether a client is publishing to or playing from a stream:\n\n```mermaid\nsequenceDiagram\n    participant Client\n    participant LiveService\n    participant Session\n    \n    Client-\u003e\u003eLiveService: Connect (RTMP/HTTP)\n    \n    alt Play Request\n        Client-\u003e\u003eLiveService: OnPlay(conn, sessionName, param)\n        LiveService-\u003e\u003eLiveService: CreateSession(sessionName)\n        LiveService-\u003e\u003eSession: CreatePlayerUser()\n        Session-\u003e\u003eSession: AddPlayer()\n        LiveService-\u003e\u003eClient: Set context and return\n    else Publish Request\n        Client-\u003e\u003eLiveService: OnPublish(conn, sessionName, param)\n        LiveService-\u003e\u003eLiveService: CreateSession(sessionName)\n        LiveService-\u003e\u003eSession: CreatePublishUser()\n        Session-\u003e\u003eSession: SetPublisher()\n        LiveService-\u003e\u003eClient: Set context and return\n    end\n    \n    alt Media Data (for Publisher)\n        Client-\u003e\u003eLiveService: OnRecv(conn, data)\n        LiveService-\u003e\u003eSession: GetStream()-\u003eAddPacket()\n        Session-\u003e\u003eSession: ActiveAllPlayers()\n    end\n```\n\nSources: [src/live/LiveService.cc:135-195](), [src/live/Session.cc:46-111](), [src/live/Stream.cc:60-115]()\n\n### Session Termination and Cleanup\n\nSessions are terminated and cleaned up in three main scenarios:\n\n1. When manually closed using `CloseSession()`\n2. When a timeout occurs (checked periodically)\n3. When the system shuts down\n\nThe session timeout mechanism is implemented by the `OnTimer` method in LiveService, which periodically checks all sessions for timeout conditions:\n\n```mermaid\nflowchart TD\n    A[\"LiveService.OnTimer()\"] --\u003e B[\"Lock sessions list\"]\n    B --\u003e C[\"For each session\"]\n    C --\u003e D{\"Session.IsTimeout()?\"}\n    D -- \"Yes\" --\u003e E[\"Log timeout\"]\n    E --\u003e F[\"Session.Clear()\"]\n    F --\u003e G[\"Remove from sessions_\"]\n    D -- \"No\" --\u003e H[\"Continue to next session\"]\n    G --\u003e C\n    H --\u003e C\n    C -- \"All sessions checked\" --\u003e I[\"Schedule next timer\"]\n```\n\nA session is considered timed out if:\n- Its stream has been inactive for a certain period (default 20 seconds)\n- There are no players and the session has been idle longer than the configured `stream_idle_time`\n\nSources: [src/live/LiveService.cc:87-105](), [src/live/Session.cc:32-44](), [src/live/Stream.cc:24-32]()\n\n## Publisher and Player Management\n\nEach Session manages one publisher and multiple players, maintaining the relationships between these entities.\n\n### User Types\n\nThe system distinguishes between different types of users:\n\n| User Type | Description | Connection Method |\n|-----------|-------------|------------------|\n| Publisher | Provides media content to the stream | RTMP |\n| RTMP Player | Consumes media via RTMP protocol | RTMP |\n| FLV Player | Consumes media via HTTP/FLV protocol | HTTP |\n\n### Adding Publishers and Players\n\n```mermaid\nflowchart TB\n    subgraph \"Session Management\"\n        direction LR\n        subgraph \"Session\" \n            P[\"Publisher\n            (max 1 per session)\"]\n            S[\"Stream\"]\n            PL[\"Players\n            (multiple allowed)\"]\n        end\n    end\n    \n    subgraph \"Connection Sources\"\n        direction TB\n        RP[\"RTMP Publisher\"] --\u003e P\n        RPLR[\"RTMP Player\"] --\u003e PL\n        FPLR[\"HTTP/FLV Player\"] --\u003e PL\n    end\n    \n    P -- \"Sends media data\" --\u003e S\n    S -- \"Delivers frames\" --\u003e PL\n```\n\nWhen a new publisher or player connects:\n\n1. The appropriate protocol handler (RTMP or HTTP) processes the connection\n2. LiveService creates or locates the relevant session\n3. The session creates the appropriate user object (publisher or player)\n4. The connection is associated with the user via the context system\n5. The user is added to the session\n\nSources: [src/live/LiveService.cc:135-182](), [src/live/Session.cc:46-180]()\n\n## Connection Handling and User Contexts\n\nThe session management system uses a context-based approach to associate connections with user objects:\n\n```mermaid\nflowchart LR\n    subgraph \"Connection\"\n        C[\"TcpConnection\"]\n        CTX[\"Context Map\"]\n    end\n    \n    subgraph \"User Objects\"\n        U[\"User\"]\n        PU[\"PlayerUser\"]\n        FPU[\"FlvPlayerUser\"]\n        RPU[\"RtmpPlayerUser\"]\n    end\n    \n    C -- \"SetContext(kUserContext, user)\" --\u003e CTX\n    CTX -- \"GetContext\u003cUser\u003e(kUserContext)\" --\u003e U\n    U \u003c|-- PU\n    PU \u003c|-- FPU\n    PU \u003c|-- RPU\n    \n    U -- \"Has reference to\" --\u003e S[\"Session\"]\n    U -- \"Has reference to\" --\u003e ST[\"Stream\"]\n```\n\nWhen a connection is closed or an error occurs, the `OnConnectionDestroy` method in LiveService retrieves the user object from the connection context and removes it from the session:\n\n```\nconnection → GetContext(kUserContext) → user → GetSession() → CloseUser(user)\n```\n\nSources: [src/live/LiveService.cc:111-118](), [src/live/Session.cc:112-144]()\n\n## Session and Stream Interaction\n\nEach session is associated with a single Stream object that manages the media data for that session:\n\n### Media Data Flow\n\n```mermaid\nflowchart LR\n    subgraph \"Publisher\"\n        PC[\"Publisher Client\"]\n    end\n    \n    subgraph \"Session Management\"\n        LS[\"LiveService\"]\n        S[\"Session\"]\n        STR[\"Stream\"]\n        GB[\"Packet Buffer\"]\n        GM[\"GOP Manager\"]\n        CH[\"Codec Headers\"]\n    end\n    \n    subgraph \"Players\"\n        PR1[\"RTMP Player\"]\n        PR2[\"FLV Player\"]\n    end\n    \n    PC -- \"1. Media packets\" --\u003e LS\n    LS -- \"2. OnRecv()\" --\u003e S\n    S -- \"3. AddPacket()\" --\u003e STR\n    STR -- \"4. Store packets\" --\u003e GB\n    STR -- \"5. Manage keyframes\" --\u003e GM\n    STR -- \"6. Track codec info\" --\u003e CH\n    STR -- \"7. ActiveAllPlayers()\" --\u003e S\n    S -- \"8. PostFrames()\" --\u003e PR1\n    S -- \"8. PostFrames()\" --\u003e PR2\n```\n\nKey interactions:\n1. When the publisher sends media data, it's received by LiveService\n2. LiveService passes the data to the appropriate session\n3. The session adds the packet to its stream\n4. The stream processes the packet, updates GOP information, and activates players\n5. Players request and receive media frames through the stream\n\nSources: [src/live/LiveService.cc:185-195](), [src/live/Stream.cc:60-115](), [src/live/Stream.cc:117-153]()\n\n## HTTP and RTMP Protocol Integration\n\nThe session management system works with both RTMP and HTTP protocols, handling the protocol-specific aspects of session creation and management:\n\n```mermaid\nflowchart TD\n    subgraph \"Protocol Handlers\"\n        RS[\"RtmpServer\"]\n        HS[\"HttpServer\"]\n        RC[\"RtmpContext\"]\n        HC[\"HttpContext\"]\n        FC[\"FlvContext\"]\n    end\n    \n    subgraph \"Session Management\"\n        LS[\"LiveService\"]\n        S[\"Session\"]\n        STR[\"Stream\"]\n    end\n    \n    RS -- \"OnPublish/OnPlay\" --\u003e LS\n    HS -- \"OnRequest\" --\u003e LS\n    LS -- \"CreateSession\" --\u003e S\n    S -- \"CreatePublishUser/\n    CreatePlayerUser\" --\u003e S\n    S -- \"Stream management\" --\u003e STR\n    \n    HC -- \"HTTP players\" --\u003e FC\n    FC -- \"FlvPlayerUser\" --\u003e S\n    RC -- \"RtmpPlayerUser\" --\u003e S\n```\n\nFor HTTP/FLV playback:\n1. HttpServer receives the request and passes it to LiveService's OnRequest method\n2. The URL is parsed to extract the session name (domain/app/stream)\n3. A session is created or retrieved\n4. A FlvPlayerUser is created and added to the session\n5. A FlvContext is created to handle the HTTP/FLV protocol specifics\n\nSources: [src/live/LiveService.cc:249-328](), [src/mmedia/http/HttpServer.cc:35-89]()\n\n## Session Timeout and Cleanup Mechanisms\n\nThe system employs several mechanisms to ensure proper cleanup of inactive sessions:\n\n### Timeout Conditions\n\nA session is considered timed out if either:\n1. The stream has been inactive for more than 20 seconds (default)\n2. There are no players and the session has been idle for longer than the configured `stream_idle_time`\n\n```mermaid\nflowchart TD\n    A[\"Session.IsTimeout()\"] --\u003e B{\"Stream.Timeout()?\"}\n    B -- \"Yes\" --\u003e C[\"Return true\"]\n    B -- \"No\" --\u003e D{\"player_count == 0 AND\n    idle_time \u003e stream_idle_time?\"}\n    D -- \"Yes\" --\u003e C\n    D -- \"No\" --\u003e E[\"Return false\"]\n```\n\n### Periodic Cleanup\n\nLiveService runs a periodic timer task to check for and clean up timed-out sessions:\n\n1. A task is created during LiveService startup that calls OnTimer every 5 seconds\n2. OnTimer iterates through all sessions, checking for timeouts\n3. Timed-out sessions are logged, cleared, and removed from the sessions map\n\nSources: [src/live/LiveService.cc:87-105](), [src/live/LiveService.cc:227-230](), [src/live/Session.cc:32-44](), [src/live/Stream.cc:24-32]()\n\n## Session State Management\n\nSession state is tracked through several key attributes:\n\n| Attribute | Purpose |\n|-----------|---------|\n| stream_time_ | Tracks last activity time of the stream |\n| ready_time_ | Records when the stream became ready (had a keyframe) |\n| player_live_time_ | Tracks last activity time of any player |\n| has_audio_, has_video_, has_meta_ | Track media type availability |\n| stream_version_ | Incremented when stream configuration changes |\n\nSources: [src/live/Stream.cc:9-58](), [src/live/Session.cc:17-32]()\n\n## Summary\n\nThe Session Management system in StreamMediaServer provides a robust framework for managing the lifecycle of streaming sessions. It:\n\n1. Creates and maintains sessions based on client requests\n2. Manages the relationship between publishers, players, and streams\n3. Handles media data flow from publishers to players\n4. Cleans up inactive sessions to conserve resources\n5. Provides integration with both RTMP and HTTP protocols\n\nThis central system connects the protocol handlers with the media processing components, forming the backbone of the streaming server architecture."])</script><script>self.__next_f.push([1,"26:T24bf,"])</script><script>self.__next_f.push([1,"# User Management\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/live/PlayerUser.cc](src/live/PlayerUser.cc)\n- [src/live/RtmpPlayerUser.cc](src/live/RtmpPlayerUser.cc)\n- [src/live/RtmpPlayerUser.h](src/live/RtmpPlayerUser.h)\n- [src/live/User.cc](src/live/User.cc)\n- [src/live/User.h](src/live/User.h)\n- [src/live/base/CodecUtils.cc](src/live/base/CodecUtils.cc)\n- [src/live/base/CodecUtils.h](src/live/base/CodecUtils.h)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThe User Management subsystem in StreamMediaServer manages the publisher and player entities that connect to the streaming server. This document describes the user class hierarchy, types of users, how they manage their connections, and how media data flows through them. For details on how users relate to sessions, see [Session Management](#4.2).\n\n## User Class Hierarchy\n\nThe User Management system employs a class hierarchy to represent different types of users connecting to the streaming service.\n\n```mermaid\nclassDiagram\n    class User {\n        #connection_: ConnectionPtr\n        #stream_: StreamPtr\n        #session_: SessionPtr\n        #domain_name_: string\n        #app_name_: string\n        #stream_name_: string\n        +GetUserType(): UserType\n        +SetUserType(type: UserType): void\n        +GetUserProtocol(): UserProtocol\n        +Close(): void\n        +Active(): void\n        +Deactive(): void\n    }\n\n    class PlayerUser {\n        #meta_: PacketPtr\n        #audio_header_: PacketPtr\n        #video_header_: PacketPtr\n        #time_corrector_: TimeCorrector\n        #out_frames_: vector\u003cPacketPtr\u003e\n        +Meta(): PacketPtr\n        +AudioHeader(): PacketPtr\n        +VideoHeader(): PacketPtr\n        +ClearMeta(): void\n        +ClearAudioHeader(): void\n        +ClearVideoHeader(): void\n        +GetTimeCorrector(): TimeCorrector\u0026\n    }\n\n    class RtmpPlayerUser {\n        +PostFrames(): bool\n        +GetUserType(): UserType\n        -PushFrame(packet: PacketPtr, is_header: bool): bool\n        -PushFrames(list: vector\u003cPacketPtr\u003e): bool\n    }\n\n    User \u003c|-- PlayerUser : inherits\n    PlayerUser \u003c|-- RtmpPlayerUser : inherits\n```\n\nSources: [src/live/User.h](), [src/live/PlayerUser.cc](), [src/live/RtmpPlayerUser.h]()\n\n### Base User Class\n\nThe `User` class is the foundation of the user management system, representing any entity (publisher or player) connected to the streaming server. It maintains:\n\n- Connection information: TCP connection details\n- Stream reference: The media stream it's associated with\n- Session reference: The streaming session it belongs to\n- Identification details: Domain name, app name, stream name\n- Type and protocol information: The type of user and protocol used\n\nSources: [src/live/User.h:43-98](), [src/live/User.cc]()\n\n### User Types and Protocols\n\nThe system supports multiple user types and protocols:\n\n```mermaid\ngraph TD\n    subgraph \"UserType Enum\"\n        Publisher[\"Publisher Types\"]\n        Player[\"Player Types\"]\n        \n        Publisher --\u003e RTMP[\"kUserTypePublishRtmp\"]\n        Publisher --\u003e MPEGTS[\"kUserTypePublishMpegts\"]\n        Publisher --\u003e PAV[\"kUserTypePublishPav\"]\n        Publisher --\u003e WebRTC_Pub[\"kUserTypePublishWebRtc\"]\n        \n        Player --\u003e PAV_Player[\"kUserTypePlayerPav\"]\n        Player --\u003e FLV[\"kUserTypePlayerFlv\"]\n        Player --\u003e HLS[\"kUserTypePlayerHls\"]\n        Player --\u003e RTMP_Player[\"kUserTypePlayerRtmp\"]\n        Player --\u003e WebRTC_Player[\"kUserTypePlayerWebRTC\"]\n    end\n    \n    subgraph \"UserProtocol Enum\"\n        HTTP[\"kUserProtocolHttp\"]\n        HTTPS[\"kUserProtocolHttps\"]\n        QUIC[\"kUserProtocolQuic\"]\n        RTSP[\"kUserProtocolRtsp\"]\n        WebRTC_Proto[\"kUserProtocolWebRTC\"]\n        UDP[\"kUserProtocolUdp\"]\n    end\n```\n\nSources: [src/live/User.h:18-40]()\n\n## User Lifecycle Management\n\n### Creation and Initialization\n\nUsers are typically created by a `Session` when a client connects to the streaming server. The initialization process includes:\n\n1. Setting up the connection\n2. Assigning the appropriate stream\n3. Linking to the session\n4. Setting identification details (domain, app, stream name)\n\n### Activation and Deactivation\n\nThe User Management system employs an active/inactive state mechanism to efficiently manage resources:\n\n- Users are marked active when they are processing media data\n- Users are deactivated when idle\n- The `Active()` and `Deactive()` methods control this state by interacting with the underlying connection\n\n```mermaid\nsequenceDiagram\n    participant Client\n    participant Connection\n    participant User\n    participant Stream\n    \n    Client-\u003e\u003eConnection: Send data\n    Connection-\u003e\u003eUser: Process data\n    User-\u003e\u003eUser: Active()\n    User-\u003e\u003eStream: Process media\n    \n    Note over User: When idle\n    User-\u003e\u003eUser: Deactive()\n    User-\u003e\u003eConnection: Mark as inactive\n```\n\nSources: [src/live/User.cc:84-98]()\n\n### Termination\n\nWhen a user disconnects or a session terminates, the `Close()` method is called to clean up resources:\n\n1. The connection is forcibly closed\n2. Resources are released\n3. The user is removed from its session\n\nSources: [src/live/User.cc:69-74]()\n\n## Media Data Flow for PlayerUser\n\nThe `PlayerUser` class specializes `User` for clients that consume streams. It handles:\n\n1. Storage of codec information (metadata, audio/video headers)\n2. Time correction for synchronized playback\n3. Media frame management\n\n```mermaid\nflowchart LR\n    subgraph \"Stream\"\n        StreamBuffer[\"Media Packet Buffer\"]\n    end\n    \n    subgraph \"PlayerUser\"\n        Meta[\"meta_: PacketPtr\"]\n        AudioHeader[\"audio_header_: PacketPtr\"]\n        VideoHeader[\"video_header_: PacketPtr\"]\n        TimeCorrector[\"time_corrector_: TimeCorrector\"]\n        OutFrames[\"out_frames_: vector\u003cPacketPtr\u003e\"]\n    end\n    \n    subgraph \"Protocol-Specific User (e.g., RtmpPlayerUser)\"\n        PostFrames[\"PostFrames()\"]\n        PushFrame[\"PushFrame()\"]\n    end\n    \n    subgraph \"Connection\"\n        Context[\"Protocol Context\"]\n        Socket[\"TCP Socket\"]\n    end\n    \n    StreamBuffer --\u003e Meta\n    StreamBuffer --\u003e AudioHeader\n    StreamBuffer --\u003e VideoHeader\n    StreamBuffer --\u003e OutFrames\n    \n    Meta --\u003e PostFrames\n    AudioHeader --\u003e PostFrames\n    VideoHeader --\u003e PostFrames\n    OutFrames --\u003e PostFrames\n    TimeCorrector --\u003e PostFrames\n    \n    PostFrames --\u003e PushFrame\n    PushFrame --\u003e Context\n    Context --\u003e Socket\n```\n\nSources: [src/live/PlayerUser.cc](), [src/live/RtmpPlayerUser.cc:14-64]()\n\n### RTMP Player Example\n\nThe `RtmpPlayerUser` is a concrete implementation of `PlayerUser` for RTMP playback. Its workflow:\n\n1. Get frames from the `Stream` to populate its internal buffers\n2. Send metadata and codec headers first (in correct order)\n3. Send media frames in sequence\n4. Correct timestamps for synchronized playback\n5. Manage connection state\n\nSources: [src/live/RtmpPlayerUser.cc](), [src/live/RtmpPlayerUser.h]()\n\n## Packet and Frame Processing\n\nUsers handle different types of media packets:\n\n| Packet Type | Description | Handling |\n|-------------|-------------|----------|\n| Metadata | Stream configuration information | Sent first to initialize player |\n| Audio Header | Audio codec configuration | Sent after metadata |\n| Video Header | Video codec configuration | Sent after audio header |\n| Media Frames | Actual audio/video content | Sent in sequence with corrected timestamps |\n\nThe system ensures codec headers are correctly identified and processed:\n\n```mermaid\nflowchart TD\n    Packet[\"Incoming Packet\"]\n    \n    Packet --\u003e IsCodecHeader{\"IsCodecHeader()?\"}\n    Packet --\u003e IsKeyFrame{\"IsKeyFrame()?\"}\n    \n    IsCodecHeader --\u003e|Yes| StoreHeader[\"Store as codec header\"]\n    IsCodecHeader --\u003e|No| RegularPacket[\"Process as regular packet\"]\n    \n    IsKeyFrame --\u003e|Yes| KeyFrameProc[\"Special key frame processing\"]\n    IsKeyFrame --\u003e|No| RegularFrameProc[\"Regular frame processing\"]\n```\n\nSources: [src/live/base/CodecUtils.h](), [src/live/base/CodecUtils.cc]()\n\n## Integration with Other Subsystems\n\n### Connection with Sessions\n\nEach `User` maintains a reference to its parent `Session`. This allows:\n\n- Access to session-wide configurations\n- Communication with other users in the same session\n- Proper cleanup when sessions terminate\n\n### Stream Interaction\n\nUsers interact with their assigned `Stream` to:\n\n1. Publishers: Push media packets to the stream\n2. Players: Retrieve media packets from the stream\n3. Both: Access codec information and stream state\n\nThis interaction is crucial for the flow of media data through the system.\n\nSources: [src/live/User.h:75-83]()\n\n## User Identification and Configuration\n\nUsers are identified by several attributes:\n\n- Domain name\n- Application name\n- Stream name\n- Parameters\n- User ID (typically derived from IP and port)\n\nThese attributes are used for routing, access control, and resource allocation. Additionally, each user has associated application information (`AppInfo`) that defines configuration settings for that particular stream.\n\nSources: [src/live/User.h:50-60](), [src/live/User.cc:13-51]()\n\n## Summary\n\nThe User Management subsystem is a critical component of the StreamMediaServer, responsible for managing the life cycle of publisher and player connections. It provides an extensible class hierarchy to support various streaming protocols and user types, while efficiently managing media data flow and resource utilization."])</script><script>self.__next_f.push([1,"27:T320f,"])</script><script>self.__next_f.push([1,"# Stream and GOP Management\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/live/GopMgr.h](src/live/GopMgr.h)\n- [src/live/Session.cc](src/live/Session.cc)\n- [src/live/Stream.cc](src/live/Stream.cc)\n- [src/live/tmp/CodecHeader.cc](src/live/tmp/CodecHeader.cc)\n- [src/live/tmp/CodecHeader.h](src/live/tmp/CodecHeader.h)\n- [src/live/tmp/GopMgr.cc](src/live/tmp/GopMgr.cc)\n- [src/live/tmp/GopMgr.h](src/live/tmp/GopMgr.h)\n- [src/network/UdpClient.cc](src/network/UdpClient.cc)\n- [src/network/base/Network.h](src/network/base/Network.h)\n- [src/network/net/Acceptor.cc](src/network/net/Acceptor.cc)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document details the Stream and GOP Management system in the StreamMediaServer project, explaining how media streams are organized and managed for efficient delivery to clients. This includes packet buffering, GOP (Group of Pictures) tracking, codec header management, and the mechanisms that enable smooth live streaming with controlled latency.\n\nFor information about the broader live streaming system, see [Live Streaming System](#4), and for details on how users interact with streams, see [User Management](#4.3).\n\n## Stream Management Overview\n\nIn the StreamMediaServer, each `Session` owns a single `Stream` object that manages the media data for that session. The `Stream` class is responsible for buffering media packets, tracking GOP structures, managing codec metadata, and serving frames to players with appropriate latency.\n\n```mermaid\nclassDiagram\n    class Stream {\n        -packet_buffer_: vector~PacketPtr~\n        -gop_mgr_: GopMgr\n        -codec_headers_: CodecHeader\n        -frame_index_: atomic\u003cint32_t\u003e\n        -session_: Session\u0026\n        -session_name_: string\n        -ready_: bool\n        +AddPacket(packet)\n        +GetFrames(user)\n        +Ready()\n        +HasMedia()\n        +LocateGop(user)\n        +SkipFrame(user)\n        +GetNextFrame(user)\n    }\n    \n    class Session {\n        -stream_: StreamPtr\n        -publisher_: UserPtr\n        -players_: set\u003cPlayerUserPtr\u003e\n        +CreatePublishUser()\n        +CreatePlayerUser()\n        +GetStream()\n    }\n    \n    class GopMgr {\n        -gops_: vector\u003cGopItemInfo\u003e\n        -gop_length_: int32_t\n        -max_gop_length_: int32_t\n        -latest_timestamp_: int64_t\n        +AddFrame(packet)\n        +GetGopByLatency(content_latency, latency)\n        +ClearExpriedGop(min_idx)\n    }\n    \n    class CodecHeader {\n        -video_header_: PacketPtr\n        -audio_header_: PacketPtr\n        -meta_: PacketPtr\n        -video_header_packets_: vector\u003cPacketPtr\u003e\n        -audio_header_packets_: vector\u003cPacketPtr\u003e\n        -meta_packets_: vector\u003cPacketPtr\u003e\n        +ParseCodecHeader(packet)\n        +Meta(idx)\n        +VideoHeader(idx)\n        +AudioHeader(idx)\n    }\n    \n    Stream --\u003e GopMgr: manages\n    Stream --\u003e CodecHeader: manages\n    Session \"1\" --\u003e \"1\" Stream: owns\n```\n\nSources: [src/live/Stream.cc:9-37](), [src/live/Session.cc:17-21]()\n\n## Media Packet Flow\n\nThe following diagram illustrates how media packets flow through the Stream and GOP Management system:\n\n```mermaid\nflowchart TD\n    subgraph \"Publisher\"\n        PUB[\"Publisher Client\"]\n    end\n    \n    subgraph \"Protocol Handler\"\n        RTMPServer[\"RTMP Server\"]\n    end\n    \n    subgraph \"Stream System\"\n        LiveService[\"LiveService\"]\n        Session[\"Session\"]\n        Stream[\"Stream\"]\n        \n        subgraph \"Stream Components\"\n            PKT_BUFFER[\"Packet Buffer\"]\n            GOP_MGR[\"GopMgr\"]\n            CODEC_HEADERS[\"CodecHeader\"]\n        end\n    end\n    \n    subgraph \"Players\"\n        RTMP_PLAYER[\"RTMP Player\"]\n        FLV_PLAYER[\"HTTP/FLV Player\"]\n    end\n    \n    PUB --\u003e RTMPServer\n    RTMPServer --\u003e LiveService\n    LiveService --\u003e Session\n    Session --\u003e Stream\n    \n    Stream --\u003e PKT_BUFFER\n    Stream --\u003e GOP_MGR\n    Stream --\u003e CODEC_HEADERS\n    \n    PKT_BUFFER --\u003e RTMP_PLAYER\n    PKT_BUFFER --\u003e FLV_PLAYER\n```\n\nSources: [src/live/Stream.cc:60-115]()\n\n## Packet Buffer System\n\nThe Stream class maintains a circular buffer of media packets that holds recent frames. This buffer is the primary storage mechanism for stream data.\n\n### Key Features:\n\n1. **Fixed-size circular buffer**: The buffer has a predefined size (`packet_buffer_size_`), and once filled, it starts overwriting older packets.\n\n2. **Indexed access**: Each packet is assigned an incrementing index when added to the buffer, allowing for fast retrieval.\n\n3. **Thread safety**: Buffer operations are protected by a mutex to ensure thread safety.\n\n### Packet Addition Process\n\nWhen a new packet is received from a publisher, it goes through the following process:\n\n1. Timestamp correction is applied\n2. The packet is indexed and stored in the buffer\n3. If it's a keyframe, the stream is marked as ready\n4. Codec headers are parsed and stored if the packet contains codec information\n5. The packet is added to the GOP manager for tracking\n6. Players are notified of new content\n\n```mermaid\nsequenceDiagram\n    participant Publisher\n    participant Stream\n    participant Buffer as \"Packet Buffer\"\n    participant GOP as \"GopMgr\"\n    participant Codec as \"CodecHeader\"\n    \n    Publisher-\u003e\u003eStream: Send media packet\n    Stream-\u003e\u003eStream: Correct timestamp\n    Stream-\u003e\u003eStream: Assign index\n    Stream-\u003e\u003eCodec: If codec header, parse\n    Stream-\u003e\u003eGOP: Add to GOP tracker\n    Stream-\u003e\u003eBuffer: Store in buffer\n    Stream-\u003e\u003eStream: Notify players\n```\n\nSources: [src/live/Stream.cc:60-115]()\n\n## GOP (Group of Pictures) Management\n\nA GOP is a collection of frames that begins with a keyframe (I-frame) and includes all subsequent frames until the next keyframe. In streaming applications, GOPs are fundamental for seeking, latency control, and player synchronization.\n\n### GopMgr Class\n\nThe `GopMgr` class maintains a list of GOP structures, tracking:\n\n- The index and timestamp of each keyframe\n- The length of each GOP\n- The maximum GOP length encountered\n- The total number of GOPs\n\nEach GOP is represented by a `GopItemInfo` structure containing the index and timestamp of its keyframe.\n\n```mermaid\nclassDiagram\n    class GopMgr {\n        -gops_: vector\u003cGopItemInfo\u003e\n        -gop_length_: int32_t\n        -max_gop_length_: int32_t\n        -gop_numbers_: int32_t\n        -total_gop_length_: int32_t\n        -latest_timestamp_: int64_t\n        +AddFrame(packet)\n        +GetGopByLatency(content_latency, latency)\n        +ClearExpriedGop(min_idx)\n        +GopSize()\n        +LatestTimestamp()\n    }\n    \n    class GopItemInfo {\n        +index: int32_t\n        +timestamp: int64_t\n    }\n    \n    GopMgr \"1\" --\u003e \"*\" GopItemInfo: contains\n```\n\nSources: [src/live/GopMgr.h:11-44]()\n\n### Latency Control Using GOPs\n\nOne of the key functions of GOP management is controlling the playback latency for viewers. When a player connects to a stream, the system locates an appropriate GOP based on the desired content latency:\n\n1. The system calls `GetGopByLatency()` to find a GOP that meets the latency requirement\n2. It calculates the latency by comparing the GOP's timestamp with the latest timestamp\n3. It returns the index of the first frame in the selected GOP\n4. If no suitable GOP is found, the player waits for more frames\n\n```mermaid\nflowchart TD\n    START[\"Player connects\"]\n    GET_GOP[\"Get GOP by latency\"]\n    CHECK_LATENCY[\"Calculate latency of each GOP\"]\n    SUITABLE[\"Is GOP suitable?\"]\n    RETURN_GOP[\"Return GOP index\"]\n    WAIT[\"Wait for more frames\"]\n    \n    START --\u003e GET_GOP\n    GET_GOP --\u003e CHECK_LATENCY\n    CHECK_LATENCY --\u003e SUITABLE\n    SUITABLE -- \"Yes\" --\u003e RETURN_GOP\n    SUITABLE -- \"No\" --\u003e WAIT\n```\n\nSources: [src/live/Stream.cc:154-235](), [src/live/tmp/GopMgr.cc:29-45]()\n\n### Memory Management\n\nTo prevent memory leaks and ensure efficient operation, the system periodically cleans up expired GOPs:\n\n1. When the buffer's capacity is reached, older frames are overwritten\n2. The `ClearExpriedGop()` method removes GOP entries that reference frames no longer in the buffer\n3. This process is triggered whenever new frames are added to the buffer\n\nSources: [src/live/Stream.cc:95-101](), [src/live/tmp/GopMgr.cc:47-62]()\n\n## Codec Header Management\n\nCodec headers contain essential metadata about the audio and video streams, including format information that players need to decode the media correctly. The `CodecHeader` class manages these headers.\n\n### Types of Codec Headers\n\n1. **Metadata (Meta)**: Contains general stream information like resolution, framerate, etc.\n2. **Video Headers**: Contain video codec configuration, typically H.264/AVC or H.265/HEVC specific data\n3. **Audio Headers**: Contain audio codec configuration, typically AAC specific data\n\n### Version Tracking\n\nThe system tracks different versions of codec headers that may occur during a stream:\n\n1. Each time a new codec header is received, the version counter is incremented\n2. Headers are stored in vectors, allowing players to access the correct version\n3. When a player joins, it receives the most recent codec headers applicable to its playback position\n\n```mermaid\nflowchart LR\n    subgraph \"Codec Header Management\"\n        PARSE[\"ParseCodecHeader()\"]\n        \n        subgraph \"Storage\"\n            META[\"Meta Headers\"]\n            VIDEO[\"Video Headers\"]\n            AUDIO[\"Audio Headers\"]\n        end\n        \n        subgraph \"Retrieval\"\n            GET_META[\"Meta(idx)\"]\n            GET_VIDEO[\"VideoHeader(idx)\"]\n            GET_AUDIO[\"AudioHeader(idx)\"]\n        end\n    end\n    \n    PACKET[\"Incoming Packet\"] --\u003e PARSE\n    PARSE -- \"Is Meta\" --\u003e META\n    PARSE -- \"Is Video Header\" --\u003e VIDEO\n    PARSE -- \"Is Audio Header\" --\u003e AUDIO\n    \n    PLAYER[\"Player Request\"] --\u003e GET_META\n    PLAYER --\u003e GET_VIDEO\n    PLAYER --\u003e GET_AUDIO\n    \n    META --\u003e GET_META\n    VIDEO --\u003e GET_VIDEO\n    AUDIO --\u003e GET_AUDIO\n```\n\nSources: [src/live/tmp/CodecHeader.h:12-36](), [src/live/tmp/CodecHeader.cc:19-206]()\n\n## Player Interaction with Streams\n\nPlayers interact with the stream through a series of methods that manage their playback position and data delivery.\n\n### Key Player-Stream Interactions:\n\n1. **Locating Initial Position**: When a player connects, `LocateGop()` positions it at an appropriate GOP\n2. **Frame Delivery**: `GetFrames()` retrieves the next batch of frames for the player\n3. **Latency Adjustment**: `SkipFrame()` allows players to skip ahead if they fall too far behind\n4. **Codec Header Delivery**: Players receive the appropriate codec headers for their playback position\n\n### Frame Fetching Process\n\n```mermaid\nsequenceDiagram\n    participant P as \"PlayerUser\"\n    participant S as \"Stream\"\n    participant G as \"GopMgr\"\n    participant C as \"CodecHeader\"\n    participant B as \"Packet Buffer\"\n    \n    P-\u003e\u003eS: Request frames\n    alt First request\n        S-\u003e\u003eG: LocateGop(user)\n        G-\u003e\u003eS: Return suitable GOP index\n        S-\u003e\u003eC: Get meta header\n        S-\u003e\u003eC: Get audio header\n        S-\u003e\u003eC: Get video header\n        C-\u003e\u003eP: Provide codec headers\n    else Already playing\n        S-\u003e\u003eS: Check if need to skip frames\n        alt Too far behind\n            S-\u003e\u003eG: Get new GOP by latency\n            G-\u003e\u003eS: Return new GOP index\n            S-\u003e\u003eP: Update playback position\n        end\n    end\n    S-\u003e\u003eB: GetNextFrame(user)\n    B-\u003e\u003eP: Provide frame data\n```\n\nSources: [src/live/Stream.cc:117-305]()\n\n## Frame Skipping for Latency Control\n\nThe Stream system implements a frame-skipping mechanism to maintain desired latency:\n\n1. When a player requests frames, the system checks if it has fallen too far behind\n2. If the player's current frame is outside the buffer or too old, `SkipFrame()` is called\n3. The system locates a new GOP based on the configured content latency\n4. The player's position is updated to the new GOP\n5. New codec headers are provided if they've changed since the player's previous position\n\nThis mechanism prevents players from falling too far behind during a live stream, maintaining the configured latency even if network or processing delays occur.\n\nSources: [src/live/Stream.cc:237-279]()\n\n## Design Considerations\n\nThe Stream and GOP Management system is designed with several key considerations:\n\n1. **Low Latency**: The system prioritizes maintaining the configured content latency through GOP tracking and frame skipping.\n\n2. **Memory Efficiency**: The circular buffer and GOP cleanup mechanisms ensure memory usage remains bounded regardless of stream duration.\n\n3. **Codec Flexibility**: By tracking codec headers separately, the system can handle codec changes during a stream.\n\n4. **Dynamic Adaptation**: Players can join at any time and will automatically receive the appropriate frames and headers.\n\n5. **Thread Safety**: Mutex locks ensure that concurrent access to the stream data is properly synchronized."])</script><script>self.__next_f.push([1,"28:T2a55,"])</script><script>self.__next_f.push([1,"# Configuration and Logging\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [CMakeLists.txt](CMakeLists.txt)\n- [src/base/Config.cc](src/base/Config.cc)\n- [src/base/Config.h](src/base/Config.h)\n- [src/base/Logger.cc](src/base/Logger.cc)\n- [src/base/Logger.h](src/base/Logger.h)\n- [src/live/Session.h](src/live/Session.h)\n- [src/main/CMakeLists.txt](src/main/CMakeLists.txt)\n- [src/main/TestLog.cc](src/main/TestLog.cc)\n\n\u003c/details\u003e\n\n\n\nThis document provides a comprehensive overview of the configuration and logging systems in the StreamMediaServer. These critical subsystems enable flexible server configuration and robust logging capabilities for monitoring and debugging.\n\nThe configuration system allows server parameters to be defined through JSON configuration files, while the logging system provides structured logging with configurable verbosity levels and file rotation.\n\nFor information about the overall architecture, see [StreamMediaServer Overview](#1). For details about the application structure that configuration manages, see [Live Streaming System](#4).\n\n## Configuration System\n\nThe StreamMediaServer uses a JSON-based configuration system to define server behavior. Configuration files specify server parameters, service endpoints, log settings, and application domains.\n\n### Configuration System Architecture\n\n```mermaid\nclassDiagram\n    class ConfigMgr {\n        -config_: ConfigPtr\n        -lock_: mutex\n        +LoadConfig(file): bool\n        +GetConfig(): ConfigPtr\n    }\n    \n    class Config {\n        -log_info_: LogInfoPtr\n        -services_: vector~ServiceInfoPtr~\n        -domaininfos_: unordered_map\n        -lock_: mutex\n        +LoadConfig(file): bool\n        +GetLogInfo(): LogInfoPtr\n        +GetServiceInfos(): vector~ServiceInfoPtr~\n        +GetServiceInfo(protocol, transport): ServiceInfoPtr\n        +GetAppInfo(domain, app): AppInfoPtr\n        +GetDomainInfo(domain): DomainInfoPtr\n    }\n    \n    class LogInfo {\n        +level: LogLevel\n        +path: string\n        +name: string\n        +rotate_type: RotateType\n    }\n    \n    class ServiceInfo {\n        +addr: string\n        +port: uint16_t\n        +protocol: string\n        +transport: string\n    }\n    \n    class DomainInfo {\n        +ParseDomainInfo(file): bool\n        +DomainName(): string\n        +GetAppInfo(app): AppInfoPtr\n    }\n    \n    class AppInfo {\n        +various configuration parameters\n    }\n    \n    class Singleton {\n        +Instance(): T\u0026\n    }\n    \n    ConfigMgr --* Config : contains\n    Config --* LogInfo : contains\n    Config --* \"0..*\" ServiceInfo : contains\n    Config --* \"0..*\" DomainInfo : contains\n    DomainInfo --* \"0..*\" AppInfo : contains\n    Singleton --\u003e ConfigMgr : provides access\n```\n\nSources: [src/base/Config.h:45-84](), [src/base/Config.h:85-96](), [src/base/Config.h:20-30](), [src/base/Config.h:32-38]()\n\n### Configuration Loading Process\n\n```mermaid\nflowchart TD\n    Start[\"ConfigMgr::LoadConfig()\"] --\u003e ReadFile[\"Read JSON configuration file\"]\n    ReadFile --\u003e ParseMain[\"Parse main settings\\n(name, cpu_start, cpus, threads)\"]\n    ParseMain --\u003e ParseLog[\"ParseLogInfo()\\nProcess log settings\"]\n    ParseLog --\u003e ParseServices[\"ParseServiceInfo()\\nProcess service endpoints\"]\n    ParseServices --\u003e ParseDirectories[\"ParseDirectory()\\nProcess domain directories\"]\n    ParseDirectories --\u003e ProcessPath[\"ParseDomainPath()\\nProcess directories containing domain files\"]\n    ProcessPath --\u003e ProcessFiles[\"ParseDomainFile()\\nParse individual domain configuration files\"]\n    ProcessFiles --\u003e SetConfig[\"Store ConfigPtr in ConfigMgr\"]\n    SetConfig --\u003e ReturnStatus[\"Return success/failure status\"]\n```\n\nSources: [src/base/Config.cc:17-57](), [src/base/Config.cc:117-126](), [src/base/Config.cc:175-203](), [src/base/Config.cc:206-244](), [src/base/Config.cc:247-262]()\n\n### Configuration File Structure\n\nThe StreamMediaServer configuration uses JSON format with the following main sections:\n\n| Section | Description | Example |\n|---------|-------------|---------|\n| name | Server instance name | `\"tmms\"` |\n| cpu_start | Starting CPU core | `0` |\n| cpus | Number of CPU cores to use | `4` |\n| threads | Number of worker threads | `8` |\n| log | Logging configuration | `{\"level\": \"DEBUG\", \"path\": \"/var/log\", \"name\": \"tmms.log\", \"rotate\": \"DAY\"}` |\n| services | Service endpoint definitions | `[{\"addr\": \"0.0.0.0\", \"port\": 1935, \"protocol\": \"rtmp\", \"transport\": \"tcp\"}]` |\n| directory | Domain configuration directories | `[\"/etc/tmms/domains\"]` |\n\nSources: [src/base/Config.cc:17-57]()\n\n### Configuration Access\n\nThe StreamMediaServer uses the Singleton pattern to provide global access to the configuration system through the `sConfigMgr` macro. This provides a centralized point for retrieving configuration information throughout the application.\n\n```cpp\n// Example usage:\nConfigPtr config = sConfigMgr-\u003eGetConfig();\nLogInfoPtr logInfo = config-\u003eGetLogInfo();\nServiceInfoPtr rtmpService = config-\u003eGetServiceInfo(\"rtmp\", \"tcp\");\n```\n\nSources: [src/base/Config.h:100](), [src/base/Config.cc:127-131]()\n\n## Logging System\n\nThe StreamMediaServer includes a flexible logging system that supports multiple log levels, file output, and log rotation.\n\n### Logging System Architecture\n\n```mermaid\nclassDiagram\n    class Logger {\n        -level_: LogLevel\n        -log_: FileLogPtr\n        +SetLogLevel(level): void\n        +GetLogLevel(): LogLevel\n        +Write(msg): void\n    }\n    \n    class FileLog {\n        +WriteLog(msg): void\n        +setRotate(type): void\n    }\n    \n    class FileMgr {\n        +GetFileLog(name): FileLogPtr\n        +OnCheck(): void\n    }\n    \n    class LogStream {\n        +operator\u003c\u003c(): LogStream\u0026\n    }\n    \n    enum LogLevel {\n        kTrace\n        kDebug\n        kInfo\n        kWarn\n        kError\n    }\n    \n    enum RotateType {\n        kRotateNone\n        kRotateMinute\n        kRotateHour\n        kRotateDay\n    }\n    \n    Logger --\u003e LogLevel : uses\n    Logger --\u003e FileLog : writes to\n    FileMgr --\u003e FileLog : creates\n    LogStream --\u003e Logger : uses\n    FileLog --\u003e RotateType : configured with\n```\n\nSources: [src/base/Logger.h:8-15](), [src/base/Logger.h:16-27](), [src/base/Logger.cc:5-25](), [src/base/Config.h:22-30]()\n\n### Log Levels\n\nThe logging system supports five log levels in decreasing order of verbosity:\n\n| Level | Enum Value | Description |\n|-------|------------|-------------|\n| TRACE | kTrace | Most detailed level for tracing program execution |\n| DEBUG | kDebug | Detailed information for debugging |\n| INFO | kInfo | Important runtime information |\n| WARN | kWarn | Warning conditions |\n| ERROR | kError | Error conditions |\n\nSources: [src/base/Logger.h:8-15](), [src/base/Config.cc:64-86]()\n\n### Log Configuration\n\nLog configuration is specified in the configuration file under the \"log\" section:\n\n```json\n{\n  \"log\": {\n    \"level\": \"DEBUG\",\n    \"path\": \"/var/log\",\n    \"name\": \"tmms.log\",\n    \"rotate\": \"DAY\"\n  }\n}\n```\n\nThe log configuration parameters include:\n\n| Parameter | Description | Possible Values |\n|-----------|-------------|----------------|\n| level | Log verbosity level | \"TRACE\", \"DEBUG\", \"INFO\", \"WARN\", \"ERROR\" |\n| path | Directory path for log files | Any valid directory path |\n| name | Base name for log files | Any valid filename |\n| rotate | Log rotation type | \"HOUR\", \"DAY\" |\n\nSources: [src/base/Config.cc:59-110](), [src/base/Config.h:20-30]()\n\n### Log Rotation\n\nThe logging system supports automatic log file rotation based on time:\n\n- **Hour-based rotation** (`kRotateHour`): Creates a new log file every hour\n- **Day-based rotation** (`kRotateDay`): Creates a new log file every day\n\nLog files are named using the base name and a timestamp suffix according to the rotation period.\n\nSources: [src/base/Config.cc:88-99](), [src/base/Config.h:29]()\n\n### Log Usage\n\nThe logging system provides a set of macros for easy logging at different levels:\n\n```cpp\nLOG_TRACE \u003c\u003c \"Detailed trace information\";\nLOG_DEBUG \u003c\u003c \"Debug information\";\nLOG_INFO \u003c\u003c \"Important information\";\nLOG_WARN \u003c\u003c \"Warning message\";\nLOG_ERROR \u003c\u003c \"Error message\";\n```\n\nThese macros use C++ stream syntax, allowing for easy composition of log messages.\n\nSources: [src/main/TestLog.cc:16-17]()\n\n## Integration of Configuration and Logging\n\nThe configuration system plays a critical role in setting up the logging system. During server initialization, the configuration is loaded first, and then the logging system is configured based on the settings in the configuration file.\n\n```mermaid\nsequenceDiagram\n    participant Main as \"Main Program\"\n    participant ConfigMgr as \"ConfigMgr\"\n    participant Config as \"Config\"\n    participant Logger as \"Logger\"\n    participant FileLog as \"FileLog\"\n    \n    Main-\u003e\u003eConfigMgr: LoadConfig(\"config.json\")\n    ConfigMgr-\u003e\u003eConfig: LoadConfig(\"config.json\")\n    Config-\u003e\u003eConfig: ParseLogInfo()\n    Config--\u003e\u003eConfigMgr: Return success\n    \n    Main-\u003e\u003eConfigMgr: GetConfig()\n    ConfigMgr--\u003e\u003eMain: Return ConfigPtr\n    Main-\u003e\u003eConfig: GetLogInfo()\n    Config--\u003e\u003eMain: Return LogInfoPtr\n    \n    Main-\u003e\u003eFileLog: Create(logInfo-\u003epath + logInfo-\u003ename)\n    FileLog-\u003e\u003eFileLog: setRotate(logInfo-\u003erotate_type)\n    Main-\u003e\u003eLogger: Create(fileLog)\n    Main-\u003e\u003eLogger: SetLogLevel(logInfo-\u003elevel)\n    \n    Note over Main,Logger: Logger is now configured and ready for use\n```\n\nSources: [src/base/Config.cc:59-110](), [src/main/TestLog.cc:24-27]()\n\n## System Initialization\n\nThe following sequence shows how the configuration and logging systems are initialized during server startup:\n\n1. Load configuration file using `ConfigMgr::LoadConfig()`\n2. Retrieve configuration with `sConfigMgr-\u003eGetConfig()`\n3. Get log configuration with `config-\u003eGetLogInfo()`\n4. Create and configure the file logger\n5. Set the log level according to configuration\n6. Begin logging server activity\n\nThis initialization ensures that both configuration and logging are properly set up before the server begins handling connections.\n\nSources: [src/base/Config.cc:117-126](), [src/main/TestLog.cc:24-27]()\n\n## Best Practices\n\nWhen working with the configuration and logging systems:\n\n1. **Configuration File Management**:\n   - Keep configuration files in a version-controlled repository\n   - Use separate configuration files for development and production\n   - Document configuration changes\n\n2. **Logging Best Practices**:\n   - Use appropriate log levels (don't log everything at DEBUG)\n   - Include relevant context in log messages\n   - Set up log rotation to prevent disk space issues\n   - Consider log aggregation for distributed deployments\n\n3. **Configuration Updates**:\n   - The configuration is currently loaded only at startup\n   - To change configuration, update files and restart the server\n\nThese practices help maintain system stability and make troubleshooting easier."])</script><script>self.__next_f.push([1,"29:T2f2e,"])</script><script>self.__next_f.push([1,"# Configuration System\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [bin/log/tmms.log](bin/log/tmms.log)\n- [src/base/Config.cc](src/base/Config.cc)\n- [src/base/Config.h](src/base/Config.h)\n- [src/live/LiveService.cc](src/live/LiveService.cc)\n- [src/live/Session.h](src/live/Session.h)\n- [src/mmedia/http/HttpRequest.cc](src/mmedia/http/HttpRequest.cc)\n- [src/mmedia/http/HttpServer.cc](src/mmedia/http/HttpServer.cc)\n- [src/mmedia/http/HttpServer.h](src/mmedia/http/HttpServer.h)\n\n\u003c/details\u003e\n\n\n\nThis page documents the configuration system used in the StreamMediaServer, which provides a centralized way to manage and access server settings. The configuration system handles loading, parsing, and providing access to settings that control server behavior, including network binding, protocols, logging, and application settings.\n\n## Overview\n\nThe configuration system is based on a JSON configuration file format and provides a singleton manager for accessing configuration values throughout the application. It serves as the foundation for setting up various components including the RTMP and HTTP services, event loops, DNS resolution, and logging system.\n\n```mermaid\ngraph TD\n    subgraph \"Configuration System\"\n        ConfigFile[\"JSON Config Files\"]\n        ConfigMgr[\"ConfigMgr Singleton\"]\n        Config[\"Config Class\"]\n        Settings[\"Server Settings\"]\n    end\n    \n    subgraph \"Configuration Data\"\n        LogSettings[\"Log Settings\"]\n        ServiceSettings[\"Service Settings\"]\n        DomainSettings[\"Domain Settings\"]\n        AppSettings[\"Application Settings\"]\n    end\n    \n    subgraph \"Consumers\"\n        LiveService[\"LiveService\"]\n        HttpServer[\"HttpServer\"]\n        RtmpServer[\"RtmpServer\"]\n        Logging[\"Logging System\"]\n    end\n    \n    ConfigFile --\u003e ConfigMgr\n    ConfigMgr --\u003e Config\n    Config --\u003e Settings\n    \n    Settings --\u003e LogSettings\n    Settings --\u003e ServiceSettings\n    Settings --\u003e DomainSettings\n    Settings --\u003e AppSettings\n    \n    LogSettings --\u003e Logging\n    ServiceSettings --\u003e LiveService\n    DomainSettings --\u003e LiveService\n    AppSettings --\u003e LiveService\n    \n    LiveService --\u003e HttpServer\n    LiveService --\u003e RtmpServer\n```\n\nSources: \n- [src/base/Config.h]()\n- [src/base/Config.cc]()\n- [src/live/LiveService.cc:197-226]()\n\n## Configuration System Architecture\n\nThe configuration system consists of two main classes:\n\n1. **Config** - Stores the actual configuration data and provides methods to access it\n2. **ConfigMgr** - A singleton that manages loading and providing access to the configuration\n\n```mermaid\nclassDiagram\n    class ConfigMgr {\n        -config_: ConfigPtr\n        -lock_: mutex\n        +LoadConfig(file: string): bool\n        +GetConfig(): ConfigPtr\n    }\n    \n    class Config {\n        -log_info_: LogInfoPtr\n        -services_: vector\u003cServiceInfoPtr\u003e\n        -domaininfos_: unordered_map\u003cstring, DomainInfoPtr\u003e\n        -lock_: mutex\n        +name_: string\n        +cpu_start_: int32_t\n        +thread_num_: int32_t\n        +cpus_: int32_t\n        +LoadConfig(file: string): bool\n        +GetLogInfo(): LogInfoPtr\u0026\n        +GetServiceInfos(): vector\u003cServiceInfoPtr\u003e\u0026\n        +GetServiceInfo(protocol: string, transport: string): ServiceInfoPtr\u0026\n        +GetAppInfo(domain: string, app: string): AppInfoPtr\n        +GetDomainInfo(domain: string): DomainInfoPtr\n    }\n    \n    class LogInfo {\n        +level: LogLevel\n        +path: string\n        +name: string\n        +rotate_type: RotateType\n    }\n    \n    class ServiceInfo {\n        +addr: string\n        +port: uint16_t\n        +protocol: string\n        +transport: string\n    }\n    \n    class DomainInfo {\n        +DomainName(): string\n        +GetAppInfo(app: string): AppInfoPtr\n    }\n    \n    class AppInfo {\n        +Name(): string\n    }\n    \n    ConfigMgr --\u003e \"1\" Config : manages\n    Config --\u003e \"1\" LogInfo : contains\n    Config --\u003e \"*\" ServiceInfo : contains\n    Config --\u003e \"*\" DomainInfo : contains\n    DomainInfo --\u003e \"*\" AppInfo : contains\n```\n\nSources:\n- [src/base/Config.h:19-96]()\n- [src/base/Config.cc:117-131]()\n\n## Configuration File Format\n\nThe configuration file uses a JSON format with multiple sections controlling different aspects of the server. Here's an overview of the key configuration sections:\n\n### Top-Level Configuration\n\n| Field | Type | Description |\n|-------|------|-------------|\n| name | string | Name of the server instance |\n| cpu_start | integer | Starting CPU ID for thread affinity |\n| cpus | integer | Number of CPUs to use |\n| threads | integer | Number of worker threads |\n| log | object | Logging configuration |\n| services | array | Service endpoint configurations |\n| directory | array | Paths to domain configuration files |\n\n### Example Configuration\n\n```json\n{\n  \"name\": \"StreamMediaServer\",\n  \"cpu_start\": 0,\n  \"cpus\": 4,\n  \"threads\": 4,\n  \"log\": {\n    \"level\": \"DEBUG\",\n    \"path\": \"log\",\n    \"name\": \"tmms\",\n    \"rotate\": \"DAY\"\n  },\n  \"services\": [\n    {\n      \"addr\": \"0.0.0.0\",\n      \"port\": 1935,\n      \"protocol\": \"RTMP\",\n      \"transport\": \"tcp\"\n    },\n    {\n      \"addr\": \"0.0.0.0\",\n      \"port\": 8080,\n      \"protocol\": \"HTTP\",\n      \"transport\": \"tcp\"\n    }\n  ],\n  \"directory\": [\n    \"conf/domains\"\n  ]\n}\n```\n\nSources:\n- [src/base/Config.cc:17-57]()\n- [src/base/Config.cc:148-173]()\n\n## Configuration Loading Process\n\nThe configuration loading process follows these steps:\n\n```mermaid\nflowchart TD\n    Start[\"Start Server\"] --\u003e LoadConfig[\"ConfigMgr::LoadConfig()\"]\n    LoadConfig --\u003e ParseJson[\"Parse JSON File\"]\n    ParseJson --\u003e BasicConfig[\"Parse Basic Settings\\n(name, CPU, threads)\"]\n    BasicConfig --\u003e LogConfig[\"Parse Log Configuration\"]\n    LogConfig --\u003e ServiceConfig[\"Parse Service Configuration\"]\n    ServiceConfig --\u003e DomainConfig[\"Parse Domain Configuration\"]\n    DomainConfig --\u003e Complete[\"Configuration Loaded\"]\n    \n    subgraph \"Domain Configuration\"\n        DomainConfig --\u003e ScanDir[\"Scan Directory Paths\"]\n        ScanDir --\u003e ParseFiles[\"Parse Domain Files\"]\n        ParseFiles --\u003e StoreDomains[\"Store Domain Info\"]\n    end\n    \n    Complete --\u003e UseConfig[\"Use Configuration in LiveService\"]\n```\n\nThe configuration loading is typically initiated at application startup. The `ConfigMgr::LoadConfig()` method creates a new `Config` object and calls its `LoadConfig()` method to load and parse the configuration file.\n\nSources:\n- [src/base/Config.cc:17-57]()\n- [src/base/Config.cc:117-131]()\n- [src/base/Config.cc:176-262]()\n\n## Key Configuration Components\n\n### Server Configuration\n\nThe basic server configuration includes:\n\n- **Server name**: Identifier for the server instance\n- **CPU settings**: Controls thread affinity (cpu_start, cpus)\n- **Thread settings**: Number of worker threads\n\n### Service Configuration\n\nThe service configuration defines the network protocols and endpoints:\n\n```cpp\nstruct ServiceInfo\n{\n    std::string addr;      // Binding address (e.g., \"0.0.0.0\")\n    uint16_t port;         // Port number\n    std::string protocol;  // Protocol (e.g., \"RTMP\", \"HTTP\")\n    std::string transport; // Transport (e.g., \"tcp\")\n};\n```\n\nEach service entry in the configuration defines a protocol endpoint that the server will listen on.\n\n### Logging Configuration\n\nThe logging configuration controls how the server logs information:\n\n```cpp\nstruct LogInfo\n{\n    LogLevel level;       // Log level (TRACE, DEBUG, INFO, etc.)\n    std::string path;     // Path to log files\n    std::string name;     // Base name for log files\n    RotateType rotate_type; // Log rotation strategy\n};\n```\n\n### Domain and Application Configuration\n\nDomains and applications are configured through separate configuration files specified in the `directory` section. Each domain can have multiple applications with specific settings.\n\nSources:\n- [src/base/Config.h:20-43]()\n- [src/base/Config.cc:59-110]()\n- [src/base/Config.cc:148-173]()\n\n## Using the Configuration System\n\n### Accessing Configuration\n\nThe configuration is accessed through the `ConfigMgr` singleton, which provides a thread-safe way to retrieve the current configuration:\n\n```cpp\n// Get the configuration object\nConfigPtr config = sConfigMgr-\u003eGetConfig();\n\n// Access configuration values\nLogInfoPtr logInfo = config-\u003eGetLogInfo();\nconst std::vector\u003cServiceInfoPtr\u003e\u0026 services = config-\u003eGetServiceInfos();\nAppInfoPtr appInfo = config-\u003eGetAppInfo(domain, app);\n```\n\n### Integration with LiveService\n\nThe LiveService uses the configuration to set up services and manage streaming sessions:\n\n```mermaid\nsequenceDiagram\n    participant LiveService\n    participant ConfigMgr\n    participant EventLoopThreadPool\n    participant RtmpServer\n    participant HttpServer\n    \n    LiveService-\u003e\u003eConfigMgr: GetConfig()\n    ConfigMgr--\u003e\u003eLiveService: Return ConfigPtr\n    \n    LiveService-\u003e\u003e+EventLoopThreadPool: Create(config-\u003ethread_num_, etc.)\n    EventLoopThreadPool--\u003e\u003e-LiveService: pool_\n    \n    LiveService-\u003e\u003eEventLoopThreadPool: Start()\n    \n    loop For each service configuration\n        LiveService-\u003e\u003eLiveService: Check protocol\n        alt protocol == \"RTMP\"\n            LiveService-\u003e\u003e+RtmpServer: Create(loop, addr, port)\n            RtmpServer--\u003e\u003e-LiveService: Add to servers_\n        else protocol == \"HTTP\"\n            LiveService-\u003e\u003e+HttpServer: Create(loop, addr, port)\n            HttpServer--\u003e\u003e-LiveService: Add to servers_\n        end\n        LiveService-\u003e\u003eLiveService: Start server\n    end\n```\n\nSources:\n- [src/base/Config.h:100]() (Singleton definition)\n- [src/live/LiveService.cc:197-226]() (Configuration usage in LiveService)\n\n## Session Configuration\n\nWhen creating a streaming session, the LiveService uses the domain and application configuration to determine the session's behavior:\n\n```cpp\nSessionPtr LiveService::CreateSession(const std::string \u0026session_name) {\n  // ...\n  \n  //查找配置\n  ConfigPtr config = sConfigMgr-\u003eGetConfig();\n  auto app_info = config-\u003eGetAppInfo(list[0], list[1]);//domain app\n  \n  //查找失败\n  if(!app_info) {\n    LIVE_ERROR \u003c\u003c \"create session faild. cann't find config. domain:\" \u003c\u003c list[0] \u003c\u003c \", app:\" \u003c\u003c list[1];\n    return session_null;\n  }\n  \n  //找到配置了，创建session\n  auto s = std::make_shared\u003cSession\u003e(session_name);\n  s-\u003eSetAppInfo(app_info);\n  // ...\n}\n```\n\nSources:\n- [src/live/LiveService.cc:28-56]()\n- [src/live/Session.h:40-41]()\n\n## HTTP Service Configuration\n\nThe HTTP service uses the configuration system to determine how to handle HTTP requests and establish stream sessions:\n\n```mermaid\ngraph TD\n    subgraph \"Configuration Flow\"\n        ConfigFile[\"JSON Config Files\"]\n        ConfigMgr[\"ConfigMgr\"]\n        Config[\"Config\"]\n    end\n    \n    subgraph \"HTTP Handling\"\n        HttpServer[\"HttpServer\"]\n        HttpContext[\"HttpContext\"]\n        HttpRequest[\"HttpRequest\"]\n        LiveService[\"LiveService\"]\n        Session[\"Session\"]\n    end\n    \n    ConfigFile --\u003e ConfigMgr\n    ConfigMgr --\u003e Config\n    Config --\u003e LiveService\n    \n    HttpServer --\u003e HttpContext\n    HttpContext --\u003e HttpRequest\n    HttpRequest --\u003e LiveService\n    LiveService --\u003e Session\n    \n    Config -.-\u003e HttpServer\n    Config -.-\u003e Session\n```\n\nThe HTTP service is initialized based on the service configuration entries with `protocol` set to \"HTTP\". When handling requests like `.flv` streams, it uses the domain and application configuration to establish the appropriate session.\n\nSources:\n- [src/mmedia/http/HttpServer.h:11-29]()\n- [src/mmedia/http/HttpServer.cc:20-29]()\n- [src/mmedia/http/HttpRequest.cc]()\n- [src/live/LiveService.cc:249-327]()\n\n## Summary\n\nThe configuration system in StreamMediaServer provides a flexible foundation for controlling server behavior. Through a JSON-based configuration format, it allows for:\n\n1. Setting up network services with different protocols\n2. Configuring logging behavior\n3. Managing domain and application settings\n4. Controlling thread and CPU usage\n\nThe singleton pattern used for ConfigMgr ensures that configuration is consistently available throughout the application, while the thread-safe implementation supports concurrent access."])</script><script>self.__next_f.push([1,"2a:T1f8f,"])</script><script>self.__next_f.push([1,"# Logging System\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [CMakeLists.txt](CMakeLists.txt)\n- [src/base/Logger.cc](src/base/Logger.cc)\n- [src/base/Logger.h](src/base/Logger.h)\n- [src/base/StringUtils.cc](src/base/StringUtils.cc)\n- [src/base/StringUtils.h](src/base/StringUtils.h)\n- [src/main/CMakeLists.txt](src/main/CMakeLists.txt)\n- [src/main/TestLog.cc](src/main/TestLog.cc)\n- [src/mmedia/base/Packet.cc](src/mmedia/base/Packet.cc)\n- [src/mmedia/base/Packet.h](src/mmedia/base/Packet.h)\n- [src/mmedia/rtmp/RtmpClient.cc](src/mmedia/rtmp/RtmpClient.cc)\n- [src/mmedia/tests/RtmpClientTest.cpp](src/mmedia/tests/RtmpClientTest.cpp)\n- [src/network/TestContext.cc](src/network/TestContext.cc)\n\n\u003c/details\u003e\n\n\n\nThe StreamMediaServer includes a centralized logging system designed to provide consistent logging capabilities across all components of the application. This document details the architecture, configuration, and usage of the logging system.\n\n## Architecture Overview\n\nThe logging system is built around several core components that work together to capture, format, and store log messages.\n\n```mermaid\nclassDiagram\n    class Logger {\n        -level_: LogLevel\n        -log_: FileLogPtr\n        +Logger(file_log)\n        +SetLogLevel(level)\n        +GetLogLevel()\n        +Write(msg)\n    }\n    \n    class FileLog {\n        +WriteLog(msg)\n        +setRotate(type)\n    }\n    \n    class FileMgr {\n        +GetFileLog(path)\n        +OnCheck()\n    }\n    \n    class LogStream {\n        +operator\u003c\u003c(T)\n    }\n    \n    class TaskMgr {\n        +Add(task)\n        +OnWork()\n    }\n    \n    Logger --\u003e FileLog : \"uses\"\n    FileMgr --\u003e FileLog : \"manages\"\n    LogStream --\u003e Logger : \"writes to\"\n    TaskMgr --\u003e FileMgr : \"checks periodically\"\n```\n\n**Diagram: Logging System Class Structure**\n\nSources: [src/base/Logger.h](), [src/base/Logger.cc](), [src/main/TestLog.cc]()\n\n## Core Components\n\n### Logger\n\nThe `Logger` class is the central component of the logging system. It manages log levels and handles writing log messages to the appropriate destination.\n\n- **Constructor**: Takes a `FileLogPtr` to specify the log destination\n- **SetLogLevel/GetLogLevel**: Controls which messages are processed based on severity\n- **Write**: Sends formatted message to the output destination (file or console)\n\nSources: [src/base/Logger.h:16-29](), [src/base/Logger.cc:5-25]()\n\n### LogLevel Enumeration\n\nThe system defines five log levels to categorize messages by their importance:\n\n```mermaid\ngraph TD\n    TRACE[\"kTrace (0)\"] --\u003e DEBUG[\"kDebug (1)\"]\n    DEBUG --\u003e INFO[\"kInfo (2)\"]\n    INFO --\u003e WARN[\"kWarn (3)\"]\n    WARN --\u003e ERROR[\"kError (4)\"]\n```\n\n**Diagram: Log Level Hierarchy**\n\nSources: [src/base/Logger.h:8-15]()\n\nWhen a log level is set, only messages at that level or higher will be processed. For example, setting the level to `kWarn` will only show warning and error messages, while ignoring debug and info messages.\n\n### FileLog\n\nThe `FileLog` class handles writing log messages to disk files. It supports:\n\n- Writing formatted log messages to files\n- Log file rotation based on time or size constraints\n- Management through the `FileMgr` singleton\n\nSources: [src/main/TestLog.cc:24-25]()\n\n### FileMgr\n\nThe `FileMgr` singleton manages `FileLog` instances across the application:\n\n- Creates and provides access to log files via `GetFileLog`\n- Periodically checks log files for rotation via `OnCheck`\n- Integrates with the TaskMgr for scheduled operations\n\nSources: [src/main/TestLog.cc:24-32]()\n\n## Logging Flow\n\nThe following diagram illustrates how log messages flow through the system:\n\n```mermaid\nsequenceDiagram\n    participant App as \"Application Code\"\n    participant Macro as \"LOG_XXX Macro\"\n    participant Stream as \"LogStream\"\n    participant Logger as \"Logger\"\n    participant File as \"FileLog\"\n    \n    App-\u003e\u003eMacro: LOG_INFO \u003c\u003c \"message\"\n    Macro-\u003e\u003eStream: Create LogStream(INFO)\n    Stream-\u003e\u003eLogger: Check if level enabled\n    Stream-\u003e\u003eStream: Format message\n    Stream-\u003e\u003eLogger: Write(formatted message)\n    Logger-\u003e\u003eFile: WriteLog(message)\n    File-\u003e\u003eFile: Write to disk\n```\n\n**Diagram: Log Message Flow**\n\nSources: [src/main/TestLog.cc:16-18](), [src/base/Logger.cc:17-24]()\n\n## Usage Examples\n\n### Basic Logging\n\nThe system provides stream-like syntax for logging through macros:\n\n```cpp\nLOG_INFO \u003c\u003c \"info now :\" \u003c\u003c TTime::NowMs();\nLOG_DEBUG \u003c\u003c \"debug now\" \u003c\u003c TTime::NowMs();\n```\n\nSources: [src/main/TestLog.cc:16-17]()\n\n### Component-Specific Logging\n\nDifferent components can have their own logging macros to help categorize logs by module:\n\n```cpp\nRTMP_ERROR \u003c\u003c \"message parse error.\";\nRTMP_ERROR \u003c\u003c \"invalid url: \" \u003c\u003c url_;\n```\n\nSources: [src/mmedia/rtmp/RtmpClient.cc:55-56](), [src/mmedia/rtmp/RtmpClient.cc:114]()\n\n### Setting Up the Logger\n\n```cpp\n// Create a file log with rotation\nFileLogPtr log = sFileMgr-\u003eGetFileLog(\"test.log\");\nlog-\u003esetRotate(kRotateMinute);\n\n// Initialize the global logger\ng_logger = new Logger(log);\ng_logger-\u003eSetLogLevel(kTrace);\n```\n\nSources: [src/main/TestLog.cc:24-27]()\n\n### Log Rotation Management\n\nLog rotation is handled automatically through integration with the `TaskMgr`:\n\n```cpp\n// Create a periodic task to check for log rotation\nTaskPtr task = std::make_shared\u003cTask\u003e([](const TaskPtr \u0026task){\n  sFileMgr-\u003eOnCheck();\n  task-\u003eRestart();\n}, 1000);  // Check every 1000ms\n\n// Add the task to the task manager\nsTaskMgr-\u003eAdd(task);\n```\n\nSources: [src/main/TestLog.cc:28-33]()\n\n## Log Rotation Types\n\nThe system supports different rotation strategies:\n\n- **Time-based rotation**: Rotate logs based on time intervals (e.g., minute, hour, day)\n  - Example: `log-\u003esetRotate(kRotateMinute);`\n  \n- **Size-based rotation**: (May be supported but not shown in provided code samples)\n\nSources: [src/main/TestLog.cc:25]()\n\n## Integration with Other Systems\n\nThe logging system is designed to work seamlessly with other components of the StreamMediaServer:\n\n### Task Manager Integration\n\nThe logging system uses the TaskMgr for periodic operations like checking for log rotation conditions.\n\nSources: [src/main/TestLog.cc:28-33]()\n\n### Component Usage\n\nVarious components throughout the server use the logging system:\n- RTMP module uses component-specific logging via `RTMP_ERROR`\n- Core modules use standard logging via `LOG_INFO`, `LOG_DEBUG`, etc.\n\nSources: [src/mmedia/rtmp/RtmpClient.cc:55-56](), [src/mmedia/rtmp/RtmpClient.cc:114](), [src/main/TestLog.cc:16-17]()\n\n## Configuration\n\nThe logging system can be configured in several ways:\n\n### Log Levels\n\nSet the global log level to control verbosity:\n```cpp\ng_logger-\u003eSetLogLevel(kTrace);  // Most verbose\ng_logger-\u003eSetLogLevel(kDebug);  // Development level\ng_logger-\u003eSetLogLevel(kInfo);   // Production level\ng_logger-\u003eSetLogLevel(kWarn);   // Warning level\ng_logger-\u003eSetLogLevel(kError);  // Error level only\n```\n\nSources: [src/base/Logger.h:8-15](), [src/main/TestLog.cc:27]()\n\n### Log Destination\n\nLogs can be directed to:\n- File: By providing a `FileLogPtr` to the Logger constructor\n- Console: By providing a null `FileLogPtr` (output goes to stdout)\n\nSources: [src/base/Logger.cc:17-24]()\n\n## Best Practices\n\n1. **Use appropriate log levels**: \n   - `kTrace`: For extremely detailed debugging\n   - `kDebug`: For development information\n   - `kInfo`: For operational events\n   - `kWarn`: For potential issues\n   - `kError`: For actual errors\n\n2. **Include context**: Always include relevant context in log messages (e.g., connection IDs, session names)\n\n3. **Configure rotation**: Set up proper log rotation to prevent disk space issues\n\n4. **Use component-specific logging**: Create component-specific logging macros for better categorization\n\n## Summary\n\nThe StreamMediaServer logging system provides a flexible, centralized approach to logging across all server components. Through its hierarchical log levels, file rotation capabilities, and integration with the task management system, it offers both development-time debugging support and production-time operational monitoring."])</script><script>self.__next_f.push([1,"16:[\"$\",\"$L17\",null,{\"repoName\":\"Algorithm-zh/StreamMediaServer\",\"wiki\":{\"metadata\":{\"repo_name\":\"Algorithm-zh/StreamMediaServer\",\"commit_hash\":\"99517f48\",\"generated_at\":\"2025-04-30T07:41:40.785568\"},\"pages\":[{\"page_plan\":{\"id\":\"1\",\"title\":\"StreamMediaServer Overview\"},\"content\":\"$18\"},{\"page_plan\":{\"id\":\"1.1\",\"title\":\"Architecture Overview\"},\"content\":\"$19\"},{\"page_plan\":{\"id\":\"1.2\",\"title\":\"Build System\"},\"content\":\"$1a\"},{\"page_plan\":{\"id\":\"2\",\"title\":\"Network Layer\"},\"content\":\"$1b\"},{\"page_plan\":{\"id\":\"2.1\",\"title\":\"Event Loop System\"},\"content\":\"$1c\"},{\"page_plan\":{\"id\":\"2.2\",\"title\":\"TCP Server and Client\"},\"content\":\"$1d\"},{\"page_plan\":{\"id\":\"2.3\",\"title\":\"DNS Service\"},\"content\":\"$1e\"},{\"page_plan\":{\"id\":\"3\",\"title\":\"Media Processing System\"},\"content\":\"$1f\"},{\"page_plan\":{\"id\":\"3.1\",\"title\":\"RTMP Protocol Implementation\"},\"content\":\"$20\"},{\"page_plan\":{\"id\":\"3.2\",\"title\":\"HTTP Protocol Implementation\"},\"content\":\"$21\"},{\"page_plan\":{\"id\":\"3.3\",\"title\":\"Media Demuxing\"},\"content\":\"$22\"},{\"page_plan\":{\"id\":\"4\",\"title\":\"Live Streaming System\"},\"content\":\"$23\"},{\"page_plan\":{\"id\":\"4.1\",\"title\":\"LiveService\"},\"content\":\"$24\"},{\"page_plan\":{\"id\":\"4.2\",\"title\":\"Session Management\"},\"content\":\"$25\"},{\"page_plan\":{\"id\":\"4.3\",\"title\":\"User Management\"},\"content\":\"$26\"},{\"page_plan\":{\"id\":\"4.4\",\"title\":\"Stream and GOP Management\"},\"content\":\"$27\"},{\"page_plan\":{\"id\":\"5\",\"title\":\"Configuration and Logging\"},\"content\":\"$28\"},{\"page_plan\":{\"id\":\"5.1\",\"title\":\"Configuration System\"},\"content\":\"$29\"},{\"page_plan\":{\"id\":\"5.2\",\"title\":\"Logging System\"},\"content\":\"$2a\"}]},\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]\n"])</script><script>self.__next_f.push([1,"c:null\n10:[[\"$\",\"title\",\"0\",{\"children\":\"Algorithm-zh/StreamMediaServer | DeepWiki\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"StreamMediaServer is a multimedia streaming system that supports multiple streaming protocols for live media distribution. This document introduces the system architecture, key components, and their i\"}],[\"$\",\"meta\",\"2\",{\"property\":\"og:title\",\"content\":\"Algorithm-zh/StreamMediaServer | DeepWiki\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:description\",\"content\":\"StreamMediaServer is a multimedia streaming system that supports multiple streaming protocols for live media distribution. This document introduces the system architecture, key components, and their i\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:url\",\"content\":\"https://deepwiki.com/Algorithm-zh/StreamMediaServer\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:site_name\",\"content\":\"DeepWiki\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"7\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"8\",{\"name\":\"twitter:title\",\"content\":\"Algorithm-zh/StreamMediaServer | DeepWiki\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:description\",\"content\":\"StreamMediaServer is a multimedia streaming system that supports multiple streaming protocols for live media distribution. This document introduces the system architecture, key components, and their i\"}],[\"$\",\"link\",\"10\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"48x48\"}],[\"$\",\"link\",\"11\",{\"rel\":\"icon\",\"href\":\"/icon.png?66aaf51e0e68c818\",\"type\":\"image/png\",\"sizes\":\"16x16\"}],[\"$\",\"link\",\"12\",{\"rel\":\"apple-touch-icon\",\"href\":\"/apple-icon.png?a4f658907db0ab87\",\"type\":\"image/png\",\"sizes\":\"180x180\"}]]\n"])</script><next-route-announcer style="position: absolute;"></next-route-announcer><iframe id="_hjSafeContext_68052959" title="_hjSafeContext" tabindex="-1" aria-hidden="true" src="%E7%AE%97%E6%B3%95-ZH_streamMediaserver%20_%20Deepwiki_files/a.html" style="display: none !important; width: 1px !important; height: 1px !important; opacity: 0 !important; pointer-events: none !important;"></iframe></body><div style="all: initial;"><div style="all: initial;" id="__hcfy__"></div></div></html>